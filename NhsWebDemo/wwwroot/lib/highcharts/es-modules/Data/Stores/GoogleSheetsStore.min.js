"use strict";var __extends=this&&this.__extends||function(){var r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o])})(e,t)};return function(e,t){function o(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(o.prototype=t.prototype,new o)}}();import DataStore from"./DataStore.js";import GoogleSheetsParser from"../Parsers/GoogleSheetsParser.js";import HU from"../../Core/HttpUtilities.js";var ajax=HU.ajax;import U from"../../Core/Utilities.js";var merge=U.merge,GoogleSheetsStore=function(r){function s(e,t,o){e=r.call(this,e)||this;return e.options=merge(s.defaultOptions,t),e.parser=o||new GoogleSheetsParser({firstRowAsNames:e.options.firstRowAsNames}),e}return __extends(s,r),s.prototype.fetchSheet=function(o){var r=this,e=r.options,t=e.enablePolling,s=e.dataRefreshRate,a=["https://spreadsheets.google.com/feeds/cells",e.googleSpreadsheetKey,e.worksheet,"public/values?alt=json"].join("/");r.table.deleteColumns(),r.emit({type:"load",detail:o,table:r.table,url:a}),ajax({url:a,dataType:"json",success:function(e){r.parser.parse(e),r.table.setColumns(r.parser.getTable().getColumns()),t&&setTimeout(function(){r.fetchSheet()},1e3*s),r.emit({type:"afterLoad",detail:o,table:r.table,url:a})},error:function(e,t){r.emit({type:"loadError",detail:o,error:t,table:r.table,xhr:e})}})},s.prototype.load=function(e){this.options.googleSpreadsheetKey&&this.fetchSheet(e)},s.defaultOptions={googleSpreadsheetKey:"",worksheet:1,enablePolling:!1,dataRefreshRate:2,firstRowAsNames:!0},s}(DataStore);DataStore.addStore(GoogleSheetsStore);export default GoogleSheetsStore;