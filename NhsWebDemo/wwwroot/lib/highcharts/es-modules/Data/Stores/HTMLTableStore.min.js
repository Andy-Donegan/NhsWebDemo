"use strict";var __extends=this&&this.__extends||function(){var r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)e.hasOwnProperty(o)&&(t[o]=e[o])})(t,e)};return function(t,e){function o(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}}();import DataStore from"./DataStore.js";import DataTable from"../DataTable.js";import H from"../../Core/Globals.js";var win=H.win;import HTMLTableParser from"../Parsers/HTMLTableParser.js";import U from"../../Core/Utilities.js";var merge=U.merge,objectEach=U.objectEach,HTMLTableStore=function(r){function a(t,e,o){void 0===t&&(t=new DataTable),void 0===e&&(e={});t=r.call(this,t)||this;return t.tableElement=null,t.options=merge(a.defaultOptions,e),t.parserOptions=t.options,t.parser=o||new HTMLTableParser(t.options,t.tableElement),t}return __extends(a,r),a.prototype.fetchTable=function(){var t,e=this,o=e.options.table;"string"==typeof o?(e.tableID=o,t=win.document.getElementById(o)):e.tableID=(t=o).id,e.tableElement=t},a.prototype.load=function(t){var e=this;e.fetchTable(),e.table.deleteColumns(),e.emit({type:"load",detail:t,table:e.table,tableElement:e.tableElement}),e.tableElement?(e.parser.parse(merge({tableHTML:e.tableElement},e.options),t),e.table.setColumns(e.parser.getTable().getColumns()),e.emit({type:"afterLoad",detail:t,table:e.table,tableElement:e.tableElement})):e.emit({type:"loadError",detail:t,error:"HTML table not provided, or element with ID not found",table:e.table})},a.prototype.getHTMLTableForExport=function(t){var e,o=t=void 0===t?{}:t,n=o.useLocalDecimalPoint?1.1.toLocaleString()[1]:".",r=!1!==this.parserOptions.firstRowAsNames,p=o.useMultiLevelHeaders,u=o.useRowspanHeaders,c=function(t,e){var o=t.length;if(e.length!==o)return!1;for(;o--;)if(t[o]!==e[o])return!1;return!0},a=function(t,e,o){var r,a,n="<thead>",l=0,i=o||e&&e.length,s=0;if(p&&t&&e&&!c(t,e)){for(n+="<tr>";l<i;++l)(r=t[l])===t[l+1]?++s:s?(n+=b("th","highcharts-table-topheading",'scope="col" colspan="'+(s+1)+'"',r),s=0):(r===e[l]?u?(a=2,delete e[l]):(a=1,e[l]=""):a=1,n+=b("th","highcharts-table-topheading",'scope="col"'+(1<a?' valign="top" rowspan="'+a+'"':""),r));n+="</tr>"}if(e){for(n+="<tr>",l=0,i=e.length;l<i;++l)void 0!==e[l]&&(n+=b("th",null,'scope="col"',e[l]));n+="</tr>"}return n+="</thead>"},b=function(t,e,o,r){var a=r,e="text"+(e?" "+e:"");return"number"==typeof a?(a=a.toString(),","===n&&(a=a.replace(".",n)),e="number"):r||(a="",e="empty"),"<"+t+(o?" "+o:"")+' class="'+e+'">'+a+"</"+t+">"},t=this.getColumnsForExport(o.usePresentationOrder),l=t.columnNames,i=t.columnValues,s=[],f=l.length,h=[],t="";r&&(e=[],t=p?(i.forEach(function(t){t=(t.shift()||"").toString();e.push(t)}),a(l,e)):a(null,l));for(var m=0;m<f;m++){var d=l[m],g=i[m],v=g.length,d=this.whatIs(d);d&&d.dataType;for(var T=0;T<v;T++){var y=g[T];h[T]||(h[T]=[]),"string"!=typeof y&&"number"!=typeof y&&void 0!==y&&(y=(y||"").toString()),h[T][m]=b(m?"td":"th",null,m?"":'scope="row"',y),m===f-1&&s.push("<tr>"+h[T].join("")+"</tr>")}}a="";return"<table>"+(a=o.tableCaption?'<caption class="highcharts-table-caption">'+o.tableCaption+"</caption>":a)+t+"<tbody>"+s.join("")+"</tbody></table>"},a.prototype.save=function(t,e){var o=a.defaultExportOptions;return objectEach(this.parserOptions,function(t,e){e in o&&(o[e]=t)}),this.getHTMLTableForExport(merge(o,t))},a.defaultOptions={table:""},a.defaultExportOptions={decimalPoint:null,exportIDColumn:!1,useRowspanHeaders:!0,useMultiLevelHeaders:!0},a}(DataStore);DataStore.addStore(HTMLTableStore);export default HTMLTableStore;