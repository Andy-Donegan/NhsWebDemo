"use strict";import H from"../Core/Globals.js";var win=H.win,delay=setTimeout,DataPromise=function(){function s(e){if(this.jobs=[],this.state=s.State.Pending,this.value=void 0,win.Promise&&!s.onlyPolyfill)return new win.Promise(e);var t=this;delay(function(){try{e(function(e){return t.resolved(e)},function(e){return t.rejected(e)})}catch(e){t.rejected(e)}},0)}return s.isPromiseLike=function(e){return"object"==typeof e&&null!==e&&"function"==typeof e.then},s.reject=function(n){return win.Promise&&!s.onlyPolyfill?win.Promise.reject(n):new s(function(e,t){return t(n)})},s.resolve=function(n){return win.Promise&&!s.onlyPolyfill?win.Promise.resolve(n):s.isPromiseLike(n)?new s(function(e,t){n.then(e,t)}):new s(function(e){return e(n)})},s.prototype.catch=function(e){return this.then(null,e)},s.prototype.rejected=function(e){var t=this;t.state===s.State.Pending&&(t.state=s.State.Rejected,t.reason=e,delay(function(){return t.work()},0))},s.prototype.resolved=function(e){var t=this;t.state===s.State.Pending&&(s.isPromiseLike(e)?e.then(function(e){return t.resolved(e)},function(e){return t.rejected(e)}):(t.state=s.State.Fulfilled,t.value=e,delay(function(){return t.work()},0)))},s.prototype.then=function(n,r){function o(t){if(r)try{var e=r(t);return void(e instanceof s?e.then(function(e){return i.resolved(e)},function(e){return i.rejected(e)}):i.resolved(e))}catch(e){t=e}if(!i.jobs.length)throw t||new Error("Unhandled exception");i.rejected(t)}function e(e){if(n)try{var t=n(e);t instanceof s?t.then(function(e){return i.resolved(e)},function(e){return i.rejected(e)}):i.resolved(t)}catch(e){o(e)}else i.resolved(e)}var t=this,i=new s(function(){});switch(t.state){case s.State.Fulfilled:e(t.value);break;case s.State.Rejected:o(t.reason);break;default:t.jobs.push({resolve:e,reject:o})}return i},s.prototype.work=function(){for(var e,t,n=this,r=n.jobs;e=r.shift();)try{n.state===s.State.Fulfilled?e.resolve(n.value):e.reject&&(t=!0,e.reject(n.reason))}catch(e){t=!1,n.reason=e,n.state=s.State.Rejected}if(!1===t)throw n.reason||new Error("Unhandled rejection")},s.onlyPolyfill=!1,s}();!function(e){(e=e.State||(e.State={}))[e.Fulfilled=2]="Fulfilled",e[e.Pending=0]="Pending",e[e.Rejected=1]="Rejected"}(DataPromise=DataPromise||{});export default DataPromise;