"use strict";import A from"../Animation/AnimationUtilities.js";var getDeferredAnimation=A.getDeferredAnimation;import F from"../FormatUtilities.js";var format=F.format;import U from"../Utilities.js";var DataLabel,defined=U.defined,extend=U.extend,fireEvent=U.fireEvent,isArray=U.isArray,merge=U.merge,objectEach=U.objectEach,pick=U.pick,splat=U.splat;!function(t){var a=[];function i(e,a,t,i,o){function r(t){c&&l.xAxis&&!L&&l.setDataLabelStartPos(e,a,o,u,t)}var n,s,l=this,d=this.chart,h=this.isCartesian&&d.inverted,c=this.enabledDataSorting,p=pick(e.dlBox&&e.dlBox.centerX,e.plotX,-9999),b=pick(e.plotY,-9999),f=a.getBBox(),g=t.rotation,y=t.align,u=d.isInsidePlot(p,Math.round(b),{inverted:h,paneCoordinates:!0,series:l}),L="justify"===pick(t.overflow,c?"none":"justify"),x=this.visible&&!1!==e.visible&&(e.series.forceDL||c&&!L||u||pick(t.inside,!!this.options.stacking)&&i&&d.isInsidePlot(p,h?i.x+1:i.y+i.height-1,{inverted:h,paneCoordinates:!0,series:l}));x&&(n=d.renderer.fontMetrics(d.styledMode?void 0:t.style.fontSize,a).b,i=extend({x:h?this.yAxis.len-b:p,y:Math.round(h?this.xAxis.len-p:b),width:0,height:0},i),extend(t,{width:f.width,height:f.height}),g?(L=!1,n=d.renderer.rotCorr(n,g),r(s={x:i.x+(t.x||0)+i.width/2+n.x,y:i.y+(t.y||0)+{top:0,middle:.5,bottom:1}[t.verticalAlign]*i.height}),a[o?"attr":"animate"](s).attr({align:y}),n=180<(n=(g+720)%360)&&n<360,"left"===y?s.y-=n?f.height:0:"center"===y?(s.x-=f.width/2,s.y-=f.height/2):"right"===y&&(s.x-=f.width,s.y-=n?0:f.height),a.placed=!0,a.alignAttr=s):(r(i),a.align(t,void 0,i),s=a.alignAttr),L&&0<=i.height?this.justifyDataLabel(a,t,s,f,i,o):pick(t.crop,!0)&&(x=d.isInsidePlot(s.x,s.y,{paneCoordinates:!0,series:l})&&d.isInsidePlot(s.x+f.width,s.y+f.height,{paneCoordinates:!0,series:l})),t.shape&&!g&&a[o?"attr":"animate"]({anchorX:h?d.plotWidth-e.plotY:e.plotX,anchorY:h?d.plotHeight-e.plotX:e.plotY})),o&&c&&(a.placed=!1),x||c&&!L||(a.hide(!0),a.placed=!1)}function o(){var p,b=this,f=b.chart,g=b.options,t=b.points,e=b.hasRendered||0,y=f.renderer,a=(i=g.dataLabels).animation,a=i.defer?getDeferredAnimation(f,a,b):{defer:0,duration:0},i=n(n(f.options.plotOptions&&f.options.plotOptions.series&&f.options.plotOptions.series.dataLabels,f.options.plotOptions&&f.options.plotOptions[b.type]&&f.options.plotOptions[b.type].dataLabels),i);fireEvent(this,"drawDataLabels"),(isArray(i)||i.enabled||b._hasPointLabels)&&((p=b.plotGroup("dataLabelsGroup","data-labels",e?"inherit":"hidden",i.zIndex||6)).attr({opacity:+e}),e||(e=b.dataLabelsGroup)&&(b.visible&&p.show(!0),e[g.animation?"animate":"attr"]({opacity:1},a)),t.forEach(function(c){splat(n(i,c.dlOptions||c.options&&c.options.dataLabels)).forEach(function(t,e){var a,i,o,r,n=t.enabled&&(!c.isNull||c.dataLabelOnNull)&&function(t,e){var a=e.filter;if(a){e=a.operator,t=t[a.property],a=a.value;return">"===e&&a<t||"<"===e&&t<a||">="===e&&a<=t||"<="===e&&t<=a||"=="===e&&t==a||"==="===e&&t===a?!0:!1}return!0}(c,t),s=c.connectors?c.connectors[e]:c.connector,l=c.dataLabels?c.dataLabels[e]:c.dataLabel,d=pick(t.distance,c.labelDistance),h=!l;n&&(o=c.getLabelConfig(),i=pick(t[c.formatPrefix+"Format"],t.format),a=defined(i)?format(i,o,f):(t[c.formatPrefix+"Formatter"]||t.formatter).call(o,t),i=t.style,o=t.rotation,f.styledMode||(i.color=pick(t.color,i.color,b.color,"#000000"),"contrast"===i.color?(c.contrastColor=y.getContrast(c.color||b.color),i.color=!defined(d)&&t.inside||d<0||g.stacking?c.contrastColor:"#000000"):delete c.contrastColor,g.cursor&&(i.cursor=g.cursor)),r={r:t.borderRadius||0,rotation:o,padding:t.padding,zIndex:1},f.styledMode||(r.fill=t.backgroundColor,r.stroke=t.borderColor,r["stroke-width"]=t.borderWidth),objectEach(r,function(t,e){void 0===t&&delete r[e]})),!l||n&&defined(a)&&!!l.div==!!t.useHTML||(c.dataLabel=l=c.dataLabel&&c.dataLabel.destroy(),c.dataLabels&&(1===c.dataLabels.length?delete c.dataLabels:delete c.dataLabels[e]),e||delete c.dataLabel,s&&(c.connector=c.connector.destroy(),c.connectors&&(1===c.connectors.length?delete c.connectors:delete c.connectors[e]))),n&&defined(a)&&(l?r.text=a:(c.dataLabels=c.dataLabels||[],l=c.dataLabels[e]=o?y.text(a,0,-9999,t.useHTML).addClass("highcharts-data-label"):y.label(a,0,-9999,t.shape,null,null,t.useHTML,null,"data-label"),e||(c.dataLabel=l),l.addClass(" highcharts-data-label-color-"+c.colorIndex+" "+(t.className||"")+(t.useHTML?" highcharts-tracker":""))),l.options=t,l.attr(r),f.styledMode||l.css(i).shadow(t.shadow),l.added||l.add(p),t.textPath&&!t.useHTML&&(l.setTextPath(c.getDataLabelPath&&c.getDataLabelPath(l)||c.graphic,t.textPath),c.dataLabelPath&&!t.textPath.enabled&&(c.dataLabelPath=c.dataLabelPath.destroy())),b.alignDataLabel(c,l,t,null,h))})})),fireEvent(this,"afterDrawDataLabels")}function r(t,e,a,i,o,r){var n,s=this.chart,l=e.align,d=e.verticalAlign,h=!t.box&&t.padding||0,c=e.x,p=void 0===c?0:c,b=e.y,c=void 0===b?0:b,b=(a.x||0)+h;return b<0&&("right"===l&&0<=p?(e.align="left",e.inside=!0):p-=b,n=!0),(b=(a.x||0)+i.width-h)>s.plotWidth&&("left"===l&&p<=0?(e.align="right",e.inside=!0):p+=s.plotWidth-b,n=!0),(b=a.y+h)<0&&("bottom"===d&&0<=c?(e.verticalAlign="top",e.inside=!0):c-=b,n=!0),(b=(a.y||0)+i.height-h)>s.plotHeight&&("top"===d&&c<=0?(e.verticalAlign="bottom",e.inside=!0):c+=s.plotHeight-b,n=!0),n&&(e.x=p,e.y=c,t.placed=!r,t.align(e,void 0,o)),n}function n(e,a){var t,i=[];if(isArray(e)&&!isArray(a))i=e.map(function(t){return merge(t,a)});else if(isArray(a)&&!isArray(e))i=a.map(function(t){return merge(e,t)});else if(isArray(e)||isArray(a))for(t=Math.max(e.length,a.length);t--;)i[t]=merge(e[t],a[t]);else i=merge(e,a);return i}function s(t,e,a,i,o){var r=this.chart,n=r.inverted,s=this.xAxis,l=s.reversed,d=n?e.height/2:e.width/2,t=t.pointWidth,t=t?t/2:0;e.startXPos=n?o.x:l?-d-t:s.width-d+t,e.startYPos=n?l?this.yAxis.height-d+t:-d-t:o.y,i?"hidden"===e.visibility&&(e.show(),e.attr({opacity:0}).animate({opacity:1})):e.attr({opacity:1}).animate({opacity:0},void 0,e.hide),r.hasRendered&&(a&&e.attr({x:e.startXPos,y:e.startYPos}),e.placed=!0)}t.compose=function(t){var e;-1===a.indexOf(t)&&(e=t.prototype,a.push(t),e.alignDataLabel=i,e.drawDataLabels=o,e.justifyDataLabel=r,e.setDataLabelStartPos=s)}}(DataLabel=DataLabel||{});export default DataLabel;