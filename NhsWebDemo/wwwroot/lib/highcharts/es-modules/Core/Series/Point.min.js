"use strict";import AST from"../Renderer/HTML/AST.js";import A from"../Animation/AnimationUtilities.js";var animObject=A.animObject;import D from"../DefaultOptions.js";var defaultOptions=D.defaultOptions;import F from"../FormatUtilities.js";var format=F.format;import U from"../Utilities.js";var addEvent=U.addEvent,defined=U.defined,erase=U.erase,extend=U.extend,fireEvent=U.fireEvent,getNestedProperty=U.getNestedProperty,isArray=U.isArray,isFunction=U.isFunction,isNumber=U.isNumber,isObject=U.isObject,merge=U.merge,objectEach=U.objectEach,pick=U.pick,syncTimeout=U.syncTimeout,removeEvent=U.removeEvent,uniqueKey=U.uniqueKey,Point=function(){function l(){this.category=void 0,this.colorIndex=void 0,this.formatPrefix="point",this.id=void 0,this.isNull=!1,this.name=void 0,this.options=void 0,this.percentage=void 0,this.selected=!1,this.series=void 0,this.total=void 0,this.visible=!0,this.x=void 0}return l.prototype.animateBeforeDestroy=function(){var e=this,o={x:e.startXPos,opacity:0},t=e.getGraphicalProps();t.singular.forEach(function(t){e[t]=e[t].animate("dataLabel"===t?{x:e[t].startXPos,y:e[t].startYPos,opacity:0}:o)}),t.plural.forEach(function(t){e[t].forEach(function(t){t.element&&t.animate(extend({x:e.startXPos},t.startYPos?{x:t.startXPos,y:t.startYPos}:{}))})})},l.prototype.applyOptions=function(t,e){var o=this,i=o.series,s=i.options.pointValKey||i.pointValKey;return t=l.prototype.optionsToObject.call(this,t),extend(o,t),o.options=o.options?extend(o.options,t):t,t.group&&delete o.group,t.dataLabels&&delete o.dataLabels,s&&(o.y=l.prototype.getNestedProperty.call(o,s)),o.isNull=pick(o.isValid&&!o.isValid(),null===o.x||!isNumber(o.y)),o.formatPrefix=o.isNull?"null":"point",o.selected&&(o.state="select"),"name"in o&&void 0===e&&i.xAxis&&i.xAxis.hasNames&&(o.x=i.xAxis.nameToX(o)),void 0===o.x&&i?o.x=void 0===e?i.autoIncrement():e:isNumber(t.x)&&i.options.relativeXValue&&(o.x=i.autoIncrement(t.x)),o},l.prototype.destroy=function(){var t,e=this,o=e.series,i=o.chart,s=o.options.dataSorting,r=i.hoverPoints,o=e.series.chart.renderer.globalAnimation,o=animObject(o);function n(){for(t in(e.graphic||e.dataLabel||e.dataLabels)&&(removeEvent(e),e.destroyElements()),e)e[t]=null}e.legendItem&&i.legend.destroyItem(e),r&&(e.setState(),erase(r,e),r.length||(i.hoverPoints=null)),e===i.hoverPoint&&e.onMouseOut(),s&&s.enabled?(this.animateBeforeDestroy(),syncTimeout(n,o.duration)):n(),i.pointCount--},l.prototype.destroyElements=function(t){var e=this,t=e.getGraphicalProps(t);t.singular.forEach(function(t){e[t]=e[t].destroy()}),t.plural.forEach(function(t){e[t].forEach(function(t){t.element&&t.destroy()}),delete e[t]})},l.prototype.firePointEvent=function(t,e,o){var i=this,s=this.series.options;(s.point.events[t]||i.options&&i.options.events&&i.options.events[t])&&i.importEvents(),"click"===t&&s.allowPointSelect&&(o=function(t){i.select&&i.select(null,t.ctrlKey||t.metaKey||t.shiftKey)}),fireEvent(i,t,e,o)},l.prototype.getClassName=function(){var t=this;return"highcharts-point"+(t.selected?" highcharts-point-select":"")+(t.negative?" highcharts-negative":"")+(t.isNull?" highcharts-null-point":"")+(void 0!==t.colorIndex?" highcharts-color-"+t.colorIndex:"")+(t.options.className?" "+t.options.className:"")+(t.zone&&t.zone.className?" "+t.zone.className.replace("highcharts-negative",""):"")},l.prototype.getGraphicalProps=function(o){var t,e,i=this,s=[],r={singular:[],plural:[]};for((o=o||{graphic:1,dataLabel:1}).graphic&&s.push("graphic","upperGraphic","shadowGroup"),o.dataLabel&&s.push("dataLabel","dataLabelUpper","connector"),e=s.length;e--;)t=s[e],i[t]&&r.singular.push(t);return["dataLabel","connector"].forEach(function(t){var e=t+"s";o[t]&&i[e]&&r.plural.push(e)}),r},l.prototype.getLabelConfig=function(){return{x:this.category,y:this.y,color:this.color,colorIndex:this.colorIndex,key:this.name||this.category,series:this.series,point:this,percentage:this.percentage,total:this.total||this.stackTotal}},l.prototype.getNestedProperty=function(t){if(t)return 0===t.indexOf("custom.")?getNestedProperty(t,this.options):this[t]},l.prototype.getZone=function(){for(var t=this.series,e=t.zones,o=t.zoneAxis||"y",i=0,s=e[i];this[o]>=s.value;)s=e[++i];return this.nonZonedColor||(this.nonZonedColor=this.color),s&&s.color&&!this.options.color?this.color=s.color:this.color=this.nonZonedColor,s},l.prototype.hasNewShapeType=function(){return(this.graphic&&(this.graphic.symbolName||this.graphic.element.nodeName))!==this.shapeType},l.prototype.init=function(t,e,o){return this.series=t,this.applyOptions(e,o),this.id=defined(this.id)?this.id:uniqueKey(),this.resolveColor(),t.chart.pointCount++,fireEvent(this,"afterInit"),this},l.prototype.optionsToObject=function(t){var e,o=this.series,i=o.options.keys,s=i||o.pointArrayMap||["y"],r=s.length,n={},a=0,c=0;if(isNumber(t)||null===t)n[s[0]]=t;else if(isArray(t))for(!i&&t.length>r&&("string"==(e=typeof t[0])?n.name=t[0]:"number"==e&&(n.x=t[0]),a++);c<r;)i&&void 0===t[a]||(0<s[c].indexOf(".")?l.prototype.setNestedProperty(n,t[a],s[c]):n[s[c]]=t[a]),a++,c++;else"object"==typeof t&&((n=t).dataLabels&&(o._hasPointLabels=!0),t.marker&&(o._hasPointMarkers=!0));return n},l.prototype.resolveColor=function(){var t,e,o=this.series,i=o.chart.options.chart,s=o.chart.styledMode,i=i.colorCount;delete this.nonZonedColor,o.options.colorByPoint?(s||(t=(e=o.options.colors||o.chart.options.colors)[o.colorCounter],i=e.length),e=o.colorCounter,o.colorCounter++,o.colorCounter===i&&(o.colorCounter=0)):(s||(t=o.color),e=o.colorIndex),this.colorIndex=pick(this.options.colorIndex,e),this.color=pick(this.options.color,t)},l.prototype.setNestedProperty=function(t,s,e){return e.split(".").reduce(function(t,e,o,i){o=i.length-1===o;return t[e]=o?s:isObject(t[e],!0)?t[e]:{},t[e]},t),t},l.prototype.tooltipFormatter=function(e){var t=this.series,o=t.tooltipOptions,i=pick(o.valueDecimals,""),s=o.valuePrefix||"",r=o.valueSuffix||"";return t.chart.styledMode&&(e=t.chart.tooltip.styledModeFormat(e)),(t.pointArrayMap||["y"]).forEach(function(t){t="{point."+t,e=(e=s||r?e.replace(RegExp(t+"}","g"),s+t+"}"+r):e).replace(RegExp(t+"}","g"),t+":,."+i+"f}")}),format(e,{point:this,series:this.series},t.chart)},l.prototype.update=function(e,o,i,t){var s,r=this,n=r.series,a=r.graphic,c=n.chart,l=n.options;function p(){r.applyOptions(e);var t=a&&r.hasDummyGraphic,t=null===r.y?!t:t;a&&t&&(r.graphic=a.destroy(),delete r.hasDummyGraphic),isObject(e,!0)&&(a&&a.element&&e&&e.marker&&void 0!==e.marker.symbol&&(r.graphic=a.destroy()),e&&e.dataLabels&&r.dataLabel&&(r.dataLabel=r.dataLabel.destroy()),r.connector&&(r.connector=r.connector.destroy())),s=r.index,n.updateParallelArrays(r,s),l.data[s]=isObject(l.data[s],!0)||isObject(e,!0)?r.options:pick(e,l.data[s]),n.isDirty=n.isDirtyData=!0,!n.fixedBox&&n.hasCartesianSeries&&(c.isDirtyBox=!0),"point"===l.legendType&&(c.isDirtyLegend=!0),o&&c.redraw(i)}o=pick(o,!0),!1===t?p():r.firePointEvent("update",{options:e},p)},l.prototype.remove=function(t,e){this.series.removePoint(this.series.data.indexOf(this),t,e)},l.prototype.select=function(t,e){var o=this,i=o.series,s=i.chart;t=pick(t,!o.selected),this.selectedStaging=t,o.firePointEvent(t?"select":"unselect",{accumulate:e},function(){o.selected=o.options.selected=t,i.options.data[i.data.indexOf(o)]=o.options,o.setState(t&&"select"),e||s.getSelectedPoints().forEach(function(t){var e=t.series;t.selected&&t!==o&&(t.selected=t.options.selected=!1,e.options.data[e.data.indexOf(t)]=t.options,t.setState(s.hoverPoints&&e.options.inactiveOtherPoints?"inactive":""),t.firePointEvent("unselect"))})}),delete this.selectedStaging},l.prototype.onMouseOver=function(t){var e=this.series.chart,o=e.pointer;t=t?o.normalize(t):o.getChartCoordinatesFromPoint(this,e.inverted),o.runPointActions(t,this)},l.prototype.onMouseOut=function(){var t=this.series.chart;this.firePointEvent("mouseOut"),this.series.options.inactiveOtherPoints||(t.hoverPoints||[]).forEach(function(t){t.setState()}),t.hoverPoints=t.hoverPoint=null},l.prototype.importEvents=function(){var o,t;this.hasImportedEvents||(t=merge((o=this).series.options.point,o.options).events,o.events=t,objectEach(t,function(t,e){isFunction(t)&&addEvent(o,e,t)}),this.hasImportedEvents=!0)},l.prototype.setState=function(t,e){var o,i,s,r,n=this,a=n.series,c=n.state,l=a.options.states[t||"normal"]||{},p=defaultOptions.plotOptions[a.type].marker&&a.options.marker,h=p&&!1===p.enabled,d=p&&p.states&&p.states[t||"normal"]||{},u=!1===d.enabled,y=n.marker||{},m=a.chart,f=p&&a.markerAttribs,v=a.halo,g=a.stateMarkerGraphic;(t=t||"")===n.state&&!e||n.selected&&"select"!==t||!1===l.enabled||t&&(u||h&&!1===d.enabled)||t&&y.states&&y.states[t]&&!1===y.states[t].enabled||(n.state=t,f&&(o=a.markerAttribs(n,t)),n.graphic&&!n.hasDummyGraphic?(c&&n.graphic.removeClass("highcharts-point-"+c),t&&n.graphic.addClass("highcharts-point-"+t),m.styledMode||(i=a.pointAttribs(n,t),s=pick(m.options.chart.animation,l.animation),a.options.inactiveOtherPoints&&isNumber(i.opacity)&&((n.dataLabels||[]).forEach(function(t){t&&t.animate({opacity:i.opacity},s)}),n.connector&&n.connector.animate({opacity:i.opacity},s)),n.graphic.animate(i,s)),o&&n.graphic.animate(o,pick(m.options.chart.animation,d.animation,p.animation)),g&&g.hide()):(t&&d&&(r=y.symbol||a.symbol,g&&g.currentSymbol!==r&&(g=g.destroy()),o&&(g?g[e?"animate":"attr"]({x:o.x,y:o.y}):r&&(a.stateMarkerGraphic=g=m.renderer.symbol(r,o.x,o.y,o.width,o.height).add(a.markerGroup),g.currentSymbol=r)),!m.styledMode&&g&&"inactive"!==n.state&&g.attr(a.pointAttribs(n,t))),g&&(g[t&&n.isInside?"show":"hide"](),g.element.point=n,g.addClass(n.getClassName(),!0))),r=l.halo,g=(l=n.graphic||g)&&l.visibility||"inherit",r&&r.size&&l&&"hidden"!==g&&!n.isCluster?(v||(a.halo=v=m.renderer.path().add(l.parentGroup)),v.show()[e?"animate":"attr"]({d:n.haloPath(r.size)}),v.attr({class:"highcharts-halo highcharts-color-"+pick(n.colorIndex,a.colorIndex)+(n.className?" "+n.className:""),visibility:g,zIndex:-1}),v.point=n,m.styledMode||v.attr(extend({fill:n.color||a.color,"fill-opacity":r.opacity},AST.filterUserAttributes(r.attributes||{})))):v&&v.point&&v.point.haloPath&&v.animate({d:v.point.haloPath(0)},null,v.hide),fireEvent(n,"afterSetState",{state:t}))},l.prototype.haloPath=function(t){return this.series.chart.renderer.symbols.circle(Math.floor(this.plotX)-t,this.plotY-t,2*t,2*t)},l}();export default Point;