"use strict";import A from"../Animation/AnimationUtilities.js";var animObject=A.animObject,setAnimation=A.setAnimation;import D from"../DefaultOptions.js";var defaultOptions=D.defaultOptions;import F from"../Foundation.js";var registerEventOptions=F.registerEventOptions;import H from"../Globals.js";var hasTouch=H.hasTouch,svg=H.svg,win=H.win;import LegendSymbol from"../Legend/LegendSymbol.js";import Point from"./Point.js";import SeriesDefaults from"./SeriesDefaults.js";import SeriesRegistry from"./SeriesRegistry.js";var seriesTypes=SeriesRegistry.seriesTypes;import SVGElement from"../Renderer/SVG/SVGElement.js";import U from"../Utilities.js";var addEvent=U.addEvent,arrayMax=U.arrayMax,arrayMin=U.arrayMin,clamp=U.clamp,cleanRecursively=U.cleanRecursively,correctFloat=U.correctFloat,defined=U.defined,erase=U.erase,error=U.error,extend=U.extend,find=U.find,fireEvent=U.fireEvent,getNestedProperty=U.getNestedProperty,isArray=U.isArray,isNumber=U.isNumber,isString=U.isString,merge=U.merge,objectEach=U.objectEach,pick=U.pick,removeEvent=U.removeEvent,splat=U.splat,syncTimeout=U.syncTimeout,Series=function(){function t(){this._i=void 0,this.chart=void 0,this.data=void 0,this.eventOptions=void 0,this.eventsToUnbind=void 0,this.index=void 0,this.linkedSeries=void 0,this.options=void 0,this.points=void 0,this.processedXData=void 0,this.processedYData=void 0,this.tooltipOptions=void 0,this.userOptions=void 0,this.xAxis=void 0,this.yAxis=void 0,this.zones=void 0}return t.prototype.init=function(t,e){fireEvent(this,"init",{options:e});var i=this,r=t.series;this.eventsToUnbind=[],i.chart=t,i.options=i.setOptions(e);var o=i.options;i.linkedSeries=[],i.bindAxes(),extend(i,{name:o.name,state:"",visible:!1!==o.visible,selected:!0===o.selected}),registerEventOptions(this,o);var s,e=o.events;(e&&e.click||o.point&&o.point.events&&o.point.events.click||o.allowPointSelect)&&(t.runTrackerClick=!0),i.getColor(),i.getSymbol(),i.parallelArrays.forEach(function(t){i[t+"Data"]||(i[t+"Data"]=[])}),i.isCartesian&&(t.hasCartesianSeries=!0),r.length&&(s=r[r.length-1]),i._i=pick(s&&s._i,-1)+1,i.opacity=i.options.opacity,t.orderSeries(this.insert(r)),o.dataSorting&&o.dataSorting.enabled?i.setDataSortingOptions():i.points||i.data||i.setData(o.data,!1),fireEvent(this,"afterInit")},t.prototype.is=function(t){return seriesTypes[t]&&this instanceof seriesTypes[t]},t.prototype.insert=function(t){var e,i=this.options.index;if(isNumber(i)){for(e=t.length;e--;)if(i>=pick(t[e].options.index,t[e]._i)){t.splice(e+1,0,this);break}-1===e&&t.unshift(this),e+=1}else t.push(this);return pick(e,t.length-1)},t.prototype.bindAxes=function(){var r,o=this,s=o.options,t=o.chart;fireEvent(this,"bindAxes",null,function(){(o.axisTypes||[]).forEach(function(e){var i=0;t[e].forEach(function(t){r=t.options,(s[e]===i&&!r.isInternal||void 0!==s[e]&&s[e]===r.id||void 0===s[e]&&0===r.index)&&(o.insert(t.series),(o[e]=t).isDirty=!0),r.isInternal||i++}),o[e]||o.optionalAxis===e||error(18,!0,t)})}),fireEvent(this,"afterBindAxes")},t.prototype.updateParallelArrays=function(i,r){var o=i.series,e=arguments,t=isNumber(r)?function(t){var e="y"===t&&o.toYData?o.toYData(i):i[t];o[t+"Data"][r]=e}:function(t){Array.prototype[r].apply(o[t+"Data"],Array.prototype.slice.call(e,2))};o.parallelArrays.forEach(t)},t.prototype.hasData=function(){return this.visible&&void 0!==this.dataMax&&void 0!==this.dataMin||this.visible&&this.yData&&0<this.yData.length},t.prototype.autoIncrement=function(t){var e,i=this.options,r=i.pointIntervalUnit,o=i.relativeXValue,s=this.chart.time,a=this.xIncrement,a=pick(a,i.pointStart,0);return this.pointInterval=e=pick(this.pointInterval,i.pointInterval,1),o&&isNumber(t)&&(e*=t),r&&(i=new s.Date(a),"day"===r?s.set("Date",i,s.get("Date",i)+e):"month"===r?s.set("Month",i,s.get("Month",i)+e):"year"===r&&s.set("FullYear",i,s.get("FullYear",i)+e),e=i.getTime()-a),o&&isNumber(t)?a+e:(this.xIncrement=a+e,a)},t.prototype.setDataSortingOptions=function(){var t=this.options;extend(this,{requireSorting:!1,sorted:!1,enabledDataSorting:!0,allowDG:!1}),defined(t.pointRange)||(t.pointRange=1)},t.prototype.setOptions=function(t){var e=this.chart,i=e.options,r=i.plotOptions,o=e.userOptions||{},s=merge(t),a=e.styledMode,n={plotOptions:r,userOptions:s};fireEvent(this,"setOptions",n);var t=n.plotOptions[this.type],e=o.plotOptions||{};this.userOptions=n.userOptions;o=merge(t,r.series,o.plotOptions&&o.plotOptions[this.type],s);this.tooltipOptions=merge(defaultOptions.tooltip,defaultOptions.plotOptions.series&&defaultOptions.plotOptions.series.tooltip,defaultOptions.plotOptions[this.type].tooltip,i.tooltip.userOptions,r.series&&r.series.tooltip,r[this.type].tooltip,s.tooltip),this.stickyTracking=pick(s.stickyTracking,e[this.type]&&e[this.type].stickyTracking,e.series&&e.series.stickyTracking,!(!this.tooltipOptions.shared||this.noSharedTooltip)||o.stickyTracking),null===t.marker&&delete o.marker,this.zoneAxis=o.zoneAxis;e=this.zones=(o.zones||[]).slice();return!o.negativeColor&&!o.negativeFillColor||o.zones||(t={value:o[this.zoneAxis+"Threshold"]||o.threshold||0,className:"highcharts-negative"},a||(t.color=o.negativeColor,t.fillColor=o.negativeFillColor),e.push(t)),e.length&&defined(e[e.length-1].value)&&e.push(a?{}:{color:this.color,fillColor:this.fillColor}),fireEvent(this,"afterSetOptions",{options:o}),o},t.prototype.getName=function(){return pick(this.options.name,"Series "+(this.index+1))},t.prototype.getCyclic=function(t,e,i){var r,o,s=this.chart,a=this.userOptions,n=t+"Index",p=t+"Counter",h=i?i.length:pick(s.options.chart[t+"Count"],s[t+"Count"]);e||(o=pick(a[n],a["_"+n]),defined(o)?r=o:(s.series.length||(s[p]=0),a["_"+n]=r=s[p]%h,s[p]+=1),i&&(e=i[r])),void 0!==r&&(this[n]=r),this[t]=e},t.prototype.getColor=function(){this.chart.styledMode?this.getCyclic("color"):this.options.colorByPoint?this.color="#cccccc":this.getCyclic("color",this.options.color||defaultOptions.plotOptions[this.type].color,this.chart.options.colors)},t.prototype.getPointsCollection=function(){return(this.hasGroupedData?this.points:this.data)||[]},t.prototype.getSymbol=function(){var t=this.options.marker;this.getCyclic("symbol",t.symbol,this.chart.options.symbols)},t.prototype.findPointIndex=function(e,t){var i,r,o,s=e.id,a=e.x,n=this.points,p=this.options.dataSorting;if(s){var h=this.chart.get(s);h instanceof Point&&(i=h)}else if(this.linkedParent||this.enabledDataSorting||this.options.relativeXValue){h=function(t){return!t.touched&&t.index===e.index};if(p&&p.matchByName?h=function(t){return!t.touched&&t.name===e.name}:this.options.relativeXValue&&(h=function(t){return!t.touched&&t.options.x===e.x}),!(i=find(n,h)))return}return i&&void 0!==(o=i&&i.index)&&(r=!0),-1!==(o=void 0===o&&isNumber(a)?this.xData.indexOf(a,t):o)&&void 0!==o&&this.cropped&&(o=o>=this.cropStart?o-this.cropStart:o),o=!r&&isNumber(o)&&n[o]&&n[o].touched?void 0:o},t.prototype.updateData=function(t,e){var o,i,r,s,a=this.options,n=a.dataSorting,p=this.points,h=[],l=this.requireSorting,d=t.length===p.length,c=!0;if(this.xIncrement=null,t.forEach(function(t,e){var i=defined(t)&&this.pointClass.prototype.optionsToObject.call({series:this},t)||{},r=i.x;i.id||isNumber(r)?(-1===(i=this.findPointIndex(i,s))||void 0===i?h.push(t):p[i]&&t!==a.data[i]?(p[i].update(t,!1,null,!1),p[i].touched=!0,l&&(s=i+1)):p[i]&&(p[i].touched=!0),(!d||e!==i||n&&n.enabled||this.hasDerivedData)&&(o=!0)):h.push(t)},this),o)for(i=p.length;i--;)(r=p[i])&&!r.touched&&r.remove&&r.remove(!1,e);else!d||n&&n.enabled?c=!1:(t.forEach(function(t,e){t!==p[e].y&&p[e].update&&p[e].update(t,!1,null,!1)}),h.length=0);return p.forEach(function(t){t&&(t.touched=!1)}),!!c&&(h.forEach(function(t){this.addPoint(t,!1,null,null,!1)},this),null===this.xIncrement&&this.xData&&this.xData.length&&(this.xIncrement=arrayMax(this.xData),this.autoIncrement()),!0)},t.prototype.setData=function(t,e,i,r){var o,s,a,n=this,p=n.points,h=p&&p.length||0,l=n.options,d=n.chart,c=l.dataSorting,u=n.xAxis,f=l.turboThreshold,y=this.xData,v=this.yData,g=n.pointArrayMap,m=g&&g.length,x=l.keys,k=0,b=1,D=(t=t||[]).length;if(e=pick(e,!0),c&&c.enabled&&(t=this.sortData(t)),!(a=!1!==r&&D&&h&&!n.cropped&&!n.hasGroupedData&&n.visible&&!n.isSeriesBoosting?this.updateData(t,i):a)){if(n.xIncrement=null,n.colorCounter=0,this.parallelArrays.forEach(function(t){n[t+"Data"].length=0}),f&&f<D)if(g=n.getFirstValidPoint(t),isNumber(g))for(o=0;o<D;o++)y[o]=this.autoIncrement(),v[o]=t[o];else if(isArray(g))if(m)if(g.length===m)for(o=0;o<D;o++)y[o]=this.autoIncrement(),v[o]=t[o];else for(o=0;o<D;o++)s=t[o],y[o]=s[0],v[o]=s.slice(1,m+1);else if(x&&(k=0<=(k=x.indexOf("x"))?k:0,b=0<=(b=x.indexOf("y"))?b:1),k===(b=1===g.length?0:b))for(o=0;o<D;o++)y[o]=this.autoIncrement(),v[o]=t[o][b];else for(o=0;o<D;o++)s=t[o],y[o]=s[k],v[o]=s[b];else error(12,!1,d);else for(o=0;o<D;o++)void 0!==t[o]&&(n.pointClass.prototype.applyOptions.apply(s={series:n},[t[o]]),n.updateParallelArrays(s,o));for(v&&isString(v[0])&&error(14,!0,d),n.data=[],n.options.data=n.userOptions.data=t,o=h;o--;)p[o]&&p[o].destroy&&p[o].destroy();u&&(u.minRange=u.userMinRange),n.isDirty=d.isDirtyBox=!0,n.isDirtyData=!!p,i=!1}"point"===l.legendType&&(this.processData(),this.generatePoints()),e&&d.redraw(i)},t.prototype.sortData=function(o){function s(t,e){return defined(e)&&t.pointClass.prototype.optionsToObject.call({series:t},e)||{}}var i=this,r=i.options.dataSorting.sortKey||"y";return o.forEach(function(t,e){o[e]=s(i,t),o[e].index=e},this),o.concat().sort(function(t,e){t=getNestedProperty(r,t),e=getNestedProperty(r,e);return e<t?-1:t<e?1:0}).forEach(function(t,e){t.x=e},this),i.linkedSeries&&i.linkedSeries.forEach(function(i){var t=i.options,r=t.data;t.dataSorting&&t.dataSorting.enabled||!r||(r.forEach(function(t,e){r[e]=s(i,t),o[e]&&(r[e].x=o[e].x,r[e].index=e)}),i.setData(r,!1))}),o},t.prototype.getProcessedData=function(t){var e,i,r,o,s,a,n=this,p=n.xAxis,h=n.options,l=h.cropThreshold,d=t||n.getExtremesFromAll||h.getExtremesFromAll,c=n.isCartesian,u=p&&p.val2lin,f=!(!p||!p.logarithmic),y=0,v=n.xData,t=n.yData,g=n.requireSorting,m=!1,h=v.length;for(p&&(s=(a=p.getExtremes()).min,a=a.max,m=p.categories&&!p.names.length),c&&n.sorted&&!d&&(!l||l<h||n.forceCrop)&&(v[h-1]<s||v[0]>a?(v=[],t=[]):n.yData&&(v[0]<s||v[h-1]>a)&&(v=(e=this.cropData(n.xData,n.yData,s,a)).xData,t=e.yData,y=e.start,e=!0)),o=v.length||1;--o;)0<(i=f?u(v[o])-u(v[o-1]):v[o]-v[o-1])&&(void 0===r||i<r)?r=i:i<0&&g&&!m&&(error(15,!1,n.chart),g=!1);return{xData:v,yData:t,cropped:e,cropStart:y,closestPointRange:r}},t.prototype.processData=function(t){var e=this,i=e.xAxis;if(e.isCartesian&&!e.isDirty&&!i.isDirty&&!e.yAxis.isDirty&&!t)return!1;t=e.getProcessedData();e.cropped=t.cropped,e.cropStart=t.cropStart,e.processedXData=t.xData,e.processedYData=t.yData,e.closestPointRange=e.basePointRange=t.closestPointRange,fireEvent(e,"afterProcessData")},t.prototype.cropData=function(t,e,i,r,o){var s,a,n=t.length,p=0,h=n;for(o=pick(o,this.cropShoulder),s=0;s<n;s++)if(t[s]>=i){p=Math.max(0,s-o);break}for(a=s;a<n;a++)if(t[a]>r){h=a+o;break}return{xData:t.slice(p,h),yData:e.slice(p,h),start:p,end:h}},t.prototype.generatePoints=function(){var t,e,i,r,o=this,s=o.options,a=s.data,n=o.processedXData,p=o.processedYData,h=o.pointClass,l=n.length,d=o.cropStart||0,c=o.hasGroupedData,u=s.keys,f=[],y=s.dataGrouping&&s.dataGrouping.groupAll?d:0,v=o.data;for(v||c||((s=[]).length=a.length,v=o.data=s),u&&c&&(o.options.keys=!1),r=0;r<l;r++)e=d+r,c?((i=(new h).init(o,[n[r]].concat(splat(p[r])))).dataGroup=o.groupMap[y+r],i.dataGroup.options&&(i.options=i.dataGroup.options,extend(i,i.dataGroup.options),delete i.dataLabels)):(i=v[e])||void 0===a[e]||(v[e]=i=(new h).init(o,a[e],n[r])),i&&(i.index=c?y+r:e,f[r]=i);if(o.options.keys=u,v&&(l!==(t=v.length)||c))for(r=0;r<t;r++)r!==d||c||(r+=l),v[r]&&(v[r].destroyElements(),v[r].plotX=void 0);o.data=v,o.points=f,fireEvent(this,"afterGeneratePoints")},t.prototype.getXExtremes=function(t){return{min:arrayMin(t),max:arrayMax(t)}},t.prototype.getExtremes=function(t,e){var i,r,o,s,a,n=this.xAxis,p=this.yAxis,h=this.processedXData||this.xData,l=[],d=this.requireSorting?this.cropShoulder:0,c=!!p&&p.positiveValuesOnly,u=0,f=0,y=0,v=(t=t||this.stackedYData||this.processedYData||[]).length;for(n&&(u=(g=n.getExtremes()).min,f=g.max),s=0;s<v;s++)if(r=h[s],o=t[s],i=(isNumber(o)||isArray(o))&&(o.length||0<o||!c),r=e||this.getExtremesFromAll||this.options.getExtremesFromAll||this.cropped||!n||(h[s+d]||r)>=u&&(h[s-d]||r)<=f,i&&r)if(a=o.length)for(;a--;)isNumber(o[a])&&(l[y++]=o[a]);else l[y++]=o;var g={activeYData:l,dataMin:arrayMin(l),dataMax:arrayMax(l)};return fireEvent(this,"afterGetExtremes",{dataExtremes:g}),g},t.prototype.applyExtremes=function(){var t=this.getExtremes();return this.dataMin=t.dataMin,this.dataMax=t.dataMax,t},t.prototype.getFirstValidPoint=function(t){for(var e=t.length,i=0,r=null;null===r&&i<e;)r=t[i],i++;return r},t.prototype.translate=function(){this.processedXData||this.processData(),this.generatePoints();var t,e,i,r,o=this,s=o.options,a=s.stacking,n=o.xAxis,p=n.categories,h=o.enabledDataSorting,l=o.yAxis,d=o.points,c=d.length,u=o.pointPlacementToXValue(),f=Boolean(u),y=s.threshold,v=s.startFromThreshold?y:0,g=this.zoneAxis||"y",m=Number.MAX_VALUE;function x(t){return clamp(t,-1e5,1e5)}for(t=0;t<c;t++){var k=d[t],b=k.x,D=void 0,A=void 0,S=k.y,E=k.low,O=a&&l.stacking&&l.stacking.stacks[(o.negStacks&&S<(v?0:y)?"-":"")+o.stackKey];(l.positiveValuesOnly&&!l.validatePositiveValue(S)||n.positiveValuesOnly&&!n.validatePositiveValue(b))&&(k.isNull=!0),k.plotX=e=correctFloat(x(n.translate(b,0,0,0,1,u,"flags"===this.type))),a&&o.visible&&O&&O[b]&&(r=o.getStackIndicator(r,b,o.index),k.isNull||(A=(D=O[b]).points[r.key])),isArray(A)&&(E=A[0],S=A[1],E===v&&r.key===O[b].base&&(E=pick(isNumber(y)&&y,l.min)),l.positiveValuesOnly&&E<=0&&(E=null),k.total=k.stackTotal=D.total,k.percentage=D.total&&k.y/D.total*100,k.stackY=S,o.irregularWidths||D.setOffset(o.pointXOffset||0,o.barW||0)),k.yBottom=defined(E)?x(l.translate(E,0,1,0,1)):null,o.dataModify&&(S=o.dataModify.modifyValue(S,t)),k.plotY=void 0,!isNumber(S)||void 0!==(S=l.translate(S,!1,!0,!1,!0))&&(k.plotY=x(S)),k.isInside=this.isPointInside(k),k.clientX=f?correctFloat(n.translate(b,0,0,0,1,u)):e,k.negative=k[g]<(s[g+"Threshold"]||y||0),k.category=p&&void 0!==p[k.x]?p[k.x]:k.x,k.isNull||!1===k.visible||(void 0!==i&&(m=Math.min(m,Math.abs(e-i))),i=e),k.zone=this.zones.length?k.getZone():void 0,!k.graphic&&o.group&&h&&(k.isNew=!0)}o.closestPointRangePx=m,fireEvent(this,"afterTranslate")},t.prototype.getValidPoints=function(t,e,i){var r=this.chart;return(t||this.points||[]).filter(function(t){return!(e&&!r.isInsidePlot(t.plotX,t.plotY,{inverted:r.inverted}))&&(!1!==t.visible&&(i||!t.isNull))})},t.prototype.getClipBox=function(){var t=this.chart,e=this.xAxis,i=this.yAxis,r=merge(t.clipBox);return e&&e.len!==t.plotSizeX&&(r.width=e.len),i&&i.len!==t.plotSizeY&&(r.height=i.len),r},t.prototype.getSharedClipKey=function(){return this.sharedClipKey=(this.options.xAxis||0)+","+(this.options.yAxis||0),this.sharedClipKey},t.prototype.setClip=function(){var t=this.chart,e=this.group,i=this.markerGroup,r=t.sharedClips,o=t.renderer,s=this.getClipBox(),a=this.getSharedClipKey(),t=r[a];t?t.animate(s):r[a]=t=o.clipRect(s),e&&e.clip(!1===this.options.clip?void 0:t),i&&i.clip()},t.prototype.animate=function(t){var i,e=this.chart,r=this.group,o=this.markerGroup,s=e.inverted,a=animObject(this.options.animation),n=[this.getSharedClipKey(),a.duration,a.easing,a.defer].join(","),p=e.sharedClips[n],h=e.sharedClips[n+"m"];t&&r?(t=this.getClipBox(),p?p.attr("height",t.height):(t.width=0,s&&(t.x=e.plotHeight),p=e.renderer.clipRect(t),e.sharedClips[n]=p,s={x:s?(e.plotSizeX||0)+99:-99,y:s?-e.plotLeft:-e.plotTop,width:99,height:s?e.chartWidth:e.chartHeight},h=e.renderer.clipRect(s),e.sharedClips[n+"m"]=h),r.clip(p),o&&o.clip(h)):p&&!p.hasClass("highcharts-animating")&&(r=this.getClipBox(),i=a.step,o&&o.element.childNodes.length&&(a.step=function(t,e){i&&i.apply(e,arguments),h&&h.element&&h.attr(e.prop,"width"===e.prop?t+99:t)}),p.addClass("highcharts-animating").animate(r,a))},t.prototype.afterAnimate=function(){var r=this;this.setClip(),objectEach(this.chart.sharedClips,function(t,e,i){t&&!r.chart.container.querySelector('[clip-path="url(#'+t.id+')"]')&&(t.destroy(),delete i[e])}),this.finishedAnimating=!0,fireEvent(this,"afterAnimate")},t.prototype.drawPoints=function(){var t,e=this,i=e.points,r=e.chart,o=e.options.marker,s=e[e.specialGroup]||e.markerGroup,a=e.xAxis,n=pick(o.enabled,!(a&&!a.isRadial)||null,e.closestPointRangePx>=o.enabledThreshold*o.radius);if(!1!==o.enabled||e._hasPointMarkers)for(t=0;t<i.length;t++){var p,h,l,d,c,u=(h=(p=i[t]).graphic)?"animate":"attr",f=p.marker||{},y=!!p.marker;(n&&void 0===f.enabled||f.enabled)&&!p.isNull&&!1!==p.visible?(l=pick(f.symbol,e.symbol,"rect"),d=e.markerAttribs(p,p.selected&&"select"),e.enabledDataSorting&&(p.startXPos=a.reversed?-(d.width||0):a.width),c=!1!==p.isInside,h?h[c?"show":"hide"](c).animate(d):c&&(0<(d.width||0)||p.hasImage)&&(p.graphic=h=r.renderer.symbol(l,d.x,d.y,d.width,d.height,y?f:o).add(s),e.enabledDataSorting&&r.hasRendered&&(h.attr({x:p.startXPos}),u="animate")),h&&"animate"===u&&h[c?"show":"hide"](c).animate(d),h&&!r.styledMode&&h[u](e.pointAttribs(p,p.selected&&"select")),h&&h.addClass(p.getClassName(),!0)):h&&(p.graphic=h.destroy())}},t.prototype.markerAttribs=function(t,e){var i=this.options,r=i.marker,o=t.marker||{},s=o.symbol||r.symbol,a=pick(o.radius,r.radius);e&&(r=r.states[e],e=o.states&&o.states[e],a=pick(e&&e.radius,r&&r.radius,a+(r&&r.radiusPlus||0))),t.hasImage=s&&0===s.indexOf("url"),t.hasImage&&(a=0);t={x:i.crisp?Math.floor(t.plotX-a):t.plotX-a,y:t.plotY-a};return a&&(t.width=t.height=2*a),t},t.prototype.pointAttribs=function(t,e){var i=this.options.marker,r=t&&t.options,o=r&&r.marker||{},s=r&&r.color,a=t&&t.color,n=t&&t.zone&&t.zone.color,p=this.color,r=pick(o.lineWidth,i.lineWidth),t=1,p=s||n||a||p,a=o.fillColor||i.fillColor||p,p=o.lineColor||i.lineColor||p;return(e=e||"normal")&&(i=i.states[e]||{},e=o.states&&o.states[e]||{},r=pick(e.lineWidth,i.lineWidth,r+pick(e.lineWidthPlus,i.lineWidthPlus,0)),a=e.fillColor||i.fillColor||a,p=e.lineColor||i.lineColor||p,t=pick(e.opacity,i.opacity,t)),{stroke:p,"stroke-width":r,fill:a,opacity:t}},t.prototype.destroy=function(i){var t,e,r,o=this,s=o.chart,a=/AppleWebKit\/533/.test(win.navigator.userAgent),n=o.data||[];for(fireEvent(o,"destroy"),this.removeEvents(i),(o.axisTypes||[]).forEach(function(t){(r=o[t])&&r.series&&(erase(r.series,o),r.isDirty=r.forceRedraw=!0)}),o.legendItem&&o.chart.legend.destroyItem(o),t=n.length;t--;)(e=n[t])&&e.destroy&&e.destroy();o.clips&&o.clips.forEach(function(t){return t.destroy()}),U.clearTimeout(o.animationTimeout),objectEach(o,function(t,e){t instanceof SVGElement&&!t.survive&&t[a&&"group"===e?"hide":"destroy"]()}),s.hoverSeries===o&&(s.hoverSeries=void 0),erase(s.series,o),s.orderSeries(),objectEach(o,function(t,e){i&&"hcEvents"===e||delete o[e]})},t.prototype.applyZones=function(){var i,r,o,s,a,n,p,h,l=this,d=this.chart,c=d.renderer,t=this.zones,u=this.clips||[],f=this.graph,y=this.area,v=Math.max(d.chartWidth,d.chartHeight),g=this[(this.zoneAxis||"y")+"Axis"],m=d.inverted,x=!1;t.length&&(f||y)&&g&&void 0!==g.min?(s=g.reversed,a=g.horiz,f&&!this.showLine&&f.hide(),y&&y.hide(),o=g.getExtremes(),t.forEach(function(t,e){h=s?a?d.plotWidth:0:!a&&g.toPixels(o.min)||0,h=clamp(pick(i,h),0,v),i=clamp(Math.round(g.toPixels(pick(t.value,o.max),!0)||0),0,v),x&&(h=i=g.toPixels(o.max)),n=Math.abs(h-i),p=Math.min(h,i),h=Math.max(h,i),g.isXAxis?(r={x:m?h:p,y:0,width:n,height:v},a||(r.x=d.plotHeight-r.x)):(r={x:0,y:m?h:p,width:v,height:n},a&&(r.y=d.plotWidth-r.y)),m&&c.isVML&&(r=g.isXAxis?{x:0,y:s?p:h,height:r.width,width:d.chartWidth}:{x:r.y-d.plotLeft-d.spacingBox.x,y:0,width:r.height,height:d.chartHeight}),u[e]?u[e].animate(r):u[e]=c.clipRect(r),p=l["zone-area-"+e],h=l["zone-graph-"+e],f&&h&&h.clip(u[e]),y&&p&&p.clip(u[e]),x=t.value>o.max,l.resetZones&&0===i&&(i=void 0)}),this.clips=u):l.visible&&(f&&f.show(!0),y&&y.show(!0))},t.prototype.invertGroups=function(e){var i=this,r=i.chart;function t(){["group","markerGroup"].forEach(function(t){i[t]&&(r.renderer.isVML&&i[t].attr({width:i.yAxis.len,height:i.xAxis.len}),i[t].width=i.yAxis.len,i[t].height=i.xAxis.len,i[t].invert(!i.isRadialSeries&&e))})}i.xAxis&&(i.eventsToUnbind.push(addEvent(r,"resize",t)),t(),i.invertGroups=t)},t.prototype.plotGroup=function(t,e,i,r,o){var s=this[t],a=!s,r={visibility:i,zIndex:r||.1};return void 0===this.opacity||this.chart.styledMode||"inactive"===this.state||(r.opacity=this.opacity),a&&(this[t]=s=this.chart.renderer.g().add(o)),s.addClass("highcharts-"+e+" highcharts-series-"+this.index+" highcharts-"+this.type+"-series "+(defined(this.colorIndex)?"highcharts-color-"+this.colorIndex+" ":"")+(this.options.className||"")+(s.hasClass("highcharts-tracker")?" highcharts-tracker":""),!0),s.attr(r)[a?"attr":"animate"](this.getPlotBox()),s},t.prototype.getPlotBox=function(){var t=this.chart,e=this.xAxis,i=this.yAxis;return t.inverted&&(e=i,i=this.xAxis),{translateX:e?e.left:t.plotLeft,translateY:i?i.top:t.plotTop,scaleX:1,scaleY:1}},t.prototype.removeEvents=function(t){t||removeEvent(this),this.eventsToUnbind.length&&(this.eventsToUnbind.forEach(function(t){t()}),this.eventsToUnbind.length=0)},t.prototype.render=function(){var t=this,e=t.chart,i=t.options,r=animObject(i.animation),o=t.visible?"inherit":"hidden",s=i.zIndex,a=t.hasRendered,n=e.seriesGroup,p=e.inverted,h=!t.finishedAnimating&&e.renderer.isSVG?r.duration:0;fireEvent(this,"render");e=t.plotGroup("group","series",o,s,n);t.markerGroup=t.plotGroup("markerGroup","markers",o,s,n),!1!==i.clip&&t.setClip(),t.animate&&h&&t.animate(!0),e.inverted=!!pick(t.invertible,t.isCartesian)&&p,t.drawGraph&&(t.drawGraph(),t.applyZones()),t.visible&&t.drawPoints(),t.drawDataLabels&&t.drawDataLabels(),t.redrawPoints&&t.redrawPoints(),t.drawTracker&&!1!==t.options.enableMouseTracking&&t.drawTracker(),t.invertGroups(p),t.animate&&h&&t.animate(),a||(h&&r.defer&&(h+=r.defer),t.animationTimeout=syncTimeout(function(){t.afterAnimate()},h||0)),t.isDirty=!1,t.hasRendered=!0,fireEvent(t,"afterRender")},t.prototype.redraw=function(){var t=this,e=t.chart,i=t.isDirty||t.isDirtyData,r=t.group,o=t.xAxis,s=t.yAxis;r&&(e.inverted&&r.attr({width:e.plotWidth,height:e.plotHeight}),r.animate({translateX:pick(o&&o.left,e.plotLeft),translateY:pick(s&&s.top,e.plotTop)})),t.translate(),t.render(),i&&delete this.kdTree},t.prototype.searchPoint=function(t,e){var i=this.xAxis,r=this.yAxis,o=this.chart.inverted;return this.searchKDTree({clientX:o?i.len-t.chartY+i.pos:t.chartX-i.pos,plotY:o?r.len-t.chartX+r.pos:t.chartY-r.pos},e,t)},t.prototype.buildKDTree=function(t){this.buildingKdTree=!0;var a=this,e=-1<a.options.findNearestPointBy.indexOf("y")?2:1;delete a.kdTree,syncTimeout(function(){a.kdTree=function t(e,i,r){var o,s=e&&e.length;if(s)return o=a.kdAxisArray[i%r],e.sort(function(t,e){return t[o]-e[o]}),{point:e[s=Math.floor(s/2)],left:t(e.slice(0,s),i+1,r),right:t(e.slice(s+1),i+1,r)}}(a.getValidPoints(null,!a.directTouch),e,e),a.buildingKdTree=!1},a.options.kdNow||t&&"touchstart"===t.type?0:1)},t.prototype.searchKDTree=function(t,e,i){var l=this,d=this.kdAxisArray[0],c=this.kdAxisArray[1],u=e?"distX":"dist",e=-1<l.options.findNearestPointBy.indexOf("y")?2:1;function f(t,e,i,r){var o,s=e.point,a=l.kdAxisArray[i%r],n=s;p=s,o=((h=defined((o=t)[d])&&defined(p[d])?Math.pow(o[d]-p[d],2):null)||0)+((defined(o[c])&&defined(p[c])?Math.pow(o[c]-p[c],2):null)||0),p.dist=defined(o)?Math.sqrt(o):Number.MAX_VALUE,p.distX=defined(h)?Math.sqrt(h):Number.MAX_VALUE;var p=t[a]-s[a],h=p<0?"left":"right",a=p<0?"right":"left";return e[h]&&(n=(h=f(t,e[h],i+1,r))[u]<n[u]?h:s),n=e[a]&&Math.sqrt(p*p)<n[u]?(r=f(t,e[a],i+1,r))[u]<n[u]?r:n:n}if(this.kdTree||this.buildingKdTree||this.buildKDTree(i),this.kdTree)return f(t,this.kdTree,e,e)},t.prototype.pointPlacementToXValue=function(){var t=this.options,e=t.pointPlacement,i=t.pointRange,t=this.xAxis,e=e;return"between"===e&&(e=t.reversed?-.5:.5),isNumber(e)?e*(i||t.pointRange):0},t.prototype.isPointInside=function(t){var e=this.chart,i=this.xAxis,r=this.yAxis;return void 0!==t.plotY&&void 0!==t.plotX&&0<=t.plotY&&t.plotY<=(r?r.len:e.plotHeight)&&0<=t.plotX&&t.plotX<=(i?i.len:e.plotWidth)},t.prototype.drawTracker=function(){function e(t){s.hoverSeries!==i&&i.onMouseOver()}var i=this,r=i.options,t=r.trackByArea,o=[].concat(t?i.areaPath:i.graphPath),s=i.chart,a=s.pointer,n=s.renderer,p=s.options.tooltip.snap,h=i.tracker,l="rgba(192,192,192,"+(svg?1e-4:.002)+")";h?h.attr({d:o}):i.graph&&(i.tracker=n.path(o).attr({visibility:i.visible?"visible":"hidden",zIndex:2}).addClass(t?"highcharts-tracker-area":"highcharts-tracker-line").add(i.group),s.styledMode||i.tracker.attr({"stroke-linecap":"round","stroke-linejoin":"round",stroke:l,fill:t?l:"none","stroke-width":i.graph.strokeWidth()+(t?0:2*p)}),[i.tracker,i.markerGroup,i.dataLabelsGroup].forEach(function(t){t&&(t.addClass("highcharts-tracker").on("mouseover",e).on("mouseout",function(t){a.onTrackerMouseOut(t)}),r.cursor&&!s.styledMode&&t.css({cursor:r.cursor}),hasTouch&&t.on("touchstart",e))})),fireEvent(this,"afterDrawTracker")},t.prototype.addPoint=function(t,e,i,r,o){var s,a=this,n=a.options,p=a.data,h=a.chart,l=a.xAxis,d=l&&l.hasNames&&l.names,c=n.data,u=a.xData;e=pick(e,!0);l={series:a};a.pointClass.prototype.applyOptions.apply(l,[t]);var f=l.x,y=u.length;if(a.requireSorting&&f<u[y-1])for(s=!0;y&&u[y-1]>f;)y--;a.updateParallelArrays(l,"splice",y,0,0),a.updateParallelArrays(l,y),d&&l.name&&(d[f]=l.name),c.splice(y,0,t),s&&(a.data.splice(y,0,null),a.processData()),"point"===n.legendType&&a.generatePoints(),i&&(p[0]&&p[0].remove?p[0].remove(!1):(p.shift(),a.updateParallelArrays(l,"shift"),c.shift())),!1!==o&&fireEvent(a,"addPoint",{point:l}),a.isDirty=!0,a.isDirtyData=!0,e&&h.redraw(r)},t.prototype.removePoint=function(t,e,i){function r(){n&&n.length===s.length&&n.splice(t,1),s.splice(t,1),o.options.data.splice(t,1),o.updateParallelArrays(a||{series:o},"splice",t,1),a&&a.destroy(),o.isDirty=!0,o.isDirtyData=!0,e&&p.redraw()}var o=this,s=o.data,a=s[t],n=o.points,p=o.chart;setAnimation(i,p),e=pick(e,!0),a?a.firePointEvent("remove",null,r):r()},t.prototype.remove=function(t,e,i,r){var o=this,s=o.chart;function a(){o.destroy(r),s.isDirtyLegend=s.isDirtyBox=!0,s.linkSeries(),pick(t,!0)&&s.redraw(e)}!1!==i?fireEvent(o,"remove",null,a):a()},t.prototype.update=function(t,e){t=cleanRecursively(t,this.userOptions),fireEvent(this,"update",{options:t});var i,r=this,o=r.chart,s=r.userOptions,a=r.initialType||r.type,n=o.options.plotOptions,p=seriesTypes[a].prototype,h=r.finishedAnimating&&{animation:!1},l={},d=["eventOptions","navigatorSeries","baseSeries"],c=t.type||s.type||o.options.chart.type,u=!(this.hasDerivedData||c&&c!==this.type||void 0!==t.pointStart||void 0!==t.pointInterval||void 0!==t.relativeXValue||r.hasOptionChanged("dataGrouping")||r.hasOptionChanged("pointStart")||r.hasOptionChanged("pointInterval")||r.hasOptionChanged("pointIntervalUnit")||r.hasOptionChanged("keys")),c=c||a;u&&(d.push("data","isDirtyData","points","processedXData","processedYData","xIncrement","cropped","_hasPointMarkers","_hasPointLabels","clips","nodes","layout","mapMap","mapData","minY","maxY","minX","maxX"),!1!==t.visible&&d.push("area","graph"),r.parallelArrays.forEach(function(t){d.push(t+"Data")}),t.data&&(t.dataSorting&&extend(r.options.dataSorting,t.dataSorting),this.setData(t.data,!1))),t=merge(s,h,{index:(void 0===s.index?r:s).index,pointStart:pick(n&&n.series&&n.series.pointStart,s.pointStart,r.xData[0])},!u&&{data:r.options.data},t),u&&t.data&&(t.data=r.options.data),(d=["group","markerGroup","dataLabelsGroup","transformGroup"].concat(d)).forEach(function(t){d[t]=r[t],delete r[t]});var f,h=!1;if(seriesTypes[c]){if(h=c!==r.type,r.remove(!1,!1,!1,!0),h)if(Object.setPrototypeOf)Object.setPrototypeOf(r,seriesTypes[c].prototype);else{n=Object.hasOwnProperty.call(r,"hcEvents")&&r.hcEvents;for(i in p)r[i]=void 0;extend(r,seriesTypes[c].prototype),n?r.hcEvents=n:delete r.hcEvents}}else error(17,!0,o,{missingModuleFor:c});d.forEach(function(t){r[t]=d[t]}),r.init(o,t),u&&this.points&&(!1===(f=r.options).visible?(l.graphic=1,l.dataLabel=1):r._hasPointLabels||(c=f.marker,t=f.dataLabels,!c||!1!==c.enabled&&(s.marker&&s.marker.symbol)===c.symbol||(l.graphic=1),t&&!1===t.enabled&&(l.dataLabel=1)),this.points.forEach(function(t){t&&t.series&&(t.resolveColor(),Object.keys(l).length&&t.destroyElements(l),!1===f.showInLegend&&t.legendItem&&o.legend.destroyItem(t))},this)),r.initialType=a,o.linkSeries(),h&&r.linkedSeries.length&&(r.isDirtyData=!0),fireEvent(this,"afterUpdate"),pick(e,!0)&&o.redraw(u&&void 0)},t.prototype.setName=function(t){this.name=this.options.name=this.userOptions.name=t,this.chart.isDirtyLegend=!0},t.prototype.hasOptionChanged=function(t){var e=this.chart,i=this.options[t],r=e.options.plotOptions,e=this.userOptions[t];return e?i!==e:i!==pick(r&&r[this.type]&&r[this.type][t],r&&r.series&&r.series[t],i)},t.prototype.onMouseOver=function(){var t=this,e=t.chart,i=e.hoverSeries;e.pointer.setHoverChartIndex(),i&&i!==t&&i.onMouseOut(),t.options.events.mouseOver&&fireEvent(t,"mouseOver"),t.setState("hover"),e.hoverSeries=t},t.prototype.onMouseOut=function(){var t=this,e=t.options,i=t.chart,r=i.tooltip,o=i.hoverPoint;i.hoverSeries=null,o&&o.onMouseOut(),t&&e.events.mouseOut&&fireEvent(t,"mouseOut"),!r||t.stickyTracking||r.shared&&!t.noSharedTooltip||r.hide(),i.series.forEach(function(t){t.setState("",!0)})},t.prototype.setState=function(e,t){var i,r=this,o=r.options,s=r.graph,a=o.inactiveOtherPoints,n=o.states,p=pick(n[e||"normal"]&&n[e||"normal"].animation,r.chart.options.chart.animation),h=o.lineWidth,l=0,d=o.opacity;if(e=e||"",r.state!==e&&([r.group,r.markerGroup,r.dataLabelsGroup].forEach(function(t){t&&(r.state&&t.removeClass("highcharts-series-"+r.state),e&&t.addClass("highcharts-series-"+e))}),r.state=e,!r.chart.styledMode)){if(n[e]&&!1===n[e].enabled)return;if(e&&(h=n[e].lineWidth||h+(n[e].lineWidthPlus||0),d=pick(n[e].opacity,d)),s&&!s.dashstyle)for(s.animate(i={"stroke-width":h},p);r["zone-graph-"+l];)r["zone-graph-"+l].animate(i,p),l+=1;a||[r.group,r.markerGroup,r.dataLabelsGroup,r.labelBySeries].forEach(function(t){t&&t.animate({opacity:d},p)})}t&&a&&r.points&&r.setAllPointsToState(e||void 0)},t.prototype.setAllPointsToState=function(e){this.points.forEach(function(t){t.setState&&t.setState(e)})},t.prototype.setVisible=function(e,t){var i=this,r=i.chart,o=i.legendItem,s=r.options.chart.ignoreHiddenSeries,a=i.visible;i.visible=e=i.options.visible=i.userOptions.visible=void 0===e?!a:e;var n=e?"show":"hide";["group","dataLabelsGroup","markerGroup","tracker","tt"].forEach(function(t){i[t]&&i[t][n]()}),r.hoverSeries!==i&&(r.hoverPoint&&r.hoverPoint.series)!==i||i.onMouseOut(),o&&r.legend.colorizeItem(i,e),i.isDirty=!0,i.options.stacking&&r.series.forEach(function(t){t.options.stacking&&t.visible&&(t.isDirty=!0)}),i.linkedSeries.forEach(function(t){t.setVisible(e,!1)}),s&&(r.isDirtyBox=!0),fireEvent(i,n),!1!==t&&r.redraw()},t.prototype.show=function(){this.setVisible(!0)},t.prototype.hide=function(){this.setVisible(!1)},t.prototype.select=function(t){var e=this;e.selected=t=this.options.selected=void 0===t?!e.selected:t,e.checkbox&&(e.checkbox.checked=t),fireEvent(e,t?"select":"unselect")},t.prototype.shouldShowTooltip=function(t,e,i){return(i=void 0===i?{}:i).series=this,i.visiblePlotOnly=!0,this.chart.isInsidePlot(t,e,i)},t.defaultOptions=SeriesDefaults,t}();extend(Series.prototype,{axisTypes:["xAxis","yAxis"],coll:"series",colorCounter:0,cropShoulder:1,directTouch:!1,drawLegendSymbol:LegendSymbol.drawLineMarker,isCartesian:!0,kdAxisArray:["clientX","plotY"],parallelArrays:["x","y"],pointClass:Point,requireSorting:!0,sorted:!0});export default SeriesRegistry.series=Series;