"use strict";import AxisDefaults from"./AxisDefaults.js";import D from"../DefaultOptions.js";var defaultOptions=D.defaultOptions;import H from"../Globals.js";var noop=H.noop;import U from"../Utilities.js";var RadialAxis,addEvent=U.addEvent,correctFloat=U.correctFloat,defined=U.defined,extend=U.extend,fireEvent=U.fireEvent,merge=U.merge,pick=U.pick,relativeLength=U.relativeLength,wrap=U.wrap;!function(t){var e=[],c={gridLineWidth:1,labels:{align:void 0,distance:15,x:0,y:void 0,style:{textOverflow:"none"}},maxPadding:0,minPadding:0,showLastLabel:!1,tickLength:0},d={labels:{align:"center",x:0,y:void 0},minorGridLineWidth:0,minorTickInterval:"auto",minorTickLength:10,minorTickPosition:"inside",minorTickWidth:1,tickLength:10,tickPosition:"inside",tickWidth:2,title:{rotation:0},zIndex:2},p={gridLineInterpolation:"circle",gridLineWidth:1,labels:{align:"right",x:-3,y:-2},showLastLabel:!1,title:{x:4,text:null,rotation:90}};function i(){this.autoConnect=this.isCircular&&void 0===pick(this.userMax,this.options.max)&&correctFloat(this.endAngleRad-this.startAngleRad)===correctFloat(2*Math.PI),!this.isCircular&&this.chart.inverted&&this.max++,this.autoConnect&&(this.max+=(this.categories?1:this.pointRange)||this.closestPointRange||0)}function s(){var i=this;return function(){if(i.isRadial&&i.tickPositions&&i.options.labels&&!0!==i.options.labels.allowOverlap)return i.tickPositions.map(function(t){return i.ticks[t]&&i.ticks[t].label}).filter(function(t){return Boolean(t)})}}function u(){return noop}function n(t,i,e){var s,n,a,o=this.pane.center,r=t.value;return this.isCircular?(defined(r)?t.point&&(t.point.shapeArgs||{}).start&&(r=this.chart.inverted?this.translate(t.point.rectPlotY,!0):t.point.x):(n=t.chartX||0,a=t.chartY||0,r=this.translate(Math.atan2(a-e,n-i)-this.startAngleRad,!0)),n=(s=this.getPosition(r)).x,a=s.y):(defined(r)||(n=t.chartX,a=t.chartY),defined(n)&&defined(a)&&(e=o[1]+this.chart.plotTop,r=this.translate(Math.min(Math.sqrt(Math.pow(n-i,2)+Math.pow(a-e,2)),o[2]/2)-o[3]/2,!0))),[r,n||0,a||0]}function a(t,i,e){var s,n=this.pane.center,a=this.chart,o=this.left||0,r=this.top||0,h=pick(i,n[2]/2-this.offset);return(e=void 0===e?this.horiz?0:this.center&&-this.center[3]/2:e)&&(h+=e),this.isCircular||void 0!==i?((s=this.chart.renderer.symbols.arc(o+n[0],r+n[1],h,h,{start:this.startAngleRad,end:this.endAngleRad,open:!0,innerR:0})).xBounds=[o+n[0]],s.yBounds=[r+n[1]-h]):(h=this.postTranslate(this.angleRad,h),s=[["M",this.center[0]+a.plotLeft,this.center[1]+a.plotTop],["L",h.x,h.y]]),s}function o(){this.constructor.prototype.getOffset.call(this),this.chart.axisOffset[this.side]=0}function r(t,i,e){var s,n,a,o,r=this.chart,h=function(t){if("string"!=typeof t)return t;var i=parseInt(t,10);return i=g.test(t)?i*d/100:i},l=this.center,c=this.startAngleRad,d=l[2]/2,p=Math.min(this.offset,0),u=this.left||0,f=this.top||0,g=/%$/,x=this.isCircular,v=pick(h(e.outerRadius),d),P=h(e.innerRadius),h=pick(h(e.thickness),10);return"polygon"===this.options.gridLineInterpolation?o=this.getPlotLinePath({value:t}).concat(this.getPlotLinePath({value:i,reverse:!0})):(t=Math.max(t,this.min),i=Math.min(i,this.max),t=this.translate(t),i=this.translate(i),x||(v=t||0,P=i||0),"circle"!==e.shape&&x?(n=c+(t||0),s=c+(i||0)):(n=-Math.PI/2,s=1.5*Math.PI,a=!0),h-=p,o=r.renderer.symbols.arc(u+l[0],f+l[1],v-=p,v,{start:Math.min(n,s),end:Math.max(n,s),innerR:pick(P,v-h),open:a}),x&&(n=(s+n)/2,u=u+l[0]+l[2]/2*Math.cos(n),o.xBounds=n>-Math.PI/2&&n<Math.PI/2?[u,r.plotWidth]:[0,u],o.yBounds=[f+l[1]+l[2]/2*Math.sin(n)],o.yBounds[0]+=n>-Math.PI&&n<0||n>Math.PI?-10:10)),o}function h(t){var i,e,s,n,a,o=this,r=this.pane.center,h=this.chart,l=h.inverted,c=t.reverse,d=this.pane.options.background?this.pane.options.background[0]||this.pane.options.background:{},p=d.innerRadius||"0%",u=d.outerRadius||"100%",f=r[0]+h.plotLeft,g=r[1]+h.plotTop,x=this.height,v=t.isCrosshair,P=r[3]/2,A=t.value,m=this.getPosition(A),d=m.x,m=m.y;if(v&&(A=(n=this.getCrosshairPosition(t,f,g))[0],d=n[1],m=n[2]),this.isCircular)n=Math.sqrt(Math.pow(d-f,2)+Math.pow(m-g,2)),p="string"==typeof p?relativeLength(p,1):p/n,u="string"==typeof u?relativeLength(u,1):u/n,r&&P&&(p<(n=P/n)&&(p=n),u<n&&(u=n)),a=[["M",f+p*(d-f),g-p*(g-m)],["L",d-(1-u)*(d-f),m+(1-u)*(g-m)]];else if((A=this.translate(A))&&(A<0||x<A)&&(A=0),"circle"===this.options.gridLineInterpolation)a=this.getLinePath(0,A,P);else if(a=[],h[l?"yAxis":"xAxis"].forEach(function(t){t.pane===o.pane&&(i=t)}),i){s=i.tickPositions,i.autoConnect&&(s=s.concat([s[0]])),c&&(s=s.slice().reverse()),A&&(A+=P);for(var L=0;L<s.length;L++)e=i.getPosition(s[L],A),a.push(L?["L",e.x,e.y]:["M",e.x,e.y])}return a}function l(t,i){t=this.translate(t);return this.postTranslate(this.isCircular?t:this.angleRad,pick(this.isCircular?i:t<0?0:t,this.center[2]/2)-this.offset)}function f(){var t=this.center,i=this.chart,e=this.options.title;return{x:i.plotLeft+t[0]+(e.x||0),y:i.plotTop+t[1]-{high:.5,middle:.25,low:0}[e.align]*t[2]+(e.y||0)}}function g(t){t.beforeSetTickPositions=i,t.createLabelCollector=s,t.getCrosshairPosition=n,t.getLinePath=a,t.getOffset=o,t.getPlotBandPath=r,t.getPlotLinePath=h,t.getPosition=l,t.getTitlePosition=f,t.postTranslate=y,t.setAxisSize=b,t.setAxisTranslation=k,t.setOptions=C}function x(){var t=this.chart,i=this.options,e=t.angular&&this.isXAxis,s=this.pane,n=s&&s.options;!e&&s&&(t.angular||t.polar)&&(this.angleRad=(i.angle||0)*Math.PI/180,this.startAngleRad=(n.startAngle-90)*Math.PI/180,this.endAngleRad=(pick(n.endAngle,n.startAngle+360)-90)*Math.PI/180,this.offset=i.offset||0)}function v(t){this.isRadial&&(t.align=void 0,t.preventDefault())}function P(){var t;this.chart&&this.chart.labelCollectors&&(0<=(t=this.labelCollector?this.chart.labelCollectors.indexOf(this.labelCollector):-1)&&this.chart.labelCollectors.splice(t,1))}function A(t){var i,e=this.chart,s=e.inverted,n=e.angular,a=e.polar,o=this.isXAxis,r=this.coll,h=n&&o,l=e.options,t=t.userOptions.pane||0,t=this.pane=e.pane&&e.pane[t];"colorAxis"!==r?(n?(h?((i=this).isHidden=!0,i.createLabelCollector=u,i.getOffset=noop,i.redraw=M,i.render=M,i.setScale=noop,i.setCategories=noop,i.setTitle=noop):g(this),(i=!o)&&(this.defaultPolarOptions=d)):a&&(g(this),i=this.horiz,this.defaultPolarOptions=i?c:merge("xAxis"===r?AxisDefaults.defaultXAxisOptions:AxisDefaults.defaultYAxisOptions,p),s&&"yAxis"===r&&(this.defaultPolarOptions.stackLabels=AxisDefaults.defaultYAxisOptions.stackLabels,this.defaultPolarOptions.reversedStacks=!0)),n||a?(this.isRadial=!0,l.chart.zoomType=null,this.labelCollector||(this.labelCollector=this.createLabelCollector()),this.labelCollector&&e.labelCollectors.push(this.labelCollector)):this.isRadial=!1,t&&i&&(t.axis=this),this.isCircular=i):this.isRadial=!1}function m(){this.isRadial&&this.beforeSetTickPositions()}function L(t){var i,e,s,n,a,o,r,h,l,c,d,p,u,f,g,x=this.label;x&&(i=this.axis,e=x.getBBox(),s=i.options.labels,n=(i.translate(this.pos)+i.startAngleRad+Math.PI/2)/Math.PI*180%360,a=Math.round(n),o=defined(s.y)?0:.3*-e.height,r=s.y,l=20,c=s.align,d="end",u=p=a<0?a+360:a,g=f=0,i.isRadial&&(h=i.getPosition(this.pos,i.center[2]/2+relativeLength(pick(s.distance,-25),i.center[2]/2,-i.center[2]/2)),"auto"===s.rotation?x.attr({rotation:n}):defined(r)||(r=i.chart.renderer.fontMetrics(x.styles&&x.styles.fontSize).b-e.height/2),defined(c)||(c=i.isCircular?(l=e.width>i.len*i.tickInterval/(i.max-i.min)?0:l)<n&&n<180-l?"left":180+l<n&&n<360-l?"right":"center":"center",x.attr({align:c})),"auto"===c&&2===i.tickPositions.length&&i.isCircular&&(90<p&&p<180?p=180-p:270<p&&p<=360&&(p=540-p),i.pane.options.startAngle!==a&&i.pane.options.startAngle!==a+360&&i.pane.options.startAngle!==a-360||(d="start"),c=-90<=a&&a<=90||-360<=a&&a<=-270||270<=a&&a<=360?"start"===d?"right":"left":"start"===d?"left":"right",p<15||180<=p&&p<195?f=.3*e.height:15<=p&&p<=35?f="start"===d?0:.75*e.height:195<=p&&p<=215?f="start"===d?.75*e.height:0:35<p&&p<=90?f="start"===d?.25*-e.height:e.height:215<p&&p<=270&&(f="start"===d?e.height:.25*-e.height),(u=180<u&&u<=360?360-u:u)<15?g="start"===d?.15*-e.height:.15*e.height:165<u&&u<=180&&(g="start"===d?.15*e.height:.15*-e.height),x.attr({align:c=70<u&&u<110?"center":c}),x.translate(g,f+o)),t.pos.x=h.x+(s.x||0),t.pos.y=h.y+(r||0)))}function R(t){this.axis.getPosition&&extend(t.pos,this.axis.getPosition(this.pos))}function y(t,i){var e=this.chart,s=this.center;return t=this.startAngleRad+t,{x:e.plotLeft+s[0]+Math.cos(t)*i,y:e.plotTop+s[1]+Math.sin(t)*i}}function M(){this.isDirty=!1}function b(){var t,i;this.constructor.prototype.setAxisSize.call(this),this.isRadial&&(this.pane.updateCenter(this),t=this.center=this.pane.center.slice(),this.isCircular?this.sector=this.endAngleRad-this.startAngleRad:(i=this.postTranslate(this.angleRad,t[3]/2),t[0]=i.x-this.chart.plotLeft,t[1]=i.y-this.chart.plotTop),this.len=this.width=this.height=(t[2]-t[3])*pick(this.sector,1)/2)}function k(){this.constructor.prototype.setAxisTranslation.call(this),this.center&&(this.isCircular?this.transA=(this.endAngleRad-this.startAngleRad)/(this.max-this.min||1):this.transA=(this.center[2]-this.center[3])/2/(this.max-this.min||1),this.isXAxis?this.minPixelPadding=this.transA*this.minPointOffset:this.minPixelPadding=0)}function C(t){t=this.options=merge(this.constructor.defaultOptions,this.defaultPolarOptions,defaultOptions[this.coll],t);t.plotBands||(t.plotBands=[]),fireEvent(this,"afterSetOptions")}function O(t,i,e,s,n,a,o){var r=this.axis,o=r.isRadial?["M",i,e,"L",(r=r.getPosition(this.pos,r.center[2]/2+s)).x,r.y]:t.call(this,i,e,s,n,a,o);return o}t.compose=function(t,i){return-1===e.indexOf(t)&&(e.push(t),addEvent(t,"afterInit",x),addEvent(t,"autoLabelAlign",v),addEvent(t,"destroy",P),addEvent(t,"init",A),addEvent(t,"initialAxisTranslation",m)),-1===e.indexOf(i)&&(e.push(i),addEvent(i,"afterGetLabelPosition",L),addEvent(i,"afterGetPosition",R),wrap(i.prototype,"getMarkPath",O)),t}}(RadialAxis=RadialAxis||{});export default RadialAxis;