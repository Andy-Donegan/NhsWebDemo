"use strict";import F from"../FormatUtilities.js";import H from"../Globals.js";var deg2rad=H.deg2rad;import U from"../Utilities.js";var clamp=U.clamp,correctFloat=U.correctFloat,defined=U.defined,destroyObjectProperties=U.destroyObjectProperties,extend=U.extend,fireEvent=U.fireEvent,isNumber=U.isNumber,merge=U.merge,objectEach=U.objectEach,pick=U.pick,Tick=function(){function t(t,e,i,r,a){this.isNew=!0,this.isNewLabel=!0,this.axis=t,this.pos=e,this.type=i||"",this.parameters=a||{},this.tickmarkOffset=this.parameters.tickmarkOffset,this.options=this.parameters.options,fireEvent(this,"init"),i||r||this.addLabel()}return t.prototype.addLabel=function(){var t,e,i,r=this,a=r.axis,o=a.options,s=a.chart,l=a.categories,n=a.logarithmic,d=a.names,h=r.pos,c=pick(r.options&&r.options.labels,o.labels),p=a.tickPositions,f=h===p[0],m=h===p[p.length-1],b=(!c.step||1===c.step)&&1===a.tickInterval,p=p.info,x=r.label,d=this.parameters.category||(l?pick(l[h],d[h],h):h);n&&isNumber(d)&&(d=correctFloat(n.lin2log(d))),a.dateTime&&(p?t=(e=s.time.resolveDTLFormat(o.dateTimeLabelFormats[!o.grid&&p.higherRanks[h]||p.unitName])).main:isNumber(d)&&(t=a.dateTime.getXDateFormat(d,o.dateTimeLabelFormats||{}))),r.isFirst=f,r.isLast=m;var y={axis:a,chart:s,dateTimeLabelFormat:t,isFirst:f,isLast:m,pos:h,tick:r,tickPositionInfo:p,value:d};fireEvent(this,"labelFormat",y);function L(t){return c.formatter?c.formatter.call(t,t):c.format?(t.text=a.defaultLabelFormatter.call(t),F.format(c.format,t,s)):a.defaultLabelFormatter.call(t,t)}var d=L.call(y,y),g=e&&e.list;r.shortenLabel=g?function(){for(i=0;i<g.length;i++)if(extend(y,{dateTimeLabelFormat:g[i]}),x.attr({text:L.call(y,y)}),x.getBBox().width<a.getSlotWidth(r)-2*c.padding)return;x.attr({text:""})}:void 0,b&&a._addedPlotLB&&r.moveLabel(d,c),defined(x)||r.movedLabel?x&&x.textStr!==d&&!b&&(!x.textWidth||c.style.width||x.styles.width||x.css({width:null}),x.attr({text:d}),x.textPxLength=x.getBBox().width):(r.label=x=r.createLabel({x:0,y:0},d,c),r.rotation=0)},t.prototype.createLabel=function(t,e,i){var r=this.axis,a=r.chart,r=defined(e)&&i.enabled?a.renderer.text(e,t.x,t.y,i.useHTML).add(r.labelGroup):null;return r&&(a.styledMode||r.css(merge(i.style)),r.textPxLength=r.getBBox().width),r},t.prototype.destroy=function(){destroyObjectProperties(this,this.axis)},t.prototype.getPosition=function(t,e,i,r){var a=this.axis,o=a.chart,s=r&&o.oldChartHeight||o.chartHeight,a={x:t?correctFloat(a.translate(e+i,null,null,r)+a.transB):a.left+a.offset+(a.opposite?(r&&o.oldChartWidth||o.chartWidth)-a.right-a.left:0),y:t?s-a.bottom+a.offset-(a.opposite?a.height:0):correctFloat(s-a.translate(e+i,null,null,r)-a.transB)};return a.y=clamp(a.y,-1e5,1e5),fireEvent(this,"afterGetPosition",{pos:a}),a},t.prototype.getLabelPosition=function(t,e,i,r,a,o,s,l){var n=this.axis,d=n.transA,h=(n.isLinked&&n.linkedParent?n.linkedParent:n).reversed,c=n.staggerLines,p=n.tickRotCorr||{x:0,y:0},f=r||n.reserveSpaceDefault?0:-n.labelOffset*("center"===n.labelAlign?.5:1),m={},b=a.y;return defined(b)||(b=0===n.side?i.rotation?-8:-i.getBBox().height:2===n.side?p.y+8:Math.cos(i.rotation*deg2rad)*(p.y-i.getBBox(!1,0).height/2)),t=t+a.x+f+p.x-(o&&r?o*d*(h?-1:1):0),e=e+b-(o&&!r?o*d*(h?1:-1):0),c&&(l=s/(l||1)%c,e+=(l=n.opposite?c-l-1:l)*(n.labelOffset/c)),m.x=t,m.y=Math.round(e),fireEvent(this,"afterGetLabelPosition",{pos:m,tickmarkOffset:o,index:s}),m},t.prototype.getLabelSize=function(){return this.label?this.label.getBBox()[this.axis.horiz?"height":"width"]:0},t.prototype.getMarkPath=function(t,e,i,r,a,o){return o.crispLine([["M",t,e],["L",t+(a?0:-i),e+(a?i:0)]],r)},t.prototype.handleOverflow=function(t){var e,i=this.axis,r=i.options.labels,a=t.x,o=i.chart.chartWidth,s=i.chart.spacing,l=pick(i.labelLeft,Math.min(i.pos,s[3])),n=pick(i.labelRight,Math.max(i.isRadial?0:i.pos+i.len,o-s[1])),d=this.label,h=this.rotation,c={left:0,center:.5,right:1}[i.labelAlign||d.attr("align")],p=d.getBBox().width,f=i.getSlotWidth(this),m=c,b={},x=f,s=1;h||"justify"!==r.overflow?h<0&&a-c*p<l?e=Math.round(a/Math.cos(h*deg2rad)-l):0<h&&n<a+c*p&&(e=Math.round((o-a)/Math.cos(h*deg2rad))):(a-c*p<l?x=t.x+x*(1-c)-l:n<a+(1-c)*p&&(x=n-t.x+x*c,s=-1),(x=Math.min(f,x))<f&&"center"===i.labelAlign&&(t.x+=s*(f-x-m*(f-Math.min(p,x)))),(x<p||i.autoRotation&&(d.styles||{}).width)&&(e=x)),e&&(this.shortenLabel?this.shortenLabel():(b.width=Math.floor(e)+"px",(r.style||{}).textOverflow||(b.textOverflow="ellipsis"),d.css(b)))},t.prototype.moveLabel=function(e,t){var i,r=this,a=r.label,o=r.axis,s=o.reversed,l=!1;a&&a.textStr===e?(r.movedLabel=a,l=!0,delete r.label):objectEach(o.ticks,function(t){l||t.isNew||t===r||!t.label||t.label.textStr!==e||(r.movedLabel=t.label,l=!0,t.labelPos=r.movedLabel.xy,delete t.label)}),l||!r.labelPos&&!a||(i=r.labelPos||a.xy,a=o.horiz?s?0:o.width+o.left:i.x,o=o.horiz?i.y:s?o.width+o.left:0,r.movedLabel=r.createLabel({x:a,y:o},e,t),r.movedLabel&&r.movedLabel.attr({opacity:0}))},t.prototype.render=function(t,e,i){var r=this,a=r.axis,o=a.horiz,s=r.pos,l=pick(r.tickmarkOffset,a.tickmarkOffset),n=r.getPosition(o,s,l,e),s=n.x,l=n.y,l=o&&s===a.pos+a.len||!o&&l===a.pos?-1:1,a=pick(i,r.label&&r.label.newOpacity,1);i=pick(i,1),this.isActive=!0,this.renderGridLine(e,i,l),this.renderMark(n,i,l),this.renderLabel(n,e,a,t),r.isNew=!1,fireEvent(this,"afterRender")},t.prototype.renderGridLine=function(t,e,i){var r,a=this,o=a.axis,s=o.options,l={},n=a.pos,d=a.type,h=pick(a.tickmarkOffset,o.tickmarkOffset),c=o.chart.renderer,p=a.gridLine,f=s.gridLineWidth,m=s.gridLineColor,b=s.gridLineDashStyle;"minor"===a.type&&(f=s.minorGridLineWidth,m=s.minorGridLineColor,b=s.minorGridLineDashStyle),p||(o.chart.styledMode||(l.stroke=m,l["stroke-width"]=f||0,l.dashstyle=b),d||(l.zIndex=1),t&&(e=0),a.gridLine=p=c.path().attr(l).addClass("highcharts-"+(d?d+"-":"")+"grid-line").add(o.gridGroup)),p&&(r=o.getPlotLinePath({value:n+h,lineWidth:p.strokeWidth()*i,force:"pass",old:t}))&&p[t||a.isNew?"attr":"animate"]({d:r,opacity:e})},t.prototype.renderMark=function(t,e,i){var r=this,a=r.axis,o=a.options,s=a.chart.renderer,l=r.type,n=a.tickSize(l?l+"Tick":"tick"),d=t.x,h=t.y,c=pick(o["minor"!==l?"tickWidth":"minorTickWidth"],!l&&a.isXAxis?1:0),p=o["minor"!==l?"tickColor":"minorTickColor"],t=r.mark,o=!t;n&&(a.opposite&&(n[0]=-n[0]),t||(r.mark=t=s.path().addClass("highcharts-"+(l?l+"-":"")+"tick").add(a.axisGroup),a.chart.styledMode||t.attr({stroke:p,"stroke-width":c})),t[o?"attr":"animate"]({d:r.getMarkPath(d,h,n[0],t.strokeWidth()*i,a.horiz,s),opacity:e}))},t.prototype.renderLabel=function(t,e,i,r){var a=this,o=a.axis,s=o.horiz,l=o.options,n=a.label,d=l.labels,h=d.step,c=pick(a.tickmarkOffset,o.tickmarkOffset),p=t.x,f=t.y,o=!0;n&&isNumber(p)&&(n.xy=t=a.getLabelPosition(p,f,n,s,d,c,r,h),a.isFirst&&!a.isLast&&!l.showFirstLabel||a.isLast&&!a.isFirst&&!l.showLastLabel?o=!1:!s||d.step||d.rotation||e||0===i||a.handleOverflow(t),(o=h&&r%h?!1:o)&&isNumber(t.y)?(t.opacity=i,n[a.isNewLabel?"attr":"animate"](t),a.isNewLabel=!1):(n.attr("y",-9999),a.isNewLabel=!0))},t.prototype.replaceMovedLabel=function(){var t,e=this,i=e.label,r=e.axis,a=r.reversed;i&&!e.isNew&&(t=r.horiz?a?r.left:r.width+r.left:i.xy.x,a=r.horiz?i.xy.y:a?r.width+r.top:r.top,i.animate({x:t,y:a,opacity:0},void 0,i.destroy),delete e.label),r.isDirty=!0,e.label=e.movedLabel,delete e.movedLabel},t}();export default Tick;