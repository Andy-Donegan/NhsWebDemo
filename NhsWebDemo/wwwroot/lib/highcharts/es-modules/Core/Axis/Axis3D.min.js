"use strict";import H from"../Globals.js";var deg2rad=H.deg2rad;import Math3D from"../../Extensions/Math3D.js";var perspective=Math3D.perspective,perspective3D=Math3D.perspective3D,shapeArea=Math3D.shapeArea;import Tick from"./Tick.js";import Tick3D from"./Tick3D.js";import U from"../Utilities.js";var addEvent=U.addEvent,merge=U.merge,pick=U.pick,wrap=U.wrap,Axis3DAdditions=function(){function t(t){this.axis=t}return t.prototype.fix3dPosition=function(t,i){var e=this.axis,s=e.chart;if("colorAxis"===e.coll||!s.chart3d||!s.is3d())return t;var o,a,r,p=deg2rad*s.options.chart.options3d.alpha,x=deg2rad*s.options.chart.options3d.beta,n=pick(i&&e.options.title.position3d,e.options.labels.position3d),l=pick(i&&e.options.title.skew3d,e.options.labels.skew3d),h=s.chart3d.frame3d,c=s.plotLeft,y=s.plotWidth+c,d=s.plotTop,f=s.plotHeight+d,u=0,z=0,i={x:0,y:1,z:0},s=!1;if(t=e.axis3D.swapZ({x:t.x,y:t.y,z:0}),e.isZAxis)if(e.opposite){if(null===h.axes.z.top)return{};z=t.y-d,t.x=h.axes.z.top.x,t.y=h.axes.z.top.y,o=h.axes.z.top.xDir,s=!h.top.frontFacing}else{if(null===h.axes.z.bottom)return{};z=t.y-f,t.x=h.axes.z.bottom.x,t.y=h.axes.z.bottom.y,o=h.axes.z.bottom.xDir,s=!h.bottom.frontFacing}else if(e.horiz)if(e.opposite){if(null===h.axes.x.top)return{};z=t.y-d,t.y=h.axes.x.top.y,t.z=h.axes.x.top.z,o=h.axes.x.top.xDir,s=!h.top.frontFacing}else{if(null===h.axes.x.bottom)return{};z=t.y-f,t.y=h.axes.x.bottom.y,t.z=h.axes.x.bottom.z,o=h.axes.x.bottom.xDir,s=!h.bottom.frontFacing}else if(e.opposite){if(null===h.axes.y.right)return{};u=t.x-y,t.x=h.axes.y.right.x,t.z=h.axes.y.right.z,o={x:(o=h.axes.y.right.xDir).z,y:o.y,z:-o.x}}else{if(null===h.axes.y.left)return{};u=t.x-c,t.x=h.axes.y.left.x,t.z=h.axes.y.left.z,o=h.axes.y.left.xDir}"chart"===n||("flap"===n?e.horiz?(r=Math.sin(p),a=Math.cos(p),e.opposite&&(r=-r),i={x:o.z*(r=s?-r:r),y:a,z:-o.x*r}):o={x:Math.cos(x),y:0,z:Math.sin(x)}:"ortho"===n?e.horiz?(a=Math.sin(p),r=Math.cos(p),n=Math.sin(x)*r,a=-a,r=-r*Math.cos(x),i={x:o.y*r-o.z*a,y:o.z*n-o.x*r,z:o.x*a-o.y*n},n=1/Math.sqrt(i.x*i.x+i.y*i.y+i.z*i.z),i={x:(n=s?-n:n)*i.x,y:n*i.y,z:n*i.z}):o={x:Math.cos(x),y:0,z:Math.sin(x)}:e.horiz?i={x:Math.sin(x)*Math.sin(p),y:Math.cos(p),z:-Math.cos(x)*Math.sin(p)}:o={x:Math.cos(x),y:0,z:Math.sin(x)}),t.x+=u*o.x+z*i.x,t.y+=u*o.y+z*i.y,t.z+=u*o.z+z*i.z;z=perspective([t],e.chart)[0];return l&&(shapeArea(perspective([t,{x:t.x+o.x,y:t.y+o.y,z:t.z+o.z},{x:t.x+i.x,y:t.y+i.y,z:t.z+i.z}],e.chart))<0&&(o={x:-o.x,y:-o.y,z:-o.z}),e=perspective([{x:t.x,y:t.y,z:t.z},{x:t.x+o.x,y:t.y+o.y,z:t.z+o.z},{x:t.x+i.x,y:t.y+i.y,z:t.z+i.z}],e.chart),z.matrix=[e[1].x-e[0].x,e[1].y-e[0].y,e[2].x-e[0].x,e[2].y-e[0].y,z.x,z.y],z.matrix[4]-=z.x*z.matrix[0]+z.y*z.matrix[2],z.matrix[5]-=z.x*z.matrix[1]+z.y*z.matrix[3]),z},t.prototype.swapZ=function(t,i){var e=this.axis;if(e.isZAxis){e=i?0:e.chart.plotLeft;return{x:e+t.z,y:t.y,z:t.x-e}}return t},t}(),Axis3D=function(){function i(){}return i.compose=function(t){merge(!0,t.defaultOptions,i.defaultOptions),t.keepProps.push("axis3D"),addEvent(t,"init",i.onInit),addEvent(t,"afterSetOptions",i.onAfterSetOptions),addEvent(t,"drawCrosshair",i.onDrawCrosshair);t=t.prototype;wrap(t,"getLinePath",i.wrapGetLinePath),wrap(t,"getPlotBandPath",i.wrapGetPlotBandPath),wrap(t,"getPlotLinePath",i.wrapGetPlotLinePath),wrap(t,"getSlotWidth",i.wrapGetSlotWidth),wrap(t,"getTitlePosition",i.wrapGetTitlePosition),Tick3D.compose(Tick)},i.onAfterSetOptions=function(){var t=this,i=t.chart,e=t.options;i.is3d&&i.is3d()&&"colorAxis"!==t.coll&&(e.tickWidth=pick(e.tickWidth,0),e.gridLineWidth=pick(e.gridLineWidth,1))},i.onDrawCrosshair=function(t){var i=this;i.chart.is3d()&&"colorAxis"!==i.coll&&t.point&&(t.point.crosshairPos=i.isXAxis?t.point.axisXpos:i.len-t.point.axisYpos)},i.onInit=function(){var t=this;t.axis3D||(t.axis3D=new Axis3DAdditions(t))},i.wrapGetLinePath=function(t){var i=this;return i.chart.is3d()&&"colorAxis"!==i.coll?[]:t.apply(i,[].slice.call(arguments,1))},i.wrapGetPlotBandPath=function(t){if(!this.chart.is3d()||"colorAxis"===this.coll)return t.apply(this,[].slice.call(arguments,1));var i=arguments,t=i[2],e=[],s=this.getPlotLinePath({value:i[1]}),o=this.getPlotLinePath({value:t});if(s&&o)for(var a=0;a<s.length;a+=2){var r=s[a],p=s[a+1],x=o[a],n=o[a+1];"M"===r[0]&&"L"===p[0]&&"M"===x[0]&&"L"===n[0]&&e.push(r,p,n,["L",x[1],x[2]],["Z"])}return e},i.wrapGetPlotLinePath=function(t){var i=this,e=i.axis3D,s=i.chart,o=t.apply(i,[].slice.call(arguments,1));if("colorAxis"===i.coll||!s.chart3d||!s.is3d())return o;if(null===o)return o;var a=s.options.chart.options3d,r=i.isZAxis?s.plotWidth:a.depth,t=s.chart3d.frame3d,i=o[0],a=o[1],o=[];return"M"===i[0]&&"L"===a[0]&&(r=[e.swapZ({x:i[1],y:i[2],z:0}),e.swapZ({x:i[1],y:i[2],z:r}),e.swapZ({x:a[1],y:a[2],z:0}),e.swapZ({x:a[1],y:a[2],z:r})],this.horiz?(this.isZAxis?(t.left.visible&&o.push(r[0],r[2]),t.right.visible&&o.push(r[1],r[3])):(t.front.visible&&o.push(r[0],r[2]),t.back.visible&&o.push(r[1],r[3])),t.top.visible&&o.push(r[0],r[1]),t.bottom.visible&&o.push(r[2],r[3])):(t.front.visible&&o.push(r[0],r[2]),t.back.visible&&o.push(r[1],r[3]),t.left.visible&&o.push(r[0],r[1]),t.right.visible&&o.push(r[2],r[3])),o=perspective(o,this.chart,!1)),s.renderer.toLineSegments(o)},i.wrapGetSlotWidth=function(t,i){var e=this,s=e.chart,o=e.ticks,a=e.gridGroup;if(e.categories&&s.frameShapes&&s.is3d()&&a&&i&&i.label){var r=a.element.childNodes[0].getBBox(),p=s.frameShapes.left.getBBox(),x=s.options.chart.options3d,n={x:s.plotWidth/2,y:s.plotHeight/2,z:x.depth/2,vd:pick(x.depth,1)*pick(x.viewDistance,0)},l=i.pos,h=o[l-1],a=o[l+1],s=void 0,x=void 0,o=void 0;return 0!==l&&h&&h.label&&h.label.xy&&(x=perspective3D({x:h.label.xy.x,y:h.label.xy.y,z:null},n,n.vd)),a&&a.label&&a.label.xy&&(o=perspective3D({x:a.label.xy.x,y:a.label.xy.y,z:null},n,n.vd)),s={x:i.label.xy.x,y:i.label.xy.y,z:null},s=perspective3D(s,n,n.vd),Math.abs(x?s.x-x.x:o?o.x-s.x:r.x-p.x)}return t.apply(e,[].slice.call(arguments,1))},i.wrapGetTitlePosition=function(t){t=t.apply(this,[].slice.call(arguments,1));return this.axis3D?this.axis3D.fix3dPosition(t,!0):t},i.defaultOptions={labels:{position3d:"offset",skew3d:!1},title:{position3d:null,skew3d:null}},i}();export default Axis3D;