"use strict";import Axis from"./Axis.js";import AxisDefaults from"./AxisDefaults.js";import H from"../Globals.js";var dateFormats=H.dateFormats;import U from"../Utilities.js";var GridAxis,addEvent=U.addEvent,defined=U.defined,erase=U.erase,find=U.find,isArray=U.isArray,isNumber=U.isNumber,merge=U.merge,pick=U.pick,timeUnits=U.timeUnits,wrap=U.wrap;function argsToArray(t){return Array.prototype.slice.call(t,1)}function isObject(t){return U.isObject(t,!0)}function applyGridOptions(t){var i=t.options;i.labels.align=pick(i.labels.align,"center"),t.categories||(i.showLastLabel=!1),t.labelRotation=0,i.labels.rotation=0}!function(x){var t;function r(r,t){var n={width:0,height:0};return t.forEach(function(t){var i,e=r[t],t=0;isObject(e)&&(i=(e=isObject(e.label)?e.label:{}).getBBox?e.getBBox().height:0,e.textStr&&!isNumber(e.textPxLength)&&(e.textPxLength=e.getBBox().width),t=isNumber(e.textPxLength)?Math.round(e.textPxLength):0,e.textStr&&(t=Math.round(e.getBBox().width)),n.height=Math.max(i,n.height),n.width=Math.max(t,n.width))}),"treegrid"===this.options.type&&this.treeGrid&&this.treeGrid.mapOfPosToGridNode&&(t=this.treeGrid.mapOfPosToGridNode[-1].height||0,n.width+=this.options.labels.indentation*(t-1)),n}function n(){var t=this.grid;(t&&t.columns||[]).forEach(function(t){t.getOffset()})}function s(t){var i,e,r,n,s,o,a,d,l,h,c,f,g,u,p=this;!0===(p.options.grid||{}).enabled&&(u=p.axisTitle,i=p.height,e=p.horiz,r=p.left,n=p.offset,s=p.opposite,o=p.options,a=p.top,d=p.width,l=p.tickSize(),h=u&&u.getBBox().width,c=o.title.x,f=o.title.y,g=pick(o.title.margin,e?5:10),u=p.chart.renderer.fontMetrics(o.title.style.fontSize,u).f,p=(e?a+i:r)+(e?1:-1)*(s?-1:1)*(l?l[0]/2:0)+(p.side===x.Side.bottom?u:0),t.titlePosition.x=e?r-(h||0)/2-g+c:p+(s?d:0)+n+c,t.titlePosition.y=e?p-(s?i:0)+(s?u:-u)/2+n+f:a-g+f)}function o(){var t=this,i=t.chart,e=t.options.grid,r=void 0===e?{}:e,n=t.userOptions;if(r.enabled&&applyGridOptions(t),r.columns)for(var s=t.grid.columns=[],o=t.grid.columnIndex=0;++o<r.columns.length;){var a=merge(n,r.columns[r.columns.length-o-1],{linkedTo:0,type:"category",scrollbar:{enabled:!1}});delete a.grid.columns;a=new Axis(t.chart,a);a.grid.isColumn=!0,a.grid.columnIndex=o,erase(i.axes,a),erase(i[t.coll],a),s.push(a)}}function a(){var t=this,i=t.grid,e=t.options;if(!0===(e.grid||{}).enabled){var r,n,s,o=t.min||0,a=t.max||0;if(t.maxLabelDimensions=t.getMaxLabelDimensions(t.ticks,t.tickPositions),t.rightWall&&t.rightWall.destroy(),t.grid&&t.grid.isOuterAxis()&&t.axisLine&&((n=e.lineWidth)&&(s=(d=t.getLinePath(n))[0],r=d[1],n=((t.tickSize("tick")||[1])[0]-1)*(t.side===x.Side.top||t.side===x.Side.left?-1:1),"M"===s[0]&&"L"===r[0]&&(t.horiz?(s[2]+=n,r[2]+=n):(s[1]+=n,r[1]+=n)),!t.horiz&&t.chart.marginRight&&(n=[s,["L",t.left,s[2]||0]],s=["L",t.chart.chartWidth-t.chart.marginRight,t.toPixels(a+t.tickmarkOffset)],s=[["M",r[1]||0,t.toPixels(a+t.tickmarkOffset)],s],t.grid.upperBorder||o%1==0||(t.grid.upperBorder=t.grid.renderBorder(n)),t.grid.upperBorder&&(t.grid.upperBorder.attr({stroke:e.lineColor,"stroke-width":e.lineWidth}),t.grid.upperBorder.animate({d:n})),t.grid.lowerBorder||a%1==0||(t.grid.lowerBorder=t.grid.renderBorder(s)),t.grid.lowerBorder&&(t.grid.lowerBorder.attr({stroke:e.lineColor,"stroke-width":e.lineWidth}),t.grid.lowerBorder.animate({d:s}))),t.grid.axisLineExtra?(t.grid.axisLineExtra.attr({stroke:e.lineColor,"stroke-width":e.lineWidth}),t.grid.axisLineExtra.animate({d:d})):t.grid.axisLineExtra=t.grid.renderBorder(d),t.axisLine[t.showAxis?"show":"hide"](!0))),(i&&i.columns||[]).forEach(function(t){t.render()}),!t.horiz&&t.chart.hasRendered&&(t.scrollbar||t.linkedParent&&t.linkedParent.scrollbar)){for(var e=t.tickmarkOffset,d=t.tickPositions[t.tickPositions.length-1],i=t.tickPositions[0],l=void 0;(l=t.hiddenLabels.pop())&&l.element;)l.show();(l=t.ticks[i].label)&&(e<o-i?t.hiddenLabels.push(l.hide()):l.show()),(l=t.ticks[d].label)&&(e<d-a?t.hiddenLabels.push(l.hide()):l.show());i=t.ticks[d].mark;i&&(d-a<e&&0<d-a&&t.ticks[d].isLast?i.hide():t.ticks[d-1]&&i.show())}}}function d(){var t=this,i=t.tickPositions&&t.tickPositions.info,e=t.options,r=e.grid||{},n=t.userOptions.labels||{};r.enabled&&(t.horiz?(t.series.forEach(function(t){t.options.pointRange=0}),i&&e.dateTimeLabelFormats&&e.labels&&!defined(n.align)&&(!1===e.dateTimeLabelFormats[i.unitName].range||1<i.count)&&(e.labels.align="left",defined(n.x)||(e.labels.x=3))):"treegrid"!==this.options.type&&t.grid&&t.grid.columns&&(this.minPointOffset=this.tickInterval))}function l(t){var l,i=this.options,e=t.userOptions,t=i&&isObject(i.grid)?i.grid:{};!0===t.enabled&&(l=merge(!0,{className:"highcharts-grid-axis "+(e.className||""),dateTimeLabelFormats:{hour:{list:["%H:%M","%H"]},day:{list:["%A, %e. %B","%a, %e. %b","%E"]},week:{list:["Week %W","W%W"]},month:{list:["%B","%b","%o"]}},grid:{borderWidth:1},labels:{padding:2,style:{fontSize:"13px"}},margin:0,title:{text:null,reserveSpace:!1,rotation:0},units:[["millisecond",[1,10,100]],["second",[1,10]],["minute",[1,5,15]],["hour",[1,6]],["day",[1]],["week",[1]],["month",[1]],["year",null]]},e),"xAxis"===this.coll&&(defined(e.linkedTo)&&!defined(e.tickPixelInterval)&&(l.tickPixelInterval=350),defined(e.tickPixelInterval)||!defined(e.linkedTo)||defined(e.tickPositioner)||defined(e.tickInterval)||(l.tickPositioner=function(t,i){var e=this.linkedParent&&this.linkedParent.tickPositions&&this.linkedParent.tickPositions.info;if(e){for(var r=l.units||[],n=void 0,s=void 0,o=void 0,a=0;a<r.length;a++)if(r[a][0]===e.unitName){n=a;break}r[n+1]?(o=r[n+1][0],s=(r[n+1][1]||[1])[0]):"year"===e.unitName&&(o="year",s=10*e.count);var d=timeUnits[o];return this.tickInterval=d*s,this.getTimeTicks({unitRange:d,count:s,unitName:o},t,i,this.options.startOfWeek)}})),merge(!0,this.options,l),this.horiz&&(i.minPadding=pick(e.minPadding,0),i.maxPadding=pick(e.maxPadding,0)),isNumber(i.grid.borderWidth)&&(i.tickWidth=i.lineWidth=t.borderWidth))}function h(t){var i=t.userOptions,t=i&&i.grid||{},i=t.columns;t.enabled&&i&&merge(!0,this.options,i[i.length-1])}function c(){(this.grid.columns||[]).forEach(function(t){t.setScale()})}function f(t){var i=AxisDefaults.defaultLeftAxisOptions,e=this.horiz,r=this.maxLabelDimensions,n=this.options.grid,n=void 0===n?{}:n;n.enabled&&r&&(i=2*Math.abs(i.labels.x),r=e?n.cellHeight||i+r.height:i+r.width,isArray(t.tickSize)?t.tickSize[0]=r:t.tickSize=[r,0])}function g(){this.axes.forEach(function(t){(t.grid&&t.grid.columns||[]).forEach(function(t){t.setAxisSize(),t.setAxisTranslation()})})}function u(i){var t=this.grid;(t.columns||[]).forEach(function(t){t.destroy(i.keepEvents)}),t.columns=void 0}function p(t){var i=t.userOptions||{},t=i.grid||{};t.enabled&&defined(t.borderColor)&&(i.tickColor=i.lineColor=t.borderColor),this.grid||(this.grid=new e(this)),this.hiddenLabels=[]}function m(t){var i,e,r,n,s=this.label,o=this.axis,a=o.reversed,d=o.chart,l=o.options.grid||{},h=o.options.labels,c=h.align,f=x.Side[o.side],g=t.tickmarkOffset,u=o.tickPositions,p=this.pos-g,m=isNumber(u[t.index+1])?u[t.index+1]-g:(o.max||0)+g,u=o.tickSize("tick"),g=u?u[0]:0,u=u?u[1]/2:0;!0===l.enabled&&("top"===f?e=(i=o.top+o.offset)-g:"bottom"===f?i=(e=d.chartHeight-o.bottom+o.offset)+g:(i=o.top+o.len-(o.translate(a?m:p)||0),e=o.top+o.len-(o.translate(a?p:m)||0)),"right"===f?n=(r=d.chartWidth-o.right+o.offset)+g:"left"===f?r=(n=o.left+o.offset)-g:(r=Math.round(o.left+(o.translate(a?m:p)||0))-u,n=Math.min(Math.round(o.left+(o.translate(a?p:m)||0))-u,o.left+o.len)),this.slotWidth=n-r,t.pos.x="left"===c?r:"right"===c?n:r+(n-r)/2,t.pos.y=e+(i-e)/2,d=d.renderer.fontMetrics(h.style.fontSize,s&&s.element),s=s?s.getBBox().height:0,h.useHTML?t.pos.y+=d.b+-s/2:(s=Math.round(s/d.h),t.pos.y+=(d.b-(d.h-d.f))/2+-((s-1)*d.h)/2),t.pos.x+=o.horiz&&h.x||0)}function k(t){var i,e,r,n,s,o=t.axis,a=t.value;o.options.grid&&o.options.grid.enabled&&(n=o.tickPositions,i=(o.linkedParent||o).series[0],e=a===n[0],r=a===n[n.length-1],s=void 0,(n=i&&find(i.options.data,function(t){return t[o.isXAxis?"x":"y"]===a}))&&i.is("gantt")&&(s=merge(n),H.seriesTypes.gantt.prototype.pointClass.setGanttPointAliases(s)),t.isFirst=e,t.isLast=r,t.point=s)}function b(){var t=this,i=t.options,e=i.grid||{},r=t.categories,n=t.tickPositions,s=n[0],o=n[n.length-1],a=t.linkedParent&&t.linkedParent.min,d=t.linkedParent&&t.linkedParent.max,l=a||t.min,a=d||t.max,d=t.tickInterval,o=a<o&&o-d<a;!0!==e.enabled||r||!t.horiz&&!t.isLinked||(s<l&&l<s+d&&!i.startOnTick&&(n[0]=l),o&&!i.endOnTick&&(n[n.length-1]=a))}function v(t){var i=this.options.grid;return!0===(void 0===i?{}:i).enabled&&this.categories?this.tickInterval:t.apply(this,argsToArray(arguments))}(t=x.Side||(x.Side={}))[t.top=0]="top",t[t.right=1]="right",t[t.bottom=2]="bottom",t[t.left=3]="left",x.compose=function(t,i,e){return-1===t.keepProps.indexOf("grid")&&(t.keepProps.push("grid"),t.prototype.getMaxLabelDimensions=r,wrap(t.prototype,"unsquish",v),addEvent(t,"init",p),addEvent(t,"afterGetOffset",n),addEvent(t,"afterGetTitlePosition",s),addEvent(t,"afterInit",o),addEvent(t,"afterRender",a),addEvent(t,"afterSetAxisTranslation",d),addEvent(t,"afterSetOptions",l),addEvent(t,"afterSetOptions",h),addEvent(t,"afterSetScale",c),addEvent(t,"afterTickSize",f),addEvent(t,"trimTicks",b),addEvent(t,"destroy",u)),addEvent(i,"afterSetChartSize",g),addEvent(e,"afterGetLabelPosition",m),addEvent(e,"labelFormat",k),t};var e=(i.prototype.isOuterAxis=function(){var e=this.axis,t=e.chart,i=e.grid.columnIndex,r=e.linkedParent&&e.linkedParent.grid.columns||e.grid.columns,n=i?e.linkedParent:e,s=-1,o=0;return t[e.coll].forEach(function(t,i){t.side!==e.side||t.options.isInternal||(o=i,t===n&&(s=i))}),o===s&&(!isNumber(i)||r.length===i)},i.prototype.renderBorder=function(t){var i=this.axis,e=i.chart.renderer,r=i.options,i=e.path(t).addClass("highcharts-axis-line").add(i.axisBorder);return e.styledMode||i.attr({stroke:r.lineColor,"stroke-width":r.lineWidth,zIndex:7}),i},i);function i(t){this.axis=t}x.Additions=e}(GridAxis=GridAxis||{}),dateFormats.E=function(t){return this.dateFormat("%a",t,!0).charAt(0)},dateFormats.W=function(t){var i=new this.Date(t),e=(this.get("Day",i)+6)%7,t=new this.Date(i.valueOf());this.set("Date",t,this.get("Date",i)-e+3);e=new this.Date(this.get("FullYear",t),0,1);return 4!==this.get("Day",e)&&(this.set("Month",i,0),this.set("Date",i,1+(11-this.get("Day",e))%7)),(1+Math.floor((t.valueOf()-e.valueOf())/6048e5)).toString()};export default GridAxis;