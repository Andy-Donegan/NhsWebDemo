"use strict";import StackItem from"../../Extensions/Stacking.js";import U from"../Utilities.js";var BrokenAxis,addEvent=U.addEvent,find=U.find,fireEvent=U.fireEvent,isArray=U.isArray,isNumber=U.isNumber,pick=U.pick;!function(i){var n=[];function e(){void 0!==this.brokenAxis&&this.brokenAxis.setBreaks(this.options.breaks,!1)}function s(){var i=this;i.brokenAxis&&i.brokenAxis.hasBreaks&&(i.options.ordinal=!1)}function o(){var i=this,t=i.brokenAxis;if(t&&t.hasBreaks){for(var r=i.tickPositions,n=i.tickPositions.info,e=[],s=0;s<r.length;s++)t.isInAnyBreak(r[s])||e.push(r[s]);i.tickPositions=e,i.tickPositions.info=n}}function a(){var i=this;i.brokenAxis||(i.brokenAxis=new t(i))}function f(){var i=this,t=i.isDirty,r=i.options.connectNulls,n=i.points,e=i.xAxis,s=i.yAxis;if(t)for(var o=n.length;o--;){var a=n[o],f=!(null===a.y&&!1===r)&&(e&&e.brokenAxis&&e.brokenAxis.isInAnyBreak(a.x,!0)||s&&s.brokenAxis&&s.brokenAxis.isInAnyBreak(a.y,!0));a.visible=!f&&!1!==a.options.visible}}function u(){this.drawBreaks(this.xAxis,["x"]),this.drawBreaks(this.yAxis,pick(this.pointArrayMap,["y"]))}function k(r,i){var n,e,s,o,t,a=this,f=a.points;r&&r.brokenAxis&&r.brokenAxis.hasBreaks&&(t=r.brokenAxis,i.forEach(function(i){n=t&&t.breakArray||[],e=r.isXAxis?r.min:pick(a.options.threshold,r.min),f.forEach(function(t){o=pick(t["stack"+i.toUpperCase()],t[i]),n.forEach(function(i){isNumber(e)&&isNumber(o)&&(s=!1,e<i.from&&o>i.to||e>i.from&&o<i.from?s="pointBreak":(e<i.from&&o>i.from&&o<i.to||e>i.from&&o>i.to&&o<i.from)&&(s="pointInBreak"),s&&fireEvent(r,s,{point:t,brk:i}))})})}))}function c(){var i=this.currentDataGrouping,i=i&&i.gapSize,t=this.points.slice(),r=this.yAxis,n=this.options.gapSize,e=t.length-1;if(n&&0<e){"value"!==this.options.gapUnit&&(n*=this.basePointRange),i&&n<i&&i>=this.basePointRange&&(n=i);for(var s,o,a=void 0;e--;)a&&!1!==a.visible||(a=t[e+1]),s=t[e],!1!==a.visible&&!1!==s.visible&&(a.x-s.x>n&&(o=(s.x+a.x)/2,t.splice(e+1,0,{isNull:!0,x:o}),r.stacking&&this.options.stacking&&((r.stacking.stacks[this.stackKey][o]=new StackItem(r,r.options.stackLabels,!1,o,this.stack)).total=0)),a=s)}return this.getGraphPath(t)}i.compose=function(i,t){var r;return-1===n.indexOf(i)&&(n.push(i),i.keepProps.push("brokenAxis"),addEvent(i,"init",a),addEvent(i,"afterInit",e),addEvent(i,"afterSetTickPositions",o),addEvent(i,"afterSetOptions",s)),-1===n.indexOf(t)&&(n.push(t),(r=t.prototype).drawBreaks=k,r.gappedPath=c,addEvent(t,"afterGeneratePoints",f),addEvent(t,"afterRender",u)),i};var t=(l.isInBreak=function(i,t){var r=i.repeat||1/0,n=i.from,e=i.to-i.from,r=n<=t?(t-n)%r:r-(n-t)%r,r=i.inclusive?r<=e:r<e&&0!=r;return r},l.lin2Val=function(i){var t=this.brokenAxis,r=t&&t.breakArray;if(!r||!isNumber(i))return i;for(var n,e=i,s=0;s<r.length&&!((n=r[s]).from>=e);s++)(n.to<e||l.isInBreak(n,e))&&(e+=n.len);return e},l.val2Lin=function(i){var t=this.brokenAxis,r=t&&t.breakArray;if(!r||!isNumber(i))return i;for(var n,e=i,s=0;s<r.length;s++)if((n=r[s]).to<=i)e-=n.len;else{if(n.from>=i)break;if(l.isInBreak(n,i)){e-=i-n.from;break}}return e},l.prototype.findBreakAt=function(t,i){return find(i,function(i){return i.from<t&&t<i.to})},l.prototype.isInAnyBreak=function(i,t){var r,n,e,s=this.axis,o=s.options.breaks||[],a=o.length;if(a&&isNumber(i)){for(;a--;)l.isInBreak(o[a],i)&&(r=!0,n=n||pick(o[a].showPoints,!s.isXAxis));e=r&&t?r&&!n:r}return e},l.prototype.setBreaks=function(i,t){var c=this,h=c.axis,r=isArray(i)&&!!i.length;h.isDirty=c.hasBreaks!==r,c.hasBreaks=r,h.options.breaks=h.userOptions.breaks=i,h.forceRedraw=!0,h.series.forEach(function(i){i.isDirty=!0}),r||h.val2lin!==l.val2Lin||(delete h.val2lin,delete h.lin2val),r&&(h.userOptions.ordinal=!1,h.lin2val=l.lin2Val,h.val2lin=l.val2Lin,h.setExtremes=function(i,t,r,n,e){if(c.hasBreaks){for(var s=this.options.breaks||[],o=void 0;o=c.findBreakAt(i,s);)i=o.to;for(;o=c.findBreakAt(t,s);)t=o.from;t<i&&(t=i)}h.constructor.prototype.setExtremes.call(this,i,t,r,n,e)},h.setAxisTranslation=function(){var i,t,r,n,e,s,o,a,f,u,k;h.constructor.prototype.setAxisTranslation.call(this),c.unitLength=void 0,c.hasBreaks&&(i=h.options.breaks||[],t=[],r=[],n=pick(h.pointRangePadding,0),e=0,a=h.userMin||h.min,f=h.userMax||h.max,i.forEach(function(i){o=i.repeat||1/0,isNumber(a)&&isNumber(f)&&(l.isInBreak(i,a)&&(a+=i.to%o-a%o),l.isInBreak(i,f)&&(f-=f%o-i.from%o))}),i.forEach(function(i){if(u=i.from,o=i.repeat||1/0,isNumber(a)&&isNumber(f)){for(;a<u-o;)u-=o;for(;u<a;)u+=o;for(k=u;k<f;k+=o)t.push({value:k,move:"in"}),t.push({value:k+i.to-i.from,move:"out",size:i.breakSize})}}),t.sort(function(i,t){return i.value===t.value?("in"===i.move?0:1)-("in"===t.move?0:1):i.value-t.value}),s=0,u=a,t.forEach(function(i){1===(s+="in"===i.move?1:-1)&&"in"===i.move&&(u=i.value),0===s&&isNumber(u)&&(r.push({from:u,to:i.value,len:i.value-u-(i.size||0)}),e+=i.value-u-(i.size||0))}),c.breakArray=r,isNumber(a)&&isNumber(f)&&isNumber(h.min)&&(c.unitLength=f-a-e+n,fireEvent(h,"afterBreaks"),h.staticScale?h.transA=h.staticScale:c.unitLength&&(h.transA*=(f-h.min+n)/c.unitLength),n&&(h.minPixelPadding=h.transA*(h.minPointOffset||0)),h.min=a,h.max=f))}),pick(t,!0)&&h.chart.redraw()},l);function l(i){this.hasBreaks=!1,this.axis=i}i.Additions=t}(BrokenAxis=BrokenAxis||{});export default BrokenAxis;