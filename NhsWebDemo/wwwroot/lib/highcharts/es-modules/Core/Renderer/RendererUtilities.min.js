"use strict";import U from"../Utilities.js";var RendererUtilities,clamp=U.clamp,pick=U.pick,stableSort=U.stableSort;(RendererUtilities||(RendererUtilities={})).distribute=function r(e,i,s){for(var t,n,a=e,o=a.reducedLen||i,l=function(e,t){return e.target-t.target},p=!0,c=[],u=0,g=e.length;g--;)u+=e[g].size;if(o<u){for(stableSort(e,function(e,t){return(t.rank||0)-(e.rank||0)}),u=g=0;u<=o;)u+=e[g].size,g++;c=e.splice(g-1,e.length)}for(stableSort(e,l),e=e.map(function(e){return{size:e.size,targets:[e.target],align:pick(e.align,.5)}});p;){for(g=e.length;g--;)t=e[g],n=(Math.min.apply(0,t.targets)+Math.max.apply(0,t.targets))/2,t.pos=clamp(n-t.size*t.align,0,i-t.size);for(g=e.length,p=!1;g--;)0<g&&e[g-1].pos+e[g-1].size>e[g].pos&&(e[g-1].size+=e[g].size,e[g-1].targets=e[g-1].targets.concat(e[g].targets),e[g-1].align=.5,e[g-1].pos+e[g-1].size>i&&(e[g-1].pos=i-e[g-1].size),e.splice(g,1),p=!0)}return a.push.apply(a,c),g=0,e.some(function(e){var t=0;return(e.targets||[]).some(function(){return a[g].pos=e.pos+t,void 0!==s&&Math.abs(a[g].pos-a[g].target)>s?(a.slice(0,g+1).forEach(function(e){return delete e.pos}),a.reducedLen=(a.reducedLen||i)-.1*i,a.reducedLen>.1*i&&r(a,i,s),!0):(t+=a[g].size,g++,!1)})}),stableSort(a,l),a};export default RendererUtilities;