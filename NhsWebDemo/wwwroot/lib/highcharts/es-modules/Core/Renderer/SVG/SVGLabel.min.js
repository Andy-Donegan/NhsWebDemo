var __extends=this&&this.__extends||function(){var h=function(t,e){return(h=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)};return function(t,e){function i(){this.constructor=t}h(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}}();import SVGElement from"./SVGElement.js";import U from"../../Utilities.js";var defined=U.defined,extend=U.extend,isNumber=U.isNumber,merge=U.merge,pick=U.pick,removeEvent=U.removeEvent,SVGLabel=function(g){function c(t,e,i,h,s,o,r,n,d,a){var x,p=g.call(this)||this;return p.paddingLeftSetter=p.paddingSetter,p.paddingRightSetter=p.paddingSetter,p.init(t,"g"),p.textStr=e,p.x=i,p.y=h,p.anchorX=o,p.anchorY=r,p.baseline=d,p.className=a,p.addClass("button"===a?"highcharts-no-tooltip":"highcharts-label"),a&&p.addClass("highcharts-"+a),p.text=t.text(void 0,0,0,n).attr({zIndex:1}),"string"==typeof s&&((x=/^url\((.*?)\)$/.test(s))||p.renderer.symbols[s])&&(p.symbolKey=s),p.bBox=c.emptyBBox,p.padding=3,p.baselineOffset=0,p.needsBox=t.styledMode||x,p.deferredAttr={},p.alignFactor=0,p}return __extends(c,g),c.prototype.alignSetter=function(t){t={left:0,center:.5,right:1}[t];t!==this.alignFactor&&(this.alignFactor=t,this.bBox&&isNumber(this.xSetting)&&this.attr({x:this.xSetting}))},c.prototype.anchorXSetter=function(t,e){this.anchorX=t,this.boxAttr(e,Math.round(t)-this.getCrispAdjust()-this.xSetting)},c.prototype.anchorYSetter=function(t,e){this.anchorY=t,this.boxAttr(e,t-this.ySetting)},c.prototype.boxAttr=function(t,e){this.box?this.box.attr(t,e):this.deferredAttr[t]=e},c.prototype.css=function(e){var i,t;return e&&(i={},e=merge(e),c.textProps.forEach(function(t){void 0!==e[t]&&(i[t]=e[t],delete e[t])}),this.text.css(i),t="width"in i,"fontSize"in i||"fontWeight"in i?this.updateTextPadding():t&&this.updateBoxSize()),SVGElement.prototype.css.call(this,e)},c.prototype.destroy=function(){removeEvent(this.element,"mouseenter"),removeEvent(this.element,"mouseleave"),this.text&&this.text.destroy(),this.box&&(this.box=this.box.destroy()),SVGElement.prototype.destroy.call(this)},c.prototype.fillSetter=function(t,e){t&&(this.needsBox=!0),this.fill=t,this.boxAttr(e,t)},c.prototype.getBBox=function(){this.textStr&&0===this.bBox.width&&0===this.bBox.height&&this.updateBoxSize();var t=this.padding,e=pick(this.paddingLeft,t);return{width:this.width,height:this.height,x:this.bBox.x-e,y:this.bBox.y-t}},c.prototype.getCrispAdjust=function(){return this.renderer.styledMode&&this.box?this.box.strokeWidth()%2/2:(this["stroke-width"]?parseInt(this["stroke-width"],10):0)%2/2},c.prototype.heightSetter=function(t){this.heightSetting=t},c.prototype.onAdd=function(){var t=this.textStr;this.text.add(this),this.attr({text:defined(t)?t:"",x:this.x,y:this.y}),this.box&&defined(this.anchorX)&&this.attr({anchorX:this.anchorX,anchorY:this.anchorY})},c.prototype.paddingSetter=function(t,e){isNumber(t)?t!==this[e]&&(this[e]=t,this.updateTextPadding()):this[e]=void 0},c.prototype.rSetter=function(t,e){this.boxAttr(e,t)},c.prototype.shadow=function(t){return t&&!this.renderer.styledMode&&(this.updateBoxSize(),this.box&&this.box.shadow(t)),this},c.prototype.strokeSetter=function(t,e){this.stroke=t,this.boxAttr(e,t)},c.prototype["stroke-widthSetter"]=function(t,e){t&&(this.needsBox=!0),this["stroke-width"]=t,this.boxAttr(e,t)},c.prototype["text-alignSetter"]=function(t){this.textAlign=t},c.prototype.textSetter=function(t){void 0!==t&&this.text.attr({text:t}),this.updateTextPadding()},c.prototype.updateBoxSize=function(){var t=this.text.element.style,e={},i=this.padding,h=this.bBox=isNumber(this.widthSetting)&&isNumber(this.heightSetting)&&!this.textAlign||!defined(this.text.textStr)?c.emptyBBox:this.text.getBBox();this.width=this.getPaddedWidth(),this.height=(this.heightSetting||h.height||0)+2*i;var s,t=this.renderer.fontMetrics(t&&t.fontSize,this.text);this.baselineOffset=i+Math.min((this.text.firstLineMetrics||t).b,h.height||1/0),this.heightSetting&&(this.baselineOffset+=(this.heightSetting-t.h)/2),this.needsBox&&(this.box||((s=this.box=this.symbolKey?this.renderer.symbol(this.symbolKey):this.renderer.rect()).addClass(("button"===this.className?"":"highcharts-label-box")+(this.className?" highcharts-"+this.className+"-box":"")),s.add(this)),s=this.getCrispAdjust(),e.x=s,e.y=(this.baseline?-this.baselineOffset:0)+s,e.width=Math.round(this.width),e.height=Math.round(this.height),this.box.attr(extend(e,this.deferredAttr)),this.deferredAttr={})},c.prototype.updateTextPadding=function(){var t=this.text;this.updateBoxSize();var e=this.baseline?0:this.baselineOffset,i=pick(this.paddingLeft,this.padding);defined(this.widthSetting)&&this.bBox&&("center"===this.textAlign||"right"===this.textAlign)&&(i+={center:.5,right:1}[this.textAlign]*(this.widthSetting-this.bBox.width)),i===t.x&&e===t.y||(t.attr("x",i),t.hasBoxWidthChanged&&(this.bBox=t.getBBox(!0)),void 0!==e&&t.attr("y",e)),t.x=i,t.y=e},c.prototype.widthSetter=function(t){this.widthSetting=isNumber(t)?t:void 0},c.prototype.getPaddedWidth=function(){var t=this.padding,e=pick(this.paddingLeft,t),t=pick(this.paddingRight,t);return(this.widthSetting||this.bBox.width||0)+e+t},c.prototype.xSetter=function(t){this.x=t,this.alignFactor&&(t-=this.alignFactor*this.getPaddedWidth(),this["forceAnimate:x"]=!0),this.xSetting=Math.round(t),this.attr("translateX",this.xSetting)},c.prototype.ySetter=function(t){this.ySetting=this.y=Math.round(t),this.attr("translateY",this.ySetting)},c.emptyBBox={width:0,height:0,x:0,y:0},c.textProps=["color","direction","fontFamily","fontSize","fontStyle","fontWeight","lineHeight","textAlign","textDecoration","textOutline","textOverflow","width"],c}(SVGElement);export default SVGLabel;