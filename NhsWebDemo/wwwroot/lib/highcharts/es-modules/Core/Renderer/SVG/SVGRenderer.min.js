"use strict";import AST from"../HTML/AST.js";import Color from"../../Color/Color.js";import H from"../../Globals.js";var charts=H.charts,deg2rad=H.deg2rad,doc=H.doc,isFirefox=H.isFirefox,isMS=H.isMS,isWebKit=H.isWebKit,noop=H.noop,SVG_NS=H.SVG_NS,symbolSizes=H.symbolSizes,win=H.win;import RendererRegistry from"../RendererRegistry.js";import SVGElement from"./SVGElement.js";import SVGLabel from"./SVGLabel.js";import Symbols from"./Symbols.js";import TextBuilder from"./TextBuilder.js";import U from"../../Utilities.js";var hasInternalReferenceBug,addEvent=U.addEvent,attr=U.attr,createElement=U.createElement,css=U.css,defined=U.defined,destroyObjectProperties=U.destroyObjectProperties,extend=U.extend,isArray=U.isArray,isNumber=U.isNumber,isObject=U.isObject,isString=U.isString,merge=U.merge,pick=U.pick,pInt=U.pInt,uniqueKey=U.uniqueKey,SVGRenderer=function(){function t(t,e,i,r,n,s,o){this.alignedObjects=void 0,this.box=void 0,this.boxWrapper=void 0,this.cache=void 0,this.cacheKeys=void 0,this.chartIndex=void 0,this.defs=void 0,this.globalAnimation=void 0,this.gradients=void 0,this.height=void 0,this.imgCount=void 0,this.isSVG=void 0,this.style=void 0,this.url=void 0,this.width=void 0,this.init(t,e,i,r,n,s,o)}return t.prototype.init=function(t,e,i,r,n,s,o){var a,h=this,d=h.createElement("svg").attr({version:"1.1",class:"highcharts-root"}),l=d.element;o||d.css(this.getStyle(r)),t.appendChild(l),attr(t,"dir","ltr"),-1===t.innerHTML.indexOf("xmlns")&&attr(l,"xmlns",this.SVG_NS),h.isSVG=!0,this.box=l,this.boxWrapper=d,h.alignedObjects=[],this.url=this.getReferenceURL(),this.createElement("desc").add().element.appendChild(doc.createTextNode("Created with Highcharts 9.3.3")),h.defs=this.createElement("defs").add(),h.allowHTML=s,h.forExport=n,h.styledMode=o,h.gradients={},h.cache={},h.cacheKeys=[],h.imgCount=0,h.setSize(e,i,!1),isFirefox&&t.getBoundingClientRect&&((i=function(){css(t,{left:0,top:0}),a=t.getBoundingClientRect(),css(t,{left:Math.ceil(a.left)-a.left+"px",top:Math.ceil(a.top)-a.top+"px"})})(),h.unSubPixelFix=addEvent(win,"resize",i))},t.prototype.definition=function(t){return new AST([t]).addToDOM(this.defs.element)},t.prototype.getReferenceURL=function(){var t,e;if((isFirefox||isWebKit)&&doc.getElementsByTagName("base").length&&(defined(hasInternalReferenceBug)||(e=uniqueKey(),t=new AST([{tagName:"svg",attributes:{width:8,height:8},children:[{tagName:"defs",children:[{tagName:"clipPath",attributes:{id:e},children:[{tagName:"rect",attributes:{width:4,height:4}}]}]},{tagName:"rect",attributes:{id:"hitme",width:8,height:8,"clip-path":"url(#"+e+")",fill:"rgba(0,0,0,0.001)"}}]}]).addToDOM(doc.body),css(t,{position:"fixed",top:0,left:0,zIndex:9e5}),e=doc.elementFromPoint(6,6),hasInternalReferenceBug="hitme"===(e&&e.id),doc.body.removeChild(t)),hasInternalReferenceBug))return win.location.href.split("#")[0].replace(/<[^>]*>/g,"").replace(/([\('\)])/g,"\\$1").replace(/ /g,"%20");return""},t.prototype.getStyle=function(t){return this.style=extend({fontFamily:'"Lucida Grande", "Lucida Sans Unicode", Arial, Helvetica, sans-serif',fontSize:"12px"},t),this.style},t.prototype.setStyle=function(t){this.boxWrapper.css(this.getStyle(t))},t.prototype.isHidden=function(){return!this.boxWrapper.getBBox().width},t.prototype.destroy=function(){var t=this,e=t.defs;return t.box=null,t.boxWrapper=t.boxWrapper.destroy(),destroyObjectProperties(t.gradients||{}),t.gradients=null,e&&(t.defs=e.destroy()),t.unSubPixelFix&&t.unSubPixelFix(),t.alignedObjects=null},t.prototype.createElement=function(t){var e=new this.Element;return e.init(this,t),e},t.prototype.getRadialAttr=function(t,e){return{cx:t[0]-t[2]/2+(e.cx||0)*t[2],cy:t[1]-t[2]/2+(e.cy||0)*t[2],r:(e.r||0)*t[2]}},t.prototype.buildText=function(t){new TextBuilder(t).buildSVG()},t.prototype.getContrast=function(t){return(t=Color.parse(t).rgba)[0]*=1,t[1]*=1.2,t[2]*=.5,459<t[0]+t[1]+t[2]?"#000000":"#FFFFFF"},t.prototype.button=function(t,e,i,r,n,s,o,a,h,d){var l,c,u,p,m=this.label(t,e,i,h,void 0,void 0,d,void 0,"button"),g=this.styledMode,f=0,n=(y=n?merge(n):{})&&y.style||{},y=AST.filterUserAttributes(y);return m.attr(merge({padding:8,r:2},y)),g||(y=merge({fill:"#f7f7f7",stroke:"#cccccc","stroke-width":1,style:{color:"#333333",cursor:"pointer",fontWeight:"normal"}},{style:n},y),l=y.style,delete y.style,s=merge(y,{fill:"#e6e6e6"},AST.filterUserAttributes(s||{})),c=s.style,delete s.style,o=merge(y,{fill:"#e6ebf5",style:{color:"#000000",fontWeight:"bold"}},AST.filterUserAttributes(o||{})),u=o.style,delete o.style,a=merge(y,{style:{color:"#cccccc"}},AST.filterUserAttributes(a||{})),p=a.style,delete a.style),addEvent(m.element,isMS?"mouseover":"mouseenter",function(){3!==f&&m.setState(1)}),addEvent(m.element,isMS?"mouseout":"mouseleave",function(){3!==f&&m.setState(f)}),m.setState=function(t){1!==t&&(m.state=f=t),m.removeClass(/highcharts-button-(normal|hover|pressed|disabled)/).addClass("highcharts-button-"+["normal","hover","pressed","disabled"][t||0]),g||m.attr([y,s,o,a][t||0]).css([l,c,u,p][t||0])},g||m.attr(y).css(extend({cursor:"default"},l)),m.on("touchstart",function(t){return t.stopPropagation()}).on("click",function(t){3!==f&&r.call(m,t)})},t.prototype.crispLine=function(t,e,i){void 0===i&&(i="round");var r=t[0],n=t[1];return defined(r[1])&&r[1]===n[1]&&(r[1]=n[1]=Math[i](r[1])-e%2/2),defined(r[2])&&r[2]===n[2]&&(r[2]=n[2]=Math[i](r[2])+e%2/2),t},t.prototype.path=function(t){var e=this.styledMode?{}:{fill:"none"};return isArray(t)?e.d=t:isObject(t)&&extend(e,t),this.createElement("path").attr(e)},t.prototype.circle=function(t,e,i){e=isObject(t)?t:void 0===t?{}:{x:t,y:e,r:i},i=this.createElement("circle");return i.xSetter=i.ySetter=function(t,e,i){i.setAttribute("c"+e,t)},i.attr(e)},t.prototype.arc=function(t,e,i,r,n,s){isObject(t)?(e=(o=t).y,i=o.r,r=o.innerR,n=o.start,s=o.end,t=o.x):o={innerR:r,start:n,end:s};var o=this.symbol("arc",t,e,i,i,o);return o.r=i,o},t.prototype.rect=function(t,e,i,r,n,s){n=isObject(t)?t.r:n;var o=this.createElement("rect"),r=isObject(t)?t:void 0===t?{}:{x:t,y:e,width:Math.max(i,0),height:Math.max(r,0)};return this.styledMode||(void 0!==s&&(r["stroke-width"]=s,r=o.crisp(r)),r.fill="none"),n&&(r.r=n),o.rSetter=function(t,e,i){o.r=t,attr(i,{rx:t,ry:t})},o.rGetter=function(){return o.r||0},o.attr(r)},t.prototype.setSize=function(t,e,i){this.width=t,this.height=e,this.boxWrapper.animate({width:t,height:e},{step:function(){this.attr({viewBox:"0 0 "+this.attr("width")+" "+this.attr("height")})},duration:pick(i,!0)?void 0:0}),this.alignElements()},t.prototype.g=function(t){var e=this.createElement("g");return t?e.attr({class:"highcharts-"+t}):e},t.prototype.image=function(e,t,i,r,n,s){var o={preserveAspectRatio:"none"},a=function(t,e){t.setAttributeNS?t.setAttributeNS("http://www.w3.org/1999/xlink","href",e):t.setAttribute("hc-svg-href",e)};isNumber(t)&&(o.x=t),isNumber(i)&&(o.y=i),isNumber(r)&&(o.width=r),isNumber(n)&&(o.height=n);var h=this.createElement("image").attr(o),n=function(t){a(h.element,e),s.call(h,t)};return s?(a(h.element,"data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="),o=new win.Image,addEvent(o,"load",n),o.src=e,o.complete&&n({})):a(h.element,e),h},t.prototype.symbol=function(t,e,i,r,n,s){var o,a,h,d,l=this,c=/^url\((.*?)\)$/,u=c.test(t),p=!u&&(this.symbols[t]?t:"circle"),m=p&&this.symbols[p];return m?("number"==typeof e&&(o=m.call(this.symbols,Math.round(e||0),Math.round(i||0),r||0,n||0,s)),o=this.path(o),l.styledMode||o.attr("fill","none"),extend(o,{symbolName:p||void 0,x:e,y:i,width:r,height:n}),s&&extend(o,s)):u&&(h=t.match(c)[1],(d=o=this.image(h)).imgwidth=pick(symbolSizes[h]&&symbolSizes[h].width,s&&s.width),d.imgheight=pick(symbolSizes[h]&&symbolSizes[h].height,s&&s.height),a=function(t){return t.attr({width:t.width,height:t.height})},["width","height"].forEach(function(t){d[t+"Setter"]=function(t,e){var i=this["img"+e];this[e]=t,defined(i)&&(s&&"within"===s.backgroundSize&&this.width&&this.height&&(i=Math.round(i*Math.min(this.width/this.imgwidth,this.height/this.imgheight))),this.element&&this.element.setAttribute(e,i),this.alignByTranslate||(i=((this[e]||0)-i)/2,this.attr("width"===e?{translateX:i}:{translateY:i})))}}),defined(e)&&d.attr({x:e,y:i}),d.isImg=!0,defined(d.imgwidth)&&defined(d.imgheight)?a(d):(d.attr({width:0,height:0}),createElement("img",{onload:function(){var t=charts[l.chartIndex];0===this.width&&(css(this,{position:"absolute",top:"-999em"}),doc.body.appendChild(this)),symbolSizes[h]={width:this.width,height:this.height},d.imgwidth=this.width,d.imgheight=this.height,d.element&&a(d),this.parentNode&&this.parentNode.removeChild(this),l.imgCount--,l.imgCount||!t||t.hasLoaded||t.onload()},src:h}),this.imgCount++)),o},t.prototype.clipRect=function(t,e,i,r){var n=uniqueKey()+"-",s=this.createElement("clipPath").attr({id:n}).add(this.defs),r=this.rect(t,e,i,r,0).add(s);return r.id=n,r.clipPath=s,r.count=0,r},t.prototype.text=function(t,e,i,r){var n=this,s={};if(r&&(n.allowHTML||!n.forExport))return n.html(t,e,i);s.x=Math.round(e||0),i&&(s.y=Math.round(i)),defined(t)&&(s.text=t);s=n.createElement("text").attr(s);return r&&(!n.forExport||n.allowHTML)||(s.xSetter=function(t,e,i){for(var r=i.getElementsByTagName("tspan"),n=i.getAttribute(e),s=0,o=void 0;s<r.length;s++)(o=r[s]).getAttribute(e)===n&&o.setAttribute(e,t);i.setAttribute(e,t)}),s},t.prototype.fontMetrics=function(t,e){t=!this.styledMode&&/px/.test(t)||!win.getComputedStyle?t||e&&e.style&&e.style.fontSize||this.style&&this.style.fontSize:e&&SVGElement.prototype.getStyle.call(e,"font-size");e=(t=/px/.test(t)?pInt(t):12)<24?t+3:Math.round(1.2*t);return{h:e,b:Math.round(.8*e),f:t}},t.prototype.rotCorr=function(t,e,i){var r=t;return e&&i&&(r=Math.max(r*Math.cos(e*deg2rad),4)),{x:-t/3*Math.sin(e*deg2rad),y:r}},t.prototype.pathToSegments=function(t){for(var e=[],i=[],r={A:8,C:7,H:2,L:3,M:3,Q:5,S:5,T:3,V:2},n=0;n<t.length;n++)isString(i[0])&&isNumber(t[n])&&i.length===r[i[0].toUpperCase()]&&t.splice(n,0,i[0].replace("M","L").replace("m","l")),"string"==typeof t[n]&&(i.length&&e.push(i.slice(0)),i.length=0),i.push(t[n]);return e.push(i.slice(0)),e},t.prototype.label=function(t,e,i,r,n,s,o,a,h){return new SVGLabel(this,t,e,i,r,n,s,o,a,h)},t.prototype.alignElements=function(){this.alignedObjects.forEach(function(t){return t.align()})},t}();extend(SVGRenderer.prototype,{Element:SVGElement,SVG_NS:SVG_NS,escapes:{"&":"&amp;","<":"&lt;",">":"&gt;","'":"&#39;",'"':"&quot;"},symbols:Symbols,draw:noop}),RendererRegistry.registerRendererType("svg",SVGRenderer,!0);export default SVGRenderer;