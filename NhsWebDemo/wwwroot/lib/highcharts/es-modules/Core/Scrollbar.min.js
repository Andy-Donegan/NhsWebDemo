"use strict";import D from"./DefaultOptions.js";var defaultOptions=D.defaultOptions;import H from"./Globals.js";import ScrollbarAxis from"./Axis/ScrollbarAxis.js";import ScrollbarDefaults from"./ScrollbarDefaults.js";import U from"./Utilities.js";var addEvent=U.addEvent,correctFloat=U.correctFloat,defined=U.defined,destroyObjectProperties=U.destroyObjectProperties,fireEvent=U.fireEvent,merge=U.merge,pick=U.pick,removeEvent=U.removeEvent,Scrollbar=function(){function l(t,r,o){this._events=[],this.chart=void 0,this.chartX=0,this.chartY=0,this.from=0,this.group=void 0,this.options=void 0,this.renderer=void 0,this.scrollbar=void 0,this.scrollbarButtons=[],this.scrollbarGroup=void 0,this.scrollbarLeft=0,this.scrollbarRifles=void 0,this.scrollbarStrokeWidth=1,this.scrollbarTop=0,this.size=0,this.to=0,this.track=void 0,this.trackBorderWidth=1,this.userOptions=void 0,this.x=0,this.y=0,this.init(t,r,o)}return l.compose=function(t){ScrollbarAxis.compose(t,l)},l.swapXY=function(t,r){return r&&t.forEach(function(t){for(var r,o=t.length,e=0;e<o;e+=2)"number"==typeof(r=t[e+1])&&(t[e+1]=t[e+2],t[e+2]=r)}),t},l.prototype.addEvents=function(){var t=this.options.inverted?[1,0]:[0,1],r=this.scrollbarButtons,o=this.scrollbarGroup.element,e=this.track.element,i=this.mouseDownHandler.bind(this),s=this.mouseMoveHandler.bind(this),a=this.mouseUpHandler.bind(this),e=[[r[t[0]].element,"click",this.buttonToMinClick.bind(this)],[r[t[1]].element,"click",this.buttonToMaxClick.bind(this)],[e,"click",this.trackClick.bind(this)],[o,"mousedown",i],[o.ownerDocument,"mousemove",s],[o.ownerDocument,"mouseup",a]];H.hasTouch&&e.push([o,"touchstart",i],[o.ownerDocument,"touchmove",s],[o.ownerDocument,"touchend",a]),e.forEach(function(t){addEvent.apply(null,t)}),this._events=e},l.prototype.buttonToMaxClick=function(t){var r=this,o=(r.to-r.from)*pick(r.options.step,.2);r.updatePosition(r.from+o,r.to+o),fireEvent(r,"changed",{from:r.from,to:r.to,trigger:"scrollbar",DOMEvent:t})},l.prototype.buttonToMinClick=function(t){var r=this,o=correctFloat(r.to-r.from)*pick(r.options.step,.2);r.updatePosition(correctFloat(r.from-o),correctFloat(r.to-o)),fireEvent(r,"changed",{from:r.from,to:r.to,trigger:"scrollbar",DOMEvent:t})},l.prototype.cursorToScrollbarPosition=function(t){var r=this,o=r.options,o=o.minWidth>r.calculatedWidth?o.minWidth:0;return{chartX:(t.chartX-r.x-r.xOffset)/(r.barWidth-o),chartY:(t.chartY-r.y-r.yOffset)/(r.barWidth-o)}},l.prototype.destroy=function(){var r=this,t=r.chart.scroller;r.removeEvents(),["track","scrollbarRifles","scrollbar","scrollbarGroup","group"].forEach(function(t){r[t]&&r[t].destroy&&(r[t]=r[t].destroy())}),t&&r===t.scrollbar&&(t.scrollbar=null,destroyObjectProperties(t.scrollbarButtons))},l.prototype.drawScrollbarButton=function(t){var r=this,o=r.renderer,e=r.scrollbarButtons,i=r.options,s=r.size,a=o.g().add(r.group);e.push(a),a=o.rect().addClass("highcharts-scrollbar-button").add(a),r.chart.styledMode||a.attr({stroke:i.buttonBorderColor,"stroke-width":i.buttonBorderWidth,fill:i.buttonBackgroundColor}),a.attr(a.crisp({x:-.5,y:-.5,width:s+1,height:s+1,r:i.buttonBorderRadius},a.strokeWidth())),a=o.path(l.swapXY([["M",s/2+(t?-1:1),s/2-3],["L",s/2+(t?-1:1),s/2+3],["L",s/2+(t?2:-2),s/2]],i.vertical)).addClass("highcharts-scrollbar-arrow").add(e[t]),r.chart.styledMode||a.attr({fill:i.buttonArrowColor})},l.prototype.init=function(t,r,o){var e=this;e.scrollbarButtons=[],e.renderer=t,e.userOptions=r,e.options=merge(ScrollbarDefaults,defaultOptions.scrollbar,r),e.chart=o,e.size=pick(e.options.size,e.options.height),r.enabled&&(e.render(),e.addEvents())},l.prototype.mouseDownHandler=function(t){var r=this,t=r.chart.pointer.normalize(t),t=r.cursorToScrollbarPosition(t);r.chartX=t.chartX,r.chartY=t.chartY,r.initPositions=[r.from,r.to],r.grabbedCenter=!0},l.prototype.mouseMoveHandler=function(t){var r=this,o=r.chart.pointer.normalize(t),e=r.options.vertical?"chartY":"chartX",i=r.initPositions||[];!r.grabbedCenter||t.touches&&0===t.touches[0][e]||(e=r.cursorToScrollbarPosition(o)[e]-r[e],r.hasDragged=!0,r.updatePosition(i[0]+e,i[1]+e),r.hasDragged&&fireEvent(r,"changed",{from:r.from,to:r.to,trigger:"scrollbar",DOMType:t.type,DOMEvent:t}))},l.prototype.mouseUpHandler=function(t){var r=this;r.hasDragged&&fireEvent(r,"changed",{from:r.from,to:r.to,trigger:"scrollbar",DOMType:t.type,DOMEvent:t}),r.grabbedCenter=r.hasDragged=r.chartX=r.chartY=null},l.prototype.position=function(t,r,o,e){var i=this,s=i.options.vertical,a=i.rendered?"animate":"attr",l=e,n=0;i.x=t,i.y=r+this.trackBorderWidth,i.width=o,i.height=e,i.xOffset=l,i.yOffset=n,s?(i.width=i.yOffset=o=n=i.size,i.xOffset=l=0,i.barWidth=e-2*o,i.x=t+=i.options.margin):(i.height=i.xOffset=e=l=i.size,i.barWidth=o-2*e,i.y=i.y+i.options.margin),i.group[a]({translateX:t,translateY:i.y}),i.track[a]({width:o,height:e}),i.scrollbarButtons[1][a]({translateX:s?0:o-l,translateY:s?e-n:0})},l.prototype.removeEvents=function(){this._events.forEach(function(t){removeEvent.apply(null,t)}),this._events.length=0},l.prototype.render=function(){var t=this,r=t.renderer,o=t.options,e=t.size,i=t.chart.styledMode,s=r.g("scrollbar").attr({zIndex:o.zIndex,translateY:-99999}).add();t.group=s,t.track=r.rect().addClass("highcharts-scrollbar-track").attr({x:0,r:o.trackBorderRadius||0,height:e,width:e}).add(s),i||t.track.attr({fill:o.trackBackgroundColor,stroke:o.trackBorderColor,"stroke-width":o.trackBorderWidth}),t.trackBorderWidth=t.track.strokeWidth(),t.track.attr({y:-this.trackBorderWidth%2/2}),t.scrollbarGroup=r.g().add(s),t.scrollbar=r.rect().addClass("highcharts-scrollbar-thumb").attr({height:e,width:e,r:o.barBorderRadius||0}).add(t.scrollbarGroup),t.scrollbarRifles=r.path(l.swapXY([["M",-3,e/4],["L",-3,2*e/3],["M",0,e/4],["L",0,2*e/3],["M",3,e/4],["L",3,2*e/3]],o.vertical)).addClass("highcharts-scrollbar-rifles").add(t.scrollbarGroup),i||(t.scrollbar.attr({fill:o.barBackgroundColor,stroke:o.barBorderColor,"stroke-width":o.barBorderWidth}),t.scrollbarRifles.attr({stroke:o.rifleColor,"stroke-width":1})),t.scrollbarStrokeWidth=t.scrollbar.strokeWidth(),t.scrollbarGroup.translate(-t.scrollbarStrokeWidth%2/2,-t.scrollbarStrokeWidth%2/2),t.drawScrollbarButton(0),t.drawScrollbarButton(1)},l.prototype.setRange=function(t,r){var o,e,i=this,s=i.options,a=s.vertical,l=s.minWidth,n=i.barWidth,c=!this.rendered||this.hasDragged||this.chart.navigator&&this.chart.navigator.hasDragged?"attr":"animate";defined(n)&&(o=n*Math.min(r,1),t=Math.max(t,0),e=Math.ceil(n*t),i.calculatedWidth=o=correctFloat(o-e),o<l&&(e=(n-l+o)*t,o=l),l=Math.floor(e+i.xOffset+i.yOffset),e=o/2-.5,i.from=t,i.to=r,a?(i.scrollbarGroup[c]({translateY:l}),i.scrollbar[c]({height:o}),i.scrollbarRifles[c]({translateY:e}),i.scrollbarTop=l,i.scrollbarLeft=0):(i.scrollbarGroup[c]({translateX:l}),i.scrollbar[c]({width:o}),i.scrollbarRifles[c]({translateX:e}),i.scrollbarLeft=l,i.scrollbarTop=0),o<=12?i.scrollbarRifles.hide():i.scrollbarRifles.show(!0),!1===s.showFull&&(t<=0&&1<=r?i.group.hide():i.group.show()),i.rendered=!0)},l.prototype.shouldUpdateExtremes=function(t){return pick(this.options.liveRedraw,H.svg&&!H.isTouchDevice&&!this.chart.isBoosting)||"mouseup"===t||"touchend"===t||!defined(t)},l.prototype.trackClick=function(t){var r=this,o=r.chart.pointer.normalize(t),e=r.to-r.from,i=r.y+r.scrollbarTop,s=r.x+r.scrollbarLeft;r.options.vertical&&o.chartY>i||!r.options.vertical&&o.chartX>s?r.updatePosition(r.from+e,r.to+e):r.updatePosition(r.from-e,r.to-e),fireEvent(r,"changed",{from:r.from,to:r.to,trigger:"scrollbar",DOMEvent:t})},l.prototype.update=function(t){this.destroy(),this.init(this.chart.renderer,merge(!0,this.options,t),this.chart)},l.prototype.updatePosition=function(t,r){1<r&&(t=correctFloat(1-correctFloat(r-t)),r=1),t<0&&(r=correctFloat(r-t),t=0),this.from=t,this.to=r},l.defaultOptions=ScrollbarDefaults,l}();defaultOptions.scrollbar=merge(!0,Scrollbar.defaultOptions,defaultOptions.scrollbar);export default Scrollbar;