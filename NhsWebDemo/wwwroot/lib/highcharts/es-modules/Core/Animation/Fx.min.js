"use strict";import Color from"../Color/Color.js";var color=Color.parse;import H from"../Globals.js";var win=H.win;import U from"../Utilities.js";var isNumber=U.isNumber,objectEach=U.objectEach,Fx=function(){function l(t,e,i){this.pos=NaN,this.options=e,this.elem=t,this.prop=i}return l.prototype.dSetter=function(){var t=this.paths,e=t&&t[0],i=t&&t[1],s=this.now||0,o=[];if(1!==s&&e&&i)if(e.length===i.length&&s<1)for(var r=0;r<i.length;r++){for(var n=e[r],h=i[r],l=[],p=0;p<h.length;p++){var a=n[p],u=h[p];isNumber(a)&&isNumber(u)&&("A"!==h[0]||4!==p&&5!==p)?l[p]=a+s*(u-a):l[p]=u}o.push(l)}else o=i;else o=this.toD||[];this.elem.attr("d",o,void 0,!0)},l.prototype.update=function(){var t=this.elem,e=this.prop,i=this.now,s=this.options.step;this[e+"Setter"]?this[e+"Setter"]():t.attr?t.element&&t.attr(e,i,null,!0):t.style[e]=i+this.unit,s&&s.call(t,i,this)},l.prototype.run=function(t,e,i){var s=this,o=s.options,r=function(t){return!r.stopped&&s.step(t)},n=win.requestAnimationFrame||function(t){setTimeout(t,13)},h=function(){for(var t=0;t<l.timers.length;t++)l.timers[t]()||l.timers.splice(t--,1);l.timers.length&&n(h)};t!==e||this.elem["forceAnimate:"+this.prop]?(this.startTime=+new Date,this.start=t,this.end=e,this.unit=i,this.now=this.start,this.pos=0,r.elem=this.elem,r.prop=this.prop,r()&&1===l.timers.push(r)&&n(h)):(delete o.curAnim[this.prop],o.complete&&0===Object.keys(o.curAnim).length&&o.complete.call(this.elem))},l.prototype.step=function(t){var e,i=+new Date,s=this.options,o=this.elem,r=s.complete,n=s.duration,h=s.curAnim,n=!(o.attr&&!o.element)&&(t||i>=n+this.startTime?(this.now=this.end,this.pos=1,this.update(),h[this.prop]=!0,e=!0,objectEach(h,function(t){!0!==t&&(e=!1)}),e&&r&&r.call(o),!1):(this.pos=s.easing((i-this.startTime)/n),this.now=this.start+(this.end-this.start)*this.pos,this.update(),!0));return n},l.prototype.initPath=function(t,e,i){var s,o,r,n,h=t.startX,l=t.endX,i=i.slice(),p=t.isArea,a=p?2:1,e=e&&e.slice();if(!e)return[i,i];function u(t,e){for(;t.length<o;){var i=t[0],s=e[o-t.length];s&&"M"===i[0]&&("C"===s[0]?t[0]=["C",i[1],i[2],i[1],i[2],i[1],i[2]]:t[0]=["L",i[1],i[2]]),t.unshift(i),p&&(i=t.pop(),t.push(t[t.length-1],i))}}function c(t){for(;t.length<o;){var e,i=t[Math.floor(t.length/a)-1].slice();"C"===i[0]&&(i[1]=i[5],i[2]=i[6]),p?(e=t[Math.floor(t.length/a)].slice(),t.splice(t.length/2,0,i,e)):t.push(i)}}if(h&&l&&l.length){for(r=0;r<h.length;r++){if(h[r]===l[0]){s=r;break}if(h[0]===l[l.length-h.length+r]){s=r,n=!0;break}if(h[h.length-1]===l[l.length-h.length+r]){s=h.length-r;break}}void 0===s&&(e=[])}return e.length&&isNumber(s)&&(o=i.length+s*a,n?(u(e,i),c(i)):(u(i,e),c(e))),[e,i]},l.prototype.fillSetter=function(){l.prototype.strokeSetter.apply(this,arguments)},l.prototype.strokeSetter=function(){this.elem.attr(this.prop,color(this.start).tweenTo(color(this.end),this.pos),void 0,!0)},l.timers=[],l}();export default Fx;