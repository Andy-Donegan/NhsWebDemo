"use strict";import Color from"../Color/Color.js";var color=Color.parse;import Math3D from"../../Extensions/Math3D.js";var perspective=Math3D.perspective,shapeArea3D=Math3D.shapeArea3D;import D from"../DefaultOptions.js";var genericDefaultOptions=D.defaultOptions;import U from"../Utilities.js";var Chart3D,addEvent=U.addEvent,isArray=U.isArray,merge=U.merge,pick=U.pick,wrap=U.wrap;!function(o){var e=(t.prototype.get3dFrame=function(){var a=this.chart,e=a.options.chart.options3d,t=e.frame,i=a.plotLeft,o=a.plotLeft+a.plotWidth,r=a.plotTop,l=a.plotTop+a.plotHeight,s=e.depth,x=function(e){e=shapeArea3D(e,a);return.5<e?1:e<-.5?-1:0},n=x([{x:i,y:l,z:s},{x:o,y:l,z:s},{x:o,y:l,z:0},{x:i,y:l,z:0}]),h=x([{x:i,y:r,z:0},{x:o,y:r,z:0},{x:o,y:r,z:s},{x:i,y:r,z:s}]),y=x([{x:i,y:r,z:0},{x:i,y:r,z:s},{x:i,y:l,z:s},{x:i,y:l,z:0}]),c=x([{x:o,y:r,z:s},{x:o,y:r,z:0},{x:o,y:l,z:0},{x:o,y:l,z:s}]),z=x([{x:i,y:l,z:0},{x:o,y:l,z:0},{x:o,y:r,z:0},{x:i,y:r,z:0}]),b=x([{x:i,y:r,z:s},{x:o,y:r,z:s},{x:o,y:l,z:s},{x:i,y:l,z:s}]),f=!1,p=!1,d=!1,g=!1;[].concat(a.xAxis,a.yAxis,a.zAxis).forEach(function(e){e&&(e.horiz?e.opposite?p=!0:f=!0:e.opposite?g=!0:d=!0)});x=function(e,t,i){for(var o=["size","color","visible"],r={},l=0;l<o.length;l++)for(var a=o[l],s=0;s<e.length;s++)if("object"==typeof e[s]){var x=e[s][a];if(null!=x){r[a]=x;break}}return!0===r.visible||!1===r.visible?i=r.visible:"auto"===r.visible&&(i=0<t),{size:pick(r.size,1),color:pick(r.color,"none"),frontFacing:0<t,visible:i}},y={axes:{},bottom:x([t.bottom,t.top,t],n,f),top:x([t.top,t.bottom,t],h,p),left:x([t.left,t.right,t.side,t],y,d),right:x([t.right,t.left,t.side,t],c,g),back:x([t.back,t.front,t],b,!0),front:x([t.front,t.back,t],z,!1)};return"auto"===e.axisLabelPosition?(c=[],(b=function(e,t){return e.visible!==t.visible||e.visible&&t.visible&&e.frontFacing!==t.frontFacing})(y.left,y.front)&&c.push({y:(r+l)/2,x:i,z:0,xDir:{x:1,y:0,z:0}}),b(y.left,y.back)&&c.push({y:(r+l)/2,x:i,z:s,xDir:{x:0,y:0,z:-1}}),b(y.right,y.front)&&c.push({y:(r+l)/2,x:o,z:0,xDir:{x:0,y:0,z:1}}),b(y.right,y.back)&&c.push({y:(r+l)/2,x:o,z:s,xDir:{x:-1,y:0,z:0}}),x=[],b(y.bottom,y.front)&&x.push({x:(i+o)/2,y:l,z:0,xDir:{x:1,y:0,z:0}}),b(y.bottom,y.back)&&x.push({x:(i+o)/2,y:l,z:s,xDir:{x:-1,y:0,z:0}}),t=[],b(y.top,y.front)&&t.push({x:(i+o)/2,y:r,z:0,xDir:{x:1,y:0,z:0}}),b(y.top,y.back)&&t.push({x:(i+o)/2,y:r,z:s,xDir:{x:-1,y:0,z:0}}),z=[],b(y.bottom,y.left)&&z.push({z:(0+s)/2,y:l,x:i,xDir:{x:0,y:0,z:-1}}),b(y.bottom,y.right)&&z.push({z:(0+s)/2,y:l,x:o,xDir:{x:0,y:0,z:1}}),e=[],b(y.top,y.left)&&e.push({z:(0+s)/2,y:r,x:i,xDir:{x:0,y:0,z:-1}}),b(y.top,y.right)&&e.push({z:(0+s)/2,y:r,x:o,xDir:{x:0,y:0,z:1}}),s=function(e,t,i){if(0===e.length)return null;if(1===e.length)return e[0];for(var o=perspective(e,a,!1),r=0,l=1;l<o.length;l++)(i*o[l][t]>i*o[r][t]||i*o[l][t]==i*o[r][t]&&o[l].z<o[r].z)&&(r=l);return e[r]},y.axes={y:{left:s(c,"x",-1),right:s(c,"x",1)},x:{top:s(t,"y",-1),bottom:s(x,"y",1)},z:{top:s(e,"y",-1),bottom:s(z,"y",1)}}):y.axes={y:{left:{x:i,z:0,xDir:{x:1,y:0,z:0}},right:{x:o,z:0,xDir:{x:0,y:0,z:1}}},x:{top:{y:r,z:0,xDir:{x:1,y:0,z:0}},bottom:{y:l,z:0,xDir:{x:1,y:0,z:0}}},z:{top:{x:d?o:i,y:r,xDir:d?{x:0,y:0,z:1}:{x:0,y:0,z:-1}},bottom:{x:d?o:i,y:l,xDir:d?{x:0,y:0,z:1}:{x:0,y:0,z:-1}}}},y},t.prototype.getScale=function(e){var t=this.chart,i=t.plotLeft,o=t.plotWidth+i,r=t.plotTop,l=t.plotHeight+r,a=i+t.plotWidth/2,s=r+t.plotHeight/2,x={minX:Number.MAX_VALUE,maxX:-Number.MAX_VALUE,minY:Number.MAX_VALUE,maxY:-Number.MAX_VALUE},n=1,h=[{x:i,y:r,z:0},{x:i,y:r,z:e}];return[0,1].forEach(function(e){h.push({x:o,y:h[e].y,z:h[e].z})}),[0,1,2,3].forEach(function(e){h.push({x:h[e].x,y:l,z:h[e].z})}),(h=perspective(h,t,!1)).forEach(function(e){x.minX=Math.min(x.minX,e.x),x.maxX=Math.max(x.maxX,e.x),x.minY=Math.min(x.minY,e.y),x.maxY=Math.max(x.maxY,e.y)}),i>x.minX&&(n=Math.min(n,1-Math.abs((i+a)/(x.minX+a))%1)),o<x.maxX&&(n=Math.min(n,(o-a)/(x.maxX-a))),r>x.minY&&(n=x.minY<0?Math.min(n,(r+s)/(-x.minY+r+s)):Math.min(n,1-(r+s)/(x.minY+s)%1)),n=l<x.maxY?Math.min(n,Math.abs((l-s)/(x.maxY-s))):n},t);function t(e){this.frame3d=void 0,this.chart=e}function r(e){this.is3d()&&"scatter"===e.options.type&&(e.options.type="scatter3d")}function l(){var e,t,i,o,r,l,a,s,x,n,h,y,c,z,b;this.chart3d&&this.is3d()&&(t=(e=this).renderer,b=e.options.chart.options3d,i=e.chart3d.get3dFrame(),o=e.plotLeft,r=e.plotLeft+e.plotWidth,l=e.plotTop,a=e.plotTop+e.plotHeight,s=b.depth,x=o-(i.left.visible?i.left.size:0),n=r+(i.right.visible?i.right.size:0),h=l-(i.top.visible?i.top.size:0),y=a+(i.bottom.visible?i.bottom.size:0),c=0-(i.front.visible?i.front.size:0),z=s+(i.back.visible?i.back.size:0),b=e.hasRendered?"animate":"attr",e.chart3d.frame3d=i,e.frameShapes||(e.frameShapes={bottom:t.polyhedron().add(),top:t.polyhedron().add(),left:t.polyhedron().add(),right:t.polyhedron().add(),back:t.polyhedron().add(),front:t.polyhedron().add()}),e.frameShapes.bottom[b]({class:"highcharts-3d-frame highcharts-3d-frame-bottom",zIndex:i.bottom.frontFacing?-1e3:1e3,faces:[{fill:color(i.bottom.color).brighten(.1).get(),vertexes:[{x:x,y:y,z:c},{x:n,y:y,z:c},{x:n,y:y,z:z},{x:x,y:y,z:z}],enabled:i.bottom.visible},{fill:color(i.bottom.color).brighten(.1).get(),vertexes:[{x:o,y:a,z:s},{x:r,y:a,z:s},{x:r,y:a,z:0},{x:o,y:a,z:0}],enabled:i.bottom.visible},{fill:color(i.bottom.color).brighten(-.1).get(),vertexes:[{x:x,y:y,z:c},{x:x,y:y,z:z},{x:o,y:a,z:s},{x:o,y:a,z:0}],enabled:i.bottom.visible&&!i.left.visible},{fill:color(i.bottom.color).brighten(-.1).get(),vertexes:[{x:n,y:y,z:z},{x:n,y:y,z:c},{x:r,y:a,z:0},{x:r,y:a,z:s}],enabled:i.bottom.visible&&!i.right.visible},{fill:color(i.bottom.color).get(),vertexes:[{x:n,y:y,z:c},{x:x,y:y,z:c},{x:o,y:a,z:0},{x:r,y:a,z:0}],enabled:i.bottom.visible&&!i.front.visible},{fill:color(i.bottom.color).get(),vertexes:[{x:x,y:y,z:z},{x:n,y:y,z:z},{x:r,y:a,z:s},{x:o,y:a,z:s}],enabled:i.bottom.visible&&!i.back.visible}]}),e.frameShapes.top[b]({class:"highcharts-3d-frame highcharts-3d-frame-top",zIndex:i.top.frontFacing?-1e3:1e3,faces:[{fill:color(i.top.color).brighten(.1).get(),vertexes:[{x:x,y:h,z:z},{x:n,y:h,z:z},{x:n,y:h,z:c},{x:x,y:h,z:c}],enabled:i.top.visible},{fill:color(i.top.color).brighten(.1).get(),vertexes:[{x:o,y:l,z:0},{x:r,y:l,z:0},{x:r,y:l,z:s},{x:o,y:l,z:s}],enabled:i.top.visible},{fill:color(i.top.color).brighten(-.1).get(),vertexes:[{x:x,y:h,z:z},{x:x,y:h,z:c},{x:o,y:l,z:0},{x:o,y:l,z:s}],enabled:i.top.visible&&!i.left.visible},{fill:color(i.top.color).brighten(-.1).get(),vertexes:[{x:n,y:h,z:c},{x:n,y:h,z:z},{x:r,y:l,z:s},{x:r,y:l,z:0}],enabled:i.top.visible&&!i.right.visible},{fill:color(i.top.color).get(),vertexes:[{x:x,y:h,z:c},{x:n,y:h,z:c},{x:r,y:l,z:0},{x:o,y:l,z:0}],enabled:i.top.visible&&!i.front.visible},{fill:color(i.top.color).get(),vertexes:[{x:n,y:h,z:z},{x:x,y:h,z:z},{x:o,y:l,z:s},{x:r,y:l,z:s}],enabled:i.top.visible&&!i.back.visible}]}),e.frameShapes.left[b]({class:"highcharts-3d-frame highcharts-3d-frame-left",zIndex:i.left.frontFacing?-1e3:1e3,faces:[{fill:color(i.left.color).brighten(.1).get(),vertexes:[{x:x,y:y,z:c},{x:o,y:a,z:0},{x:o,y:a,z:s},{x:x,y:y,z:z}],enabled:i.left.visible&&!i.bottom.visible},{fill:color(i.left.color).brighten(.1).get(),vertexes:[{x:x,y:h,z:z},{x:o,y:l,z:s},{x:o,y:l,z:0},{x:x,y:h,z:c}],enabled:i.left.visible&&!i.top.visible},{fill:color(i.left.color).brighten(-.1).get(),vertexes:[{x:x,y:y,z:z},{x:x,y:h,z:z},{x:x,y:h,z:c},{x:x,y:y,z:c}],enabled:i.left.visible},{fill:color(i.left.color).brighten(-.1).get(),vertexes:[{x:o,y:l,z:s},{x:o,y:a,z:s},{x:o,y:a,z:0},{x:o,y:l,z:0}],enabled:i.left.visible},{fill:color(i.left.color).get(),vertexes:[{x:x,y:y,z:c},{x:x,y:h,z:c},{x:o,y:l,z:0},{x:o,y:a,z:0}],enabled:i.left.visible&&!i.front.visible},{fill:color(i.left.color).get(),vertexes:[{x:x,y:h,z:z},{x:x,y:y,z:z},{x:o,y:a,z:s},{x:o,y:l,z:s}],enabled:i.left.visible&&!i.back.visible}]}),e.frameShapes.right[b]({class:"highcharts-3d-frame highcharts-3d-frame-right",zIndex:i.right.frontFacing?-1e3:1e3,faces:[{fill:color(i.right.color).brighten(.1).get(),vertexes:[{x:n,y:y,z:z},{x:r,y:a,z:s},{x:r,y:a,z:0},{x:n,y:y,z:c}],enabled:i.right.visible&&!i.bottom.visible},{fill:color(i.right.color).brighten(.1).get(),vertexes:[{x:n,y:h,z:c},{x:r,y:l,z:0},{x:r,y:l,z:s},{x:n,y:h,z:z}],enabled:i.right.visible&&!i.top.visible},{fill:color(i.right.color).brighten(-.1).get(),vertexes:[{x:r,y:l,z:0},{x:r,y:a,z:0},{x:r,y:a,z:s},{x:r,y:l,z:s}],enabled:i.right.visible},{fill:color(i.right.color).brighten(-.1).get(),vertexes:[{x:n,y:y,z:c},{x:n,y:h,z:c},{x:n,y:h,z:z},{x:n,y:y,z:z}],enabled:i.right.visible},{fill:color(i.right.color).get(),vertexes:[{x:n,y:h,z:c},{x:n,y:y,z:c},{x:r,y:a,z:0},{x:r,y:l,z:0}],enabled:i.right.visible&&!i.front.visible},{fill:color(i.right.color).get(),vertexes:[{x:n,y:y,z:z},{x:n,y:h,z:z},{x:r,y:l,z:s},{x:r,y:a,z:s}],enabled:i.right.visible&&!i.back.visible}]}),e.frameShapes.back[b]({class:"highcharts-3d-frame highcharts-3d-frame-back",zIndex:i.back.frontFacing?-1e3:1e3,faces:[{fill:color(i.back.color).brighten(.1).get(),vertexes:[{x:n,y:y,z:z},{x:x,y:y,z:z},{x:o,y:a,z:s},{x:r,y:a,z:s}],enabled:i.back.visible&&!i.bottom.visible},{fill:color(i.back.color).brighten(.1).get(),vertexes:[{x:x,y:h,z:z},{x:n,y:h,z:z},{x:r,y:l,z:s},{x:o,y:l,z:s}],enabled:i.back.visible&&!i.top.visible},{fill:color(i.back.color).brighten(-.1).get(),vertexes:[{x:x,y:y,z:z},{x:x,y:h,z:z},{x:o,y:l,z:s},{x:o,y:a,z:s}],enabled:i.back.visible&&!i.left.visible},{fill:color(i.back.color).brighten(-.1).get(),vertexes:[{x:n,y:h,z:z},{x:n,y:y,z:z},{x:r,y:a,z:s},{x:r,y:l,z:s}],enabled:i.back.visible&&!i.right.visible},{fill:color(i.back.color).get(),vertexes:[{x:o,y:l,z:s},{x:r,y:l,z:s},{x:r,y:a,z:s},{x:o,y:a,z:s}],enabled:i.back.visible},{fill:color(i.back.color).get(),vertexes:[{x:x,y:y,z:z},{x:n,y:y,z:z},{x:n,y:h,z:z},{x:x,y:h,z:z}],enabled:i.back.visible}]}),e.frameShapes.front[b]({class:"highcharts-3d-frame highcharts-3d-frame-front",zIndex:i.front.frontFacing?-1e3:1e3,faces:[{fill:color(i.front.color).brighten(.1).get(),vertexes:[{x:x,y:y,z:c},{x:n,y:y,z:c},{x:r,y:a,z:0},{x:o,y:a,z:0}],enabled:i.front.visible&&!i.bottom.visible},{fill:color(i.front.color).brighten(.1).get(),vertexes:[{x:n,y:h,z:c},{x:x,y:h,z:c},{x:o,y:l,z:0},{x:r,y:l,z:0}],enabled:i.front.visible&&!i.top.visible},{fill:color(i.front.color).brighten(-.1).get(),vertexes:[{x:x,y:h,z:c},{x:x,y:y,z:c},{x:o,y:a,z:0},{x:o,y:l,z:0}],enabled:i.front.visible&&!i.left.visible},{fill:color(i.front.color).brighten(-.1).get(),vertexes:[{x:n,y:y,z:c},{x:n,y:h,z:c},{x:r,y:l,z:0},{x:r,y:a,z:0}],enabled:i.front.visible&&!i.right.visible},{fill:color(i.front.color).get(),vertexes:[{x:r,y:l,z:0},{x:o,y:l,z:0},{x:o,y:a,z:0},{x:r,y:a,z:0}],enabled:i.front.visible},{fill:color(i.front.color).get(),vertexes:[{x:n,y:y,z:c},{x:x,y:y,z:c},{x:x,y:h,z:c},{x:n,y:h,z:c}],enabled:i.front.visible}]}))}function a(){this.styledMode&&(this.renderer.definition({tagName:"style",textContent:".highcharts-3d-top{filter: url(#highcharts-brighter)}\n.highcharts-3d-side{filter: url(#highcharts-darker)}\n"}),[{name:"darker",slope:.6},{name:"brighter",slope:1.4}].forEach(function(e){this.renderer.definition({tagName:"filter",attributes:{id:"highcharts-"+e.name},children:[{tagName:"feComponentTransfer",children:[{tagName:"feFuncR",attributes:{type:"linear",slope:e.slope}},{tagName:"feFuncG",attributes:{type:"linear",slope:e.slope}},{tagName:"feFuncB",attributes:{type:"linear",slope:e.slope}}]}]})},this))}function s(){var t=this.options;this.is3d()&&(t.series||[]).forEach(function(e){"scatter"===(e.type||t.chart.type||t.chart.defaultSeriesType)&&(e.type="scatter3d")})}function x(){var e,t,i,o,r,l,a=this,s=a.options.chart.options3d;a.chart3d&&a.is3d()&&(s&&(s.alpha=s.alpha%360+(0<=s.alpha?0:360),s.beta=s.beta%360+(0<=s.beta?0:360)),e=a.inverted,t=a.clipBox,i=a.margin,o=e?"x":"y",r=e?"height":"width",l=e?"width":"height",t[e?"y":"x"]=-(i[3]||0),t[o]=-(i[0]||0),t[r]=a.chartWidth+(i[3]||0)+(i[1]||0),t[l]=a.chartHeight+(i[0]||0)+(i[2]||0),a.scale3d=1,!0===s.fitToPlot&&(a.scale3d=a.chart3d.getScale(s.depth)),a.chart3d.frame3d=a.chart3d.get3dFrame())}function n(){this.is3d()&&(this.isDirtyBox=!0)}function h(){this.chart3d&&this.is3d()&&(this.chart3d.frame3d=this.chart3d.get3dFrame())}function y(){this.chart3d||(this.chart3d=new e(this))}function c(e){return this.is3d()||e.apply(this,[].slice.call(arguments,1))}function z(e){var t,i=this.series.length;if(this.is3d())for(;i--;)(t=this.series[i]).translate(),t.render();else e.call(this)}function b(e){e.apply(this,[].slice.call(arguments,1)),this.is3d()&&(this.container.className+=" highcharts-3d-chart")}o.Composition=e,o.defaultOptions={chart:{options3d:{enabled:!1,alpha:0,beta:0,depth:100,fitToPlot:!0,viewDistance:25,axisLabelPosition:null,frame:{visible:"default",size:1,bottom:{},top:{},left:{},right:{},back:{},front:{}}}}},o.compose=function(e,t){var i=e.prototype,t=t.prototype;i.is3d=function(){return Boolean(this.options.chart.options3d&&this.options.chart.options3d.enabled)},i.propsRequireDirtyBox.push("chart.options3d"),i.propsRequireUpdateSeries.push("chart.options3d"),t.matrixSetter=function(){if(this.pos<1&&(isArray(this.start)||isArray(this.end)))for(var e=this.start||[1,0,0,1,0,0],t=this.end||[1,0,0,1,0,0],i=[],o=0;o<6;o++)i.push(this.pos*t[o]+(1-this.pos)*e[o]);else i=this.end;this.elem.attr(this.prop,i,null,!0)},merge(!0,genericDefaultOptions,o.defaultOptions),addEvent(e,"init",y),addEvent(e,"addSeries",r),addEvent(e,"afterDrawChartBox",l),addEvent(e,"afterGetContainer",a),addEvent(e,"afterInit",s),addEvent(e,"afterSetChartSize",x),addEvent(e,"beforeRedraw",n),addEvent(e,"beforeRender",h),wrap(i,"isInsidePlot",c),wrap(e,"renderSeries",z),wrap(e,"setClassName",b)}}(Chart3D=Chart3D||{});export default Chart3D;