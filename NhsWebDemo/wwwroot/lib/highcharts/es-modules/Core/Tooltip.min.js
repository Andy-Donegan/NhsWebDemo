"use strict";import F from"./FormatUtilities.js";var format=F.format;import H from"./Globals.js";var doc=H.doc;import R from"./Renderer/RendererUtilities.js";var distribute=R.distribute;import RendererRegistry from"./Renderer/RendererRegistry.js";import U from"./Utilities.js";var addEvent=U.addEvent,clamp=U.clamp,css=U.css,defined=U.defined,discardElement=U.discardElement,extend=U.extend,fireEvent=U.fireEvent,isArray=U.isArray,isNumber=U.isNumber,isString=U.isString,merge=U.merge,pick=U.pick,splat=U.splat,syncTimeout=U.syncTimeout,Tooltip=function(){function t(t,e){this.allowShared=!0,this.container=void 0,this.crosshairs=[],this.distance=0,this.isHidden=!0,this.isSticky=!1,this.now={},this.options={},this.outside=!1,this.chart=t,this.init(t,e)}return t.prototype.applyFilter=function(){var t=this.chart;t.renderer.definition({tagName:"filter",attributes:{id:"drop-shadow-"+t.index,opacity:.5},children:[{tagName:"feGaussianBlur",attributes:{in:"SourceAlpha",stdDeviation:1}},{tagName:"feOffset",attributes:{dx:1,dy:1}},{tagName:"feComponentTransfer",children:[{tagName:"feFuncA",attributes:{type:"linear",slope:.3}}]},{tagName:"feMerge",children:[{tagName:"feMergeNode"},{tagName:"feMergeNode",attributes:{in:"SourceGraphic"}}]}]})},t.prototype.bodyFormatter=function(t){return t.map(function(t){var e=t.series.tooltipOptions;return(e[(t.point.formatPrefix||"point")+"Formatter"]||t.point.tooltipFormatter).call(t.point,e[(t.point.formatPrefix||"point")+"Format"]||"")})},t.prototype.cleanSplit=function(o){this.chart.series.forEach(function(t){var e=t&&t.tt;e&&(!e.isActive||o?t.tt=e.destroy():e.isActive=!1)})},t.prototype.defaultFormatter=function(t){var e=this.points||splat(this),o=[t.tooltipFooterHeaderFormatter(e[0])];return(o=o.concat(t.bodyFormatter(e))).push(t.tooltipFooterHeaderFormatter(e[0],!0)),o},t.prototype.destroy=function(){this.label&&(this.label=this.label.destroy()),this.split&&this.tt&&(this.cleanSplit(!0),this.tt=this.tt.destroy()),this.renderer&&(this.renderer=this.renderer.destroy(),discardElement(this.container)),U.clearTimeout(this.hideTimer),U.clearTimeout(this.tooltipTimeout)},t.prototype.getAnchor=function(t,e){var o,i,r,s=this.chart,a=s.pointer,n=s.inverted,l=s.plotTop,h=s.plotLeft,d=0,c=0;return t=splat(t),this.followPointer&&e?o=[(e=void 0===e.chartX?a.normalize(e):e).chartX-h,e.chartY-l]:t[0].tooltipPos?o=t[0].tooltipPos:(t.forEach(function(t){i=t.series.yAxis,r=t.series.xAxis,d+=t.plotX||0,c+=t.plotLow?(t.plotLow+(t.plotHigh||0))/2:t.plotY||0,r&&i&&(n?(d+=l+s.plotHeight-r.len-r.pos,c+=h+s.plotWidth-i.len-i.pos):(d+=r.pos-h,c+=i.pos-l))}),d/=t.length,c/=t.length,o=[n?s.plotWidth-c:d,n?s.plotHeight-d:c],this.shared&&1<t.length&&e&&(n?o[0]=e.chartX-h:o[1]=e.chartY-l)),o.map(Math.round)},t.prototype.getLabel=function(){function t(){l.inContact=!0}function e(t){var e=l.chart.hoverSeries;l.inContact=l.shouldStickOnContact()&&l.chart.pointer.inClass(t.relatedTarget,"highcharts-tooltip"),!l.inContact&&e&&e.onMouseOut&&e.onMouseOut()}var o,i,r,s,a,n,l=this,h=this.chart.styledMode,d=this.options,c=this.split&&this.allowShared,p="tooltip"+(defined(d.className)?" "+d.className:""),u=d.style.pointerEvents||(!this.followPointer&&d.stickOnContact?"auto":"none"),f=this.chart.renderer;return l.label&&(r=!l.label.hasClass("highcharts-label"),(c&&!r||!c&&r)&&l.destroy()),this.label||(this.outside&&(i=this.chart.options.chart.style,r=RendererRegistry.getRendererType(),this.container=o=H.doc.createElement("div"),o.className="highcharts-tooltip-container",css(o,{position:"absolute",top:"1px",pointerEvents:u,zIndex:Math.max(this.options.style.zIndex||0,(i&&i.zIndex||0)+3)}),addEvent(o,"mouseenter",t),addEvent(o,"mouseleave",e),H.doc.body.appendChild(o),this.renderer=f=new r(o,0,0,i,void 0,void 0,f.styledMode)),c?this.label=f.g(p):(this.label=f.label("",0,0,d.shape,void 0,void 0,d.useHTML,void 0,p).attr({padding:d.padding,r:d.borderRadius}),h||this.label.attr({fill:d.backgroundColor,"stroke-width":d.borderWidth}).css(d.style).css({pointerEvents:u}).shadow(d.shadow)),h&&d.shadow&&(this.applyFilter(),this.label.attr({filter:"url(#drop-shadow-"+this.chart.index+")"})),l.outside&&!l.split&&(s=this.label,a=s.xSetter,n=s.ySetter,s.xSetter=function(t){a.call(s,l.distance),o.style.left=t+"px"},s.ySetter=function(t){n.call(s,l.distance),o.style.top=t+"px"}),this.label.on("mouseenter",t).on("mouseleave",e).attr({zIndex:8}).add()),this.label},t.prototype.getPosition=function(o,i,r){var s,a=this.chart,p=this.distance,u={},f=a.inverted&&r.h||0,m=this.outside,n=m?doc.documentElement.clientWidth-2*p:a.chartWidth,l=m?Math.max(doc.body.scrollHeight,doc.documentElement.scrollHeight,doc.body.offsetHeight,doc.documentElement.offsetHeight,doc.documentElement.clientHeight):a.chartHeight,h=a.pointer.getChartPosition(),g=function(t){return t*h.scaleX},y=function(t){return t*h.scaleY},t=function(t){var e="x"===t;return[t,e?n:l,e?o:i].concat(m?[e?g(o):y(i),e?h.left-p+g(r.plotX+a.plotLeft):h.top-p+y(r.plotY+a.plotTop),0,e?n:l]:[e?o:i,e?r.plotX+a.plotLeft:r.plotY+a.plotTop,e?a.plotLeft:a.plotTop,e?a.plotLeft+a.plotWidth:a.plotTop+a.plotHeight])},d=t("y"),c=t("x"),t=!!r.negative;!a.polar&&a.hoverSeries&&a.hoverSeries.yAxis&&a.hoverSeries.yAxis.reversed&&(t=!t);var v=!this.followPointer&&pick(r.ttBelow,!a.inverted===t),e=function(t,e,o,i,r,s,a){var n=m?("y"===t?y:g)(p):p,l=(o-i)/2,h=i<r-p,d=r+p+i<e,c=r-n-o+l,l=r+n-l;if(v&&d)u[t]=l;else if(!v&&h)u[t]=c;else if(h)u[t]=Math.min(a-i,c-f<0?c:c-f);else{if(!d)return!1;u[t]=Math.max(s,e<l+f+o?l:l+f)}},x=function(t,e,o,i,r){var s;return r<p||e-p<r?s=!1:u[t]=r<o/2?1:e-i/2<r?e-i-2:r-o/2,s},b=function(t){var e=d;d=c,c=e,s=t},w=function(){!1!==e.apply(0,d)?!1!==x.apply(0,c)||s||(b(!0),w()):s?u.x=u.y=0:(b(!0),w())};return(a.inverted||1<this.len)&&b(),w(),u},t.prototype.hide=function(t){var e=this;U.clearTimeout(this.hideTimer),t=pick(t,this.options.hideDelay),this.isHidden||(this.hideTimer=syncTimeout(function(){e.getLabel().fadeOut(t&&void 0),e.isHidden=!0},t))},t.prototype.init=function(t,e){this.chart=t,this.options=e,this.crosshairs=[],this.now={x:0,y:0},this.isHidden=!0,this.split=e.split&&!t.inverted&&!t.polar,this.shared=e.shared||this.split,this.outside=pick(e.outside,Boolean(t.scrollablePixelsX||t.scrollablePixelsY))},t.prototype.shouldStickOnContact=function(){return!(this.followPointer||!this.options.stickOnContact)},t.prototype.isStickyOnContact=function(){return!(!this.shouldStickOnContact()||!this.inContact)},t.prototype.move=function(t,e,o,i){var r=this,s=r.now,a=!1!==r.options.animation&&!r.isHidden&&(1<Math.abs(t-s.x)||1<Math.abs(e-s.y)),n=r.followPointer||1<r.len;extend(s,{x:a?(2*s.x+t)/3:t,y:a?(s.y+e)/2:e,anchorX:n?void 0:a?(2*s.anchorX+o)/3:o,anchorY:n?void 0:a?(s.anchorY+i)/2:i}),r.getLabel().attr(s),r.drawTracker(),a&&(U.clearTimeout(this.tooltipTimeout),this.tooltipTimeout=setTimeout(function(){r&&r.move(t,e,o,i)},32))},t.prototype.refresh=function(t,e){var o=this,i=this.chart,r=o.options,s=splat(t),a=s[0],n=[],l=r.formatter||o.defaultFormatter,h=o.shared,d=i.styledMode,c={};if(r.enabled){U.clearTimeout(this.hideTimer),o.allowShared=!(!isArray(t)&&t.series&&t.series.noSharedTooltip),o.followPointer=!o.split&&a.series.tooltipOptions.followPointer;var p=o.getAnchor(t,e),u=p[0],t=p[1];h&&o.allowShared?(i.pointer.applyInactiveState(s),s.forEach(function(t){t.setState("hover"),n.push(t.getLabelConfig())}),(c={x:a.category,y:a.y}).points=n):c=a.getLabelConfig(),this.len=n.length;l=l.call(c,o),c=a.series;if(this.distance=pick(c.tooltipOptions.distance,16),!1===l)this.hide();else{if(o.split&&o.allowShared)this.renderSplit(l,s);else{var f=u,m=t;if(e&&i.pointer.isDirectTouch&&(f=e.chartX-i.plotLeft,m=e.chartY-i.plotTop),!i.polar&&!1!==c.options.clip&&!s.some(function(t){return t.series.shouldShowTooltip(f,m)}))return void o.hide();s=o.getLabel();r.style.width&&!d||s.css({width:this.chart.spacingBox.width+"px"}),s.attr({text:l&&l.join?l.join(""):l}),s.removeClass(/highcharts-color-[\d]+/g).addClass("highcharts-color-"+pick(a.colorIndex,c.colorIndex)),d||s.attr({stroke:r.borderColor||a.color||c.color||"#666666"}),o.updatePosition({plotX:u,plotY:t,negative:a.negative,ttBelow:a.ttBelow,h:p[2]||0})}o.isHidden&&o.label&&o.label.attr({opacity:1}).show(),o.isHidden=!1}fireEvent(this,"refresh")}},t.prototype.renderSplit=function(t,u){var f,m=this,e=m.chart,o=m.chart,i=o.chartWidth,r=o.chartHeight,g=o.plotHeight,y=o.plotLeft,v=o.plotTop,s=o.pointer,a=o.scrollablePixelsY,n=void 0===a?0:a,l=o.scrollablePixelsX,h=o.scrollingContainer,a=void 0===h?{scrollLeft:0,scrollTop:0}:h,h=a.scrollLeft,a=a.scrollTop,x=o.styledMode,b=m.distance,w=m.options,T=m.options.positioner,k=m.outside&&"number"!=typeof l?doc.documentElement.getBoundingClientRect():{left:h,right:h+i,top:a,bottom:a+r},S=m.getLabel(),H=this.renderer||e.renderer,M=Boolean(e.xAxis[0]&&e.xAxis[0].opposite),i=s.getChartPosition(),d=i.left,r=i.top,X=v+a,C=g-n;function F(t,e,o,i,r){var s,a;return void 0===r&&(r=!0),{x:a=o?(s=M?0:C,clamp(t-i/2,k.left,k.right-i-(m.outside?d:0))):(s=e-X,clamp(a=r?t-i-b:t+b,r?a:k.left,k.right)),y:s}}e=(t=isString(t)?[!1,t]:t).slice(0,u.length+1).reduce(function(t,e,o){var i,r,s,a,n,l,h,d,c,p;return!1!==e&&""!==e&&(p=(c=(e=(p=(r=(i=u[o-1]||{isHeader:!0,plotX:u[0].plotX,plotY:g,series:{}}).isHeader)?m:i.series).tt=(n=p.tt,l=i,h=e.toString(),d=n,c=l.isHeader,o=l.series,p="highcharts-color-"+pick(l.colorIndex,o.colorIndex,"none"),d||(n={padding:w.padding,r:w.borderRadius},x||(n.fill=w.backgroundColor,n["stroke-width"]=w.borderWidth),d=H.label("",0,0,w[c?"headerShape":"shape"],void 0,void 0,w.useHTML).addClass((c?"highcharts-tooltip-header ":"")+"highcharts-tooltip-box "+p).attr(n).add(S)),d.isActive=!0,d.attr({text:h}),x||d.css(w.style).shadow(w.shadow).attr({stroke:w.borderColor||l.color||o.color||"#333333"}),d)).getBBox()).width+e.strokeWidth(),r&&(f=c.height,C+=f,M&&(X-=f)),h=(n=i).isHeader,o=void 0===(l=n.plotX)?0:l,l=void 0===(d=n.plotY)?0:d,d=n.series,h?(a=y+o,s=v+g/2):(n=d.xAxis,h=d.yAxis,a=n.pos+clamp(o,-b,n.len+b),d.shouldShowTooltip(0,h.pos-v+l,{ignoreX:!0})&&(s=h.pos+l)),a=(l={anchorX:a=clamp(a,k.left-b,k.right+b),anchorY:s}).anchorX,"number"==typeof(s=l.anchorY)?(l=c.height+1,c=T?T.call(m,p,l,i):F(a,s,r,p),t.push({align:T?0:void 0,anchorX:a,anchorY:s,boxWidth:p,point:i,rank:pick(c.rank,r?1:0),size:l,target:c.y,tt:e,x:c.x})):e.isActive=!1),t},[]);!T&&e.some(function(t){var e=(m.outside?d:0)+t.anchorX;return e<k.left&&e+t.boxWidth<k.right||e<d-k.left+t.boxWidth&&k.right-e>e})&&(e=e.map(function(t){var e=F(t.anchorX,t.anchorY,t.point.isHeader,t.boxWidth,!1),o=e.x,e=e.y;return extend(t,{target:e,x:o})})),m.cleanSplit(),distribute(e,C);var c={left:d,right:d};e.forEach(function(t){var e=t.x,o=t.boxWidth,t=t.isHeader;t||(m.outside&&d+e<c.left&&(c.left=d+e),!t&&m.outside&&c.left+o>c.right&&(c.right=d+e))}),e.forEach(function(t){var e=t.x,o=t.anchorX,i=t.anchorY,r=t.pos,s=t.point.isHeader,r={visibility:void 0===r?"hidden":"inherit",x:e,y:r+X,anchorX:o,anchorY:i};m.outside&&e<o&&(0<(i=d-c.left)&&(s||(r.x=e+i,r.anchorX=o+i),s&&(r.x=(c.right-c.left)/2,r.anchorX=o+i))),t.tt.attr(r)});s=m.container,i=m.outside,a=m.renderer;i&&s&&a&&(t=(n=S.getBBox()).width,e=n.height,i=n.x,n=n.y,a.setSize(t+i,e+n,!1),s.style.left=c.left+"px",s.style.top=r+"px")},t.prototype.drawTracker=function(){var t,e,o,i,r,s=this;!s.followPointer&&s.options.stickOnContact?(t=s.chart,e=s.label,r=s.shared?t.hoverPoints:t.hoverPoint,e&&r&&(o={x:0,y:0,width:0,height:0},i=this.getAnchor(r),r=e.getBBox(),i[0]+=t.plotLeft-e.translateX,i[1]+=t.plotTop-e.translateY,o.x=Math.min(0,i[0]),o.y=Math.min(0,i[1]),o.width=i[0]<0?Math.max(Math.abs(i[0]),r.width-i[0]):Math.max(Math.abs(i[0]),r.width),o.height=i[1]<0?Math.max(Math.abs(i[1]),r.height-Math.abs(i[1])):Math.max(Math.abs(i[1]),r.height),s.tracker?s.tracker.attr(o):(s.tracker=e.renderer.rect(o).addClass("highcharts-tracker").add(e),t.styledMode||s.tracker.attr({fill:"rgba(0,0,0,0)"})))):s.tracker&&s.tracker.destroy()},t.prototype.styledModeFormat=function(t){return t.replace('style="font-size: 10px"','class="highcharts-header"').replace(/style="color:{(point|series)\.color}"/g,'class="highcharts-color-{$1.colorIndex}"')},t.prototype.tooltipFooterHeaderFormatter=function(e,t){var o=e.series,i=o.tooltipOptions,r=o.xAxis,s=r&&r.dateTime,r={isFooter:t,labelConfig:e},a=i.xDateFormat,n=i[t?"footerFormat":"headerFormat"];return fireEvent(this,"headerFormatter",r,function(t){s&&!a&&isNumber(e.key)&&(a=s.getXDateFormat(e.key,i.dateTimeLabelFormats)),s&&a&&(e.point&&e.point.tooltipDateKeys||["key"]).forEach(function(t){n=n.replace("{point."+t+"}","{point."+t+":"+a+"}")}),o.chart.styledMode&&(n=this.styledModeFormat(n)),t.text=format(n,{point:e,series:o},this.chart)}),r.text},t.prototype.update=function(t){this.destroy(),merge(!0,this.chart.options.tooltip.userOptions,t),this.init(this.chart,merge(!0,this.options,t))},t.prototype.updatePosition=function(t){var e=this.chart,o=this.options,i=e.pointer,r=this.getLabel(),s=i.getChartPosition(),a=(o.positioner||this.getPosition).call(this,r.width,r.height,t),i=t.plotX+e.plotLeft,e=t.plotY+e.plotTop;this.outside&&(o=o.borderWidth+2*this.distance,this.renderer.setSize(r.width+o,r.height+o,!1),1===s.scaleX&&1===s.scaleY||(css(this.container,{transform:"scale("+s.scaleX+", "+s.scaleY+")"}),i*=s.scaleX,e*=s.scaleY),i+=s.left-a.x,e+=s.top-a.y),this.move(Math.round(a.x),Math.round(a.y||0),i,e)},t}();export default Tooltip;