"use strict";import H from"./Globals.js";var win=H.win;import U from"./Utilities.js";var defined=U.defined,error=U.error,extend=U.extend,isObject=U.isObject,merge=U.merge,objectEach=U.objectEach,pad=U.pad,pick=U.pick,splat=U.splat,timeUnits=U.timeUnits,hasNewSafariBug=H.isSafari&&win.Intl&&win.Intl.DateTimeFormat.prototype.formatRange,hasOldSafariBug=H.isSafari&&win.Intl&&!win.Intl.DateTimeFormat.prototype.formatRange,Time=function(){function e(e){this.options={},this.useUTC=!1,this.variableTimezone=!1,this.Date=win.Date,this.getTimezoneOffset=this.timezoneOffsetFunction(),this.update(e)}return e.prototype.get=function(e,t){if(this.variableTimezone||this.timezoneOffset){var i=t.getTime(),s=i-this.getTimezoneOffset(t);t.setTime(s);s=t["getUTC"+e]();return t.setTime(i),s}return this.useUTC?t["getUTC"+e]():t["get"+e]()},e.prototype.set=function(e,t,i){if(this.variableTimezone||this.timezoneOffset){if("Milliseconds"===e||"Seconds"===e||"Minutes"===e&&this.getTimezoneOffset(t)%36e5==0)return t["setUTC"+e](i);var s=this.getTimezoneOffset(t),n=t.getTime()-s;t.setTime(n),t["setUTC"+e](i);s=this.getTimezoneOffset(t),n=t.getTime()+s;return t.setTime(n)}return this.useUTC||hasNewSafariBug&&"FullYear"===e?t["setUTC"+e](i):t["set"+e](i)},e.prototype.update=function(e){var t=pick(e&&e.useUTC,!0);this.options=e=merge(!0,this.options||{},e),this.Date=e.Date||win.Date||Date,this.useUTC=t,this.timezoneOffset=t&&e.timezoneOffset,this.getTimezoneOffset=this.timezoneOffsetFunction(),this.variableTimezone=t&&!(!e.getTimezoneOffset&&!e.timezone)},e.prototype.makeTime=function(e,t,i,s,n,o){var a,r,m;return this.useUTC?(a=this.Date.UTC.apply(0,arguments),(r=this.getTimezoneOffset(a))!==(m=this.getTimezoneOffset(a+=r))?a+=m-r:r-36e5!==this.getTimezoneOffset(a-36e5)||hasOldSafariBug||(a-=36e5)):a=new this.Date(e,t,pick(i,1),pick(s,0),pick(n,0),pick(o,0)).getTime(),a},e.prototype.timezoneOffsetFunction=function(){var e=this,t=this.options,i=t.getTimezoneOffset,s=t.moment||win.moment;if(!this.useUTC)return function(e){return 6e4*new Date(e.toString()).getTimezoneOffset()};if(t.timezone){if(s)return function(e){return 6e4*-s.tz(e,t.timezone).utcOffset()};error(25)}return this.useUTC&&i?function(e){return 6e4*i(e.valueOf())}:function(){return 6e4*(e.timezoneOffset||0)}},e.prototype.dateFormat=function(i,s,e){if(!defined(s)||isNaN(s))return H.defaultOptions.lang&&H.defaultOptions.lang.invalidDate||"";i=pick(i,"%Y-%m-%d %H:%M:%S");var n=this,t=new this.Date(s),o=this.get("Hours",t),a=this.get("Day",t),r=this.get("Date",t),m=this.get("Month",t),f=this.get("FullYear",t),u=H.defaultOptions.lang,h=u&&u.weekdays,p=u&&u.shortWeekdays,t=extend({a:p?p[a]:h[a].substr(0,3),A:h[a],d:pad(r),e:pad(r,2," "),w:a,b:u.shortMonths[m],B:u.months[m],m:pad(m+1),o:m+1,y:f.toString().substr(2,2),Y:f,H:pad(o),k:o,I:pad(o%12||12),l:o%12||12,M:pad(this.get("Minutes",t)),p:o<12?"AM":"PM",P:o<12?"am":"pm",S:pad(t.getSeconds()),L:pad(Math.floor(s%1e3),3)},H.dateFormats);return objectEach(t,function(e,t){for(;-1!==i.indexOf("%"+t);)i=i.replace("%"+t,"function"==typeof e?e.call(n,s):e)}),e?i.substr(0,1).toUpperCase()+i.substr(1):i},e.prototype.resolveDTLFormat=function(e){return isObject(e,!0)?e:{main:(e=splat(e))[0],from:e[1],to:e[2]}},e.prototype.getTimeTicks=function(e,t,i,s){var n,o=this,a=o.Date,r=[],m={},f=new a(t),u=e.unitRange,h=e.count||1;if(s=pick(s,1),defined(t)){o.set("Milliseconds",f,u>=timeUnits.second?0:h*Math.floor(o.get("Milliseconds",f)/h)),u>=timeUnits.second&&o.set("Seconds",f,u>=timeUnits.minute?0:h*Math.floor(o.get("Seconds",f)/h)),u>=timeUnits.minute&&o.set("Minutes",f,u>=timeUnits.hour?0:h*Math.floor(o.get("Minutes",f)/h)),u>=timeUnits.hour&&o.set("Hours",f,u>=timeUnits.day?0:h*Math.floor(o.get("Hours",f)/h)),u>=timeUnits.day&&o.set("Date",f,u>=timeUnits.month?1:Math.max(1,h*Math.floor(o.get("Date",f)/h))),u>=timeUnits.month&&(o.set("Month",f,u>=timeUnits.year?0:h*Math.floor(o.get("Month",f)/h)),p=o.get("FullYear",f)),u>=timeUnits.year&&o.set("FullYear",f,p-=p%h),u===timeUnits.week&&(a=o.get("Day",f),o.set("Date",f,o.get("Date",f)-a+s+(a<s?-7:0)));var p=o.get("FullYear",f),g=o.get("Month",f),d=o.get("Date",f),l=o.get("Hours",f);t=f.getTime(),!o.variableTimezone&&o.useUTC||!defined(i)||(n=i-t>4*timeUnits.month||o.getTimezoneOffset(t)!==o.getTimezoneOffset(i));for(var c=f.getTime(),T=1;c<i;)r.push(c),u===timeUnits.year?c=o.makeTime(p+T*h,0):u===timeUnits.month?c=o.makeTime(p,g+T*h):!n||u!==timeUnits.day&&u!==timeUnits.week?n&&u===timeUnits.hour&&1<h?c=o.makeTime(p,g,d,l+T*h):c+=u*h:c=o.makeTime(p,g,d+T*h*(u===timeUnits.day?1:7)),T++;r.push(c),u<=timeUnits.hour&&r.length<1e4&&r.forEach(function(e){e%18e5==0&&"000000000"===o.dateFormat("%H%M%S%L",e)&&(m[e]="day")})}return r.info=extend(e,{higherRanks:m,totalRange:u*h}),r},e.prototype.getDateFormat=function(e,t,i,s){var n,o,a=this.dateFormat("%m-%d %H:%M:%S.%L",t),r="01-01 00:00:00.000",m={millisecond:15,second:12,minute:9,hour:6,day:3},f="millisecond";for(o in timeUnits){if(e===timeUnits.week&&+this.dateFormat("%w",t)===i&&a.substr(6)===r.substr(6)){o="week";break}if(timeUnits[o]>e){o=f;break}if(m[o]&&a.substr(m[o])!==r.substr(m[o]))break;"week"!==o&&(f=o)}return n=o?this.resolveDTLFormat(s[o]).main:n},e}();export default Time;