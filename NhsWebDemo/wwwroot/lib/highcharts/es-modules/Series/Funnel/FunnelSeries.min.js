"use strict";var __extends=this&&this.__extends||function(){var o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)};return function(t,e){function i(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}}();import Chart from"../../Core/Chart/Chart.js";import H from"../../Core/Globals.js";var noop=H.noop;import SeriesRegistry from"../../Core/Series/SeriesRegistry.js";var Series=SeriesRegistry.series,PieSeries=SeriesRegistry.seriesTypes.pie;import U from"../../Core/Utilities.js";var addEvent=U.addEvent,extend=U.extend,fireEvent=U.fireEvent,isArray=U.isArray,merge=U.merge,pick=U.pick,FunnelSeries=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.data=void 0,t.options=void 0,t.points=void 0,t}return __extends(t,e),t.prototype.alignDataLabel=function(t,e,i,o,n){var r=t.series,a=r.options.reversed,s=t.dlBox||t.shapeArgs,l=i.align,p=i.verticalAlign,c=((r.options||{}).dataLabels||{}).inside,d=r.center[1],h=a?2*d-t.plotY:t.plotY,g=r.getWidthAt(h-s.height/2+e.height),d="middle"===p?(s.topWidth-s.bottomWidth)/4:(g-s.bottomWidth)/2,r=s.y,h=s.x,g=pick(e.height,e.getBBox().height);"middle"===p?r=s.y-s.height/2+g/2:"top"===p&&(r=s.y-s.height+g+i.padding),("top"===p&&!a||"bottom"===p&&a||"middle"===p)&&("right"===l?h=s.x-i.padding+d:"left"===l&&(h=s.x+i.padding-d)),o={x:h,y:a?r-s.height:r,width:s.bottomWidth,height:s.height},i.verticalAlign="bottom",c&&!t.visible||Series.prototype.alignDataLabel.call(this,t,e,i,o,n),c&&(!t.visible&&t.dataLabel&&(t.dataLabel.placed=!1),t.contrastColor&&e.css({color:t.contrastColor}))},t.prototype.drawDataLabels=function(){var t,e,i,o,n,r=this,a=r.data,s=r.options.dataLabels.distance,l=a.length;for(r.center[2]-=2*s;l--;)e=(t=(i=a[l]).half)?1:-1,n=i.plotY,i.labelDistance=pick(i.options.dataLabels&&i.options.dataLabels.distance,s),r.maxLabelDistance=Math.max(i.labelDistance,r.maxLabelDistance||0),o=r.getX(n,t,i),i.labelPosition={natural:{x:0,y:n},final:{},alignment:t?"right":"left",connectorPosition:{breakAt:{x:o+(i.labelDistance-5)*e,y:n},touchingSliceAt:{x:o+i.labelDistance*e,y:n}}};SeriesRegistry.seriesTypes[r.options.dataLabels.inside?"column":"pie"].prototype.drawDataLabels.call(this)},t.prototype.translate=function(){var e,i,o,n,r,a,s,l,p,c=0,d=this,t=d.chart,h=d.options,g=h.reversed,u=h.ignoreHiddenPoint,f=t.plotWidth,b=t.plotHeight,y=0,t=h.center,v=D(t[0],f),m=D(t[1],b),L=D(h.width,f),x=D(h.height,b),A=D(h.neckWidth,f),S=D(h.neckHeight,b),W=m-x/2+x-S,b=d.data,_="left"===h.dataLabels.position?1:0;function D(t,e){return/%$/.test(t)?e*parseInt(t,10)/100:parseInt(t,10)}d.getWidthAt=function(t){return W<t||x===S?A:A+(L-A)*(1-(t-(m-x/2))/(x-S))},d.getX=function(t,e,i){return v+(e?-1:1)*(d.getWidthAt(g?2*m-t:t)/2+i.labelDistance)},d.center=[v,m,x],d.centerX=v,b.forEach(function(t){u&&!1===t.visible||(c+=t.y)}),b.forEach(function(t){p=null,i=c?t.y/c:0,s=(n=m-x/2+y*x)+i*x,e=d.getWidthAt(n),r=(o=v-e/2)+e,e=d.getWidthAt(s),l=(a=v-e/2)+e,W<n?(o=a=v-A/2,r=l=v+A/2):W<s&&(p=s,e=d.getWidthAt(W),l=(a=v-e/2)+e,s=W),g&&(n=2*m-n,s=2*m-s,null!==p&&(p=2*m-p)),e=[["M",o,n],["L",r,n],["L",l,s]],null!==p&&e.push(["L",l,p],["L",a,p]),e.push(["L",a,s],["Z"]),t.shapeType="path",t.shapeArgs={d:e},t.percentage=100*i,t.plotX=v,t.plotY=(n+(p||s))/2,t.tooltipPos=[v,t.plotY],t.dlBox={x:a,y:n,topWidth:r-o,bottomWidth:l-a,height:Math.abs(pick(p,s)-n),width:NaN},t.slice=noop,t.half=_,u&&!1===t.visible||(y+=i)}),fireEvent(d,"afterTranslate")},t.prototype.sortByAngle=function(t){t.sort(function(t,e){return t.plotY-e.plotY})},t.defaultOptions=merge(PieSeries.defaultOptions,{animation:!1,center:["50%","50%"],width:"90%",neckWidth:"30%",height:"100%",neckHeight:"25%",reversed:!1,size:!0,dataLabels:{connectorWidth:1,verticalAlign:"middle"},states:{select:{color:"#cccccc",borderColor:"#000000"}}}),t}(PieSeries);extend(FunnelSeries.prototype,{animate:noop}),addEvent(Chart,"afterHideAllOverlappingLabels",function(){this.series.forEach(function(t){var e=t.options&&t.options.dataLabels;isArray(e)&&(e=e[0]),t.is("pie")&&t.placeDataLabels&&e&&!e.inside&&t.placeDataLabels()})}),SeriesRegistry.registerSeriesType("funnel",FunnelSeries);export default FunnelSeries;