"use strict";import Axis from"../Core/Axis/Axis.js";import Point from"../Core/Series/Point.js";import Series from"../Core/Series/Series.js";var pointTooltipFormatter=Point.prototype.tooltipFormatter;import U from"../Core/Utilities.js";var DataModifyComposition,addEvent=U.addEvent,arrayMax=U.arrayMax,arrayMin=U.arrayMin,correctFloat=U.correctFloat,defined=U.defined,isArray=U.isArray,isNumber=U.isNumber,isString=U.isString,pick=U.pick;!function(t){var a=[];function r(i,e,t){this.isXAxis||(this.series.forEach(function(t){"compare"===i&&"boolean"!=typeof e?t.setCompare(e,!1):"cumulative"!==i||isString(e)||t.setCumulative(e,!1)}),pick(t,!0)&&this.chart.redraw())}function n(i){function t(t){i=i.replace("{point."+t+"}",(0<e[t]&&"change"===t?"+":"")+o(e[t],pick(e.series.tooltipOptions.changeDecimals,2)))}var e=this,o=e.series.chart.numberFormatter;return defined(e.change)&&t("change"),defined(e.cumulativeSum)&&t("cumulativeSum"),pointTooltipFormatter.apply(this,[i])}function s(){var t,i=this.options.compare;"percent"!==i&&"value"!==i&&!this.options.cumulative||(t=new o(this),"percent"===i||"value"===i?t.initCompare(i):t.initCumulative()),this.dataModify=t}function u(t){var i=t.dataExtremes,e=i.activeYData;this.dataModify&&i&&(t=void 0,this.options.compare?t=[this.dataModify.modifyValue(i.dataMin),this.dataModify.modifyValue(i.dataMax)]:this.options.cumulative&&isArray(e)&&2<=e.length&&(t=o.getCumulativeExtremes(e)),t&&(i.dataMin=arrayMin(t),i.dataMax=arrayMax(t)))}function p(t,i){this.options.compare=this.userOptions.compare=t,this.update({},pick(i,!0)),!this.dataModify||"value"!==t&&"percent"!==t?this.points.forEach(function(t){delete t.change}):this.dataModify.initCompare(t)}function c(){var t=this;if(t.xAxis&&t.processedYData&&t.dataModify){var i=t.processedXData,e=t.processedYData,o=e.length,a=!0===t.options.compareStart?0:1,r=-1,n=void 0;for(t.pointArrayMap&&(r=t.pointArrayMap.indexOf(t.options.pointValKey||t.pointValKey||"y")),n=0;n<o-a;n++){var s=e[n]&&-1<r?e[n][r]:e[n];if(isNumber(s)&&0!==s&&i[n+a]>=(t.xAxis.min||0)){t.dataModify.compareValue=s;break}}}}function d(t,i){this.setModifier("compare",t,i)}function m(t,i){t=pick(t,!1),this.options.cumulative=this.userOptions.cumulative=t,this.update({},pick(i,!0)),this.dataModify?this.dataModify.initCumulative():this.points.forEach(function(t){delete t.cumulativeSum})}function f(t,i){this.setModifier("cumulative",t,i)}t.compose=function(t,i,e){var o;return-1===a.indexOf(t)&&(a.push(t),(o=t.prototype).setCompare=p,o.setCumulative=m,addEvent(t,"afterInit",s),addEvent(t,"afterGetExtremes",u),addEvent(t,"afterProcessData",c)),-1===a.indexOf(i)&&(a.push(i),(i=i.prototype).setCompare=d,i.setModifier=r,i.setCumulative=f),-1===a.indexOf(e)&&(a.push(e),e.prototype.tooltipFormatter=n),t};var o=(i.prototype.modifyValue=function(){return 0},i.getCumulativeExtremes=function(t){var e=1/0,o=-1/0;return t.reduce(function(t,i){i=t+i;return e=Math.min(e,i,t),o=Math.max(o,i,t),i}),[e,o]},i.prototype.initCompare=function(o){this.modifyValue=function(t,i){var e=this.compareValue;return void 0===(t=null===t?0:t)||void 0===e?0:("value"===o?t-=e:t=t/e*100-(100===this.series.options.compareBase?0:100),void 0===i||(i=this.series.points[i])&&(i.change=t),t)}},i.prototype.initCumulative=function(){this.modifyValue=function(t,i){if(void 0===(t=null===t?0:t)||void 0===i)return 0;var e=0<i?this.series.points[i-1]:null;e&&e.cumulativeSum&&(t=correctFloat(e.cumulativeSum+t));i=this.series.points[i];return i&&(i.cumulativeSum=t),t}},i);function i(t){this.series=t}t.Additions=o}(DataModifyComposition=DataModifyComposition||{});export default DataModifyComposition;