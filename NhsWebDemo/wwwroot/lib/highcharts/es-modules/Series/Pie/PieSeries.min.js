"use strict";var __extends=this&&this.__extends||function(){var i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)};return function(e,t){function r(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}}();import CU from"../CenteredUtilities.js";var getStartAndEndRadians=CU.getStartAndEndRadians;import ColumnSeries from"../Column/ColumnSeries.js";import H from"../../Core/Globals.js";var noop=H.noop;import LegendSymbol from"../../Core/Legend/LegendSymbol.js";import PiePoint from"./PiePoint.js";import Series from"../../Core/Series/Series.js";import SeriesRegistry from"../../Core/Series/SeriesRegistry.js";import Symbols from"../../Core/Renderer/SVG/Symbols.js";import U from"../../Core/Utilities.js";var clamp=U.clamp,extend=U.extend,fireEvent=U.fireEvent,merge=U.merge,pick=U.pick,relativeLength=U.relativeLength,PieSeries=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.center=void 0,e.data=void 0,e.maxLabelDistance=void 0,e.options=void 0,e.points=void 0,e}return __extends(e,t),e.prototype.animate=function(e){var i=this,t=i.points,a=i.startAngleRad;e||t.forEach(function(e){var t=e.graphic,r=e.shapeArgs;t&&r&&(t.attr({r:pick(e.startR,i.center&&i.center[3]/2),start:a,end:a}),t.animate({r:r.r,start:r.start,end:r.end},i.options.animation))})},e.prototype.drawEmpty=function(){var e,t,r=this.startAngleRad,i=this.endAngleRad,a=this.options;0===this.total&&this.center?(e=this.center[0],t=this.center[1],this.graph||(this.graph=this.chart.renderer.arc(e,t,this.center[1]/2,0,r,i).addClass("highcharts-empty-series").add(this.group)),this.graph.attr({d:Symbols.arc(e,t,this.center[2]/2,0,{start:r,end:i,innerR:this.center[3]/2})}),this.chart.styledMode||this.graph.attr({"stroke-width":a.borderWidth,fill:a.fillColor||"none",stroke:a.color||"#cccccc"})):this.graph&&(this.graph=this.graph.destroy())},e.prototype.drawPoints=function(){var t=this.chart.renderer;this.points.forEach(function(e){e.graphic&&e.hasNewShapeType()&&(e.graphic=e.graphic.destroy()),e.graphic||(e.graphic=t[e.shapeType](e.shapeArgs).add(e.series.group),e.delayedRendering=!0)})},e.prototype.generatePoints=function(){t.prototype.generatePoints.call(this),this.updateTotals()},e.prototype.getX=function(e,t,r){var i=this.center,a=this.radii?this.radii[r.index]||0:i[2]/2,e=Math.asin(clamp((e-i[1])/(a+r.labelDistance),-1,1));return i[0]+(t?-1:1)*(Math.cos(e)*(a+r.labelDistance))+(0<r.labelDistance?(t?-1:1)*this.options.dataLabels.padding:0)},e.prototype.hasData=function(){return!!this.processedXData.length},e.prototype.redrawPoints=function(){var i,a,n,o,s=this,d=s.chart,l=d.renderer,p=s.options.shadow;this.drawEmpty(),!p||s.shadowGroup||d.styledMode||(s.shadowGroup=l.g("shadow").attr({zIndex:-1}).add(s.group)),s.points.forEach(function(e){var t,r={};a=e.graphic,!e.isNull&&a?(t=void 0,o=e.shapeArgs,i=e.getTranslate(),d.styledMode||(t=e.shadowGroup,(t=p&&!t?e.shadowGroup=l.g("shadow").add(s.shadowGroup):t)&&t.attr(i),n=s.pointAttribs(e,e.selected&&"select")),e.delayedRendering?(a.setRadialReference(s.center).attr(o).attr(i),d.styledMode||a.attr(n).attr({"stroke-linejoin":"round"}).shadow(p,t),e.delayedRendering=!1):(a.setRadialReference(s.center),d.styledMode||merge(!0,r,n),merge(!0,r,o,i),a.animate(r)),a.attr({visibility:e.visible?"inherit":"hidden"}),a.addClass(e.getClassName(),!0)):a&&(e.graphic=a.destroy())})},e.prototype.sortByAngle=function(e,r){e.sort(function(e,t){return void 0!==e.angle&&(t.angle-e.angle)*r})},e.prototype.translate=function(e){this.generatePoints();var t,r,i,a,n=this,o=n.options,s=o.slicedOffset,d=s+(o.borderWidth||0),l=getStartAndEndRadians(o.startAngle,o.endAngle),p=n.startAngleRad=l.start,h=(n.endAngleRad=l.end)-p,c=n.points,g=o.dataLabels.distance,f=o.ignoreHiddenPoint,u=c.length,y=0;for(e||(n.center=e=n.getCenter()),i=0;i<u;i++){t=p+y*h,!(a=c[i]).isValid()||f&&!a.visible||(y+=a.percentage/100);var m=p+y*h,b={x:e[0],y:e[1],r:e[2]/2,innerR:e[3]/2,start:Math.round(1e3*t)/1e3,end:Math.round(1e3*m)/1e3};a.shapeType="arc",a.shapeArgs=b,a.labelDistance=pick(a.options.dataLabels&&a.options.dataLabels.distance,g),a.labelDistance=relativeLength(a.labelDistance,b.r),n.maxLabelDistance=Math.max(n.maxLabelDistance||0,a.labelDistance),(r=(m+t)/2)>1.5*Math.PI?r-=2*Math.PI:r<-Math.PI/2&&(r+=2*Math.PI),a.slicedTranslation={translateX:Math.round(Math.cos(r)*s),translateY:Math.round(Math.sin(r)*s)},b=Math.cos(r)*e[2]/2,m=Math.sin(r)*e[2]/2,a.tooltipPos=[e[0]+.7*b,e[1]+.7*m],a.half=r<-Math.PI/2||r>Math.PI/2?1:0,a.angle=r,t=Math.min(d,a.labelDistance/5),a.labelPosition={natural:{x:e[0]+b+Math.cos(r)*a.labelDistance,y:e[1]+m+Math.sin(r)*a.labelDistance},final:{},alignment:a.labelDistance<0?"center":a.half?"right":"left",connectorPosition:{breakAt:{x:e[0]+b+Math.cos(r)*t,y:e[1]+m+Math.sin(r)*t},touchingSliceAt:{x:e[0]+b,y:e[1]+m}}}}fireEvent(n,"afterTranslate")},e.prototype.updateTotals=function(){for(var e,t=this.points,r=t.length,i=this.options.ignoreHiddenPoint,a=0,n=0;n<r;n++)!(e=t[n]).isValid()||i&&!e.visible||(a+=e.y);for(this.total=a,n=0;n<r;n++)(e=t[n]).percentage=0<a&&(e.visible||!i)?e.y/a*100:0,e.total=a},e.defaultOptions=merge(Series.defaultOptions,{center:[null,null],clip:!1,colorByPoint:!0,dataLabels:{allowOverlap:!0,connectorPadding:5,connectorShape:"fixedOffset",crookDistance:"70%",distance:30,enabled:!0,formatter:function(){return this.point.isNull?void 0:this.point.name},softConnector:!0,x:0},fillColor:void 0,ignoreHiddenPoint:!0,inactiveOtherPoints:!0,legendType:"point",marker:null,size:null,showInLegend:!1,slicedOffset:10,stickyTracking:!1,tooltip:{followPointer:!0},borderColor:"#ffffff",borderWidth:1,lineWidth:void 0,states:{hover:{brightness:.1}}}),e}(Series);extend(PieSeries.prototype,{axisTypes:[],directTouch:!0,drawGraph:void 0,drawLegendSymbol:LegendSymbol.drawRectangle,drawTracker:ColumnSeries.prototype.drawTracker,getCenter:CU.getCenter,getSymbol:noop,isCartesian:!1,noSharedTooltip:!0,pointAttribs:ColumnSeries.prototype.pointAttribs,pointClass:PiePoint,requireSorting:!1,searchPoint:noop,trackerGroups:["group","dataLabelsGroup"]}),SeriesRegistry.registerSeriesType("pie",PieSeries);export default PieSeries;