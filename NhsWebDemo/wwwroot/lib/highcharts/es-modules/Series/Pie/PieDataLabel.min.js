"use strict";import DataLabel from"../../Core/Series/DataLabel.js";import H from"../../Core/Globals.js";var noop=H.noop;import R from"../../Core/Renderer/RendererUtilities.js";var distribute=R.distribute;import SeriesRegistry from"../../Core/Series/SeriesRegistry.js";var Series=SeriesRegistry.series;import U from"../../Core/Utilities.js";var ColumnDataLabel,arrayMax=U.arrayMax,clamp=U.clamp,defined=U.defined,merge=U.merge,pick=U.pick,relativeLength=U.relativeLength;!function(t){var a=[],e={radialDistributionY:function(t){return t.top+t.distributeBox.pos},radialDistributionX:function(t,a,e,i){return t.getX(e<a.top+2||e>a.bottom-2?i:e,a.half,a)},justify:function(t,a,e){return e[0]+(t.half?-1:1)*(a+t.labelDistance)},alignToPlotEdges:function(t,a,e,i){t=t.getBBox().width;return a?t+i:e-t-i},alignToConnectors:function(t,a,e,i){var o,r=0;return t.forEach(function(t){o=t.dataLabel.getBBox().width,r<o&&(r=o)}),a?r+i:e-r-i}};function i(){var d,e,i,h,b,c,p,u,f,L,m,x=this,t=x.data,g=x.chart,v=x.options.dataLabels||{},y=v.connectorPadding,D=g.plotWidth,w=g.plotHeight,M=g.plotLeft,a=Math.round(g.chartWidth/3),B=x.center,C=B[2]/2,k=B[1],o=[[],[]],E=[0,0,0,0],S=x.dataLabelPositioners;x.visible&&(v.enabled||x._hasPointLabels)&&(t.forEach(function(t){t.dataLabel&&t.visible&&t.dataLabel.shortened&&(t.dataLabel.attr({width:"auto"}).css({width:"auto",textOverflow:"clip"}),t.dataLabel.shortened=!1)}),Series.prototype.drawDataLabels.apply(x),t.forEach(function(t){t.dataLabel&&(t.visible?(o[t.half].push(t),t.dataLabel._pos=null,defined(v.style.width)||defined(t.options.dataLabels&&t.options.dataLabels.style&&t.options.dataLabels.style.width)||t.dataLabel.getBBox().width>a&&(t.dataLabel.css({width:Math.round(.7*a)+"px"}),t.dataLabel.shortened=!0)):(t.dataLabel=t.dataLabel.destroy(),t.dataLabels&&1===t.dataLabels.length&&delete t.dataLabels))}),o.forEach(function(t,a){var e,i,o,r,l,s=t.length,n=[];if(s)for(x.sortByAngle(t,a-.5),0<x.maxLabelDistance&&(l=Math.max(0,k-C-x.maxLabelDistance),e=Math.min(k+C+x.maxLabelDistance,g.plotHeight),t.forEach(function(t){0<t.labelDistance&&t.dataLabel&&(t.top=Math.max(0,k-C-t.labelDistance),t.bottom=Math.min(k+C+t.labelDistance,g.plotHeight),r=t.dataLabel.getBBox().height||21,t.distributeBox={target:t.labelPosition.natural.y-t.top+r/2,size:r,rank:t.y},n.push(t.distributeBox))}),distribute(n,l=e+r-l,l/5)),L=0;L<s;L++){if(d=t[L],b=d.labelPosition,h=d.dataLabel,f=!1===d.visible?"hidden":"inherit",i=b.natural.y,u=i,n&&defined(d.distributeBox)&&(void 0===d.distributeBox.pos?f="hidden":(c=d.distributeBox.size,u=S.radialDistributionY(d))),delete d.positionIndex,v.justify)p=S.justify(d,C,B);else switch(v.alignTo){case"connectors":p=S.alignToConnectors(t,a,D,M);break;case"plotEdges":p=S.alignToPlotEdges(h,a,D,M);break;default:p=S.radialDistributionX(x,d,u,i)}h._attr={visibility:f,align:b.alignment},m=d.options.dataLabels||{},h._pos={x:p+pick(m.x,v.x)+({left:y,right:-y}[b.alignment]||0),y:u+pick(m.y,v.y)-10},b.final.x=p,b.final.y=u,pick(v.crop,!0)&&(b=h.getBBox().width,o=null,p-b<y&&1===a?(o=Math.round(b-p+y),E[3]=Math.max(o,E[3])):D-y<p+b&&0===a&&(o=Math.round(p+b-D+y),E[1]=Math.max(o,E[1])),u-c/2<0?E[0]=Math.max(Math.round(c/2-u),E[0]):w<u+c/2&&(E[2]=Math.max(Math.round(u+c/2-w),E[2])),h.sideOverflow=o)}}),0!==arrayMax(E)&&!this.verifyDataLabelOverflow(E)||(this.placeDataLabels(),this.points.forEach(function(t){var a;m=merge(v,t.options.dataLabels),(e=pick(m.connectorWidth,1))&&(a=void 0,i=t.connector,(h=t.dataLabel)&&h._pos&&t.visible&&0<t.labelDistance?(f=h._attr.visibility,(a=!i)&&(t.connector=i=g.renderer.path().addClass("highcharts-data-label-connector  highcharts-color-"+t.colorIndex+(t.className?" "+t.className:"")).add(x.dataLabelsGroup),g.styledMode||i.attr({"stroke-width":e,stroke:m.connectorColor||t.color||"#666666"})),i[a?"attr":"animate"]({d:t.getConnectorPath()}),i.attr("visibility",f)):i&&(t.connector=i.destroy()))})))}function o(){this.points.forEach(function(t){var a,e=t.dataLabel;e&&t.visible&&((a=e._pos)?(e.sideOverflow&&(e._attr.width=Math.max(e.getBBox().width-e.sideOverflow,0),e.css({width:e._attr.width+"px",textOverflow:(this.options.dataLabels.style||{}).textOverflow||"ellipsis"}),e.shortened=!0),e.attr(e._attr),e[e.moved?"animate":"attr"](a),e.moved=!0):e&&e.attr({y:-9999})),delete t.distributeBox},this)}function r(t){var a=this.center,e=this.options,i=e.center,o=e.minSize||80,r=o,l=null!==e.size;return l||(null!==i[0]?r=Math.max(a[2]-Math.max(t[1],t[3]),o):(r=Math.max(a[2]-t[1]-t[3],o),a[0]+=(t[3]-t[1])/2),null!==i[1]?r=clamp(r,o,a[2]-Math.max(t[0],t[2])):(r=clamp(r,o,a[2]-t[0]-t[2]),a[1]+=(t[0]-t[2])/2),r<a[2]?(a[2]=r,a[3]=Math.min(relativeLength(e.innerSize||0,r),r),this.translate(a),this.drawDataLabels&&this.drawDataLabels()):l=!0),l}t.compose=function(t){DataLabel.compose(Series),-1===a.indexOf(t)&&(a.push(t),(t=t.prototype).dataLabelPositioners=e,t.alignDataLabel=noop,t.drawDataLabels=i,t.placeDataLabels=o,t.verifyDataLabelOverflow=r)}}(ColumnDataLabel=ColumnDataLabel||{});export default ColumnDataLabel;