"use strict";var __extends=this&&this.__extends||function(){var i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)};return function(t,e){function r(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}}();import A from"../../Core/Animation/AnimationUtilities.js";var animObject=A.animObject;import Color from"../../Core/Color/Color.js";var color=Color.parse;import CU from"../../Core/Geometry/CircleUtilities.js";var getAreaOfIntersectionBetweenCircles=CU.getAreaOfIntersectionBetweenCircles,getCirclesIntersectionPolygon=CU.getCirclesIntersectionPolygon,isCircle1CompletelyOverlappingCircle2=CU.isCircle1CompletelyOverlappingCircle2,isPointInsideAllCircles=CU.isPointInsideAllCircles,isPointOutsideAllCircles=CU.isPointOutsideAllCircles;import GU from"../../Core/Geometry/GeometryUtilities.js";var getCenterOfPoints=GU.getCenterOfPoints;import SeriesRegistry from"../../Core/Series/SeriesRegistry.js";var ScatterSeries=SeriesRegistry.seriesTypes.scatter;import VennPoint from"./VennPoint.js";import VennUtils from"./VennUtils.js";import U from"../../Core/Utilities.js";var addEvent=U.addEvent,extend=U.extend,isArray=U.isArray,isNumber=U.isNumber,isObject=U.isObject,isString=U.isString,merge=U.merge,VennSeries=function(e){function d(){var t=null!==e&&e.apply(this,arguments)||this;return t.data=void 0,t.mapOfIdToRelation=void 0,t.options=void 0,t.points=void 0,t}return __extends(d,e),d.getLabelPosition=function(i,n){var t=i.reduce(function(t,e){var r=e.r/2;return[{x:e.x,y:e.y},{x:e.x+r,y:e.y},{x:e.x-r,y:e.y},{x:e.x,y:e.y+r},{x:e.x,y:e.y-r}].reduce(function(t,e){var r=VennUtils.getMarginFromCircles(e,i,n);return t.margin<r&&(t.point=e,t.margin=r),t},t)},{point:void 0,margin:-Number.MAX_VALUE}).point,e=VennUtils.nelderMead(function(t){return-VennUtils.getMarginFromCircles({x:t[0],y:t[1]},i,n)},[t.x,t.y]),t={x:e[0],y:e[1]};return t=!isPointInsideAllCircles(t,i)||!isPointOutsideAllCircles(t,n)?1<i.length?getCenterOfPoints(getCirclesIntersectionPolygon(i)):{x:i[0].x,y:i[0].y}:t},d.getLabelValues=function(t,e){var r=t.sets,i=e.reduce(function(t,e){return t[-1<r.indexOf(e.sets[0])?"internal":"external"].push(e.circle),t},{internal:[],external:[]});i.external=i.external.filter(function(e){return i.internal.some(function(t){return!isCircle1CompletelyOverlappingCircle2(e,t)})});e=d.getLabelPosition(i.internal,i.external);return{position:e,width:VennUtils.getLabelWidth(e,i.internal,i.external)}},d.layout=function(t){var i,n,o={},s={};return 0<t.length&&(i=VennUtils.layoutGreedyVenn(t),n=t.filter(VennUtils.isSet),t.forEach(function(t){var e=t.sets,r=e.join(),e=VennUtils.isSet(t)?i[r]:getAreaOfIntersectionBetweenCircles(e.map(function(t){return i[t]}));e&&(o[r]=e,s[r]=d.getLabelValues(t,n))})),{mapOfIdToShape:o,mapOfIdToLabelValues:s}},d.getScale=function(t,e,r){var i=r.bottom-r.top,n=r.right-r.left,o=(r.right+r.left)/2,r=(r.top+r.bottom)/2,i=Math.min(0<n?1/n*t:1,0<i?1/i*e:1);return{scale:i,centerX:t/2-o*i,centerY:e/2-r*i}},d.updateFieldBoundaries=function(t,e){var r=e.x-e.r,i=e.x+e.r,n=e.y+e.r,e=e.y-e.r;return(!isNumber(t.left)||t.left>r)&&(t.left=r),(!isNumber(t.right)||t.right<i)&&(t.right=i),(!isNumber(t.top)||t.top>e)&&(t.top=e),(!isNumber(t.bottom)||t.bottom<n)&&(t.bottom=n),t},d.prototype.animate=function(t){var n;t||(n=animObject(this.options.animation),this.points.forEach(function(t){var e,r,i=t.shapeArgs;t.graphic&&i&&(e={},r={},i.d?e.opacity=.001:(e.r=0,r.r=i.r),t.graphic.attr(e).animate(r,n),i.d&&setTimeout(function(){t&&t.graphic&&t.graphic.animate({opacity:1})},n.duration))},this))},d.prototype.drawPoints=function(){var i=this,n=i.chart,o=i.group,t=i.points||[],s=n.renderer;t.forEach(function(t){var e={zIndex:isArray(t.sets)?t.sets.length:0},r=t.shapeArgs;n.styledMode||extend(e,i.pointAttribs(t,t.state)),t.draw({isNew:!t.graphic,animatableAttribs:r,attribs:e,group:o,renderer:s,shapeType:r&&r.d?"path":"circle"})})},d.prototype.init=function(){ScatterSeries.prototype.init.apply(this,arguments),delete this.opacity},d.prototype.pointAttribs=function(t,e){var r=this.options||{},i=t&&t.options||{},e=e&&r.states[e]||{},e=merge(r,{color:t&&t.color},i,e);return{fill:color(e.color).brighten(e.brightness).get(),opacity:e.opacity,stroke:e.borderColor,"stroke-width":e.borderWidth,dashstyle:e.borderDashStyle}},d.prototype.translate=function(){var t=this.chart;this.processedXData=this.xData,this.generatePoints();var e=VennUtils.processVennData(this.options.data),e=d.layout(e),a=e.mapOfIdToShape,l=e.mapOfIdToLabelValues,e=Object.keys(a).filter(function(t){t=a[t];return t&&isNumber(t.r)}).reduce(function(t,e){return d.updateFieldBoundaries(t,a[e])},{top:0,bottom:0,left:0,right:0}),e=d.getScale(t.plotWidth,t.plotHeight,e),c=e.scale,p=e.centerX,u=e.centerY;this.points.forEach(function(t){var e,r=isArray(t.sets)?t.sets:[],i=r.join(),n=a[i],o=l[i]||{},s=o.width,i=o.position,o=t.options&&t.options.dataLabels;n&&(n.r?e={x:p+n.x*c,y:u+n.y*c,r:n.r*c}:n.d&&((n=n.d).forEach(function(t){"M"===t[0]?(t[1]=p+t[1]*c,t[2]=u+t[2]*c):"A"===t[0]&&(t[1]=t[1]*c,t[2]=t[2]*c,t[6]=p+t[6]*c,t[7]=u+t[7]*c)}),e={d:n}),i?(i.x=p+i.x*c,i.y=u+i.y*c):i={},isNumber(s)&&(s=Math.round(s*c))),t.shapeArgs=e,i&&e&&(t.plotX=i.x,t.plotY=i.y),s&&e&&(t.dlOptions=merge(!0,{style:{width:s}},isObject(o,!0)?o:void 0)),t.name=t.options.name||r.join("âˆ©")})},d.defaultOptions=merge(ScatterSeries.defaultOptions,{borderColor:"#cccccc",borderDashStyle:"solid",borderWidth:1,brighten:0,clip:!1,colorByPoint:!0,dataLabels:{enabled:!0,verticalAlign:"middle",formatter:function(){return this.point.name}},inactiveOtherPoints:!0,marker:!1,opacity:.75,showInLegend:!1,states:{hover:{opacity:1,borderColor:"#333333"},select:{color:"#cccccc",borderColor:"#000000",animation:!1},inactive:{opacity:.075}},tooltip:{pointFormat:"{point.name}: {point.value}"}}),d}(ScatterSeries);extend(VennSeries.prototype,{axisTypes:[],directTouch:!0,isCartesian:!1,pointArrayMap:["value"],pointClass:VennPoint,utils:VennUtils}),SeriesRegistry.registerSeriesType("venn",VennSeries);export default VennSeries;addEvent(VennSeries,"afterSetOptions",function(t){var e=t.options.states;this.is("venn")&&Object.keys(e).forEach(function(t){e[t].halo=!1})});