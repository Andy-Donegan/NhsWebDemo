"use strict";var __extends=this&&this.__extends||function(){var i=function(t,r){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,r){t.__proto__=r}||function(t,r){for(var e in r)r.hasOwnProperty(e)&&(t[e]=r[e])})(t,r)};return function(t,r){function e(){this.constructor=t}i(t,r),t.prototype=null===r?Object.create(r):(e.prototype=r.prototype,new e)}}();import A from"../../Core/Animation/AnimationUtilities.js";var animObject=A.animObject;import H from"../../Core/Globals.js";var noop=H.noop;import OnSeriesComposition from"../OnSeriesComposition.js";import SeriesRegistry from"../../Core/Series/SeriesRegistry.js";var Series=SeriesRegistry.series,ColumnSeries=SeriesRegistry.seriesTypes.column;import U from"../../Core/Utilities.js";var extend=U.extend,merge=U.merge,pick=U.pick;import WindbarbPoint from"./WindbarbPoint.js";var WindbarbSeries=function(i){function e(){var t=null!==i&&i.apply(this,arguments)||this;return t.data=void 0,t.options=void 0,t.points=void 0,t}return __extends(e,i),e.registerApproximation=function(){H.approximations&&!H.approximations.windbarb&&(H.approximations.windbarb=function(t,r){for(var e=0,i=0,o=t.length,n=0;n<o;n++)e+=t[n]*Math.cos(r[n]*H.deg2rad),i+=t[n]*Math.sin(r[n]*H.deg2rad);return[t.reduce(function(t,r){return t+r},0)/t.length,Math.atan2(i,e)/H.deg2rad]})},e.prototype.init=function(t,r){e.registerApproximation(),Series.prototype.init.call(this,t,r)},e.prototype.pointAttribs=function(t,r){var e=this.options,i=t.color||this.color,t=this.options.lineWidth;return r&&(i=e.states[r].color||i,t=(e.states[r].lineWidth||t)+(e.states[r].lineWidthPlus||0)),{stroke:i,"stroke-width":t}},e.prototype.windArrow=function(t){var r,e,i=1.943844*t.value,o=t.beaufortLevel,n=this.options.vectorLength/20,s=-10;if(t.isNull)return[];if(0===o)return this.chart.renderer.symbols.circle(-10*n,-10*n,20*n,20*n);if(r=[["M",0,7*n],["L",-1.5*n,7*n],["L",0,10*n],["L",1.5*n,7*n],["L",0,7*n],["L",0,-10*n]],0<(e=(i-i%50)/50))for(;e--;)r.push(-10===s?["L",0,s*n]:["M",0,s*n],["L",5*n,s*n+2],["L",0,s*n+4]),i-=50,s+=7;if(0<(e=(i-i%10)/10))for(;e--;)r.push(-10===s?["L",0,s*n]:["M",0,s*n],["L",7*n,s*n]),i-=10,s+=3;if(0<(e=(i-i%5)/5))for(;e--;)r.push(-10===s?["L",0,s*n]:["M",0,s*n],["L",4*n,s*n]),i-=5,s+=3;return r},e.prototype.drawPoints=function(){var i=this.chart,o=this.yAxis,n=i.inverted,s=this.options.vectorLength/2;this.points.forEach(function(t){var r=t.plotX,e=t.plotY;!1===this.options.clip||i.isInsidePlot(r,0)?(t.graphic||(t.graphic=this.chart.renderer.path().add(this.markerGroup).addClass("highcharts-point highcharts-color-"+pick(t.colorIndex,t.series.colorIndex))),t.graphic.attr({d:this.windArrow(t),translateX:r+this.options.xOffset,translateY:e+this.options.yOffset,rotation:t.direction}),this.chart.styledMode||t.graphic.attr(this.pointAttribs(t))):t.graphic&&(t.graphic=t.graphic.destroy()),t.tooltipPos=[r+this.options.xOffset+(n&&!this.onSeries?s:0),e+this.options.yOffset-(n?0:s+o.pos-i.plotTop)]},this)},e.prototype.animate=function(t){t?this.markerGroup.attr({opacity:.01}):this.markerGroup.animate({opacity:1},animObject(this.options.animation))},e.prototype.markerAttribs=function(t,r){return{}},e.prototype.getExtremes=function(){return{}},e.prototype.shouldShowTooltip=function(t,r,e){return(e=void 0===e?{}:e).ignoreX=this.chart.inverted,e.ignoreY=!e.ignoreX,i.prototype.shouldShowTooltip.call(this,t,r,e)},e.defaultOptions=merge(ColumnSeries.defaultOptions,{dataGrouping:{enabled:!0,approximation:"windbarb",groupPixelWidth:30},lineWidth:2,onSeries:null,states:{hover:{lineWidthPlus:0}},tooltip:{pointFormat:'<span style="color:{point.color}">‚óè</span> {series.name}: <b>{point.value}</b> ({point.beaufort})<br/>'},vectorLength:20,colorKey:"value",yOffset:-20,xOffset:0}),e}(ColumnSeries);OnSeriesComposition.compose(WindbarbSeries),extend(WindbarbSeries.prototype,{beaufortFloor:[0,.3,1.6,3.4,5.5,8,10.8,13.9,17.2,20.8,24.5,28.5,32.7],beaufortName:["Calm","Light air","Light breeze","Gentle breeze","Moderate breeze","Fresh breeze","Strong breeze","Near gale","Gale","Strong gale","Storm","Violent storm","Hurricane"],parallelArrays:["x","value","direction"],pointArrayMap:["value","direction"],pointClass:WindbarbPoint,trackerGroups:["markerGroup"],invertGroups:noop,translate:function(){var e=this.beaufortFloor,i=this.beaufortName;OnSeriesComposition.translate.call(this),this.points.forEach(function(t){for(var r=0;r<e.length&&!(e[r]>t.value);r++);t.beaufortLevel=r-1,t.beaufort=i[r-1]})}}),WindbarbSeries.registerApproximation(),SeriesRegistry.registerSeriesType("windbarb",WindbarbSeries);export default WindbarbSeries;