"use strict";import BubbleLegendDefaults from"./BubbleLegendDefaults.js";import BubbleLegendItem from"./BubbleLegendItem.js";import D from"../../Core/DefaultOptions.js";var setOptions=D.setOptions;import U from"../../Core/Utilities.js";var BubbleLegendComposition,addEvent=U.addEvent,objectEach=U.objectEach,wrap=U.wrap;!function(e){var l=[];function i(e,t,n){var l,i=this,b=i.legend,o=0<=a(i);b&&b.options.enabled&&b.bubbleLegend&&b.options.bubbleLegend.autoRanges&&o?(l=b.bubbleLegend.options,o=b.bubbleLegend.predictBubbleSizes(),b.bubbleLegend.updateRanges(o[0],o[1]),l.placed||(b.group.placed=!1,b.allItems.forEach(function(e){e.legendGroup.translateY=null})),b.render(),i.getMargins(),i.axes.forEach(function(e){e.visible&&e.render(),l.placed||(e.setScale(),e.updateNames(),objectEach(e.ticks,function(e){e.isNew=!0,e.isNewLabel=!0}))}),l.placed=!0,i.getMargins(),e.call(i,t,n),b.bubbleLegend.correctSizes(),r(b,s(b))):(e.call(i,t,n),b&&b.options.enabled&&b.bubbleLegend&&(b.render(),r(b,s(b))))}function a(e){for(var t=e.series,n=0;n<t.length;){if(t[n]&&t[n].isBubble&&t[n].visible&&t[n].zData.length)return n;n++}return-1}function s(e){for(var t,n=e.allItems,l=[],i=n.length,b=0,o=0,b=0;b<i;b++)if(n[b].legendItemHeight&&(n[b].itemHeight=n[b].legendItemHeight),n[b]===n[i-1]||n[b+1]&&n[b]._legendItemPos[1]!==n[b+1]._legendItemPos[1]){for(l.push({height:0}),t=l[l.length-1];o<=b;o++)n[o].itemHeight>t.height&&(t.height=n[o].itemHeight);t.step=b}return l}function b(e){var t=this,n=t.bubbleLegend,l=t.options,i=l.bubbleLegend,b=a(t.chart);n&&n.ranges&&n.ranges.length&&(i.ranges.length&&(i.autoRanges=!!i.ranges[0].autoRanges),t.destroyItem(n)),0<=b&&l.enabled&&i.enabled&&(i.seriesIndex=b,t.bubbleLegend=new BubbleLegendItem(i,t),t.bubbleLegend.addToLegend(e.allItems))}function o(){var e=this,t=e.chart,n=e.visible,l=e.chart.legend;l&&l.bubbleLegend&&(e.visible=!n,e.ignoreSeries=n,t=0<=a(t),l.bubbleLegend.visible!==t&&(l.update({bubbleLegend:{enabled:t}}),l.bubbleLegend.visible=t),e.visible=n)}function r(e,n){var l,i,b,t=e.allItems,o=e.options.rtl,a=0;t.forEach(function(e,t){l=e.legendGroup.translateX,i=e._legendItemPos[1],((b=e.movementX)||o&&e.ranges)&&(b=o?l-e.options.maxSize/2:l+b,e.legendGroup.attr({translateX:b})),t>n[a].step&&a++,e.legendGroup.attr({translateY:Math.round(i+n[a].height/2)}),e._legendItemPos[1]=i+n[a].height/2})}e.compose=function(e,t,n){-1===l.indexOf(e)&&(l.push(e),setOptions({legend:{bubbleLegend:BubbleLegendDefaults}}),wrap(e.prototype,"drawChartBox",i)),-1===l.indexOf(t)&&(l.push(t),addEvent(t,"afterGetAllItems",b)),-1===l.indexOf(n)&&(l.push(n),addEvent(n,"legendItemClick",o))}}(BubbleLegendComposition=BubbleLegendComposition||{});export default BubbleLegendComposition;