"use strict";var __extends=this&&this.__extends||function(){var o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)};return function(t,e){function i(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}}();import H from"../../Core/Globals.js";import ItemPoint from"./ItemPoint.js";import D from"../../Core/DefaultOptions.js";var defaultOptions=D.defaultOptions;import SeriesRegistry from"../../Core/Series/SeriesRegistry.js";var PieSeries=SeriesRegistry.seriesTypes.pie;import U from"../../Core/Utilities.js";var defined=U.defined,extend=U.extend,fireEvent=U.fireEvent,isNumber=U.isNumber,merge=U.merge,objectEach=U.objectEach,pick=U.pick,ItemSeries=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.data=void 0,t.options=void 0,t.points=void 0,t}return __extends(t,e),t.prototype.animate=function(t){t?this.group.attr({opacity:0}):this.group.animate({opacity:1},this.options.animation)},t.prototype.drawDataLabels=function(){this.center&&this.slots?H.seriesTypes.pie.prototype.drawDataLabels.call(this):this.points.forEach(function(t){t.destroyElements({dataLabel:1})})},t.prototype.drawPoints=function(){var d=this,f=this.options,g=d.chart.renderer,m=f.marker,y=this.borderWidth%2?.5:1,v=0,b=this.getRows(),S=Math.ceil(this.total/b),w=this.chart.plotWidth/S,M=this.chart.plotHeight/b,A=this.itemSize||Math.min(w,M);this.points.forEach(function(t){var i,e,o,r=t.marker||{},s=r.symbol||m.symbol,n=pick(r.radius,m.radius),a=defined(n)?2*n:A,h=a*f.itemPadding;if(t.graphics=i=t.graphics||{},d.chart.styledMode||(e=d.pointAttribs(t,t.selected&&"select")),!t.isNull&&t.visible){t.graphic||(t.graphic=g.g("point").add(d.group));for(var l,p,c,u=0;u<t.y;u++)c=d.center&&d.slots?(p=(l=d.slots.shift()).x-A/2,l.y-A/2):"horizontal"===f.layout?(p=v%S*w,M*Math.floor(v/S)):(p=w*Math.floor(v/b),v%b*M),p+=h,c+=h,l=o=Math.round(a-2*h),d.options.crisp&&(p=Math.round(p)-y,c=Math.round(c)+y),l={x:p,y:c,width:o,height:l},void 0!==n&&(l.r=n),i[u]?i[u].animate(l):i[u]=g.symbol(s,null,null,null,null,{backgroundSize:"within"}).attr(extend(l,e)).add(t.graphic),i[u].isActive=!0,v++}objectEach(i,function(t,e){t.isActive?t.isActive=!1:(t.destroy(),delete i[e])})})},t.prototype.getRows=function(){var t,e=this.options.rows;if(!e)if(t=this.chart.plotWidth/this.chart.plotHeight,e=Math.sqrt(this.total),1<t)for(e=Math.ceil(e);0<e&&!(t<this.total/e/e);)e--;else for(e=Math.floor(e);e<this.total&&!(this.total/e/e<t);)e++;return e},t.prototype.getSlots=function(){for(var t,o,r,e,i,s,n,a,h,l,p,c,u,d=this.center,f=d[2],g=d[3],m=this.slots,y=0,v=this.endAngleRad-this.startAngleRad,b=Number.MAX_VALUE,S=this.options.rows,w=(f-g)/f,M=v%(2*Math.PI)==0,A=this.total||0;b>A+(c&&M?c.length:0);)for(p=b,b=m.length=0,c=u,u=[],l=f/++y/2,S?0<=(g=(l-S)/l*f)?l=S:(g=0,w=1):l=Math.floor(l*w),t=l;0<t;t--)i=v*(e=(g+t/l*(f-g-y))/2),s=Math.ceil(i/y),u.push({rowRadius:e,rowLength:i,colCount:s}),b+=s+1;if(c){for(var _=p-this.total-(M?c.length:0);0<_;)c.map(function(t){return{angle:t.colCount/t.rowLength,row:t}}).sort(function(t,e){return e.angle-t.angle}).slice(0,Math.min(_,Math.ceil(c.length/2))).forEach(P);return c.forEach(function(t){var e=t.rowRadius,i=t.colCount;for(n=i?v/i:0,h=0;h<=i;h+=1)a=this.startAngleRad+h*n,o=d[0]+Math.cos(a)*e,r=d[1]+Math.sin(a)*e,m.push({x:o,y:r,angle:a})},this),m.sort(function(t,e){return t.angle-e.angle}),this.itemSize=y,m}function P(t){0<_&&(t.row.colCount--,_--)}},t.prototype.translate=function(t){0===this.total&&(this.center=this.getCenter()),this.slots||(this.slots=[]),isNumber(this.options.startAngle)&&isNumber(this.options.endAngle)?(H.seriesTypes.pie.prototype.translate.apply(this,arguments),this.slots=this.getSlots()):(this.generatePoints(),fireEvent(this,"afterTranslate"))},t.defaultOptions=merge(PieSeries.defaultOptions,{endAngle:void 0,innerSize:"40%",itemPadding:.1,layout:"vertical",marker:merge(defaultOptions.plotOptions.line.marker,{radius:null}),rows:void 0,crisp:!1,showInLegend:!0,startAngle:void 0}),t}(PieSeries);extend(ItemSeries.prototype,{markerAttribs:void 0}),ItemSeries.prototype.pointClass=ItemPoint,SeriesRegistry.registerSeriesType("item",ItemSeries);export default ItemSeries;