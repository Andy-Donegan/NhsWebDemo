"use strict";import Point from"../Core/Series/Point.js";import Series from"../Core/Series/Series.js";import U from"../Core/Utilities.js";var NodesComposition,defined=U.defined,extend=U.extend,find=U.find,pick=U.pick;!function(o){var i=[];function n(){return this.data=[].concat(this.points||[],this.nodes),Series.prototype.destroy.apply(this,arguments)}function s(){this.nodes&&(this.nodes.forEach(function(o){o.destroy()}),this.nodes.length=0),Series.prototype.setData.apply(this,arguments)}function r(o){var t=arguments,e=this.isNode?this.linksTo.concat(this.linksFrom):[this.fromNode,this.toNode];"select"!==o&&e.forEach(function(o){o&&o.series&&(Point.prototype.setState.apply(o,t),o.isNode||(o.fromNode.graphic&&Point.prototype.setState.apply(o.fromNode,t),o.toNode&&o.toNode.graphic&&Point.prototype.setState.apply(o.toNode,t)))}),Point.prototype.setState.apply(this,t)}o.compose=function(o,t){var e;return-1===i.indexOf(o)&&(i.push(o),(e=o.prototype).setNodeState=r,e.setState=r),-1===i.indexOf(t)&&(i.push(t),(e=t.prototype).destroy=n,e.setData=s),t},o.createNode=function(o){var t=this.pointClass,e=function(o,t){return find(o,function(o){return o.id===t})},n=e(this.nodes,o);return n||(e=this.options.nodes&&e(this.options.nodes,o),(n=(new t).init(this,extend({className:"highcharts-node",isNode:!0,id:o,y:1},e))).linksTo=[],n.linksFrom=[],n.formatPrefix="node",n.name=n.name||n.options.id||"",n.mass=pick(n.options.mass,n.options.marker&&n.options.marker.radius,this.options.marker&&this.options.marker.radius,4),n.getSum=function(){var t=0,e=0;return n.linksTo.forEach(function(o){t+=o.weight}),n.linksFrom.forEach(function(o){e+=o.weight}),Math.max(t,e)},n.offset=function(o,t){for(var e=0,i=0;i<n[t].length;i++){if(n[t][i]===o)return e;e+=n[t][i].weight}},n.hasShape=function(){var t=0;return n.linksTo.forEach(function(o){o.outgoing&&t++}),!n.linksTo.length||t!==n.linksTo.length},this.nodes.push(n)),n},o.destroy=n,o.generatePoints=function(){var t=this.chart,e={};Series.prototype.generatePoints.call(this),this.nodes||(this.nodes=[]),this.colorCounter=0,this.nodes.forEach(function(o){o.linksFrom.length=0,o.linksTo.length=0,o.level=o.options.level}),this.points.forEach(function(o){defined(o.from)&&(e[o.from]||(e[o.from]=this.createNode(o.from)),e[o.from].linksFrom.push(o),o.fromNode=e[o.from],t.styledMode?o.colorIndex=pick(o.options.colorIndex,e[o.from].colorIndex):o.color=o.options.color||e[o.from].color),defined(o.to)&&(e[o.to]||(e[o.to]=this.createNode(o.to)),e[o.to].linksTo.push(o),o.toNode=e[o.to]),o.name=o.name||o.id},this),this.nodeLookup=e},o.setNodeState=r}(NodesComposition=NodesComposition||{});export default NodesComposition;