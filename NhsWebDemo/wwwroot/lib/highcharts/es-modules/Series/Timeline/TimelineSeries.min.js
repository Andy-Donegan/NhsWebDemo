"use strict";var __extends=this&&this.__extends||function(){var n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)};return function(t,e){function i(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}}();import LegendSymbol from"../../Core/Legend/LegendSymbol.js";import SeriesRegistry from"../../Core/Series/SeriesRegistry.js";var _a=SeriesRegistry.seriesTypes,ColumnSeries=_a.column,LineSeries=_a.line;import SVGElement from"../../Core/Renderer/SVG/SVGElement.js";import TimelinePoint from"./TimelinePoint.js";import U from"../../Core/Utilities.js";var addEvent=U.addEvent,arrayMax=U.arrayMax,arrayMin=U.arrayMin,defined=U.defined,extend=U.extend,merge=U.merge,pick=U.pick,TimelineSeries=function(h){function t(){var t=null!==h&&h.apply(this,arguments)||this;return t.data=void 0,t.options=void 0,t.points=void 0,t.userOptions=void 0,t.visibilityMap=void 0,t}return __extends(t,h),t.prototype.alignDataLabel=function(t,e,i,n){var o=this,r=o.chart.inverted,a=o.visibilityMap.filter(function(t){return t}),s=o.visiblePointsCount,p=a.indexOf(t),l=o.options.dataLabels,d=t.userDLOptions||{},c=l.alternate?!p||p===s-1?1.5:2:1,a=Math.floor(o.xAxis.len/s),p=e.padding;t.visible&&(s=Math.abs(d.x||t.options.dataLabels.x),p=r?{width:(t=2*(s-p)-t.itemHeight/2)+"px",textOverflow:e.width/t*e.height/2>a*c?"ellipsis":"none"}:{width:(d.width||l.width||a*c-2*p)+"px"},e.css(p),o.chart.styledMode||e.shadow(l.shadow)),h.prototype.alignDataLabel.apply(o,arguments)},t.prototype.bindAxes=function(){var e=this;h.prototype.bindAxes.call(e),["xAxis","yAxis"].forEach(function(t){"xAxis"!==t||e[t].userOptions.type||(e[t].categories=e[t].hasNames=!0)})},t.prototype.distributeDL=function(){var i,n=this,o=n.options.dataLabels,r=1;o&&(i=o.distance||0,n.points.forEach(function(t){var e;t.options.dataLabels=merge(((e={})[n.chart.inverted?"x":"y"]=o.alternate&&r%2?-i:i,e),t.userDLOptions),r++}))},t.prototype.generatePoints=function(){var i=this;h.prototype.generatePoints.apply(i),i.points.forEach(function(t,e){t.applyOptions({x:i.xData[e]},i.xData[e])})},t.prototype.getVisibilityMap=function(){var t=this;return(t.data.length?t:t.userOptions).data.map(function(t){return!(!t||!1===t.visible||t.isNull)&&t})},t.prototype.getXExtremes=function(t){var i=this,t=t.filter(function(t,e){return i.points[e].isValid()&&i.points[e].visible});return{min:arrayMin(t),max:arrayMax(t)}},t.prototype.init=function(){var t=this;h.prototype.init.apply(t,arguments),t.eventsToUnbind.push(addEvent(t,"afterTranslate",function(){var e,i=Number.MAX_VALUE;t.points.forEach(function(t){t.isInside=t.isInside&&t.visible,t.visible&&!t.isNull&&(defined(e)&&(i=Math.min(i,Math.abs(t.plotX-e))),e=t.plotX)}),t.closestPointRangePx=i})),t.eventsToUnbind.push(addEvent(t,"drawDataLabels",function(){t.distributeDL()})),t.eventsToUnbind.push(addEvent(t,"afterDrawDataLabels",function(){var e;t.points.forEach(function(t){if(e=t.dataLabel)return e.animate=function(t){return this.targetPosition&&(this.targetPosition=t),SVGElement.prototype.animate.apply(this,arguments)},e.targetPosition||(e.targetPosition={}),t.drawConnector()})})),t.eventsToUnbind.push(addEvent(t.chart,"afterHideOverlappingLabel",function(){t.points.forEach(function(t){t.connector&&t.dataLabel&&t.dataLabel.oldOpacity!==t.dataLabel.newOpacity&&t.alignConnector()})}))},t.prototype.markerAttribs=function(t,e){var i=this.options.marker,n=t.marker||{},o=n.symbol||i.symbol,r=pick(n.width,i.width,this.closestPointRangePx),a=pick(n.height,i.height),s=0;return this.xAxis.dateTime?h.prototype.markerAttribs.call(this,t,e):(e&&(i=i.states[e]||{},e=n.states&&n.states[e]||{},s=pick(e.radius,i.radius,s+(i.radiusPlus||0))),t.hasImage=o&&0===o.indexOf("url"),{x:Math.floor(t.plotX)-r/2-s/2,y:t.plotY-a/2-s/2,width:r+s,height:a+s})},t.prototype.processData=function(){var t,e=this,i=0;for(e.visibilityMap=e.getVisibilityMap(),e.visibilityMap.forEach(function(t){t&&i++}),e.visiblePointsCount=i,t=0;t<e.xData.length;t++)e.yData[t]=1;h.prototype.processData.call(this,arguments)},t.defaultOptions=merge(LineSeries.defaultOptions,{colorByPoint:!0,stickyTracking:!1,ignoreHiddenPoint:!0,legendType:"point",lineWidth:4,tooltip:{headerFormat:'<span style="color:{point.color}">●</span> <span style="font-size: 10px"> {point.key}</span><br/>',pointFormat:"{point.description}"},states:{hover:{lineWidthPlus:0}},dataLabels:{enabled:!0,allowOverlap:!0,alternate:!0,backgroundColor:"#ffffff",borderWidth:1,borderColor:"#999999",borderRadius:3,color:"#333333",connectorWidth:1,distance:100,formatter:function(){var t=this.series.chart.styledMode?"<span>● </span>":'<span style="color:'+this.point.color+'">● </span>';return t+='<span class="highcharts-strong">'+(this.key||"")+"</span><br/>"+(this.point.label||"")},style:{textOutline:"none",fontWeight:"normal",fontSize:"12px"},shadow:!1,verticalAlign:"middle"},marker:{enabledThreshold:0,symbol:"square",radius:6,lineWidth:2,height:15},showInLegend:!1,colorKey:"x"}),t}(LineSeries);extend(TimelineSeries.prototype,{drawLegendSymbol:LegendSymbol.drawRectangle,drawTracker:ColumnSeries.prototype.drawTracker,pointClass:TimelinePoint,trackerGroups:["markerGroup","dataLabelsGroup"]}),SeriesRegistry.registerSeriesType("timeline",TimelineSeries);export default TimelineSeries;