"use strict";var __extends=this&&this.__extends||function(){var i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)e.hasOwnProperty(o)&&(t[o]=e[o])})(t,e)};return function(t,e){function o(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}}();import H from"../../Core/Globals.js";var noop=H.noop;import Series from"../../Core/Series/Series.js";import SeriesRegistry from"../../Core/Series/SeriesRegistry.js";var ColumnSeries=SeriesRegistry.seriesTypes.column;import U from"../../Core/Utilities.js";var extend=U.extend,isArray=U.isArray,isNumber=U.isNumber,isObject=U.isObject,merge=U.merge;import WordcloudPoint from"./WordcloudPoint.js";import WordcloudUtils from"./WordcloudUtils.js";var archimedeanSpiral=WordcloudUtils.archimedeanSpiral,extendPlayingField=WordcloudUtils.extendPlayingField,getBoundingBoxFromPolygon=WordcloudUtils.getBoundingBoxFromPolygon,getPlayingField=WordcloudUtils.getPlayingField,getPolygon=WordcloudUtils.getPolygon,getRandomPosition=WordcloudUtils.getRandomPosition,getRotation=WordcloudUtils.getRotation,getScale=WordcloudUtils.getScale,getSpiral=WordcloudUtils.getSpiral,intersectionTesting=WordcloudUtils.intersectionTesting,isPolygonsColliding=WordcloudUtils.isPolygonsColliding,rectangularSpiral=WordcloudUtils.rectangularSpiral,rotate2DToOrigin=WordcloudUtils.rotate2DToOrigin,rotate2DToPoint=WordcloudUtils.rotate2DToPoint,squareSpiral=WordcloudUtils.squareSpiral,updateFieldBoundaries=WordcloudUtils.updateFieldBoundaries,WordcloudSeries=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.data=void 0,t.options=void 0,t.points=void 0,t}return __extends(t,e),t.prototype.bindAxes=function(){var t={endOnTick:!1,gridLineWidth:0,lineWidth:0,maxPadding:0,startOnTick:!1,title:void 0,tickPositions:[]};Series.prototype.bindAxes.call(this),extend(this.yAxis.options,t),extend(this.xAxis.options,t)},t.prototype.pointAttribs=function(t,e){e=H.seriesTypes.column.prototype.pointAttribs.call(this,t,e);return delete e.stroke,delete e["stroke-width"],e},t.prototype.deriveFontSize=function(t,e,o){t=isNumber(t)?t:0,e=isNumber(e)?e:1,o=isNumber(o)?o:1;return Math.floor(Math.max(o,t*e))},t.prototype.drawPoints=function(){var s,d,p=this,c=p.hasRendered,t=p.xAxis,e=p.yAxis,o=p.chart,g=p.group,u=p.options,y=u.animation,m=u.allowExtendPlayingField,h=o.renderer,i=h.text().add(g),x=[],f=p.placementStrategy[u.placementStrategy],S=u.rotation,o=p.points.map(function(t){return t.weight}),P=Math.max.apply(null,o),W=p.points.concat().sort(function(t,e){return e.weight-t.weight});p.group.attr({scaleX:1,scaleY:1}),W.forEach(function(t){var e=1/P*t.weight,e=p.deriveFontSize(e,u.maxFontSize,u.minFontSize),e=extend({fontSize:e+"px"},u.style);i.css(e).attr({x:0,y:0,text:t.name}),e=i.getBBox(!0),t.dimensions={height:e.height,width:e.width}}),d=getPlayingField(t.len,e.len,W),s=getSpiral(p.spirals[u.spiral],{field:d}),W.forEach(function(t){var e,o=1/P*t.weight,i=p.deriveFontSize(o,u.maxFontSize,u.minFontSize),n=extend({fontSize:i+"px"},u.style),r=f(t,{data:W,field:d,placed:x,rotation:S}),a=extend(p.pointAttribs(t,t.selected&&"select"),{align:"center","alignment-baseline":"middle","dominant-baseline":"middle",x:r.x,y:r.y,text:t.name,rotation:isNumber(r.rotation)?r.rotation:void 0}),l=getPolygon(r.x,r.y,t.dimensions.width,t.dimensions.height,r.rotation),o=getBoundingBoxFromPolygon(l),i=intersectionTesting(t,{rectangle:o,polygon:l,field:d,placed:x,spiral:s,rotation:r.rotation});!i&&m&&(d=extendPlayingField(d,o),i=intersectionTesting(t,{rectangle:o,polygon:l,field:d,placed:x,spiral:s,rotation:r.rotation})),isObject(i)?(a.x=(a.x||0)+i.x,a.y=(a.y||0)+i.y,o.left+=i.x,o.right+=i.x,o.top+=i.y,o.bottom+=i.y,d=updateFieldBoundaries(d,o),x.push(t),t.isNull=!1,t.isInside=!0):t.isNull=!0,y&&(e={x:a.x,y:a.y},c?(delete a.x,delete a.y):(a.x=0,a.y=0)),t.draw({animatableAttribs:e,attribs:a,css:n,group:g,renderer:h,shapeArgs:void 0,shapeType:"text"})}),i=i.destroy(),e=getScale(t.len,e.len,d),p.group.attr({scaleX:e,scaleY:e})},t.prototype.hasData=function(){return isObject(this)&&!0===this.visible&&isArray(this.points)&&0<this.points.length},t.prototype.getPlotBox=function(){var t=this.chart,e=t.inverted,o=this[e?"yAxis":"xAxis"],i=this[e?"xAxis":"yAxis"],n=o?o.len:t.plotWidth,e=i?i.len:t.plotHeight;return{translateX:(o?o.left:t.plotLeft)+n/2,translateY:(i?i.top:t.plotTop)+e/2,scaleX:1,scaleY:1}},t.defaultOptions=merge(ColumnSeries.defaultOptions,{allowExtendPlayingField:!0,animation:{duration:500},borderWidth:0,clip:!1,colorByPoint:!0,minFontSize:1,maxFontSize:25,placementStrategy:"center",rotation:{from:0,orientations:2,to:90},showInLegend:!1,spiral:"rectangular",style:{fontFamily:"sans-serif",fontWeight:"900",whiteSpace:"nowrap"},tooltip:{followPointer:!0,pointFormat:'<span style="color:{point.color}">‚óè</span> {series.name}: <b>{point.weight}</b><br/>'}}),t}(ColumnSeries);extend(WordcloudSeries.prototype,{animate:noop,animateDrilldown:noop,animateDrillupFrom:noop,pointClass:WordcloudPoint,setClip:noop,placementStrategy:{random:function(t,e){var o=e.field,e=e.rotation;return{x:getRandomPosition(o.width)-o.width/2,y:getRandomPosition(o.height)-o.height/2,rotation:getRotation(e.orientations,t.index,e.from,e.to)}},center:function(t,e){e=e.rotation;return{x:0,y:0,rotation:getRotation(e.orientations,t.index,e.from,e.to)}}},pointArrayMap:["weight"],spirals:{archimedean:archimedeanSpiral,rectangular:rectangularSpiral,square:squareSpiral},utils:{extendPlayingField:extendPlayingField,getRotation:getRotation,isPolygonsColliding:isPolygonsColliding,rotate2DToOrigin:rotate2DToOrigin,rotate2DToPoint:rotate2DToPoint}}),SeriesRegistry.registerSeriesType("wordcloud",WordcloudSeries);export default WordcloudSeries;