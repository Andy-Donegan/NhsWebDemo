"use strict";import Chart from"../../Core/Chart/Chart.js";import H from"../../Core/Globals.js";import"../../Series/Networkgraph/Layouts.js";var Reingold=H.layouts["reingold-fruchterman"];import U from"../../Core/Utilities.js";var addEvent=U.addEvent,extendClass=U.extendClass,pick=U.pick;Chart.prototype.getSelectedParentNodes=function(){var e=this.series,t=[];return e.forEach(function(e){e.parentNode&&e.parentNode.selected&&t.push(e.parentNode)}),t},H.networkgraphIntegrations.packedbubble={repulsiveForceFunction:function(e,t,i,r){return Math.min(e,(i.marker.radius+r.marker.radius)/2)},barycenter:function(){var t,i,r=this,s=r.options.gravitationalConstant,o=r.box,a=r.nodes;a.forEach(function(e){i=r.options.splitSeries&&!e.isParentNode?(t=e.series.parentNode.plotX,e.series.parentNode.plotY):(t=o.width/2,o.height/2),e.fixedPosition||(e.plotX-=(e.plotX-t)*s/(e.mass*Math.sqrt(a.length)),e.plotY-=(e.plotY-i)*s/(e.mass*Math.sqrt(a.length)))})},repulsive:function(e,t,i,r){var s=t*this.diffTemperature/e.mass/e.degree,t=i.x*s,s=i.y*s;e.fixedPosition||(e.plotX+=t,e.plotY+=s),r.fixedPosition||(r.plotX-=t,r.plotY-=s)},integrate:H.networkgraphIntegrations.verlet.integrate,getK:H.noop},H.layouts.packedbubble=extendClass(Reingold,{beforeStep:function(){this.options.marker&&this.series.forEach(function(e){e&&e.calculateParentRadius()})},isStable:function(){var e=Math.abs(this.prevSystemTemperature-this.systemTemperature),t=10*this.systemTemperature/Math.sqrt(this.nodes.length);return Math.abs(t)<1&&e<1e-5||this.temperature<=0},setCircularPositions:function(){var i,r,s=this,o=s.box,e=s.nodes,t=e.length+1,a=2*Math.PI/t,n=s.options.initialPositionRadius;e.forEach(function(e,t){r=s.options.splitSeries&&!e.isParentNode?(i=e.series.parentNode.plotX,e.series.parentNode.plotY):(i=o.width/2,o.height/2),e.plotX=e.prevX=pick(e.plotX,i+n*Math.cos(e.index||t*a)),e.plotY=e.prevY=pick(e.plotY,r+n*Math.sin(e.index||t*a)),e.dispX=0,e.dispY=0})},repulsiveForces:function(){var i,r,s,o=this,a=o.options.bubblePadding;o.nodes.forEach(function(t){t.degree=t.mass,t.neighbours=0,o.nodes.forEach(function(e){i=0,t===e||t.fixedPosition||!o.options.seriesInteraction&&t.series!==e.series||(s=o.getDistXY(t,e),(r=o.vectorLength(s)-(t.marker.radius+e.marker.radius+a))<0&&(t.degree+=.01,t.neighbours++,i=o.repulsiveForce(-r/Math.sqrt(t.neighbours),o.k,t,e)),o.force("repulsive",t,i*e.mass,s,e,r))})})},applyLimitBox:function(e){var t,i=this;i.options.splitSeries&&!e.isParentNode&&i.options.parentNodeLimit&&(t=i.getDistXY(e,e.series.parentNode),(i=e.series.parentNodeRadius-e.marker.radius-i.vectorLength(t))<0&&i>-2*e.marker.radius&&(e.plotX-=.01*t.x,e.plotY-=.01*t.y)),Reingold.prototype.applyLimitBox.apply(this,arguments)}}),addEvent(Chart,"beforeRedraw",function(){this.allDataPoints&&delete this.allDataPoints});