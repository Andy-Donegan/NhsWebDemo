"use strict";var __extends=this&&this.__extends||function(){var r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)};return function(t,e){function i(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}}();import OrganizationPoint from"./OrganizationPoint.js";import SeriesRegistry from"../../Core/Series/SeriesRegistry.js";var SankeySeries=SeriesRegistry.seriesTypes.sankey;import U from"../../Core/Utilities.js";var css=U.css,extend=U.extend,merge=U.merge,pick=U.pick,wrap=U.wrap,OrganizationSeries=function(n){function l(){var t=null!==n&&n.apply(this,arguments)||this;return t.data=void 0,t.options=void 0,t.points=void 0,t}return __extends(l,n),l.curvedPath=function(t,e){for(var i=[],r=0;r<t.length;r++){var o,n,s,a,h,p,d=t[r][1],g=t[r][2];"number"==typeof d&&"number"==typeof g&&(0===r?i.push(["M",d,g]):r!==t.length-1&&e?(p=t[r-1],h=t[r+1],p&&h&&(o=p[1],n=p[2],s=h[1],a=h[2],"number"==typeof o&&"number"==typeof s&&"number"==typeof n&&"number"==typeof a&&o!==s&&n!==a&&(p=n<a?1:-1,i.push(["L",d-(h=o<s?1:-1)*Math.min(Math.abs(d-o),e),g-p*Math.min(Math.abs(g-n),e)],["C",d,g,d,g,d+h*Math.min(Math.abs(d-s),e),g+p*Math.min(Math.abs(g-a),e)])))):i.push(["L",d,g]))}return i},l.prototype.alignDataLabel=function(t,e,i){var r,o;i.useHTML&&(r=t.shapeArgs.width,o=t.shapeArgs.height,i=this.options.borderWidth+2*this.options.dataLabels.padding,this.chart.inverted&&(r=o,o=t.shapeArgs.width),o-=i,r-=i,(i=e.text)&&(css(i.element.parentNode,{width:r+"px",height:o+"px"}),css(i.element,{left:0,top:0,width:"100%",height:"100%",overflow:"hidden"})),e.getBBox=function(){return{width:r,height:o}},e.width=r,e.height=o),n.prototype.alignDataLabel.apply(this,arguments)},l.prototype.createNode=function(t){t=n.prototype.createNode.call(this,t);return t.getSum=function(){return 1},t},l.prototype.createNodeColumn=function(){var t=n.prototype.createNodeColumn.call(this);return wrap(t,"offset",function(t,e,i){i=t.call(this,e,i);return e.hangsFrom?{absoluteTop:e.hangsFrom.nodeY}:i}),t},l.prototype.pointAttribs=function(t,e){var i=this,r=SankeySeries.prototype.pointAttribs.call(i,t,e),o=(t.isNode?t:t.fromNode).level,n=i.mapOptionsToLevel[o||0]||{},s=t.options,a=n.states&&n.states[e]||{},e=["borderRadius","linkColor","linkLineWidth"].reduce(function(t,e){return t[e]=pick(a[e],s[e],n[e],i.options[e]),t},{});return t.isNode?e.borderRadius&&(r.r=e.borderRadius):(r.stroke=e.linkColor,r["stroke-width"]=e.linkLineWidth,delete r.fill),r},l.prototype.translateLink=function(t){var e=t.fromNode,i=t.toNode,r=Math.round(this.options.linkLineWidth)%2/2,o=Math.floor(e.shapeArgs.x+e.shapeArgs.width)+r,n=Math.floor(e.shapeArgs.y+e.shapeArgs.height/2)+r,s=Math.floor(i.shapeArgs.x)+r,a=Math.floor(i.shapeArgs.y+i.shapeArgs.height/2)+r,h=this.options.hangingIndent,p=i.options.offset,d=/%$/.test(p)&&parseInt(p,10),g=this.chart.inverted;g&&(o-=e.shapeArgs.width,s+=i.shapeArgs.width),p=Math.floor(s+(g?1:-1)*(this.colDistance-this.nodeWidth)/2)+r,d&&(50<=d||d<=-50)&&(p=s=Math.floor(s+(g?-.5:.5)*i.shapeArgs.width)+r,a=i.shapeArgs.y,0<d&&(a+=i.shapeArgs.height)),i.hangsFrom===e&&(this.chart.inverted?(n=Math.floor(e.shapeArgs.y+e.shapeArgs.height-h/2)+r,a=i.shapeArgs.y+i.shapeArgs.height):n=Math.floor(e.shapeArgs.y+h/2)+r,p=s=Math.floor(i.shapeArgs.x+i.shapeArgs.width/2)+r),t.plotY=1,t.shapeType="path",t.shapeArgs={d:l.curvedPath([["M",o,n],["L",p,n],["L",p,a],["L",s,a]],this.options.linkRadius)}},l.prototype.translateNode=function(t,e){SankeySeries.prototype.translateNode.call(this,t,e),t.hangsFrom&&(t.shapeArgs.height-=this.options.hangingIndent,this.chart.inverted||(t.shapeArgs.y+=this.options.hangingIndent)),t.nodeHeight=this.chart.inverted?t.shapeArgs.width:t.shapeArgs.height},l.defaultOptions=merge(SankeySeries.defaultOptions,{borderColor:"#666666",borderRadius:3,linkRadius:10,borderWidth:1,dataLabels:{nodeFormatter:function(){var t={width:"100%",height:"100%",display:"flex","flex-direction":"row","align-items":"center","justify-content":"center"},e={"max-height":"100%","border-radius":"50%"},i={width:"100%",padding:0,"text-align":"center","white-space":"normal"};function r(i){return Object.keys(i).reduce(function(t,e){return t+e+":"+i[e]+";"},'style="')+'"'}this.point.image&&(e["max-width"]="30%",i.width="70%"),this.series.chart.renderer.forExport&&(t.display="block",i.position="absolute",i.left=this.point.image?"30%":0,i.top=0);t="<div "+r(t)+">";return this.point.image&&(t+='<img src="'+this.point.image+'" '+r(e)+">"),t+="<div "+r(i)+">",this.point.name&&(t+="<h4 "+r({margin:0})+">"+this.point.name+"</h4>"),this.point.title&&(t+="<p "+r({margin:0})+">"+(this.point.title||"")+"</p>"),this.point.description&&(t+="<p "+r({opacity:.75,margin:"5px"})+">"+this.point.description+"</p>"),t+="</div></div>"},style:{fontWeight:"normal",fontSize:"13px"},useHTML:!0},hangingIndent:20,linkColor:"#666666",linkLineWidth:1,nodeWidth:50,tooltip:{nodeFormat:"{point.name}<br>{point.title}<br>{point.description}"}}),l}(SankeySeries);extend(OrganizationSeries.prototype,{pointClass:OrganizationPoint}),SeriesRegistry.registerSeriesType("organization",OrganizationSeries);export default OrganizationSeries;