"use strict";var __extends=this&&this.__extends||function(){var o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)};return function(t,e){function i(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}}();import Funnel3DComposition from"./Funnel3DComposition.js";import Funnel3DPoint from"./Funnel3DPoint.js";import H from"../../Core/Globals.js";var noop=H.noop;import Math3D from"../../Extensions/Math3D.js";var perspective=Math3D.perspective;import SeriesRegistry from"../../Core/Series/SeriesRegistry.js";var Series=SeriesRegistry.series,ColumnSeries=SeriesRegistry.seriesTypes.column;import U from"../../Core/Utilities.js";var extend=U.extend,merge=U.merge,pick=U.pick,relativeLength=U.relativeLength,Funnel3DSeries=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.center=void 0,t.data=void 0,t.options=void 0,t.points=void 0,t}return __extends(t,e),t.prototype.alignDataLabel=function(t,e,i){var o=this,n=t.dlBoxRaw,r=o.chart.inverted,s=t.plotY>pick(o.translatedThreshold,o.yAxis.len),l=pick(i.inside,!!o.options.stacking),a={x:n.x,y:n.y,height:0};i.align=pick(i.align,!r||l?"center":s?"right":"left"),i.verticalAlign=pick(i.verticalAlign,r||l?"middle":s?"top":"bottom"),"top"!==i.verticalAlign&&(a.y+=n.bottom/("bottom"===i.verticalAlign?1:2)),a.width=o.getWidthAt(a.y),o.options.reversed&&(a.width=n.fullWidth-a.width),l?a.x-=a.width/2:"left"===i.align?(i.align="right",a.x-=1.5*a.width):"right"===i.align?(i.align="left",a.x+=a.width/2):a.x-=a.width/2,t.dlBox=a,ColumnSeries.prototype.alignDataLabel.apply(o,arguments)},t.prototype.bindAxes=function(){Series.prototype.bindAxes.apply(this,arguments),extend(this.xAxis.options,{gridLineWidth:0,lineWidth:0,title:void 0,tickPositions:[]}),merge(!0,this.yAxis.options,{gridLineWidth:0,title:void 0,labels:{enabled:!1}})},t.prototype.translate=function(){Series.prototype.translate.apply(this,arguments);var e,i,o,n,r,s,l,a,d=0,t=this,p=t.chart,h=t.options,c=h.reversed,g=h.ignoreHiddenPoint,u=p.plotWidth,m=p.plotHeight,f=0,y=h.center,v=relativeLength(y[0],u),x=relativeLength(y[1],m),w=relativeLength(h.width,u),S=relativeLength(h.height,m),b=relativeLength(h.neckWidth,u),D=relativeLength(h.neckHeight,m),A=x-S/2+S-D,m=t.data;t.getWidthAt=i=function(t){return A<t||S===D?b:b+(w-b)*(1-(t-(x-S/2))/(S-D))},t.center=[v,x,S],t.centerX=v,m.forEach(function(t){g&&!1===t.visible||(d+=t.y)}),m.forEach(function(t){s=null,o=d?t.y/d:0,e=i(n=x-S/2+f*S),l=(r=n+o*S)-n,a={gradientForSides:pick(t.options.gradientForSides,h.gradientForSides),x:v,y:n,height:l,width:e,z:1,top:{width:e}},e=i(r),a.bottom={fraction:o,width:e},A<=n?a.isCylinder=!0:A<r&&(s=r,e=i(A),r=A,a.bottom.width=e,a.middle={fraction:l?(A-n)/l:0,width:e}),c&&(a.y=n=x+S/2-(f+o)*S,a.middle&&(a.middle.fraction=1-(l?a.middle.fraction:0)),e=a.width,a.width=a.bottom.width,a.bottom.width=e),t.shapeArgs=extend(t.shapeArgs,a),t.percentage=100*o,t.plotX=v,t.plotY=c?x+S/2-(f+o/2)*S:(n+(s||r))/2,r=perspective([{x:v,y:t.plotY,z:c?-(w-i(t.plotY))/2:-i(t.plotY)/2}],p,!0)[0],t.tooltipPos=[r.x,r.y],t.dlBoxRaw={x:v,width:i(t.plotY),y:n,bottom:a.height||0,fullWidth:w},g&&!1===t.visible||(f+=o)})},t.compose=Funnel3DComposition.compose,t.defaultOptions=merge(ColumnSeries.defaultOptions,{center:["50%","50%"],width:"90%",neckWidth:"30%",height:"100%",neckHeight:"25%",reversed:!1,gradientForSides:!0,animation:!1,edgeWidth:0,colorByPoint:!0,showInLegend:!1,dataLabels:{align:"right",crop:!1,inside:!1,overflow:"allow"}}),t}(ColumnSeries);extend(Funnel3DSeries.prototype,{pointClass:Funnel3DPoint,translate3dShapes:noop}),SeriesRegistry.registerSeriesType("funnel3d",Funnel3DSeries);export default Funnel3DSeries;