"use strict";import Color from"../../Core/Color/Color.js";var color=Color.parse;import H from"../../Core/Globals.js";var charts=H.charts;import SVGRenderer3D from"../../Core/Renderer/SVG/SVGRenderer3D.js";import U from"../../Core/Utilities.js";var Funnel3DComposition,error=U.error,extend=U.extend,merge=U.merge;import"../../Core/Renderer/SVG/SVGRenderer.js";(Funnel3DComposition||(Funnel3DComposition={})).compose=function(r){var e,m;SVGRenderer3D.compose(r),(e=r.prototype.elements3d).funnel3d=merge(e.cuboid,{parts:["top","bottom","frontUpper","backUpper","frontLower","backLower","rightUpper","rightLower"],mainParts:["top","bottom"],sideGroups:["upperGroup","lowerGroup"],sideParts:{upperGroup:["frontUpper","backUpper","rightUpper"],lowerGroup:["frontLower","backLower","rightLower"]},pathType:"funnel3d",opacitySetter:function(r){var e=this,t=e.parts,o=H.charts[e.renderer.chartIndex],n="group-opacity-"+r+"-"+o.index;return e.parts=e.mainParts,e.singleSetterForParts("opacity",r),e.parts=t,o.renderer.filterId||(o.renderer.definition({tagName:"filter",attributes:{id:n},children:[{tagName:"feComponentTransfer",children:[{tagName:"feFuncA",attributes:{type:"table",tableValues:"0 "+r}}]}]}),e.sideGroups.forEach(function(r){e[r].attr({filter:"url(#"+n+")"})}),e.renderer.styledMode&&(o.renderer.definition({tagName:"style",textContent:".highcharts-"+n+" {filter:url(#"+n+")}"}),e.sideGroups.forEach(function(r){r.addClass("highcharts-"+n)}))),e},fillSetter:function(r){var i=this,n=color(r),e=n.rgba[3],a={top:color(r).brighten(.1).get(),bottom:color(r).brighten(-.2).get()};return e<1?(n.rgba[3]=1,n=n.get("rgb"),i.attr({opacity:e})):n=r,(n=!n.linearGradient&&!n.radialGradient&&i.gradientForSides?{linearGradient:{x1:0,x2:1,y1:1,y2:1},stops:[[0,color(r).brighten(-.2).get()],[.5,r],[1,color(r).brighten(-.2).get()]]}:n).linearGradient?i.sideGroups.forEach(function(r){var e=i[r].gradientBox,t=n.linearGradient,o=merge(n,{linearGradient:{x1:e.x+t.x1*e.width,y1:e.y+t.y1*e.height,x2:e.x+t.x2*e.width,y2:e.y+t.y2*e.height}});i.sideParts[r].forEach(function(r){a[r]=o})}):(merge(!0,a,{frontUpper:n,backUpper:n,rightUpper:n,frontLower:n,backLower:n,rightLower:n}),n.radialGradient&&i.sideGroups.forEach(function(r){var e=i[r].gradientBox,t=e.x+e.width/2,o=e.y+e.height/2,n=Math.min(e.width,e.height);i.sideParts[r].forEach(function(r){i[r].setRadialReference([t,o,n])})})),i.singleSetterForParts("fill",null,a),i.color=i.fill=r,n.linearGradient&&[i.frontLower,i.frontUpper].forEach(function(r){r=r.element,r=r&&i.renderer.gradients[r.gradient];r&&"userSpaceOnUse"!==r.attr("gradientUnits")&&r.attr({gradientUnits:"userSpaceOnUse"})}),i},adjustForGradient:function(){var o,n=this;n.sideGroups.forEach(function(r){var e={x:Number.MAX_VALUE,y:Number.MAX_VALUE},t={x:-Number.MAX_VALUE,y:-Number.MAX_VALUE};n.sideParts[r].forEach(function(r){r=n[r];o=r.getBBox(!0),e={x:Math.min(e.x,o.x),y:Math.min(e.y,o.y)},t={x:Math.max(t.x,o.x+o.width),y:Math.max(t.y,o.y+o.height)}}),n[r].gradientBox={x:e.x,width:t.x-e.x,y:e.y,height:t.y-e.y}})},zIndexSetter:function(){return this.finishedOnAdd&&this.adjustForGradient(),this.renderer.Element.prototype.zIndexSetter.apply(this,arguments)},onAdd:function(){this.adjustForGradient(),this.finishedOnAdd=!0}}),m=r.prototype,extend(m,{funnel3d:function(r){var e=this,t=e.element3d("funnel3d",r),o=e.styledMode,n={"stroke-width":1,stroke:"none"};return t.upperGroup=e.g("funnel3d-upper-group").attr({zIndex:t.frontUpper.zIndex}).add(t),[t.frontUpper,t.backUpper,t.rightUpper].forEach(function(r){o||r.attr(n),r.add(t.upperGroup)}),t.lowerGroup=e.g("funnel3d-lower-group").attr({zIndex:t.frontLower.zIndex}).add(t),[t.frontLower,t.backLower,t.rightLower].forEach(function(r){o||r.attr(n),r.add(t.lowerGroup)}),t.gradientForSides=r.gradientForSides,t},funnel3dPath:function(r){this.getCylinderEnd||error("A required Highcharts module is missing: cylinder.js",!0,charts[this.chartIndex]);var e=this,t=charts[e.chartIndex],o=r.alphaCorrection=90-Math.abs(t.options.chart.options3d.alpha%180-90),n=m.cuboidPath.call(e,merge(r,{depth:r.width,width:(r.width+r.bottom.width)/2})),i=n.isTop,a=!n.isFront,d=!!r.middle,p=e.getCylinderEnd(t,merge(r,{x:r.x-r.width/2,z:r.z-r.width/2,alphaCorrection:o})),h=r.bottom.width,s=merge(r,{width:h,x:r.x-h/2,z:r.z-h/2,alphaCorrection:o}),l=e.getCylinderEnd(t,s,!0),c=h,g=s,u=l,f=l;return d&&(c=r.middle.width,g=merge(r,{y:r.y+r.middle.fraction*r.height,width:c,x:r.x-c/2,z:r.z-c/2}),u=e.getCylinderEnd(t,g,!1),f=e.getCylinderEnd(t,g,!1)),(i={top:p,bottom:l,frontUpper:e.getCylinderFront(p,u),zIndexes:{group:n.zIndexes.group,top:0!==i?0:3,bottom:1!==i?0:3,frontUpper:a?2:1,backUpper:a?1:2,rightUpper:a?2:1}}).backUpper=e.getCylinderBack(p,u),u=Math.min(c,r.width)/Math.max(c,r.width)!=1,i.rightUpper=e.getCylinderFront(e.getCylinderEnd(t,merge(r,{x:r.x-r.width/2,z:r.z-r.width/2,alphaCorrection:u?-o:0}),!1),e.getCylinderEnd(t,merge(g,{alphaCorrection:u?-o:0}),!d)),d&&(u=Math.min(c,h)/Math.max(c,h)!=1,merge(!0,i,{frontLower:e.getCylinderFront(f,l),backLower:e.getCylinderBack(f,l),rightLower:e.getCylinderFront(e.getCylinderEnd(t,merge(s,{alphaCorrection:u?-o:0}),!0),e.getCylinderEnd(t,merge(g,{alphaCorrection:u?-o:0}),!1)),zIndexes:{frontLower:a?2:1,backLower:a?1:2,rightLower:a?1:2}})),i}})};export default Funnel3DComposition;