"use strict";var __extends=this&&this.__extends||function(){var r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)};return function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}}();import A from"../../Core/Animation/AnimationUtilities.js";var animObject=A.animObject;import DependencyWheelPoint from"./DependencyWheelPoint.js";import H from"../../Core/Globals.js";var deg2rad=H.deg2rad;import SeriesRegistry from"../../Core/Series/SeriesRegistry.js";var _a=SeriesRegistry.seriesTypes,PieSeries=_a.pie,SankeySeries=_a.sankey;import U from"../../Core/Utilities.js";var extend=U.extend,merge=U.merge,DependencyWheelSeries=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.data=void 0,e.options=void 0,e.nodeColumns=void 0,e.nodes=void 0,e.points=void 0,e}return __extends(e,t),e.prototype.animate=function(e){var r;e||(r=animObject(this.options.animation).duration/2/this.nodes.length,this.nodes.forEach(function(e,t){var n=e.graphic;n&&(n.attr({opacity:0}),setTimeout(function(){e.graphic&&e.graphic.animate({opacity:1},{duration:r})},r*t))},this),this.points.forEach(function(e){var t=e.graphic;!e.isNode&&t&&t.attr({opacity:0}).animate({opacity:1},this.options.animation)},this))},e.prototype.createNode=function(e){var s=SankeySeries.prototype.createNode.call(this,e);return s.index=this.nodes.length-1,s.getSum=function(){return s.linksFrom.concat(s.linksTo).reduce(function(e,t){return e+t.weight},0)},s.offset=function(e){var t,n,r=0,o=s.linksFrom.concat(s.linksTo);function i(e){return e.fromNode===s?e.toNode:e.fromNode}for(o.sort(function(e,t){return i(e).index-i(t).index}),t=0;t<o.length;t++)if(i(o[t]).index>s.index){o=o.slice(0,t).reverse().concat(o.slice(t).reverse()),n=!0;break}for(n||o.reverse(),t=0;t<o.length;t++){if(o[t]===e)return r;r+=o[t].weight}},s},e.prototype.createNodeColumns=function(){var t=[this.createNodeColumn()];return this.nodes.forEach(function(e){e.column=0,t[0].push(e)}),t},e.prototype.getNodePadding=function(){return this.options.nodePadding/Math.PI},e.prototype.translate=function(){var d=this.options,h=2*Math.PI/(this.chart.plotHeight+this.getNodePadding()),o=this.getCenter(),u=(d.startAngle-90)*deg2rad;SankeySeries.prototype.translate.call(this),this.nodeColumns[0].forEach(function(e){var a,c,t,p,n,r;e.sum&&(r=e.shapeArgs,a=o[0],c=o[1],t=o[2]/2,p=t-d.nodeWidth,n=u+h*(r.y||0),r=u+h*((r.y||0)+(r.height||0)),e.angle=n+(r-n)/2,e.shapeType="arc",e.shapeArgs={x:a,y:c,r:t,innerR:p,start:n,end:r},e.dlBox={x:a+Math.cos((n+r)/2)*(t+p)/2,y:c+Math.sin((n+r)/2)*(t+p)/2,width:1,height:1},e.linksFrom.forEach(function(i){var s,e;i.linkBase&&(e=i.linkBase.map(function(e,t){var n=h*e,r=Math.cos(u+n)*(1+p),o=Math.sin(u+n)*(1+p),e=d.curveFactor||0;return(s=Math.abs(i.linkBase[3-t]*h-n))>Math.PI&&(s=2*Math.PI-s),(s*=p)<p&&(e*=s/p),{x:a+r,y:c+o,cpX:a+(1-e)*r,cpY:c+(1-e)*o}}),i.shapeArgs={d:[["M",e[0].x,e[0].y],["A",p,p,0,0,1,e[1].x,e[1].y],["C",e[1].cpX,e[1].cpY,e[2].cpX,e[2].cpY,e[2].x,e[2].y],["A",p,p,0,0,1,e[3].x,e[3].y],["C",e[3].cpX,e[3].cpY,e[0].cpX,e[0].cpY,e[0].x,e[0].y]]})}))})},e.defaultOptions=merge(SankeySeries.defaultOptions,{center:[null,null],curveFactor:.6,startAngle:0}),e}(SankeySeries);extend(DependencyWheelSeries.prototype,{orderNodes:!1,getCenter:PieSeries.prototype.getCenter}),DependencyWheelSeries.prototype.pointClass=DependencyWheelPoint,SeriesRegistry.registerSeriesType("dependencywheel",DependencyWheelSeries);export default DependencyWheelSeries;