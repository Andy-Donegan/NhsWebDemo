"use strict";var __extends=this&&this.__extends||function(){var i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)e.hasOwnProperty(o)&&(t[o]=e[o])})(t,e)};return function(t,e){function o(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}}();import FlagsPoint from"./FlagsPoint.js";import H from"../../Core/Globals.js";var noop=H.noop;import OnSeriesComposition from"../OnSeriesComposition.js";import R from"../../Core/Renderer/RendererUtilities.js";var distribute=R.distribute;import SeriesRegistry from"../../Core/Series/SeriesRegistry.js";var Series=SeriesRegistry.series,ColumnSeries=SeriesRegistry.seriesTypes.column;import SVGElement from"../../Core/Renderer/SVG/SVGElement.js";import U from"../../Core/Utilities.js";var addEvent=U.addEvent,defined=U.defined,extend=U.extend,merge=U.merge,objectEach=U.objectEach,wrap=U.wrap;import"./FlagsSymbols.js";var FlagsSeries=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.data=void 0,t.options=void 0,t.points=void 0,t}return __extends(t,e),t.prototype.animate=function(t){t&&this.setClip()},t.prototype.drawPoints=function(){for(var t,e,o,i,r,s,n,a,l,p=this,h=p.points,c=p.chart,d=c.renderer,u=c.inverted,f=p.options,g=f.y,y=p.yAxis,m={},v=[],S=h.length;S--;)i=h[S],n=(u?i.plotY:i.plotX)>p.xAxis.len,t=i.plotX,r=i.stackIndex,o=i.options.shape||f.shape,void 0!==(e=i.plotY)&&(e=i.plotY+g-(void 0!==r&&r*f.stackDistance)),i.anchorX=r?void 0:i.plotX,s=r?void 0:i.plotY,a="flag"!==o,r=i.graphic,void 0!==e&&0<=t&&!n?((r=r&&i.hasNewShapeType()?r.destroy():r)||(r=i.graphic=d.label("",null,null,o,null,null,f.useHTML).addClass("highcharts-point").add(p.markerGroup),i.graphic.div&&(i.graphic.div.point=i),r.isNew=!0),r.attr({align:a?"center":"left",width:f.width,height:f.height,"text-align":f.textAlign}),c.styledMode||r.attr(p.pointAttribs(i)).css(merge(f.style,i.style)).shadow(f.shadow),0<t&&(t-=r.strokeWidth()%2),s={y:e,anchorY:s},f.allowOverlapX&&(s.x=t,s.anchorX=i.anchorX),r.attr({text:i.options.title||f.title||"A"})[r.isNew?"attr":"animate"](s),f.allowOverlapX||(m[i.plotX]?m[i.plotX].size=Math.max(m[i.plotX].size,r.width):m[i.plotX]={align:a?.5:0,size:r.width,target:t,anchorX:t}),i.tooltipPos=[t,e+y.pos-c.plotTop]):r&&(i.graphic=r.destroy());f.allowOverlapX||(l=100,objectEach(m,function(t){t.plotX=t.anchorX,v.push(t),l=Math.max(t.size,l)}),distribute(v,(u?y:this.xAxis).len,l),h.forEach(function(t){var e=t.graphic&&m[t.plotX];e&&(t.graphic[t.graphic.isNew?"attr":"animate"]({x:e.pos+e.align*e.size,anchorX:t.anchorX}),defined(e.pos)?t.graphic.isNew=!1:(t.graphic.attr({x:-9999,anchorX:-9999}),t.graphic.isNew=!0))})),f.useHTML&&wrap(p.markerGroup,"on",function(t){return SVGElement.prototype.on.apply(t.apply(this,[].slice.call(arguments,1)),[].slice.call(arguments,1))})},t.prototype.drawTracker=function(){var o=this.points;e.prototype.drawTracker.call(this),o.forEach(function(e){var t=e.graphic;t&&(e.unbindMouseOver&&e.unbindMouseOver(),e.unbindMouseOver=addEvent(t.element,"mouseover",function(){0<e.stackIndex&&!e.raised&&(e._y=t.y,t.attr({y:e._y-8}),e.raised=!0),o.forEach(function(t){t!==e&&t.raised&&t.graphic&&(t.graphic.attr({y:t._y}),t.raised=!1)})}))})},t.prototype.pointAttribs=function(t,e){var o=this.options,i=t&&t.color||this.color,r=o.lineColor,s=t&&t.lineWidth,t=t&&t.fillColor||o.fillColor;return e&&(t=o.states[e].fillColor,r=o.states[e].lineColor,s=o.states[e].lineWidth),{fill:t||i,stroke:r||i,"stroke-width":s||o.lineWidth||0}},t.prototype.setClip=function(){Series.prototype.setClip.apply(this,arguments),!1!==this.options.clip&&this.sharedClipKey&&this.markerGroup&&this.markerGroup.clip(this.chart.sharedClips[this.sharedClipKey])},t.defaultOptions=merge(ColumnSeries.defaultOptions,{pointRange:0,allowOverlapX:!1,shape:"flag",stackDistance:12,textAlign:"center",tooltip:{pointFormat:"{point.text}"},threshold:null,y:-30,fillColor:"#ffffff",lineWidth:1,states:{hover:{lineColor:"#000000",fillColor:"#ccd6eb"}},style:{fontSize:"11px",fontWeight:"bold"}}),t}(ColumnSeries);OnSeriesComposition.compose(FlagsSeries),extend(FlagsSeries.prototype,{allowDG:!1,forceCrop:!0,invertible:!1,noSharedTooltip:!0,pointClass:FlagsPoint,sorted:!1,takeOrdinalPosition:!1,trackerGroups:["markerGroup"],buildKDTree:noop,init:Series.prototype.init,invertGroups:noop}),SeriesRegistry.registerSeriesType("flags",FlagsSeries);export default FlagsSeries;