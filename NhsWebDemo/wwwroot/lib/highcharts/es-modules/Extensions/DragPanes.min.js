"use strict";import H from"../Core/Globals.js";var hasTouch=H.hasTouch;import Axis from"../Core/Axis/Axis.js";import AxisDefaults from"../Core/Axis/AxisDefaults.js";import Pointer from"../Core/Pointer.js";import U from"../Core/Utilities.js";var addEvent=U.addEvent,clamp=U.clamp,isNumber=U.isNumber,merge=U.merge,objectEach=U.objectEach,relativeLength=U.relativeLength,wrap=U.wrap,AxisResizer=function(){function e(e){this.axis=void 0,this.controlLine=void 0,this.lastPos=void 0,this.options=void 0,this.init(e)}return e.prototype.init=function(e,t){this.axis=e,this.options=e.options.resize,this.render(),t||this.addMouseEvents()},e.prototype.render=function(){var e=this,t=e.axis,i=t.chart,o=e.options,s=o.x||0,r=o.y,n=clamp(t.top+t.height+r,i.plotTop,i.plotTop+i.plotHeight),a={};i.styledMode||(a={cursor:o.cursor,stroke:o.lineColor,"stroke-width":o.lineWidth,dashstyle:o.lineDashStyle}),e.lastPos=n-r,e.controlLine||(e.controlLine=i.renderer.path().addClass("highcharts-axis-resizer")),e.controlLine.add(t.axisGroup),o=i.styledMode?e.controlLine.strokeWidth():o.lineWidth,a.d=i.renderer.crispLine([["M",t.left+s,n],["L",t.left+t.width+s,n]],o),e.controlLine.attr(a)},e.prototype.addMouseEvents=function(){var e,t,i,o=this,s=o.controlLine.element,r=o.axis.chart.container,n=[];o.mouseMoveHandler=e=function(e){o.onMouseMove(e)},o.mouseUpHandler=t=function(e){o.onMouseUp(e)},o.mouseDownHandler=i=function(e){o.onMouseDown(e)},n.push(addEvent(r,"mousemove",e),addEvent(r.ownerDocument,"mouseup",t),addEvent(s,"mousedown",i)),hasTouch&&n.push(addEvent(r,"touchmove",e),addEvent(r.ownerDocument,"touchend",t),addEvent(s,"touchstart",i)),o.eventsToUnbind=n},e.prototype.onMouseMove=function(e){e.touches&&0===e.touches[0].pageX||this.grabbed&&(this.hasDragged=!0,this.updateAxes(this.axis.chart.pointer.normalize(e).chartY-this.options.y))},e.prototype.onMouseUp=function(e){this.hasDragged&&this.updateAxes(this.axis.chart.pointer.normalize(e).chartY-this.options.y),this.grabbed=this.hasDragged=this.axis.chart.activeResizer=null},e.prototype.onMouseDown=function(e){this.axis.chart.pointer.reset(!1,0),this.grabbed=this.axis.chart.activeResizer=!0},e.prototype.updateAxes=function(a){function h(e){return 100*e/f+"%"}function c(e,t,i){return Math.round(clamp(e,t,i))}var p,d=this,u=d.axis.chart,e=d.options.controlledAxis,t=0===e.next.length?[u.yAxis.indexOf(d.axis)+1]:e.next,e=[d.axis].concat(e.prev),l=[],x=!1,v=u.plotTop,f=u.plotHeight,m=v+f;a=clamp(a,v,m),(p=a-d.lastPos)*p<1||([e,t].forEach(function(e,n){e.forEach(function(e,t){var i,o,s=isNumber(e)?u.yAxis[e]:n||t?u.get(e):e,r=s&&s.options;r&&"navigator-y-axis"!==r.id&&(t=s.top,e=Math.round(relativeLength(r.minLength,f)),r=Math.round(relativeLength(r.maxLength,f)),n?(p=a-d.lastPos,o=c(s.len-p,e,r),t=s.top+p,m<t+o&&(a+=i=m-o-t,t+=i),(o=t<v&&m<(t=v)+o?f:o)===e&&(x=!0),l.push({axis:s,options:{top:h(t-v),height:h(o)}})):((o=c(a-t,e,r))===r&&(x=!0),a=t+o,l.push({axis:s,options:{height:h(o)}})))})}),x||(l.forEach(function(e){e.axis.update(e.options,!1)}),u.redraw(!1)))},e.prototype.destroy=function(){var i=this;delete i.axis.resizer,this.eventsToUnbind&&this.eventsToUnbind.forEach(function(e){e()}),i.controlLine.destroy(),objectEach(i,function(e,t){i[t]=null})},e.resizerOptions={minLength:"10%",maxLength:"100%",resize:{controlledAxis:{next:[],prev:[]},enabled:!1,cursor:"ns-resize",lineColor:"#cccccc",lineDashStyle:"Solid",lineWidth:4,x:0,y:0}},e}();Axis.keepProps.push("resizer"),addEvent(Axis,"afterRender",function(){var e=this,t=e.resizer,i=e.options.resize;i&&(i=!1!==i.enabled,t?i?t.init(e,!0):t.destroy():i&&(e.resizer=new AxisResizer(e)))}),addEvent(Axis,"destroy",function(e){!e.keepEvents&&this.resizer&&this.resizer.destroy()}),wrap(Pointer.prototype,"runPointActions",function(e){this.chart.activeResizer||e.apply(this,Array.prototype.slice.call(arguments,1))}),wrap(Pointer.prototype,"drag",function(e){this.chart.activeResizer||e.apply(this,Array.prototype.slice.call(arguments,1))}),merge(!0,AxisDefaults.defaultYAxisOptions,AxisResizer.resizerOptions),H.AxisResizer=AxisResizer;export default H.AxisResizer;