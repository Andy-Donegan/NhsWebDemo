"use strict";import Chart from"../Core/Chart/Chart.js";import F from"../Core/FormatUtilities.js";var format=F.format;import H from"../Core/Globals.js";var win=H.win;import U from"../Core/Utilities.js";var error=U.error,extend=U.extend,merge=U.merge,wrap=U.wrap;function pointInPolygon(o,t){for(var r=!1,n=o.x,i=o.y,e=0,a=t.length-1;e<t.length;a=e++)t[e][1]>i!=t[a][1]>i&&n<(t[a][0]-t[e][0])*(i-t[e][1])/(t[a][1]-t[e][1])+t[e][0]&&(r=!r);return r}Chart.prototype.transformFromLatLon=function(o,t){var r=this.options.chart.proj4||win.proj4;if(!r)return error(21,!1,this),{x:0,y:null};var n=t.jsonmarginX,i=void 0===n?0:n,e=t.jsonmarginY,a=void 0===e?0:e,s=t.jsonres,p=void 0===s?1:s,l=t.scale,h=void 0===l?1:l,m=t.xoffset,n=void 0===m?0:m,e=t.xpan,s=void 0===e?0:e,l=t.yoffset,m=void 0===l?0:l,e=t.ypan,l=void 0===e?0:e,e=r(t.crs,[o.lon,o.lat]),r=t.cosAngle||t.rotation&&Math.cos(t.rotation),o=t.sinAngle||t.rotation&&Math.sin(t.rotation),e=t.rotation?[e[0]*r+e[1]*o,-e[0]*o+e[1]*r]:e;return{x:((e[0]-n)*h+s)*p+i,y:-(((m-e[1])*h+l)*p-a)}},Chart.prototype.transformToLatLon=function(o,t){if(this.options.chart.proj4||win.proj4){if(null!==o.y){var r=t.jsonmarginX,n=t.jsonmarginY,i=t.jsonres,e=void 0===i?1:i,a=t.scale,s=void 0===a?1:a,p=t.xoffset,l=t.xpan,i=t.yoffset,a=t.ypan,a={x:((o.x-(void 0===r?0:r))/e-(void 0===l?0:l))/s+(void 0===p?0:p),y:((o.y-(void 0===n?0:n))/e+(void 0===a?0:a))/s+(void 0===i?0:i)},s=t.cosAngle||t.rotation&&Math.cos(t.rotation),i=t.sinAngle||t.rotation&&Math.sin(t.rotation),a=win.proj4(t.crs,"WGS84",t.rotation?{x:a.x*s+a.y*-i,y:a.x*i+a.y*s}:a);return{lat:a.y,lon:a.x}}}else error(21,!1,this)},Chart.prototype.fromPointToLatLon=function(o){var t=this.mapTransforms;if(t){for(var r in t)if(Object.hasOwnProperty.call(t,r)&&t[r].hitZone&&pointInPolygon(o,t[r].hitZone.coordinates[0]))return this.transformToLatLon(o,t[r]);return this.transformToLatLon(o,t.default)}error(22,!1,this)},Chart.prototype.fromLatLonToPoint=function(o){var t,r,n=this.mapTransforms;if(!n)return error(22,!1,this),{x:0,y:null};for(t in n)if(Object.hasOwnProperty.call(n,t)&&n[t].hitZone&&pointInPolygon(r=this.transformFromLatLon(o,n[t]),n[t].hitZone.coordinates[0]))return r;return this.transformFromLatLon(o,n.default)},H.geojson=function(o,i,t){void 0===i&&(i="map");var e=[];return o.features.forEach(function(o){var t,r=o.geometry||{},n=r.type,r=r.coordinates,o=o.properties;("map"!==i&&"mapbubble"!==i||"Polygon"!==n&&"MultiPolygon"!==n)&&("mapline"!==i||"LineString"!==n&&"MultiLineString"!==n)?"mappoint"===i&&"Point"===n&&r.length&&(t={geometry:{coordinates:r,type:n}}):r.length&&(t={geometry:{coordinates:r,type:n}}),t&&e.push(extend(t,{name:o.name||o.NAME,properties:o}))}),t&&o.copyrightShort&&(t.chart.mapCredits=format(t.chart.options.credits.mapText,{geojson:o}),t.chart.mapCreditsFull=format(t.chart.options.credits.mapTextFull,{geojson:o})),e},wrap(Chart.prototype,"addCredits",function(o,t){t=merge(!0,this.options.credits,t),this.mapCredits&&(t.href=null),o.call(this,t),this.credits&&this.mapCreditsFull&&this.credits.attr({title:this.mapCreditsFull})});