import H from"../../../Core/Globals.js";import U from"../../../Core/Utilities.js";var addEvent=U.addEvent,fireEvent=U.fireEvent,objectEach=U.objectEach,pick=U.pick,removeEvent=U.removeEvent,eventEmitterMixin={addEvents:function(){function e(t){addEvent(t,H.isTouchDevice?"touchstart":"mousedown",function(t){o.onMouseDown(t)},{passive:!1})}var a,o=this;e(this.graphic.element),(o.labels||[]).forEach(function(t){t.options.useHTML&&t.graphic.text&&e(t.graphic.text.element)}),objectEach(o.options.events,function(e,a){function t(t){"click"===a&&o.cancelClick||e.call(o,o.chart.pointer.normalize(t),o.target)}-1===(o.nonDOMEvents||[]).indexOf(a)?o.graphic.on(a,t):addEvent(o,a,t,{passive:!1})}),o.options.draggable&&(addEvent(o,"drag",o.onDrag),o.graphic.renderer.styledMode||(a={cursor:{x:"ew-resize",y:"ns-resize",xy:"move"}[o.options.draggable]},o.graphic.css(a),(o.labels||[]).forEach(function(t){t.options.useHTML&&t.graphic.text&&t.graphic.text.css(a)}))),o.isUpdating||fireEvent(o,"add")},removeDocEvents:function(){this.removeDrag&&(this.removeDrag=this.removeDrag()),this.removeMouseUp&&(this.removeMouseUp=this.removeMouseUp())},onMouseDown:function(t){var e,a,o=this,r=o.chart.pointer;t.preventDefault&&t.preventDefault(),2!==t.button&&(t=r.normalize(t),e=t.chartX,a=t.chartY,o.cancelClick=!1,o.chart.hasDraggedAnnotation=!0,o.removeDrag=addEvent(H.doc,H.isTouchDevice?"touchmove":"mousemove",function(t){o.hasDragged=!0,(t=r.normalize(t)).prevChartX=e,t.prevChartY=a,fireEvent(o,"drag",t),e=t.chartX,a=t.chartY},H.isTouchDevice?{passive:!1}:void 0),o.removeMouseUp=addEvent(H.doc,H.isTouchDevice?"touchend":"mouseup",function(t){var e=pick(o.target&&o.target.annotation,o.target);e&&(e.cancelClick=o.hasDragged),o.cancelClick=o.hasDragged,o.hasDragged=!1,o.chart.hasDraggedAnnotation=!1,fireEvent(pick(e,o),"afterUpdate"),o.onMouseUp(t)},H.isTouchDevice?{passive:!1}:void 0))},onMouseUp:function(t){var e=this.chart,a=this.target||this,o=e.options.annotations,e=e.annotations.indexOf(a);this.removeDocEvents(),o[e]=a.options},onDrag:function(t){var e;this.chart.isInsidePlot(t.chartX-this.chart.plotLeft,t.chartY-this.chart.plotTop,{visiblePlotOnly:!0})&&(e=this.mouseMoveToTranslation(t),"x"===this.options.draggable&&(e.y=0),"y"===this.options.draggable&&(e.x=0),this.points.length?this.translate(e.x,e.y):(this.shapes.forEach(function(t){t.translate(e.x,e.y)}),this.labels.forEach(function(t){t.translate(e.x,e.y)})),this.redraw(!1))},mouseMoveToRadians:function(t,e,a){var o=t.prevChartY-a,r=t.prevChartX-e,a=t.chartY-a,t=t.chartX-e;return this.chart.inverted&&(e=r,r=o,o=e,e=t,t=a,a=e),Math.atan2(a,t)-Math.atan2(o,r)},mouseMoveToTranslation:function(t){var e=t.chartX-t.prevChartX,a=t.chartY-t.prevChartY;return this.chart.inverted&&(t=a,a=e,e=t),{x:e,y:a}},mouseMoveToScale:function(t,e,a){var o=t.prevChartX-e,r=t.prevChartY-a,o=(t.chartX-e||1)/(o||1),a=(t.chartY-a||1)/(r||1);return this.chart.inverted&&(r=a,a=o,o=r),{x:o,y:a}},destroy:function(){this.removeDocEvents(),removeEvent(this),this.hcEvents=null}};export default eventEmitterMixin;