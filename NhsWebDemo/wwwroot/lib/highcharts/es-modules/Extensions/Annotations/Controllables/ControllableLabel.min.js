"use strict";import"../../../Core/Renderer/SVG/SVGRenderer.js";import ControllableMixin from"../Mixins/ControllableMixin.js";import F from"../../../Core/FormatUtilities.js";var format=F.format;import MockPoint from"../MockPoint.js";import SVGRenderer from"../../../Core/Renderer/SVG/SVGRenderer.js";var symbols=SVGRenderer.prototype.symbols;import Tooltip from"../../../Core/Tooltip.js";import U from"../../../Core/Utilities.js";var extend=U.extend,isNumber=U.isNumber,pick=U.pick,ControllableLabel=function(){function d(t,i,o){this.addControlPoints=ControllableMixin.addControlPoints,this.attr=ControllableMixin.attr,this.attrsFromOptions=ControllableMixin.attrsFromOptions,this.destroy=ControllableMixin.destroy,this.getPointsOptions=ControllableMixin.getPointsOptions,this.init=ControllableMixin.init,this.linkPoints=ControllableMixin.linkPoints,this.point=ControllableMixin.point,this.rotate=ControllableMixin.rotate,this.scale=ControllableMixin.scale,this.setControlPointsVisibility=ControllableMixin.setControlPointsVisibility,this.shouldBeDrawn=ControllableMixin.shouldBeDrawn,this.transform=ControllableMixin.transform,this.transformPoint=ControllableMixin.transformPoint,this.translateShape=ControllableMixin.translateShape,this.update=ControllableMixin.update,this.init(t,i,o),this.collection="labels"}return d.alignedPosition=function(t,i){var o,n,e=t.align,r=t.verticalAlign,s=(i.x||0)+(t.x||0),l=(i.y||0)+(t.y||0);return"right"===e?o=1:"center"===e&&(o=2),o&&(s+=(i.width-(t.width||0))/o),"bottom"===r?n=1:"middle"===r&&(n=2),n&&(l+=(i.height-(t.height||0))/n),{x:Math.round(s),y:Math.round(l)}},d.justifiedOptions=function(t,i,o,n){var e=o.align,r=o.verticalAlign,s=!i.box&&i.padding||0,l=i.getBBox(),a={align:e,verticalAlign:r,x:o.x,y:o.y,width:i.width,height:i.height},o=(n.x||0)-t.plotLeft,i=(n.y||0)-t.plotTop,n=o+s;return n<0&&("right"===e?a.align="left":a.x=(a.x||0)-n),(n=o+l.width-s)>t.plotWidth&&("left"===e?a.align="right":a.x=(a.x||0)+t.plotWidth-n),(n=i+s)<0&&("bottom"===r?a.verticalAlign="top":a.y=(a.y||0)-n),(n=i+l.height-s)>t.plotHeight&&("top"===r?a.verticalAlign="bottom":a.y=(a.y||0)+t.plotHeight-n),a},d.prototype.translatePoint=function(t,i){ControllableMixin.translatePoint.call(this,t,i,0)},d.prototype.translate=function(t,i){var o=this.annotation.chart,n=this.annotation.userOptions,e=o.annotations.indexOf(this.annotation),e=o.options.annotations[e];o.inverted&&(o=t,t=i,i=o),this.options.x+=t,this.options.y+=i,e[this.collection][this.index].x=this.options.x,e[this.collection][this.index].y=this.options.y,n[this.collection][this.index].x=this.options.x,n[this.collection][this.index].y=this.options.y},d.prototype.render=function(t){var i=this.options,o=this.attrsFromOptions(i),n=i.style;this.graphic=this.annotation.chart.renderer.label("",0,-9999,i.shape,null,null,i.useHTML,null,"annotation-label").attr(o).add(t),this.annotation.chart.styledMode||("contrast"===n.color&&(n.color=this.annotation.chart.renderer.getContrast(-1<d.shapesWithoutBackground.indexOf(i.shape)?"#FFFFFF":i.backgroundColor)),this.graphic.css(i.style).shadow(i.shadow)),i.className&&this.graphic.addClass(i.className),this.graphic.labelrank=i.labelrank,ControllableMixin.render.call(this)},d.prototype.redraw=function(t){var i=this.options,o=this.text||i.format||i.text,n=this.graphic,e=this.points[0];n.attr({text:o?format(o,e.getLabelConfig(),this.annotation.chart):i.formatter.call(e,this)});i=this.anchor(e),e=this.position(i);e?((n.alignAttr=e).anchorX=i.absolutePosition.x,e.anchorY=i.absolutePosition.y,n[t?"animate":"attr"](e)):n.attr({x:0,y:-9999}),n.placed=!!e,ControllableMixin.redraw.call(this,t)},d.prototype.anchor=function(t){var i=ControllableMixin.anchor.apply(this,arguments),o=this.options.x||0,n=this.options.y||0;return i.absolutePosition.x-=o,i.absolutePosition.y-=n,i.relativePosition.x-=o,i.relativePosition.y-=n,i},d.prototype.position=function(t){var i,o,n=this.graphic,e=this.annotation.chart,r=this.points[0],s=this.options,l=t.absolutePosition,a=t.relativePosition,h=r.series.visible&&MockPoint.prototype.isInsidePlot.call(r),p=n.width,t=void 0===p?0:p,p=n.height,p=void 0===p?0:p;return h&&(s.distance?i=Tooltip.prototype.getPosition.call({chart:e,distance:pick(s.distance,16)},t,p,{plotX:a.x,plotY:a.y,negative:r.negative,ttBelow:r.ttBelow,h:a.height||a.width}):s.positioner?i=s.positioner.call(this):(o={x:l.x,y:l.y,width:0,height:0},i=d.alignedPosition(extend(s,{width:t,height:p}),o),"justify"===this.options.overflow&&(i=d.alignedPosition(d.justifiedOptions(e,n,s,i),o))),s.crop&&(o=i.x-e.plotLeft,s=i.y-e.plotTop,h=e.isInsidePlot(o,s)&&e.isInsidePlot(o+t,s+p))),h?i:null},d.attrsMap={backgroundColor:"fill",borderColor:"stroke",borderWidth:"stroke-width",zIndex:"zIndex",borderRadius:"r",padding:"padding"},d.shapesWithoutBackground=["connector"],d}();export default ControllableLabel;symbols.connector=function(t,i,o,n,e){var r,s=e&&e.anchorX,l=e&&e.anchorY,a=o/2;return isNumber(s)&&isNumber(l)&&(r=[["M",s,l]],(e=(e=i-l)<0?-n-e:e)<o&&(a=s<t+o/2?e:o-e),i+n<l?r.push(["L",t+a,i+n]):l<i?r.push(["L",t+a,i]):s<t?r.push(["L",t,i+n/2]):t+o<s&&r.push(["L",t+o,i+n/2])),r||[]};