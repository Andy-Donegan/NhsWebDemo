"use strict";import Chart from"../../Core/Chart/Chart.js";import Color from"../../Core/Color/Color.js";var color=Color.parse;import H from"../../Core/Globals.js";var deg2rad=H.deg2rad,doc=H.doc,noop=H.noop,svg=H.svg,win=H.win;import D from"../../Core/DefaultOptions.js";var getOptions=D.getOptions;import Pointer from"../../Core/Pointer.js";import RendererRegistry from"../../Core/Renderer/RendererRegistry.js";import SVGElement from"../../Core/Renderer/SVG/SVGElement.js";import SVGRenderer from"../../Core/Renderer/SVG/SVGRenderer.js";import U from"../../Core/Utilities.js";var VMLRenderer,VMLElement,VMLRendererExtension,addEvent=U.addEvent,createElement=U.createElement,css=U.css,defined=U.defined,discardElement=U.discardElement,erase=U.erase,extend=U.extend,extendClass=U.extendClass,isArray=U.isArray,isNumber=U.isNumber,isObject=U.isObject,pick=U.pick,pInt=U.pInt,uniqueKey=U.uniqueKey;import VMLRenderer3D from"./VMLRenderer3D.js";getOptions().global.VMLRadialGradientURL="http://code.highcharts.com/9.3.3/gfx/vml-radial-gradient.png",doc&&!doc.defaultView&&(H.getStyle=U.getStyle=function e(t,r){var n={width:"clientWidth",height:"clientHeight"}[r];return t.style[r]?pInt(t.style[r]):("opacity"===r&&(r="filter"),n?(t.style.zoom=1,Math.max(t[n]-2*e(t,"padding"),0)):(t=t.currentStyle[r.replace(/\-(\w)/g,function(e,t){return t.toUpperCase()})],""===(t="filter"===r?t.replace(/alpha\(opacity=([0-9]+)\)/,function(e,t){return t/100}):t)?1:pInt(t)))}),svg||(addEvent(SVGElement,"afterInit",function(){"text"===this.element.nodeName&&this.css({position:"absolute"})}),Pointer.prototype.normalize=function(e,t){return(e=e||win.event).target||(e.target=e.srcElement),t||(this.chartPosition=t=this.getChartPosition()),extend(e,{chartX:Math.round(Math.max(e.x,e.clientX-t.left)),chartY:Math.round(e.y)})},Chart.prototype.ieSanitizeSVG=function(e){return e=e.replace(/<IMG /g,"<image ").replace(/<(\/?)TITLE>/g,"<$1title>").replace(/height=([^" ]+)/g,'height="$1"').replace(/width=([^" ]+)/g,'width="$1"').replace(/hc-svg-href="([^"]+)">/g,'xlink:href="$1"/>').replace(/ id=([^" >]+)/g,' id="$1"').replace(/class=([^" >]+)/g,'class="$1"').replace(/ transform /g," ").replace(/:(path|rect)/g,"$1").replace(/style="([^"]+)"/g,function(e){return e.toLowerCase()})},Chart.prototype.isReadyToRender=function(){var e=this;return!(!svg&&win==win.top&&"complete"!==doc.readyState)||(doc.attachEvent("onreadystatechange",function(){doc.detachEvent("onreadystatechange",e.firstRender),"complete"===doc.readyState&&e.firstRender()}),!1)},doc.createElementNS||(doc.createElementNS=function(e,t){return doc.createElement(t)}),H.addEventListenerPolyfill=function(e,t){var r=this;function n(e){e.target=e.srcElement||win,t.call(r,e)}r.attachEvent&&(r.hcEventsIE||(r.hcEventsIE={}),t.hcKey||(t.hcKey=uniqueKey()),r.hcEventsIE[t.hcKey]=n,r.attachEvent("on"+e,n))},H.removeEventListenerPolyfill=function(e,t){this.detachEvent&&(t=this.hcEventsIE[t.hcKey],this.detachEvent("on"+e,t))},(VMLElement={docMode8:doc&&8===doc.documentMode,init:function(e,t){var r=["<",t,' filled="f" stroked="f"'],n=["position: ","absolute",";"],i="div"===t;"shape"!==t&&!i||n.push("left:0;top:0;width:1px;height:1px;"),n.push("visibility: ",i?"hidden":"visible"),r.push(' style="',n.join(""),'"/>'),t&&(r=i||"span"===t||"img"===t?r.join(""):e.prepVML(r),this.element=createElement(r)),this.renderer=e},add:function(e){var t=this,r=t.renderer,n=t.element,i=r.box,o=e&&e.inverted,i=e?e.element||e:i;return e&&(this.parentGroup=e),o&&r.invertChild(n,i),i.appendChild(n),t.added=!0,t.alignOnAdd&&!t.deferUpdateTransform&&t.updateTransform(),t.onAdd&&t.onAdd(),this.className&&this.attr("class",this.className),t},updateTransform:SVGElement.prototype.htmlUpdateTransform,setSpanRotation:function(){var e=this.rotation,t=Math.cos(e*deg2rad),r=Math.sin(e*deg2rad);css(this.element,{filter:e?["progid:DXImageTransform.Microsoft.Matrix(M11=",t,", M12=",-r,", M21=",r,", M22=",t,", sizingMethod='auto expand')"].join(""):"none"})},getSpanCorrection:function(e,t,r,n,i){var o,s=n?Math.cos(n*deg2rad):1,a=n?Math.sin(n*deg2rad):0,l=pick(this.elemHeight,this.element.offsetHeight),c=i&&"left"!==i;this.xCorr=s<0&&-e,this.yCorr=a<0&&-l,this.xCorr+=a*t*((o=s*a<0)?1-r:r),this.yCorr-=s*t*(n?o?r:1-r:1),c&&(this.xCorr-=e*r*(s<0?-1:1),n&&(this.yCorr-=l*r*(a<0?-1:1)),css(this.element,{textAlign:i}))},pathToVML:function(e){for(var t=e.length,r=[];t--;)isNumber(e[t])?r[t]=Math.round(10*e[t])-5:"Z"===e[t]?r[t]="x":(r[t]=e[t],!e.isArc||"wa"!==e[t]&&"at"!==e[t]||(r[t+5]===r[t+7]&&(r[t+7]+=e[t+7]>e[t+5]?1:-1),r[t+6]===r[t+8]&&(r[t+8]+=e[t+8]>e[t+6]?1:-1)));return r.join(" ")||"x"},clip:function(e){var t,r=this,e=e?(t=e.members,erase(t,r),t.push(r),r.destroyClip=function(){erase(t,r)},e.getCSS(r)):(r.destroyClip&&r.destroyClip(),{clip:r.docMode8?"inherit":"rect(auto)"});return r.css(e)},css:SVGElement.prototype.htmlCss,safeRemoveChild:function(e){e.parentNode&&discardElement(e)},destroy:function(){return this.destroyClip&&this.destroyClip(),SVGElement.prototype.destroy.apply(this)},on:function(e,t){return this.element["on"+e]=function(){var e=win.event;e.target=e.srcElement,t(e)},this},cutOffPath:function(e,t){var r;return 9!==(r=(e=e.split(/[ ,]/)).length)&&11!==r||(e[r-4]=e[r-2]=pInt(e[r-2])-10*t),e.join(" ")},shadow:function(e,t,r){var n,i,o,s,a,l,c=[],d=this.element,h=this.renderer,p=d.style,u=d.path,f=u=u&&"string"!=typeof u.value?"x":u;if(e){for(a=pick(e.width,3),l=(e.opacity||.15)/a,n=1;n<=3;n++)o=['<shape isShadow="true" strokeweight="',s=2*a+1-2*n,'" filled="false" path="',f=r?this.cutOffPath(u.value,.5+s):f,'" coordsize="10 10" style="',d.style.cssText,'" />'],i=createElement(h.prepVML(o),null,{left:pInt(p.left)+pick(e.offsetX,1)+"px",top:pInt(p.top)+pick(e.offsetY,1)+"px"}),r&&(i.cutOff=1+s),o=['<stroke color="',e.color||"#000000",'" opacity="',l*n,'"/>'],createElement(h.prepVML(o),null,null,i),t?t.element.appendChild(i):d.parentNode.insertBefore(i,d),c.push(i);this.shadows=c}return this},updateShadows:noop,setAttr:function(e,t){this.docMode8?this.element[e]=t:this.element.setAttribute(e,t)},getAttr:function(e){return this.docMode8?this.element[e]:this.element.getAttribute(e)},classSetter:function(e){(this.added?this.element:this).className=e},dashstyleSetter:function(e,t,r){(r.getElementsByTagName("stroke")[0]||createElement(this.renderer.prepVML(["<stroke/>"]),null,null,r))[t]=e||"solid",this[t]=e},dSetter:function(e,t,r){var n,i=this.shadows;if(this.d=(e=e||[]).join&&e.join(" "),r.path=e=this.pathToVML(e),i)for(n=i.length;n--;)i[n].path=i[n].cutOff?this.cutOffPath(e,i[n].cutOff):e;this.setAttr(t,e)},fillSetter:function(e,t,r){var n=r.nodeName;"SPAN"===n?r.style.color=e:"IMG"!==n&&(r.filled="none"!==e,this.setAttr("fillcolor",this.renderer.color(e,r,t,this)))},"fill-opacitySetter":function(e,t,r){createElement(this.renderer.prepVML(["<",t.split("-")[0],' opacity="',e,'"/>']),null,null,r)},opacitySetter:noop,rotationSetter:function(e,t,r){r=r.style;this[t]=r[t]=e,r.left=-Math.round(Math.sin(e*deg2rad)+1)+"px",r.top=Math.round(Math.cos(e*deg2rad))+"px"},strokeSetter:function(e,t,r){this.setAttr("strokecolor",this.renderer.color(e,r,t,this))},"stroke-widthSetter":function(e,t,r){r.stroked=!!e,this[t]=e,isNumber(e)&&(e+="px"),this.setAttr("strokeweight",e)},titleSetter:function(e,t){this.setAttr(t,e)},visibilitySetter:function(t,r,e){"inherit"===t&&(t="visible"),this.shadows&&this.shadows.forEach(function(e){e.style[r]=t}),"DIV"===e.nodeName&&(t="hidden"===t?"-999em":0,this.docMode8||(e.style[r]=t?"visible":"hidden"),r="top"),e.style[r]=t},xSetter:function(e,t,r){this[t]=e,"x"===t?t="left":"y"===t&&(t="top"),this.updateClipping?(this[t]=e,this.updateClipping()):r.style[t]=e},zIndexSetter:function(e,t,r){r.style[t]=e},fillGetter:function(){return this.getAttr("fillcolor")||""},strokeGetter:function(){return this.getAttr("strokecolor")||""},classGetter:function(){return this.getAttr("className")||""}})["stroke-opacitySetter"]=VMLElement["fill-opacitySetter"],H.VMLElement=VMLElement=extendClass(SVGElement,VMLElement),VMLElement.prototype.ySetter=VMLElement.prototype.widthSetter=VMLElement.prototype.heightSetter=VMLElement.prototype.xSetter,VMLRendererExtension={Element:VMLElement,isIE8:-1<win.navigator.userAgent.indexOf("MSIE 8.0"),init:function(e,t,r){var n,i,o=this;if(this.crispPolyLine=SVGRenderer.prototype.crispPolyLine,o.alignedObjects=[],i=(n=o.createElement("div").css({position:"relative"})).element,e.appendChild(n.element),o.isVML=!0,o.box=i,o.boxWrapper=n,o.gradients={},o.cache={},o.cacheKeys=[],o.imgCount=0,o.setSize(t,r,!1),!doc.namespaces.hcv){doc.namespaces.add("hcv","urn:schemas-microsoft-com:vml"),r="hcv\\:fill, hcv\\:path, hcv\\:shape, hcv\\:stroke{ behavior:url(#default#VML); display: inline-block; } ";try{doc.createStyleSheet().cssText=r}catch(e){doc.styleSheets[0].cssText+=r}}},isHidden:function(){return!this.box.offsetWidth},clipRect:function(e,t,r,n){var i=this.createElement(),o=isObject(e);return extend(i,{members:[],count:0,left:(o?e.x:e)+1,top:(o?e.y:t)+1,width:(o?e.width:r)-1,height:(o?e.height:n)-1,getCSS:function(e){var t=e.element,r=t.nodeName,n=e.inverted,i=this.top-("shape"===r?t.offsetTop:0),o=this.left,s=o+this.width,t=i+this.height,o={clip:"rect("+Math.round(n?o:i)+"px,"+Math.round(n?t:s)+"px,"+Math.round(n?s:t)+"px,"+Math.round(n?i:o)+"px)"};return!n&&e.docMode8&&"DIV"===r&&extend(o,{width:s+"px",height:t+"px"}),o},updateClipping:function(){i.members.forEach(function(e){e.element&&e.css(i.getCSS(e))})}})},color:function(e,t,r,n){var i,o,s,a,l,c,d,h,p,u,f,m,g,y,v,M,E,x,S,V,C,L,R,b,w,G,I=this,j=/^rgba/,A="none";return e&&e.linearGradient?s="gradient":e&&e.radialGradient&&(s="pattern"),s?(b=e.linearGradient||e.radialGradient,g="",y=e.stops,G=w=h=d=c=E=void 0,v=[],M=function(){o=['<fill colors="'+v.join(",")+'" opacity="',u,'" o:opacity2="',p,'" type="',s,'" ',g,'focus="100%" method="any" />'],createElement(I.prepVML(o),null,null,t)},w=y[0],G=y[y.length-1],0<w[0]&&y.unshift([0,w[1]]),G[0]<1&&y.push([1,G[1]]),y.forEach(function(e,t){l=j.test(e[1])?(i=color(e[1]),a=i.get("rgb"),i.get("a")):(a=e[1],1),v.push(100*e[0]+"% "+a),t?(u=l,f=a):(p=l,m=a)}),"fill"===r?"gradient"===s?(E=b.x1||b[0]||0,c=b.y1||b[1]||0,d=b.x2||b[2]||0,h=b.y2||b[3]||0,g='angle="'+(90-180*Math.atan((h-c)/(d-E))/Math.PI)+'"',M()):(E=b.r,S=x=2*E,V=b.cx,C=b.cy,L=t.radialReference,b=function(){L&&(R=n.getBBox(),V+=(L[0]-R.x)/R.width-.5,C+=(L[1]-R.y)/R.height-.5,x*=L[2]/R.width,S*=L[2]/R.height),g='src="'+getOptions().global.VMLRadialGradientURL+'" size="'+x+","+S+'" origin="0.5,0.5" position="'+V+","+C+'" color2="'+m+'" ',M()},n.added?b():n.onAdd=b,A=f):A=a):A=j.test(e)&&"IMG"!==t.tagName?(i=color(e),n[r+"-opacitySetter"](i.get("a"),r,t),i.get("rgb")):((r=t.getElementsByTagName(r)).length&&(r[0].opacity=1,r[0].type="solid"),e),A},prepVML:function(e){var t="display:inline-block;behavior:url(#default#VML);",r=this.isIE8;return e=e.join(""),e=r?-1===(e=e.replace("/>",' xmlns="urn:schemas-microsoft-com:vml" />')).indexOf('style="')?e.replace("/>",' style="'+t+'" />'):e.replace('style="','style="'+t):e.replace("<","<hcv:")},text:SVGRenderer.prototype.html,path:function(e){var t={coordsize:"10 10"};return isArray(e)?t.d=e:isObject(e)&&extend(t,e),this.createElement("shape").attr(t)},circle:function(e,t,r){var n=this.symbol("circle");return isObject(e)&&(r=e.r,t=e.y,e=e.x),n.isCircle=!0,n.r=r,n.attr({x:e,y:t})},g:function(e){var t;return e&&(t={className:"highcharts-"+e,class:"highcharts-"+e}),this.createElement("div").attr(t)},image:function(e,t,r,n,i){e=this.createElement("img").attr({src:e});return 1<arguments.length&&e.attr({x:t,y:r,width:n,height:i}),e},createElement:function(e){return"rect"===e?this.symbol(e):SVGRenderer.prototype.createElement.call(this,e)},invertChild:function(t,e){var r=this,n=e.style,e="IMG"===t.tagName&&t.style;css(t,{flip:"x",left:pInt(n.width)-(e?pInt(e.top):1)+"px",top:pInt(n.height)-(e?pInt(e.left):1)+"px",rotation:-90}),[].forEach.call(t.childNodes,function(e){r.invertChild(e,t)})},symbols:{arc:function(e,t,r,n,i){var o=i.start,s=i.end,a=i.r||r||n,l=i.innerR,c=Math.cos(o),d=Math.sin(o),r=Math.cos(s),n=Math.sin(s);return s-o==0?["x"]:(a=["wa",e-a,t-a,e+a,t+a,e+a*c,t+a*d,e+a*r,t+a*n],i.open&&!l&&a.push("e","M",e,t),a.push("at",e-l,t-l,e+l,t+l,e+l*r,t+l*n,e+l*c,t+l*d,"x","e"),a.isArc=!0,a)},circle:function(e,t,r,n,i){return i&&defined(i.r)&&(r=n=2*i.r),i&&i.isCircle&&(e-=r/2,t-=n/2),["wa",e,t,e+r,t+n,e+r,t+n/2,e+r,t+n/2,"e"]},rect:function(e,t,r,n,i){return SVGRenderer.prototype.symbols[defined(i)&&i.r?"callout":"square"].call(0,e,t,r,n,i)}}},H.VMLRenderer=VMLRenderer=function(){this.init.apply(this,arguments)},extend(VMLRenderer.prototype,SVGRenderer.prototype),extend(VMLRenderer.prototype,VMLRendererExtension),RendererRegistry.registerRendererType("VMLRenderer",VMLRenderer,!0),VMLRenderer3D.compose(VMLRenderer,SVGRenderer)),SVGRenderer.prototype.getSpanWidth=function(e,t){var r=e.getBBox(!0).width;return r=!svg&&this.forExport?this.measureSpanWidth(t.firstChild.data,e.styles):r},SVGRenderer.prototype.measureSpanWidth=function(e,t){var r=doc.createElement("span"),e=doc.createTextNode(e);return r.appendChild(e),css(r,t),this.box.appendChild(r),t=r.offsetWidth,discardElement(r),t};