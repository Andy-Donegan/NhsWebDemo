"use strict";import Instrument from"./Instrument.js";import U from"../../Core/Utilities.js";var error=U.error,merge=U.merge,pick=U.pick,uniqueKey=U.uniqueKey,Earcon=function(){function n(n){this.id=void 0,this.instrumentsPlaying=void 0,this.options=void 0,this.init(n||{})}return n.prototype.init=function(n){this.options=n,this.options.id||(this.options.id=this.id=uniqueKey()),this.instrumentsPlaying={}},n.prototype.sonify=function(n){var t=merge(this.options,n),o=pick(t.volume,1),r=t.pan,p=this,u=n&&n.onEnd,a=p.options.onEnd;t.instruments.forEach(function(n){var t,i="string"==typeof n.instrument?Instrument.definitions[n.instrument]:n.instrument,s=merge(n.playOptions),e="";i&&i.play?n.playOptions&&(s.pan=pick(r,s.pan),t=s.onEnd,s.onEnd=function(){delete p.instrumentsPlaying[e],t&&t.apply(this,arguments),Object.keys(p.instrumentsPlaying).length||(u&&u.apply(this,arguments),a&&a.apply(this,arguments))},(i=i.copy()).setMasterVolume(o),e=i.id,(p.instrumentsPlaying[e]=i).play(s)):error(30)})},n.prototype.cancelSonify=function(t){var i=this.instrumentsPlaying,n=i&&Object.keys(i);n&&n.length&&(n.forEach(function(n){i[n].stop(!t,null,"cancelled")}),this.instrumentsPlaying={})},n}();export default Earcon;