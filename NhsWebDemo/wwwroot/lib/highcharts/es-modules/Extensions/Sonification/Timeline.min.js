"use strict";import Sonification from"./Sonification.js";import U from"../../Core/Utilities.js";var merge=U.merge,splat=U.splat;import SU from"./SonificationUtilities.js";var Timeline=function(){function t(t){this.cursor=void 0,this.options=void 0,this.paths=void 0,this.pathsPlaying=void 0,this.signalHandler=void 0,this.init(t||{})}return t.prototype.init=function(t){this.options=t,this.cursor=0,this.paths=t.paths||[],this.pathsPlaying={},this.signalHandler=new SU.SignalHandler(["playOnEnd","masterOnEnd","onPathStart","onPathEnd"]),this.signalHandler.registerSignalCallbacks(merge(t,{masterOnEnd:t.onEnd}))},t.prototype.play=function(t){this.pause(),this.signalHandler.clearSignalCallbacks(["playOnEnd"]),this.signalHandler.registerSignalCallbacks({playOnEnd:t}),this.playPaths(1)},t.prototype.rewind=function(t){this.pause(),this.signalHandler.clearSignalCallbacks(["playOnEnd"]),this.signalHandler.registerSignalCallbacks({playOnEnd:t}),this.playPaths(-1)},t.prototype.playPaths=function(s){var r=this,e=r.signalHandler;if(!r.paths.length){var t={cancelled:!1};return e.emitSignal("playOnEnd",t),void e.emitSignal("masterOnEnd",t)}var o=splat(this.paths[this.cursor]),l=this.paths[this.cursor+s];o.forEach(function(t){t&&(t.timeline=r,setTimeout(function(){var a;a=t,e.emitSignal("onPathStart",a),(r.pathsPlaying[a.id]=a)[0<s?"play":"rewind"](function(t){var n=t&&t.cancelled,i={path:a,cancelled:n};delete r.pathsPlaying[a.id],e.emitSignal("onPathEnd",i);t=0;t++,o.length<=1&&(l&&!n?(r.cursor+=s,splat(l).forEach(function(t){t[0<s?"resetCursor":"resetCursorEnd"]()}),r.playPaths(s)):(e.emitSignal("playOnEnd",i),e.emitSignal("masterOnEnd",i)))})},Sonification.fadeOutDuration))})},t.prototype.pause=function(n){var i=this;Object.keys(i.pathsPlaying).forEach(function(t){i.pathsPlaying[t]&&i.pathsPlaying[t].pause(n)}),i.pathsPlaying={}},t.prototype.resetCursor=function(){this.paths.forEach(function(t){splat(t).forEach(function(t){t.resetCursor()})}),this.cursor=0},t.prototype.resetCursorEnd=function(){this.paths.forEach(function(t){splat(t).forEach(function(t){t.resetCursorEnd()})}),this.cursor=this.paths.length-1},t.prototype.setCursor=function(n){return this.paths.some(function(t){return splat(t).some(function(t){return t.setCursor(n)})})},t.prototype.getCursor=function(){return this.getCurrentPlayingPaths().reduce(function(t,n){return t[n.id]=n.getCursor(),t},{})},t.prototype.atStart=function(){return!this.cursor&&!splat(this.paths[0]).some(function(t){return t.cursor})},t.prototype.getCurrentPlayingPaths=function(){return this.paths.length?splat(this.paths[this.cursor]):[]},t}();export default Timeline;