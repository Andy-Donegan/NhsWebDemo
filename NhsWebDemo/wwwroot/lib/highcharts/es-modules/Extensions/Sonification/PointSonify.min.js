"use strict";import Instrument from"./Instrument.js";import U from"../../Core/Utilities.js";var error=U.error,merge=U.merge,pick=U.pick;import SU from"./SonificationUtilities.js";var PointSonify,composedClasses=[],defaultInstrumentOptions={minDuration:20,maxDuration:2e3,minVolume:.1,maxVolume:1,minPan:-1,maxPan:1,minFrequency:220,maxFrequency:2200};!function(){function t(n){function a(i,n,t){if("function"==typeof i)return n?function(n){return i(s,c,n)}:i(s,c);if("string"!=typeof i)return i;var e="-"===i.charAt(0),o=e?i.slice(1):i,n=pick(s[o],s.options[o]);return c[o]=c[o]||SU.calculateDataExtremes(s.series.chart,o),SU.virtualAxisTranslate(n,c[o],t,e)}var s=this,r=s.series.chart,m=pick(n.masterVolume,r.options.sonification&&r.options.sonification.masterVolume),c=n.dataExtremes||{};(r.sonification.currentlyPlayingPoint=s).sonification=s.sonification||{},s.sonification.instrumentsPlaying=s.sonification.instrumentsPlaying||{};var l=s.sonification.signalHandler=s.sonification.signalHandler||new SU.SignalHandler(["onEnd"]);l.clearSignalCallbacks(),l.registerSignalCallbacks({onEnd:n.onEnd}),!s.isNull&&s.visible&&s.series.visible?n.instruments.forEach(function(i){var n="string"==typeof i.instrument?Instrument.definitions[i.instrument]:i.instrument,t=i.instrumentMapping||{},e=merge(defaultInstrumentOptions,i.instrumentOptions),o=n.id;n&&n.play?(void 0!==m&&n.setMasterVolume(m),(s.sonification.instrumentsPlaying[n.id]=n).play({frequency:a(t.frequency,!0,{min:e.minFrequency,max:e.maxFrequency}),duration:a(t.duration,!1,{min:e.minDuration,max:e.maxDuration}),pan:a(t.pan,!0,{min:e.minPan,max:e.maxPan}),volume:a(t.volume,!0,{min:e.minVolume,max:e.maxVolume}),onEnd:function(n){i.onEnd&&i.onEnd.apply(this,arguments),r.sonification&&r.sonification.currentlyPlayingPoint&&delete r.sonification.currentlyPlayingPoint,s.sonification&&s.sonification.instrumentsPlaying&&(delete s.sonification.instrumentsPlaying[o],Object.keys(s.sonification.instrumentsPlaying).length||l.emitSignal("onEnd",n))},minFrequency:e.minFrequency,maxFrequency:e.maxFrequency})):error(30)}):l.emitSignal("onEnd")}function e(i){var t=this.sonification&&this.sonification.instrumentsPlaying,n=t&&Object.keys(t);n&&n.length&&(n.forEach(function(n){t[n].stop(!i,null,"cancelled")}),this.sonification.instrumentsPlaying={},this.sonification.signalHandler.emitSignal("onEnd","cancelled"))}(PointSonify||(PointSonify={})).compose=function(n){var i;return-1===composedClasses.indexOf(n)&&(composedClasses.push(n),(i=n.prototype).sonify=t,i.cancelSonify=e),n}}();export default PointSonify;