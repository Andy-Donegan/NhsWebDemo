"use strict";import Chart from"../../Core/Chart/Chart.js";import D from"../../Core/DefaultOptions.js";var getOptions=D.getOptions;import Point from"../../Core/Series/Point.js";import Series from"../../Core/Series/Series.js";import SeriesRegistry from"../../Core/Series/SeriesRegistry.js";var seriesTypes=SeriesRegistry.seriesTypes;import U from"../../Core/Utilities.js";var addEvent=U.addEvent,error=U.error,isArray=U.isArray,isNumber=U.isNumber,pick=U.pick,wrap=U.wrap;import"../../Core/DefaultOptions.js";import butils from"./BoostUtils.js";import boostable from"./Boostables.js";import boostableMap from"./BoostableMap.js";var boostEnabled=butils.boostEnabled,shouldForceChartSeriesBoosting=butils.shouldForceChartSeriesBoosting,plotOptions=getOptions().plotOptions;Chart.prototype.isChartSeriesBoosting=function(){return pick(this.options.boost&&this.options.boost.seriesThreshold,50)<=this.series.length||shouldForceChartSeriesBoosting(this)},Chart.prototype.getBoostClipRect=function(t){var s={x:this.plotLeft,y:this.plotTop,width:this.plotWidth,height:this.plotHeight};return t===this&&((t=this.inverted?this.xAxis:this.yAxis).length<=1?(s.y=Math.min(t[0].pos,s.y),s.height=t[0].pos-this.plotTop+t[0].len):s.height=this.plotHeight),s},Series.prototype.getPoint=function(t){var s=t,i=this.xData||this.options.xData||this.processedXData||!1;return!t||t instanceof this.pointClass||((s=(new this.pointClass).init(this,this.options.data[t.i],i?i[t.i]:void 0)).category=pick(this.xAxis.categories?this.xAxis.categories[s.x]:s.x,s.x),s.dist=t.dist,s.distX=t.distX,s.plotX=t.plotX,s.plotY=t.plotY,s.index=t.i,s.isInside=this.isPointInside(t)),s},wrap(Series.prototype,"searchPoint",function(t){return this.getPoint(t.apply(this,[].slice.call(arguments,1)))}),wrap(Point.prototype,"haloPath",function(t){var s=this,i=s.series,o=i.chart,e=s.plotX,r=s.plotY,o=o.inverted;return i.isSeriesBoosting&&o&&(s.plotX=i.yAxis.len-r,s.plotY=i.xAxis.len-e),t=t.apply(this,Array.prototype.slice.call(arguments,1)),i.isSeriesBoosting&&o&&(s.plotX=e,s.plotY=r),t}),wrap(Series.prototype,"markerAttribs",function(t,s){var i=this,o=i.chart,e=s.plotX,r=s.plotY,o=o.inverted;return i.isSeriesBoosting&&o&&(s.plotX=i.yAxis.len-r,s.plotY=i.xAxis.len-e),t=t.apply(this,Array.prototype.slice.call(arguments,1)),i.isSeriesBoosting&&o&&(s.plotX=e,s.plotY=r),t}),addEvent(Series,"destroy",function(){var s=this,t=s.chart;t.markerGroup===s.markerGroup&&(s.markerGroup=null),t.hoverPoints&&(t.hoverPoints=t.hoverPoints.filter(function(t){return t.series===s})),t.hoverPoint&&t.hoverPoint.series===s&&(t.hoverPoint=null)}),wrap(Series.prototype,"getExtremes",function(t){return this.isSeriesBoosting&&this.hasExtremes&&this.hasExtremes()?{}:t.apply(this,Array.prototype.slice.call(arguments,1))}),["translate","generatePoints","drawTracker","drawPoints","render"].forEach(function(i){function s(t){var s=this.options.stacking&&("translate"===i||"generatePoints"===i);this.isSeriesBoosting&&!s&&boostEnabled(this.chart)&&"heatmap"!==this.type&&"treemap"!==this.type&&boostableMap[this.type]&&0!==this.options.boostThreshold?this[i+"Canvas"]&&this[i+"Canvas"]():t.call(this)}wrap(Series.prototype,i,s),"translate"===i&&["column","bar","arearange","columnrange","heatmap","treemap"].forEach(function(t){seriesTypes[t]&&wrap(seriesTypes[t].prototype,i,s)})}),wrap(Series.prototype,"processData",function(t){var s=this,i=this.options.data;function o(t){return!s.forceCrop&&(s.chart.isChartSeriesBoosting()||(t?t.length:0)>=(s.options.boostThreshold||Number.MAX_VALUE))}boostEnabled(this.chart)&&boostableMap[this.type]?(o(i)&&"heatmap"!==this.type&&"treemap"!==this.type&&!this.options.stacking&&this.hasExtremes&&this.hasExtremes(!0)||(t.apply(this,Array.prototype.slice.call(arguments,1)),i=this.processedXData),this.isSeriesBoosting=o(i),this.isSeriesBoosting?(i=void 0,this.options.data&&this.options.data.length&&(i=this.getFirstValidPoint(this.options.data),isNumber(i)||isArray(i)||error(12,!1,this.chart)),this.enterBoost()):this.exitBoost&&this.exitBoost()):t.apply(this,Array.prototype.slice.call(arguments,1))}),addEvent(Series,"hide",function(){this.canvas&&this.renderTarget&&(this.ogl&&this.ogl.clear(),this.boostClear())}),Series.prototype.enterBoost=function(){this.alteredByBoost=[],["allowDG","directTouch","stickyTracking"].forEach(function(t){this.alteredByBoost.push({prop:t,val:this[t],own:Object.hasOwnProperty.call(this,t)})},this),this.allowDG=!1,this.directTouch=!1,this.stickyTracking=!0,this.finishedAnimating=!0,this.labelBySeries&&(this.labelBySeries=this.labelBySeries.destroy())},Series.prototype.exitBoost=function(){(this.alteredByBoost||[]).forEach(function(t){t.own?this[t.prop]=t.val:delete this[t.prop]},this),this.boostClear&&this.boostClear()},Series.prototype.hasExtremes=function(t){var s=this.options,i=s.data,o=this.xAxis&&this.xAxis.options,e=this.yAxis&&this.yAxis.options,r=this.colorAxis&&this.colorAxis.options;return i.length>(s.boostThreshold||Number.MAX_VALUE)&&isNumber(e.min)&&isNumber(e.max)&&(!t||isNumber(o.min)&&isNumber(o.max))&&(!r||isNumber(r.min)&&isNumber(r.max))},Series.prototype.destroyGraphics=function(){var t,s,i=this,o=this,e=this.points;if(e)for(s=0;s<e.length;s+=1)(t=e[s])&&t.destroyElements&&t.destroyElements();["graph","area","tracker"].forEach(function(t){o[t]&&(o[t]=o[t].destroy())}),this.getZonesGraphs&&this.getZonesGraphs([["graph","highcharts-graph"]]).forEach(function(t){var s=i[t[0]];s&&(i[t[0]]=s.destroy())})},boostable.forEach(function(t){plotOptions[t]&&(plotOptions[t].boostThreshold=5e3,plotOptions[t].boostData=[],seriesTypes[t].prototype.fillOpacity=!0)});