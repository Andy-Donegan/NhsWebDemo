"use strict";import H from"../../Core/Globals.js";var win=H.win,doc=H.doc;import boostableMap from"./BoostableMap.js";import createAndAttachRenderer from"./BoostAttach.js";import U from"../../Core/Utilities.js";var pick=U.pick,CHUNK_SIZE=3e3;function patientMax(){for(var t=[],o=0;o<arguments.length;o++)t[o]=arguments[o];var e=-Number.MAX_VALUE;return t.forEach(function(t){if(null!=t&&void 0!==t.length&&0<t.length)return e=t.length,!0}),e}function boostEnabled(t){return pick(t&&t.options&&t.options.boost&&t.options.boost.enabled,!0)}function shouldForceChartSeriesBoosting(t){var o,e=0,r=0,s=pick(t.options.boost&&t.options.boost.allowForce,!0);if(void 0!==t.boostForceChartBoost)return t.boostForceChartBoost;if(1<t.series.length)for(var n=0;n<t.series.length;n++)0!==(o=t.series[n]).options.boostThreshold&&!1!==o.visible&&"heatmap"!==o.type&&(boostableMap[o.type]&&++r,patientMax(o.processedXData,o.options.data,o.points)>=(o.options.boostThreshold||Number.MAX_VALUE)&&++e);return t.boostForceChartBoost=s&&(r===t.series.length&&0<e||5<e),t.boostForceChartBoost}function renderIfNotSeriesBoosting(t,o,e){t&&o.renderTarget&&o.canvas&&!(e||o.chart).isChartSeriesBoosting()&&t.render(e||o.chart)}function allocateIfNotSeriesBoosting(t,o){t&&o.renderTarget&&o.canvas&&!o.chart.isChartSeriesBoosting()&&t.allocateBufferForSingleSeries(o)}function eachAsync(t,o,e,r,s,n){for(var i=(s=s||0)+(r=r||CHUNK_SIZE),a=!0;a&&s<i&&s<t.length;)a=o(t[s],s),++s;a&&(s<t.length?n?eachAsync(t,o,e,r,s,n):win.requestAnimationFrame?win.requestAnimationFrame(function(){eachAsync(t,o,e,r,s)}):setTimeout(function(){eachAsync(t,o,e,r,s)}):e&&e())}function hasWebGLSupport(){var t,o=0,e=["webgl","experimental-webgl","moz-webgl","webkit-3d"];if(void 0!==win.WebGLRenderingContext)for(t=doc.createElement("canvas");o<e.length;o++)try{if(null!=t.getContext(e[o]))return!0}catch(t){}return!1}function pointDrawHandler(t){var o=!0;if(!(o=this.chart.options&&this.chart.options.boost?void 0===this.chart.options.boost.enabled||this.chart.options.boost.enabled:o)||!this.isSeriesBoosting)return t.call(this);this.chart.isBoosting=!0,(t=createAndAttachRenderer(this.chart,this))&&(allocateIfNotSeriesBoosting(t,this),t.pushSeries(this)),renderIfNotSeriesBoosting(t,this)}var funs={patientMax:patientMax,boostEnabled:boostEnabled,shouldForceChartSeriesBoosting:shouldForceChartSeriesBoosting,renderIfNotSeriesBoosting:renderIfNotSeriesBoosting,allocateIfNotSeriesBoosting:allocateIfNotSeriesBoosting,eachAsync:eachAsync,hasWebGLSupport:hasWebGLSupport,pointDrawHandler:pointDrawHandler};H.hasWebGLSupport=hasWebGLSupport;export default funs;