"use strict";import A from"../Core/Animation/AnimationUtilities.js";var animObject=A.animObject;import Chart from"../Core/Chart/Chart.js";import D from"../Core/DefaultOptions.js";var defaultOptions=D.defaultOptions;import Point from"../Core/Series/Point.js";import Series from"../Core/Series/Series.js";import SeriesRegistry from"../Core/Series/SeriesRegistry.js";var seriesTypes=SeriesRegistry.seriesTypes;import SVGRenderer from"../Core/Renderer/SVG/SVGRenderer.js";var symbols=SVGRenderer.prototype.symbols;import U from"../Core/Utilities.js";var addEvent=U.addEvent,defined=U.defined,error=U.error,isArray=U.isArray,isFunction=U.isFunction,isObject=U.isObject,isNumber=U.isNumber,merge=U.merge,objectEach=U.objectEach,relativeLength=U.relativeLength,syncTimeout=U.syncTimeout;import Axis from"../Core/Axis/Axis.js";var Scatter=seriesTypes.scatter,baseGeneratePoints=Series.prototype.generatePoints,oldPointsStateId=[],stateIdCounter=0,clusterDefaultOptions={enabled:!1,allowOverlap:!0,animation:{duration:500},drillToCluster:!0,minimumClusterSize:2,layoutAlgorithm:{gridSize:50,distance:40,kmeansThreshold:100},marker:{symbol:"cluster",radius:15,lineWidth:0,lineColor:"#ffffff"},dataLabels:{enabled:!0,format:"{point.clusterPointsAmount}",verticalAlign:"middle",align:"center",style:{color:"contrast"},inside:!0}};(defaultOptions.plotOptions||{}).series=merge((defaultOptions.plotOptions||{}).series,{cluster:clusterDefaultOptions,tooltip:{clusterFormat:"<span>Clustered points: {point.clusterPointsAmount}</span><br/>"}});var pixelsToValues=function(t,e){var a=t.chart,i=t.xAxis,t=t.yAxis;return a.mapView?a.mapView.pixelsToProjectedUnits(e):{x:i?i.toValue(e.x):0,y:t?t.toValue(e.y):0}},valuesToPixels=function(t,e){var a=t.chart,i=t.xAxis,t=t.yAxis;return a.mapView?a.mapView.projectedUnitsToPixels(e):{x:i?i.toPixels(e.x):0,y:t?t.toPixels(e.y):0}};function getClusterPosition(t){for(var e=t.length,a=0,i=0,r=0;r<e;r++)a+=t[r].x,i+=t[r].y;return{x:a/e,y:i/e}}function getDataState(t,e){var a=[];return a.length=e,t.clusters.forEach(function(t){t.data.forEach(function(t){a[t.dataIndex]=t})}),t.noise.forEach(function(t){a[t.data[0].dataIndex]=t.data[0]}),a}function fadeInElement(t,e,a){t.attr({opacity:e}).animate({opacity:1},a)}function fadeInStatePoint(t,e,a,i,r){t.point&&(i&&t.point.graphic&&(t.point.graphic.show(),fadeInElement(t.point.graphic,e,a)),r&&t.point.dataLabel&&(t.point.dataLabel.show(),fadeInElement(t.point.dataLabel,e,a)))}function hideStatePoint(t,e,a){t.point&&(e&&t.point.graphic&&t.point.graphic.hide(),a&&t.point.dataLabel&&t.point.dataLabel.hide())}function destroyOldPoints(t){t&&objectEach(t,function(t){t.point&&t.point.destroy&&t.point.destroy()})}function fadeInNewPointAndDestoryOld(t,e,a,i){fadeInStatePoint(t,i,a,!0,!0),e.forEach(function(t){t.point&&t.point.destroy&&t.point.destroy()})}function getStateId(){return Math.random().toString(36).substring(2,7)+"-"+stateIdCounter++}symbols.cluster=function(t,e,a,i){var r=a/2,o=i/2,a=symbols.arc(t+r,e+o,r-4,o-4,{start:.5*Math.PI,end:2.5*Math.PI,open:!1}),i=symbols.arc(t+r,e+o,r-3,o-3,{start:.5*Math.PI,end:2.5*Math.PI,innerR:r-2,open:!1});return symbols.arc(t+r,e+o,r-1,o-1,{start:.5*Math.PI,end:2.5*Math.PI,innerR:r,open:!1}).concat(i,a)},Scatter.prototype.animateClusterPoint=function(t){var e,a,i=this.chart,r=i.mapView,o=this.options.cluster,n=animObject((o||{}).animation),s=n.duration||500,l=(this.markerClusterInfo||{}).pointsState,p=(l||{}).newState,u=(l||{}).oldState,d=[],c=0,h=0,m=!1,f=!1;u&&p&&(a=p[t.stateId],l=valuesToPixels(this,a),c=l.x-(r?0:i.plotLeft),h=l.y-(r?0:i.plotTop),1===a.parentsId.length?(t=(p||{})[t.stateId].parentsId[0],e=u[t],a.point&&a.point.graphic&&e&&e.point&&e.point.plotX&&e.point.plotY&&e.point.plotX!==a.point.plotX&&e.point.plotY!==a.point.plotY&&(t=a.point.graphic.getBBox(),o=a.point.graphic&&a.point.graphic.isImg?0:t.width/2,a.point.graphic.attr({x:e.point.plotX-o,y:e.point.plotY-o}),a.point.graphic.animate({x:c-(a.point.graphic.radius||0),y:h-(a.point.graphic.radius||0)},n,function(){f=!0,e.point&&e.point.destroy&&e.point.destroy()}),a.point.dataLabel&&a.point.dataLabel.alignAttr&&e.point.dataLabel&&e.point.dataLabel.alignAttr&&(a.point.dataLabel.attr({x:e.point.dataLabel.alignAttr.x,y:e.point.dataLabel.alignAttr.y}),a.point.dataLabel.animate({x:a.point.dataLabel.alignAttr.x,y:a.point.dataLabel.alignAttr.y},n)))):0===a.parentsId.length?(hideStatePoint(a,!0,!0),syncTimeout(function(){fadeInStatePoint(a,.1,n,!0,!0)},s/2)):(hideStatePoint(a,!0,!0),a.parentsId.forEach(function(t){u&&u[t]&&(e=u[t],d.push(e),e.point&&e.point.graphic&&(m=!0,e.point.graphic.show(),e.point.graphic.animate({x:c-(e.point.graphic.radius||0),y:h-(e.point.graphic.radius||0),opacity:.4},n,function(){f=!0,fadeInNewPointAndDestoryOld(a,d,n,.7)}),e.point.dataLabel&&-9999!==e.point.dataLabel.y&&a.point&&a.point.dataLabel&&a.point.dataLabel.alignAttr&&(e.point.dataLabel.show(),e.point.dataLabel.animate({x:a.point.dataLabel.alignAttr.x,y:a.point.dataLabel.alignAttr.y,opacity:.4},n))))}),syncTimeout(function(){f||fadeInNewPointAndDestoryOld(a,d,n,.85)},s),m||syncTimeout(function(){fadeInNewPointAndDestoryOld(a,d,n,.1)},s/2)))},Scatter.prototype.getGridOffset=function(){var t=this,e=t.chart,a=t.xAxis,i=t.yAxis;return{plotLeft:a&&t.dataMinX&&t.dataMaxX?a.reversed?a.toPixels(t.dataMaxX):a.toPixels(t.dataMinX):e.plotLeft,plotTop:i&&t.dataMinY&&t.dataMaxY?i.reversed?i.toPixels(t.dataMinY):i.toPixels(t.dataMaxY):e.plotTop}},Scatter.prototype.getScaledGridSize=function(t){var e=this,a=e.xAxis,i=this.chart.mapView,t=t.processedGridSize||clusterDefaultOptions.layoutAlgorithm.gridSize,r=!0,o=1,n=1;e.gridValueSize||(e.gridValueSize=i?t/i.getScale():Math.abs(a.toValue(t)-a.toValue(0)));for(var s=+(t/(i?e.gridValueSize*i.getScale():a.toPixels(e.gridValueSize)-a.toPixels(0))).toFixed(14);r&&1!=s;){var l=Math.pow(2,o);.75<s&&s<1.25?r=!1:1/l<=s&&s<1/l*2?(r=!1,n=l):s<=l&&l/2<s&&(r=!1,n=1/l),o++}return t/n/s},Scatter.prototype.getRealExtremes=function(){var t=this.chart,e=t.mapView?0:t.plotLeft,a=t.mapView?0:t.plotTop,i=pixelsToValues(this,{x:e,y:a}),a=pixelsToValues(this,{x:e+t.plotWidth,y:e+t.plotHeight}),e=i.x,t=a.x,i=i.y,a=a.y;return{minX:Math.min(e,t),maxX:Math.max(e,t),minY:Math.min(i,a),maxY:Math.max(i,a)}},Scatter.prototype.onDrillToCluster=function(t){(t.point||t.target).firePointEvent("drillToCluster",t,function(t){var e,a,i,r,o,n=t.point||t.target,s=n.series,l=n.series.xAxis,p=n.series.yAxis,u=n.series.chart,d=u.mapView;(s.options.cluster||{}).drillToCluster&&n.clusteredData&&(o=n.clusteredData.map(function(t){return t.x}).sort(function(t,e){return t-e}),i=n.clusteredData.map(function(t){return t.y}).sort(function(t,e){return t-e}),e=o[0],r=o[o.length-1],a=i[0],s=i[i.length-1],n=Math.abs(.1*(r-e)),o=Math.abs(.1*(s-a)),i=Math.min(e,r)-n,r=Math.max(e,r)+n,n=Math.min(a,s)-o,o=Math.max(a,s)+o,d?d.fitToBounds({x1:i,x2:r,y1:n,y2:o}):l&&p&&(u.pointer.zoomX=!0,u.pointer.zoomY=!0,u.zoom({originalEvent:t,xAxis:[{axis:l,min:i,max:r}],yAxis:[{axis:p,min:n,max:o}]})))})},Scatter.prototype.getClusterDistancesFromPoint=function(t,e,a){for(var i=[],r=0;r<t.length;r++){var o=valuesToPixels(this,{x:e,y:a}),n=valuesToPixels(this,{x:t[r].posX,y:t[r].posY}),n=Math.sqrt(Math.pow(o.x-n.x,2)+Math.pow(o.y-n.y,2));i.push({clusterIndex:r,distance:n})}return i.sort(function(t,e){return t.distance-e.distance})},Scatter.prototype.getPointsState=function(t,e,a){var i,r,o,n=e?getDataState(e,a):[],s=getDataState(t,a),l={};for(oldPointsStateId=[],t.clusters.forEach(function(t){l[t.stateId]={x:t.x,y:t.y,id:t.stateId,point:t.point,parentsId:[]}}),t.noise.forEach(function(t){l[t.stateId]={x:t.x,y:t.y,id:t.stateId,point:t.point,parentsId:[]}}),o=0;o<s.length;o++)i=s[o],r=n[o],i&&r&&i.parentStateId&&r.parentStateId&&l[i.parentStateId]&&-1===l[i.parentStateId].parentsId.indexOf(r.parentStateId)&&(l[i.parentStateId].parentsId.push(r.parentStateId),-1===oldPointsStateId.indexOf(r.parentStateId)&&oldPointsStateId.push(r.parentStateId));return l},Scatter.prototype.markerClusterAlgorithms={grid:function(t,e,a,i){for(var r={},o=this.getGridOffset(),n=this.getScaledGridSize(i),s=0;s<t.length;s++){var l=valuesToPixels(this,{x:t[s],y:e[s]}),p=l.x-o.plotLeft,l=l.y-o.plotTop,p=Math.floor(p/n);r[p=Math.floor(l/n)+"-"+p]||(r[p]=[]),r[p].push({dataIndex:a[s],x:t[s],y:e[s]})}return r},kmeans:function(t,e,a,i){var r,o,n,s,l,p,u,d=this,c=[],h=[],m={},f=i.processedDistance||clusterDefaultOptions.layoutAlgorithm.distance,x=i.iterations,g=0,y=!0,S=[];for(l in i.processedGridSize=i.processedDistance,s=d.markerClusterAlgorithms?d.markerClusterAlgorithms.grid.call(d,t,e,a,i):{})1<s[l].length&&(n=getClusterPosition(s[l]),c.push({posX:n.x,posY:n.y,oldX:0,oldY:0,startPointsLen:s[l].length,points:[]}));for(;y;){for(c.map(function(t){return t.points.length=0,t}),p=h.length=0;p<t.length;p++)r=t[p],o=e[p],((S=d.getClusterDistancesFromPoint(c,r,o)).length&&S[0].distance<f?c[S[0].clusterIndex].points:h).push({x:r,y:o,dataIndex:a[p]});for(u=0;u<c.length;u++)1===c[u].points.length&&(S=d.getClusterDistancesFromPoint(c,c[u].points[0].x,c[u].points[0].y))[1].distance<f&&(c[S[1].clusterIndex].points.push(c[u].points[0]),c[S[0].clusterIndex].points.length=0);for(y=!1,u=0;u<c.length;u++)n=getClusterPosition(c[u].points),c[u].oldX=c[u].posX,c[u].oldY=c[u].posY,c[u].posX=n.x,c[u].posY=n.y,(c[u].posX>c[u].oldX+1||c[u].posX<c[u].oldX-1||c[u].posY>c[u].oldY+1||c[u].posY<c[u].oldY-1)&&(y=!0);x&&(y=g<x-1),g++}return c.forEach(function(t,e){m["cluster"+e]=t.points}),h.forEach(function(t,e){m["noise"+e]=[t]}),m},optimizedKmeans:function(t,e,a,i){var r,o,n=this,s=(n.xAxis,n.yAxis,i.processedDistance||clusterDefaultOptions.layoutAlgorithm.gridSize),l={},p=n.getRealExtremes(),u=(n.options.cluster||{}).marker;return!n.markerClusterInfo||n.initMaxX&&n.initMaxX<p.maxX||n.initMinX&&n.initMinX>p.minX||n.initMaxY&&n.initMaxY<p.maxY||n.initMinY&&n.initMinY>p.minY?(n.initMaxX=p.maxX,n.initMinX=p.minX,n.initMaxY=p.maxY,n.initMinY=p.minY,l=n.markerClusterAlgorithms?n.markerClusterAlgorithms.kmeans.call(n,t,e,a,i):{},n.baseClusters=null):(n.baseClusters||(n.baseClusters={clusters:n.markerClusterInfo.clusters,noise:n.markerClusterInfo.noise}),n.baseClusters.clusters.forEach(function(i){i.pointsOutside=[],i.pointsInside=[],i.data.forEach(function(t){var e=valuesToPixels(n,t),a=valuesToPixels(n,i);r=Math.sqrt(Math.pow(e.x-a.x,2)+Math.pow(e.y-a.y,2)),(o=(i.clusterZone&&i.clusterZone.marker&&i.clusterZone.marker.radius?i.clusterZone.marker:u&&u.radius?u:clusterDefaultOptions.marker).radius)+(0<=s-o?s-o:o)<r&&defined(i.pointsOutside)?i.pointsOutside.push(t):defined(i.pointsInside)&&i.pointsInside.push(t)}),i.pointsInside.length&&(l[i.id]=i.pointsInside),i.pointsOutside.forEach(function(t,e){l[i.id+"_noise"+e]=[t]})}),n.baseClusters.noise.forEach(function(t){l[t.id]=t.data})),l}},Scatter.prototype.preventClusterCollisions=function(t){var a,i,r,e,o,n,s,l,p,u,d,c=this,h=t.key.split("-").map(parseFloat),m=h[0],f=h[1],x=t.gridSize,g=t.groupedData,y=t.defaultRadius,S=t.clusterRadius,C=f*x,I=m*x,h=valuesToPixels(c,t),b=h.x,D=h.y,v=[],k=0,P=(c.options.cluster||{}).marker,A=(c.options.cluster||{}).zones,M=c.getGridOffset();for(b-=M.plotLeft,D-=M.plotTop,n=1;n<5;n++)for(e=n%2?-1:1,o=n<3?-1:1,e=Math.floor((b+e*S)/x),d=[(o=Math.floor((D+o*S)/x))+"-"+e,o+"-"+f,m+"-"+e],s=0;s<d.length;s++)-1===v.indexOf(d[s])&&d[s]!==t.key&&v.push(d[s]);v.forEach(function(t){if(g[t]){g[t].posX||(u=getClusterPosition(g[t]),g[t].posX=u.x,g[t].posY=u.y);var e=valuesToPixels(c,{x:g[t].posX||0,y:g[t].posY||0});if(i=e.x-M.plotLeft,r=e.y-M.plotTop,e=t.split("-").map(parseFloat),p=e[0],l=e[1],A)for(a=g[t].length,n=0;n<A.length;n++)a>=A[n].from&&a<=A[n].to&&(k=defined((A[n].marker||{}).radius)?A[n].marker.radius||0:(P&&P.radius?P:clusterDefaultOptions.marker).radius);1<g[t].length&&0===k&&P&&P.radius?k=P.radius:1===g[t].length&&(k=y),u=S+k,k=0,l!==f&&Math.abs(b-i)<u&&(b=l-f<0?C+S:C+x-S),p!==m&&Math.abs(D-r)<u&&(D=p-m<0?I+S:I+x-S)}});h=pixelsToValues(c,{x:b+M.plotLeft,y:D+M.plotTop});return g[t.key].posX=h.x,g[t.key].posY=h.y,h},Scatter.prototype.isValidGroupedDataObject=function(t){var e,a=!1;return!!isObject(t)&&(objectEach(t,function(t){if(a=!0,isArray(t)&&t.length){for(e=0;e<t.length;e++)if(!isObject(t[e])||!t[e].x||!t[e].y)return void(a=!1)}else a=!1}),a)},Scatter.prototype.getClusteredData=function(t,e){var a,i,r,o,n,s,l,p,u,d,c,h,m,f=this,x=[],g=[],y=[],S=[],C=[],I=0,b=Math.max(2,e.minimumClusterSize||2);if(isFunction(e.layoutAlgorithm.type)&&!f.isValidGroupedDataObject(t))return error("Highcharts marker-clusters module: The custom algorithm result is not valid!",!1,f.chart),!1;for(m in t)if(t[m].length>=b){if(r=t[m],a=getStateId(),n=r.length,e.zones)for(h=0;h<e.zones.length;h++)n>=e.zones[h].from&&n<=e.zones[h].to&&((d=e.zones[h]).zoneIndex=h,u=e.zones[h].marker,c=e.zones[h].className);for(p=getClusterPosition(r),s="grid"!==e.layoutAlgorithm.type||e.allowOverlap?{x:p.x,y:p.y}:(s=f.options.marker||{},f.preventClusterCollisions({x:p.x,y:p.y,key:m,groupedData:t,gridSize:f.getScaledGridSize(e.layoutAlgorithm),defaultRadius:s.radius||3+(s.lineWidth||0),clusterRadius:u&&u.radius?u.radius:(e.marker||{}).radius||clusterDefaultOptions.marker.radius})),h=0;h<n;h++)r[h].parentStateId=a;if(y.push({x:s.x,y:s.y,id:m,stateId:a,index:I,data:r,clusterZone:d,clusterZoneClassName:c}),x.push(s.x),g.push(s.y),C.push({options:{formatPrefix:"cluster",dataLabels:e.dataLabels,marker:merge(e.marker,{states:e.states},u||{})}}),f.options.data&&f.options.data.length)for(h=0;h<n;h++)isObject(f.options.data[r[h].dataIndex])&&(r[h].options=f.options.data[r[h].dataIndex]);I++,u=null}else for(h=0;h<t[m].length;h++)i=t[m][h],a=getStateId(),l=null,o=((f.options||{}).data||[])[i.dataIndex],x.push(i.x),g.push(i.y),i.parentStateId=a,S.push({x:i.x,y:i.y,id:m,stateId:a,index:I,data:t[m]}),l=o&&"object"==typeof o&&!isArray(o)?merge(o,{x:i.x,y:i.y}):{userOptions:o,x:i.x,y:i.y},C.push({options:l}),I++;return{clusters:y,noise:S,groupedXData:x,groupedYData:g,groupMap:C}},Scatter.prototype.destroyClusteredData=function(){(this.markerClusterSeriesData||[]).forEach(function(t){t&&t.destroy&&t.destroy()}),this.markerClusterSeriesData=null},Scatter.prototype.hideClusteredData=function(){var t=this.markerClusterSeriesData,e=((this.markerClusterInfo||{}).pointsState||{}).oldState||{},a=oldPointsStateId.map(function(t){return(e[t].point||{}).id||""});(t||[]).forEach(function(t){t&&-1!==a.indexOf(t.id)?(t.graphic&&t.graphic.hide(),t.dataLabel&&t.dataLabel.hide()):t&&t.destroy&&t.destroy()})},Scatter.prototype.generatePoints=function(){var t,e,a,i,r,o,n,s=this,l=s.chart,p=(l.mapView,s.xAxis,s.yAxis,s.options.cluster),u=s.getRealExtremes(),d=[],c=[],h=[];if(p&&p.enabled&&s.xData&&s.xData.length&&s.yData&&s.yData.length&&!l.polar){r=p.layoutAlgorithm.type,(o=p.layoutAlgorithm).processedGridSize=relativeLength(o.gridSize||clusterDefaultOptions.layoutAlgorithm.gridSize,l.plotWidth),o.processedDistance=relativeLength(o.distance||clusterDefaultOptions.layoutAlgorithm.distance,l.plotWidth);for(var m=o.kmeansThreshold||clusterDefaultOptions.layoutAlgorithm.kmeansThreshold,f=o.processedGridSize/2,l=pixelsToValues(s,{x:0,y:0}),f=pixelsToValues(s,{x:f,y:f}),x=Math.abs(l.x-f.x),g=Math.abs(l.y-f.y),y=0;y<s.xData.length;y++)s.dataMaxX||(defined(e)&&defined(t)&&defined(i)&&defined(a)?isNumber(s.yData[y])&&isNumber(i)&&isNumber(a)&&(e=Math.max(s.xData[y],e),t=Math.min(s.xData[y],t),i=Math.max(s.yData[y]||i,i),a=Math.min(s.yData[y]||a,a)):(e=t=s.xData[y],i=a=s.yData[y])),s.xData[y]>=u.minX-x&&s.xData[y]<=u.maxX+x&&(s.yData[y]||u.minY)>=u.minY-g&&(s.yData[y]||u.maxY)<=u.maxY+g&&(d.push(s.xData[y]),c.push(s.yData[y]),h.push(y));defined(e)&&defined(t)&&isNumber(i)&&isNumber(a)&&(s.dataMaxX=e,s.dataMinX=t,s.dataMaxY=i,s.dataMinY=a),r=(f=(isFunction(r)?r:s.markerClusterAlgorithms?r&&s.markerClusterAlgorithms[r]?s.markerClusterAlgorithms[r]:d.length<m?s.markerClusterAlgorithms.kmeans:s.markerClusterAlgorithms.grid:function(){return!1}).call(this,d,c,h,o))&&s.getClusteredData(f,p),m=p.animation&&s.markerClusterInfo&&s.markerClusterInfo.pointsState&&s.markerClusterInfo.pointsState.oldState?(destroyOldPoints(s.markerClusterInfo.pointsState.oldState),s.markerClusterInfo.pointsState.newState):{},o=s.xData.length,f=s.markerClusterInfo,r&&(s.processedXData=r.groupedXData,s.processedYData=r.groupedYData,s.hasGroupedData=!0,s.markerClusterInfo=r,s.groupMap=r.groupMap),baseGeneratePoints.apply(this),r&&s.markerClusterInfo&&((s.markerClusterInfo.clusters||[]).forEach(function(t){(n=s.points[t.index]).isCluster=!0,n.clusteredData=t.data,n.clusterPointsAmount=t.data.length,t.point=n,addEvent(n,"click",s.onDrillToCluster)}),(s.markerClusterInfo.noise||[]).forEach(function(t){t.point=s.points[t.index]}),p.animation&&s.markerClusterInfo&&(s.markerClusterInfo.pointsState={oldState:m,newState:s.getPointsState(r,f,o)}),p.animation?this.hideClusteredData():this.destroyClusteredData(),this.markerClusterSeriesData=this.hasGroupedData?this.points:null)}else baseGeneratePoints.apply(this)},addEvent(Chart,"render",function(){(this.series||[]).forEach(function(e){var t,a;e.markerClusterInfo&&(t=e.options.cluster,a=((e.markerClusterInfo||{}).pointsState||{}).oldState,(t||{}).animation&&e.markerClusterInfo&&0===e.chart.pointer.pinchDown.length&&"pan"!==((e.xAxis||{}).eventArgs||{}).trigger&&a&&Object.keys(a).length&&(e.markerClusterInfo.clusters.forEach(function(t){e.animateClusterPoint(t)}),e.markerClusterInfo.noise.forEach(function(t){e.animateClusterPoint(t)})))})}),addEvent(Point,"update",function(){if(this.dataGroup)return error("Highcharts marker-clusters module: Running `Point.update` when point belongs to clustered series is not supported.",!1,this.series.chart),!1}),addEvent(Series,"destroy",Scatter.prototype.destroyClusteredData),addEvent(Series,"afterRender",function(){var e=(this.options.cluster||{}).drillToCluster;this.markerClusterInfo&&this.markerClusterInfo.clusters&&this.markerClusterInfo.clusters.forEach(function(t){t.point&&t.point.graphic&&(t.point.graphic.addClass("highcharts-cluster-point"),e&&t.point&&(t.point.graphic.css({cursor:"pointer"}),t.point.dataLabel&&t.point.dataLabel.css({cursor:"pointer"})),defined(t.clusterZone)&&t.point.graphic.addClass(t.clusterZoneClassName||"highcharts-cluster-zone-"+t.clusterZone.zoneIndex))})}),addEvent(Point,"drillToCluster",function(t){var e=(((t.point||t.target).series.options.cluster||{}).events||{}).drillToCluster;isFunction(e)&&e.call(this,t)}),addEvent(Axis,"setExtremes",function(){var e,t=this.chart,a=0;t.series.forEach(function(t){t.markerClusterInfo&&(e=animObject((t.options.cluster||{}).animation),a=e.duration||0)}),syncTimeout(function(){t.tooltip&&t.tooltip.destroy()},a)});