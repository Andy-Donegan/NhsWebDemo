import Chart from"../Core/Chart/Chart.js";import H from"../Core/Globals.js";import NavigationBindings from"../Extensions/Annotations/NavigationBindings.js";import D from"../Core/DefaultOptions.js";var setOptions=D.setOptions;import U from"../Core/Utilities.js";var addEvent=U.addEvent,createElement=U.createElement,css=U.css,extend=U.extend,fireEvent=U.fireEvent,getStyle=U.getStyle,isArray=U.isArray,merge=U.merge,pick=U.pick,DIV="div",SPAN="span",UL="ul",LI="li",PREFIX="highcharts-",activeClass=PREFIX+"active";setOptions({lang:{stockTools:{gui:{simpleShapes:"Simple shapes",lines:"Lines",crookedLines:"Crooked lines",measure:"Measure",advanced:"Advanced",toggleAnnotations:"Toggle annotations",verticalLabels:"Vertical labels",flags:"Flags",zoomChange:"Zoom change",typeChange:"Type change",saveChart:"Save chart",indicators:"Indicators",currentPriceIndicator:"Current Price Indicators",zoomX:"Zoom X",zoomY:"Zoom Y",zoomXY:"Zooom XY",fullScreen:"Fullscreen",typeOHLC:"OHLC",typeLine:"Line",typeCandlestick:"Candlestick",typeHLC:"HLC",typeHollowCandlestick:"Hollow Candlestick",typeHeikinAshi:"Heikin Ashi",circle:"Circle",ellipse:"Ellipse",label:"Label",rectangle:"Rectangle",flagCirclepin:"Flag circle",flagDiamondpin:"Flag diamond",flagSquarepin:"Flag square",flagSimplepin:"Flag simple",measureXY:"Measure XY",measureX:"Measure X",measureY:"Measure Y",segment:"Segment",arrowSegment:"Arrow segment",ray:"Ray",arrowRay:"Arrow ray",line:"Line",arrowInfinityLine:"Arrow line",horizontalLine:"Horizontal line",verticalLine:"Vertical line",infinityLine:"Infinity line",crooked3:"Crooked 3 line",crooked5:"Crooked 5 line",elliott3:"Elliott 3 line",elliott5:"Elliott 5 line",verticalCounter:"Vertical counter",verticalLabel:"Vertical label",verticalArrow:"Vertical arrow",fibonacci:"Fibonacci",fibonacciTimeZones:"Fibonacci Time Zones",pitchfork:"Pitchfork",parallelChannel:"Parallel channel",timeCycles:"Time Cycles"}},navigation:{popup:{circle:"Circle",ellipse:"Ellipse",rectangle:"Rectangle",label:"Label",segment:"Segment",arrowSegment:"Arrow segment",ray:"Ray",arrowRay:"Arrow ray",line:"Line",arrowInfinityLine:"Arrow line",horizontalLine:"Horizontal line",verticalLine:"Vertical line",crooked3:"Crooked 3 line",crooked5:"Crooked 5 line",elliott3:"Elliott 3 line",elliott5:"Elliott 5 line",verticalCounter:"Vertical counter",verticalLabel:"Vertical label",verticalArrow:"Vertical arrow",fibonacci:"Fibonacci",fibonacciTimeZones:"Fibonacci Time Zones",pitchfork:"Pitchfork",parallelChannel:"Parallel channel",infinityLine:"Infinity line",measure:"Measure",measureXY:"Measure XY",measureX:"Measure X",measureY:"Measure Y",timeCycles:"Time Cycles",flags:"Flags",addButton:"add",saveButton:"save",editButton:"edit",removeButton:"remove",series:"Series",volume:"Volume",connector:"Connector",innerBackground:"Inner background",outerBackground:"Outer background",crosshairX:"Crosshair X",crosshairY:"Crosshair Y",tunnel:"Tunnel",background:"Background",noFilterMatch:"No match",searchIndicators:"Search Indicators",clearFilter:"âœ• clear filter",index:"Index",period:"Period",periods:"Periods",standardDeviation:"Standard deviation",periodTenkan:"Tenkan period",periodSenkouSpanB:"Senkou Span B period",periodATR:"ATR period",multiplierATR:"ATR multiplier",shortPeriod:"Short period",longPeriod:"Long period",signalPeriod:"Signal period",decimals:"Decimals",algorithm:"Algorithm",topBand:"Top band",bottomBand:"Bottom band",initialAccelerationFactor:"Initial acceleration factor",maxAccelerationFactor:"Max acceleration factor",increment:"Increment",multiplier:"Multiplier",ranges:"Ranges",highIndex:"High index",lowIndex:"Low index",deviation:"Deviation",xAxisUnit:"x-axis unit",factor:"Factor",fastAvgPeriod:"Fast average period",slowAvgPeriod:"Slow average period",average:"Average",indicatorAliases:{abands:["Acceleration Bands"],bb:["Bollinger Bands"],dema:["Double Exponential Moving Average"],ema:["Exponential Moving Average"],ikh:["Ichimoku Kinko Hyo"],keltnerchannels:["Keltner Channels"],linearRegression:["Linear Regression"],pivotpoints:["Pivot Points"],pc:["Price Channel"],priceenvelopes:["Price Envelopes"],psar:["Parabolic SAR"],sma:["Simple Moving Average"],supertrend:["Super Trend"],tema:["Triple Exponential Moving Average"],vbp:["Volume by Price"],vwap:["Volume Weighted Moving Average"],wma:["Weighted Moving Average"],zigzag:["Zig Zag"],apo:["Absolute price indicator"],ad:["Accumulation/Distribution"],aroon:["Aroon"],aroonoscillator:["Aroon oscillator"],atr:["Average True Range"],ao:["Awesome oscillator"],cci:["Commodity Channel Index"],chaikin:["Chaikin"],cmf:["Chaikin Money Flow"],cmo:["Chande Momentum Oscillator"],disparityindex:["Disparity Index"],dmi:["Directional Movement Index"],dpo:["Detrended price oscillator"],klinger:["Klinger Oscillator"],linearRegressionAngle:["Linear Regression Angle"],linearRegressionIntercept:["Linear Regression Intercept"],linearRegressionSlope:["Linear Regression Slope"],macd:["Moving Average Convergence Divergence"],mfi:["Money Flow Index"],momentum:["Momentum"],natr:["Normalized Average True Range"],obv:["On-Balance Volume"],ppo:["Percentage Price oscillator"],roc:["Rate of Change"],rsi:["Relative Strength Index"],slowstochastic:["Slow Stochastic"],stochastic:["Stochastic"],trix:["TRIX"],williamsr:["Williams %R"]}}}},stockTools:{gui:{enabled:!0,className:"highcharts-bindings-wrapper",toolbarClassName:"stocktools-toolbar",buttons:["indicators","separator","simpleShapes","lines","crookedLines","measure","advanced","toggleAnnotations","separator","verticalLabels","flags","separator","zoomChange","fullScreen","typeChange","separator","currentPriceIndicator","saveChart"],definitions:{separator:{symbol:"separator.svg"},simpleShapes:{items:["label","circle","ellipse","rectangle"],circle:{symbol:"circle.svg"},ellipse:{symbol:"ellipse.svg"},rectangle:{symbol:"rectangle.svg"},label:{symbol:"label.svg"}},flags:{items:["flagCirclepin","flagDiamondpin","flagSquarepin","flagSimplepin"],flagSimplepin:{symbol:"flag-basic.svg"},flagDiamondpin:{symbol:"flag-diamond.svg"},flagSquarepin:{symbol:"flag-trapeze.svg"},flagCirclepin:{symbol:"flag-elipse.svg"}},lines:{items:["segment","arrowSegment","ray","arrowRay","line","arrowInfinityLine","horizontalLine","verticalLine"],segment:{symbol:"segment.svg"},arrowSegment:{symbol:"arrow-segment.svg"},ray:{symbol:"ray.svg"},arrowRay:{symbol:"arrow-ray.svg"},line:{symbol:"line.svg"},arrowInfinityLine:{symbol:"arrow-line.svg"},verticalLine:{symbol:"vertical-line.svg"},horizontalLine:{symbol:"horizontal-line.svg"}},crookedLines:{items:["elliott3","elliott5","crooked3","crooked5"],crooked3:{symbol:"crooked-3.svg"},crooked5:{symbol:"crooked-5.svg"},elliott3:{symbol:"elliott-3.svg"},elliott5:{symbol:"elliott-5.svg"}},verticalLabels:{items:["verticalCounter","verticalLabel","verticalArrow"],verticalCounter:{symbol:"vertical-counter.svg"},verticalLabel:{symbol:"vertical-label.svg"},verticalArrow:{symbol:"vertical-arrow.svg"}},advanced:{items:["fibonacci","fibonacciTimeZones","pitchfork","parallelChannel","timeCycles"],pitchfork:{symbol:"pitchfork.svg"},fibonacci:{symbol:"fibonacci.svg"},fibonacciTimeZones:{symbol:"fibonacci-timezone.svg"},parallelChannel:{symbol:"parallel-channel.svg"},timeCycles:{symbol:"time-cycles.svg"}},measure:{items:["measureXY","measureX","measureY"],measureX:{symbol:"measure-x.svg"},measureY:{symbol:"measure-y.svg"},measureXY:{symbol:"measure-xy.svg"}},toggleAnnotations:{symbol:"annotations-visible.svg"},currentPriceIndicator:{symbol:"current-price-show.svg"},indicators:{symbol:"indicators.svg"},zoomChange:{items:["zoomX","zoomY","zoomXY"],zoomX:{symbol:"zoom-x.svg"},zoomY:{symbol:"zoom-y.svg"},zoomXY:{symbol:"zoom-xy.svg"}},typeChange:{items:["typeOHLC","typeLine","typeCandlestick","typeHollowCandlestick","typeHLC","typeHeikinAshi"],typeOHLC:{symbol:"series-ohlc.svg"},typeLine:{symbol:"series-line.svg"},typeCandlestick:{symbol:"series-candlestick.svg"},typeHLC:{symbol:"series-hlc.svg"},typeHeikinAshi:{symbol:"series-heikin-ashi.svg"},typeHollowCandlestick:{symbol:"series-hollow-candlestick.svg"}},fullScreen:{symbol:"fullscreen.svg"},saveChart:{symbol:"save-chart.svg"}}}}}),addEvent(Chart,"afterGetContainer",function(){this.setStockTools()}),addEvent(Chart,"getMargins",function(){var e=this.stockTools&&this.stockTools.listWrapper,e=e&&(e.startWidth+getStyle(e,"padding-left")+getStyle(e,"padding-right")||e.offsetWidth);e&&e<this.plotWidth&&(this.plotLeft+=e,this.spacing[3]+=e)},{order:0}),["beforeRender","beforeRedraw"].forEach(function(e){addEvent(Chart,e,function(){var e,t,i,o;this.stockTools&&(o=this.options.chart,t=!1,(e=(i=this.stockTools.listWrapper)&&(i.startWidth+getStyle(i,"padding-left")+getStyle(i,"padding-right")||i.offsetWidth))&&e<this.plotWidth?(o=(i=pick(o.spacingLeft,o.spacing&&o.spacing[3],0)+e)-this.spacingBox.x,this.spacingBox.x=i,this.spacingBox.width-=o,t=!0):0===e&&(t=!0),e!==this.stockTools.prevOffsetWidth&&(this.stockTools.prevOffsetWidth=e,t&&(this.isDirtyLegend=!0)))})}),addEvent(Chart,"destroy",function(){this.stockTools&&this.stockTools.destroy()}),addEvent(Chart,"redraw",function(){this.stockTools&&this.stockTools.guiEnabled&&this.stockTools.redraw()});var Toolbar=function(){function n(e,t,i){this.arrowDown=void 0,this.arrowUp=void 0,this.arrowWrapper=void 0,this.listWrapper=void 0,this.showhideBtn=void 0,this.submenu=void 0,this.toolbar=void 0,this.wrapper=void 0,this.chart=i,this.options=e,this.lang=t,this.iconsURL=this.getIconsURL(),this.guiEnabled=e.enabled,this.visible=pick(e.visible,!0),this.placed=pick(e.placed,!1),this.eventsToUnbind=[],this.guiEnabled&&(this.createHTML(),this.init(),this.showHideNavigatorion()),fireEvent(this,"afterInit")}return n.prototype.init=function(){var t,i=this,o=this.lang,e=this.options,a=this.toolbar,r=i.addSubmenu,s=e.buttons,n=e.definitions,l=a.childNodes;s.forEach(function(e){t=i.addButton(a,n,e,o),i.eventsToUnbind.push(addEvent(t.buttonWrapper,"click",function(){i.eraseActiveButtons(l,t.buttonWrapper)})),isArray(n[e].items)&&r.call(i,t,n[e])})},n.prototype.addSubmenu=function(e,t){var i,o=this,a=e.submenuArrow,r=e.buttonWrapper,s=getStyle(r,"width"),n=this.wrapper,l=this.listWrapper,c=this.toolbar.childNodes,p=0;this.submenu=i=createElement(UL,{className:PREFIX+"submenu-wrapper"},void 0,r),this.addSubmenuItems(r,t),o.eventsToUnbind.push(addEvent(a,"click",function(e){e.stopPropagation(),o.eraseActiveButtons(c,r),0<=r.className.indexOf(PREFIX+"current")?(l.style.width=l.startWidth+"px",r.classList.remove(PREFIX+"current"),i.style.display="none"):(i.style.display="block",p=i.offsetHeight-r.offsetHeight-3,i.offsetHeight+r.offsetTop>n.offsetHeight&&r.offsetTop>p||(p=0),css(i,{top:-p+"px",left:s+3+"px"}),r.className+=" "+PREFIX+"current",l.startWidth=n.offsetWidth,l.style.width=l.startWidth+getStyle(l,"padding-left")+i.offsetWidth+3+"px")}))},n.prototype.addSubmenuItems=function(t,i){var e,o,a=this,r=this.submenu,s=this.lang,n=this.listWrapper;i.items.forEach(function(e){o=a.addButton(r,i,e,s),a.eventsToUnbind.push(addEvent(o.mainButton,"click",function(){a.switchSymbol(this,t,!0),n.style.width=n.startWidth+"px",r.style.display="none"}))}),e=r.querySelectorAll("li > ."+PREFIX+"menu-item-btn")[0],a.switchSymbol(e,!1)},n.prototype.eraseActiveButtons=function(e,t,i){[].forEach.call(e,function(e){e!==t&&(e.classList.remove(PREFIX+"current"),e.classList.remove(PREFIX+"active"),0<(i=e.querySelectorAll("."+PREFIX+"submenu-wrapper")).length&&(i[0].style.display="none"))})},n.prototype.addButton=function(e,t,i,o){void 0===o&&(o={});var a,r=t[i],s=r.items,t=r.className||"",i=createElement(LI,{className:pick(n.prototype.classMapping[i],"")+" "+t,title:o[i]||i},void 0,e),e=createElement(SPAN,{className:PREFIX+"menu-item-btn"},void 0,i);return s&&s.length?(a=createElement(SPAN,{className:PREFIX+"submenu-item-arrow "+PREFIX+"arrow-right"},void 0,i)).style.backgroundImage="url("+this.iconsURL+"arrow-bottom.svg)":e.style.backgroundImage="url("+this.iconsURL+r.symbol+")",{buttonWrapper:i,mainButton:e,submenuArrow:a}},n.prototype.addNavigation=function(){var e=this,t=e.wrapper;e.arrowWrapper=createElement(DIV,{className:PREFIX+"arrow-wrapper"}),e.arrowUp=createElement(DIV,{className:PREFIX+"arrow-up"},void 0,e.arrowWrapper),e.arrowUp.style.backgroundImage="url("+this.iconsURL+"arrow-right.svg)",e.arrowDown=createElement(DIV,{className:PREFIX+"arrow-down"},void 0,e.arrowWrapper),e.arrowDown.style.backgroundImage="url("+this.iconsURL+"arrow-right.svg)",t.insertBefore(e.arrowWrapper,t.childNodes[0]),e.scrollButtons()},n.prototype.scrollButtons=function(){var e=0,t=this,i=t.wrapper,o=t.toolbar,a=.1*i.offsetHeight;t.eventsToUnbind.push(addEvent(t.arrowUp,"click",function(){0<e&&(e-=a,o.style.marginTop=-e+"px")})),t.eventsToUnbind.push(addEvent(t.arrowDown,"click",function(){i.offsetHeight+e<=o.offsetHeight+a&&(e+=a,o.style.marginTop=-e+"px")}))},n.prototype.createHTML=function(){var e=this,t=e.chart,i=e.options,o=t.container,a=t.options.navigation,a=a&&a.bindingsClassName,r=e.wrapper=createElement(DIV,{className:PREFIX+"stocktools-wrapper "+i.className+" "+a});o.appendChild(r),["mousedown","mousemove","click","touchstart"].forEach(function(e){addEvent(r,e,function(e){return e.stopPropagation()})}),addEvent(r,"mouseover",function(e){return t.pointer.onContainerMouseLeave(e)}),e.toolbar=o=createElement(UL,{className:PREFIX+"stocktools-toolbar "+i.toolbarClassName}),e.listWrapper=i=createElement(DIV,{className:PREFIX+"menu-wrapper"}),r.insertBefore(i,r.childNodes[0]),i.insertBefore(o,i.childNodes[0]),e.showHideToolbar(),e.addNavigation()},n.prototype.showHideNavigatorion=function(){this.visible&&this.toolbar.offsetHeight>this.wrapper.offsetHeight-50?this.arrowWrapper.style.display="block":(this.toolbar.style.marginTop="0px",this.arrowWrapper.style.display="none")},n.prototype.showHideToolbar=function(){var e,t=this.chart,i=this.wrapper,o=this.listWrapper,a=this.submenu,r=this.visible;this.showhideBtn=e=createElement(DIV,{className:PREFIX+"toggle-toolbar "+PREFIX+"arrow-left"},void 0,i),e.style.backgroundImage="url("+this.iconsURL+"arrow-right.svg)",r?(i.style.height="100%",e.style.top=getStyle(o,"padding-top")+"px",e.style.left=i.offsetWidth+getStyle(o,"padding-left")+"px"):(a&&(a.style.display="none"),e.style.left="0px",this.visible=r=!1,o.classList.add(PREFIX+"hide"),e.classList.toggle(PREFIX+"arrow-right"),i.style.height=e.offsetHeight+"px"),this.eventsToUnbind.push(addEvent(e,"click",function(){t.update({stockTools:{gui:{visible:!r,placed:!0}}})}))},n.prototype.switchSymbol=function(e,t){var i=e.parentNode,o=i.className,i=i.parentNode.parentNode;-1<o.indexOf("highcharts-disabled-btn")||(i.className="",o&&i.classList.add(o.trim()),i.querySelectorAll("."+PREFIX+"menu-item-btn")[0].style.backgroundImage=e.style.backgroundImage,t&&this.toggleButtonAciveClass(i))},n.prototype.toggleButtonAciveClass=function(e){0<=e.className.indexOf(activeClass)?e.classList.remove(activeClass):e.classList.add(activeClass)},n.prototype.unselectAllButtons=function(t){var e=t.parentNode.querySelectorAll("."+activeClass);[].forEach.call(e,function(e){e!==t&&e.classList.remove(activeClass)})},n.prototype.update=function(e,t){merge(!0,this.chart.options.stockTools,e),this.destroy(),this.chart.setStockTools(e),this.chart.navigationBindings&&this.chart.navigationBindings.update(),this.chart.isDirtyBox=!0,pick(t,!0)&&this.chart.redraw()},n.prototype.destroy=function(){var e=this.wrapper,t=e&&e.parentNode;this.eventsToUnbind.forEach(function(e){e()}),t&&t.removeChild(e)},n.prototype.redraw=function(){this.showHideNavigatorion()},n.prototype.getIconsURL=function(){return this.chart.options.navigation.iconsURL||this.options.iconsURL||"https://code.highcharts.com/9.3.3/gfx/stock-icons/"},n}();Toolbar.prototype.classMapping={circle:PREFIX+"circle-annotation",ellipse:PREFIX+"ellipse-annotation",rectangle:PREFIX+"rectangle-annotation",label:PREFIX+"label-annotation",segment:PREFIX+"segment",arrowSegment:PREFIX+"arrow-segment",ray:PREFIX+"ray",arrowRay:PREFIX+"arrow-ray",line:PREFIX+"infinity-line",arrowInfinityLine:PREFIX+"arrow-infinity-line",verticalLine:PREFIX+"vertical-line",horizontalLine:PREFIX+"horizontal-line",crooked3:PREFIX+"crooked3",crooked5:PREFIX+"crooked5",elliott3:PREFIX+"elliott3",elliott5:PREFIX+"elliott5",pitchfork:PREFIX+"pitchfork",fibonacci:PREFIX+"fibonacci",fibonacciTimeZones:PREFIX+"fibonacci-time-zones",parallelChannel:PREFIX+"parallel-channel",measureX:PREFIX+"measure-x",measureY:PREFIX+"measure-y",measureXY:PREFIX+"measure-xy",timeCycles:PREFIX+"time-cycles",verticalCounter:PREFIX+"vertical-counter",verticalLabel:PREFIX+"vertical-label",verticalArrow:PREFIX+"vertical-arrow",currentPriceIndicator:PREFIX+"current-price-indicator",indicators:PREFIX+"indicators",flagCirclepin:PREFIX+"flag-circlepin",flagDiamondpin:PREFIX+"flag-diamondpin",flagSquarepin:PREFIX+"flag-squarepin",flagSimplepin:PREFIX+"flag-simplepin",zoomX:PREFIX+"zoom-x",zoomY:PREFIX+"zoom-y",zoomXY:PREFIX+"zoom-xy",typeLine:PREFIX+"series-type-line",typeOHLC:PREFIX+"series-type-ohlc",typeHLC:PREFIX+"series-type-hlc",typeCandlestick:PREFIX+"series-type-candlestick",typeHollowCandlestick:PREFIX+"series-type-hollowcandlestick",typeHeikinAshi:PREFIX+"series-type-heikinashi",fullScreen:PREFIX+"full-screen",toggleAnnotations:PREFIX+"toggle-annotations",saveChart:PREFIX+"save-chart",separator:PREFIX+"separator"},extend(Chart.prototype,{setStockTools:function(e){var t=this.options,i=t.lang,e=merge(t.stockTools&&t.stockTools.gui,e&&e.gui),i=i&&i.stockTools&&i.stockTools.gui;this.stockTools=new Toolbar(e,i,this),this.stockTools.guiEnabled&&(this.isDirtyBox=!0)}}),addEvent(NavigationBindings,"selectButton",function(e){var t=e.button,i=PREFIX+"submenu-wrapper",o=this.chart.stockTools;o&&o.guiEnabled&&(o.unselectAllButtons(e.button),0<=t.parentNode.className.indexOf(i)&&(t=t.parentNode.parentNode),o.toggleButtonAciveClass(t))}),addEvent(NavigationBindings,"deselectButton",function(e){var t=e.button,e=this.chart.stockTools;e&&e.guiEnabled&&(0<=t.parentNode.className.indexOf(PREFIX+"submenu-wrapper")&&(t=t.parentNode.parentNode),e.toggleButtonAciveClass(t))}),addEvent(Chart,"render",function(){var e=this,t=e.stockTools,i=t&&t.toolbar&&t.toolbar.querySelector(".highcharts-current-price-indicator");t&&e.navigationBindings&&e.options.series&&i&&(e.navigationBindings.constructor.prototype.utils.isPriceIndicatorEnabled(e.series)?i.firstChild.style["background-image"]='url("'+t.getIconsURL()+'current-price-hide.svg")':i.firstChild.style["background-image"]='url("'+t.getIconsURL()+'current-price-show.svg")')}),H.Toolbar=Toolbar;export default H.Toolbar;