"use strict";import D from"../Core/DefaultOptions.js";var getOptions=D.getOptions,setOptions=D.setOptions;import H from"../Core/Globals.js";import NavigationBindings from"../Extensions/Annotations/NavigationBindings.js";import Series from"../Core/Series/Series.js";import U from"../Core/Utilities.js";var correctFloat=U.correctFloat,defined=U.defined,extend=U.extend,fireEvent=U.fireEvent,isNumber=U.isNumber,merge=U.merge,pick=U.pick,uniqueKey=U.uniqueKey,bindingsUtils=NavigationBindings.prototype.utils,PREFIX="highcharts-";bindingsUtils.addFlagFromForm=function(r){return function(i){var t,s=this,n=s.chart,e=n.stockTools,o=bindingsUtils.getFieldType,a=bindingsUtils.attractToPoint(i,n);a&&(i={x:a.x,y:a.y},t={type:"flags",onSeries:a.series.id,shape:r,data:[i],xAxis:a.xAxis,yAxis:a.yAxis,point:{events:{click:function(){var t=this,i=t.options;fireEvent(s,"showPopup",{point:t,formType:"annotation-toolbar",options:{langKey:"flags",type:"flags",title:[i.title,o(i.title)],name:[i.name,o(i.name)]},onSubmit:function(i){"remove"===i.actionType?t.remove():t.update(s.fieldsToOptions(i.fields,{}))}})}}}},e&&e.guiEnabled||n.addSeries(t),fireEvent(s,"showPopup",{formType:"flag",options:{langKey:"flags",type:"flags",title:["A",o("A")],name:["Flag A",o("Flag A")]},onSubmit:function(i){s.fieldsToOptions(i.fields,t.data[0]),n.addSeries(t)}}))}},bindingsUtils.indicatorsWithAxes=["apo","ad","aroon","aroonoscillator","atr","ao","cci","chaikin","cmf","cmo","disparityindex","dmi","dpo","linearRegressionAngle","linearRegressionIntercept","linearRegressionSlope","klinger","macd","mfi","momentum","natr","obv","ppo","roc","rsi","slowstochastic","stochastic","trix","williamsr"],bindingsUtils.manageIndicators=function(i){var t,s,n,e=this,o=e.chart,a={linkedTo:i.linkedTo,type:i.type},r=bindingsUtils.indicatorsWithAxes;"edit"===i.actionType?(e.fieldsToOptions(i.fields,a),(n=o.get(i.seriesId))&&n.update(a,!1)):"remove"===i.actionType?(n=o.get(i.seriesId))&&(s=n.yAxis,n.linkedSeries&&n.linkedSeries.forEach(function(i){i.remove(!1)}),n.remove(!1),0<=r.indexOf(n.type)&&(t=s.options.height,s.remove(!1),e.resizeYAxes(t))):(a.id=uniqueKey(),e.fieldsToOptions(i.fields,a),n=o.get(a.linkedTo),t=getOptions().plotOptions,void 0!==n&&n instanceof Series&&"sum"===n.getDGApproximation()&&!defined(t&&t[a.type]&&t.dataGrouping&&t.dataGrouping.approximation)&&(a.dataGrouping={approximation:"sum"}),0<=r.indexOf(i.type)?(s=o.addAxis({id:uniqueKey(),offset:0,opposite:!0,title:{text:""},tickPixelInterval:40,showLastLabel:!1,labels:{align:"left",y:-2}},!1,!1),a.yAxis=s.options.id,e.resizeYAxes()):a.yAxis=o.get(i.linkedTo).options.yAxis,0<=["ad","cmf","klinger","mfi","obv","vbp","vwap"].indexOf(i.type)&&(a.params.volumeSeriesID=o.series.filter(function(i){return"column"===i.options.type})[0].options.id),o.addSeries(a,!1)),fireEvent(e,"deselectButton",{button:e.selectedButtonElement}),o.redraw()},bindingsUtils.updateHeight=function(i,t){var s=t.options.typeOptions,n=isNumber(s.yAxis)&&this.chart.yAxis[s.yAxis];n&&s.points&&t.update({typeOptions:{height:n.toValue(i[n.horiz?"chartX":"chartY"])-(s.points[1].y||0)}})},bindingsUtils.attractToPoint=function(i,t){var s,n,e,o,i=t.pointer.getCoordinates(i),a=Number.MAX_VALUE;if(t.navigationBindings&&(o=t.navigationBindings.utils.getAssignedAxis(i.xAxis),s=t.navigationBindings.utils.getAssignedAxis(i.yAxis)),o&&s)return e=o.value,o=s.value,s.axis.series.forEach(function(i){i.points&&i.points.forEach(function(i){i&&a>Math.abs(i.x-e)&&(a=Math.abs(i.x-e),n=i)})}),n&&n.x&&n.y?{x:n.x,y:n.y,below:o<n.y,series:n.series,xAxis:n.series.xAxis.options.index||0,yAxis:n.series.yAxis.options.index||0}:void 0},bindingsUtils.isNotNavigatorYAxis=function(i){return i.userOptions.className!==PREFIX+"navigator-yaxis"},bindingsUtils.isPriceIndicatorEnabled=function(i){return i.some(function(i){return i.lastVisiblePrice||i.lastPrice})},bindingsUtils.updateNthPoint=function(o){return function(s,i){var t=i.options.typeOptions,n=isNumber(t.xAxis)&&this.chart.xAxis[t.xAxis],e=isNumber(t.yAxis)&&this.chart.yAxis[t.yAxis];n&&e&&(t.points.forEach(function(i,t){o<=t&&(i.x=n.toValue(s[n.horiz?"chartX":"chartY"]),i.y=e.toValue(s[e.horiz?"chartX":"chartY"]))}),i.update({typeOptions:{points:t.points}}))}},extend(NavigationBindings.prototype,{getYAxisPositions:function(n,e,o,i){var a,r,l=0;function h(i){return defined(i)&&!isNumber(i)&&i.match("%")}return i&&(r=correctFloat(parseFloat(i)/100)),{positions:n.map(function(i,t){var s=correctFloat(h(i.options.height)?parseFloat(i.options.height)/100:i.height/e),i=correctFloat(h(i.options.top)?parseFloat(i.options.top)/100:(i.top-i.chart.plotTop)/e);return l=r?i<=l?correctFloat(Math.max(l,(i||0)+(s||0))):(i=correctFloat(i-r),correctFloat(l+s)):(isNumber(s)||(s=n[t-1].series.every(function(i){return i.is("sma")})?a:o/100),isNumber(i)||(i=l),a=s,correctFloat(Math.max(l,(i||0)+(s||0)))),{height:100*s,top:100*i}}),allAxesHeight:l}},getYAxisResizers:function(n){var e=[];return n.forEach(function(i,t){var s=n[t+1];e[t]=s?{enabled:!0,controlledAxis:{next:[pick(s.options.id,s.options.index)]}}:{enabled:!1}}),e},resizeYAxes:function(i){var t=this.chart,s=t.yAxis.filter(bindingsUtils.isNotNavigatorYAxis),n=t.plotHeight,t=this.getYAxisPositions(s,n,20,i),n=t.positions,e=t.allAxesHeight,o=this.getYAxisResizers(s);!i&&e<=correctFloat(1)?n[n.length-1]={height:20,top:correctFloat(100*e-20)}:n.forEach(function(i){i.height=i.height/(100*e)*100,i.top=i.top/(100*e)*100}),n.forEach(function(i,t){s[t].update({height:i.height+"%",top:i.top+"%",resize:o[t],offset:0},!1)})},recalculateYAxisPositions:function(s,n,e,o){return s.forEach(function(i,t){t=s[t-1];i.top=t?correctFloat(t.height+t.top):0,e&&(i.height=correctFloat(i.height+o*n))}),s}});var stockToolsBindings={segment:{className:"highcharts-segment",start:function(i){var t=this.chart.pointer.getCoordinates(i),s=this.utils.getAssignedAxis(t.xAxis),i=this.utils.getAssignedAxis(t.yAxis),t=this.chart.options.navigation;if(s&&i)return t=merge({langKey:"segment",type:"crookedLine",typeOptions:{xAxis:s.axis.options.index,yAxis:i.axis.options.index,points:[{x:s.value,y:i.value},{x:s.value,y:i.value}]}},t.annotationsOptions,t.bindings.segment.annotationsOptions),this.chart.addAnnotation(t)},steps:[bindingsUtils.updateNthPoint(1)]},arrowSegment:{className:"highcharts-arrow-segment",start:function(i){var t=this.chart.pointer.getCoordinates(i),s=this.utils.getAssignedAxis(t.xAxis),i=this.utils.getAssignedAxis(t.yAxis),t=this.chart.options.navigation;if(s&&i)return t=merge({langKey:"arrowSegment",type:"crookedLine",typeOptions:{line:{markerEnd:"arrow"},xAxis:s.axis.options.index,yAxis:i.axis.options.index,points:[{x:s.value,y:i.value},{x:s.value,y:i.value}]}},t.annotationsOptions,t.bindings.arrowSegment.annotationsOptions),this.chart.addAnnotation(t)},steps:[bindingsUtils.updateNthPoint(1)]},ray:{className:"highcharts-ray",start:function(i){var t=this.chart.pointer.getCoordinates(i),s=this.utils.getAssignedAxis(t.xAxis),i=this.utils.getAssignedAxis(t.yAxis),t=this.chart.options.navigation;if(s&&i)return t=merge({langKey:"ray",type:"infinityLine",typeOptions:{type:"ray",xAxis:s.axis.options.index,yAxis:i.axis.options.index,points:[{x:s.value,y:i.value},{x:s.value,y:i.value}]}},t.annotationsOptions,t.bindings.ray.annotationsOptions),this.chart.addAnnotation(t)},steps:[bindingsUtils.updateNthPoint(1)]},arrowRay:{className:"highcharts-arrow-ray",start:function(i){var t=this.chart.pointer.getCoordinates(i),s=this.utils.getAssignedAxis(t.xAxis),i=this.utils.getAssignedAxis(t.yAxis),t=this.chart.options.navigation;if(s&&i)return t=merge({langKey:"arrowRay",type:"infinityLine",typeOptions:{type:"ray",line:{markerEnd:"arrow"},xAxis:s.axis.options.index,yAxis:i.axis.options.index,points:[{x:s.value,y:i.value},{x:s.value,y:i.value}]}},t.annotationsOptions,t.bindings.arrowRay.annotationsOptions),this.chart.addAnnotation(t)},steps:[bindingsUtils.updateNthPoint(1)]},infinityLine:{className:"highcharts-infinity-line",start:function(i){var t=this.chart.pointer.getCoordinates(i),s=this.utils.getAssignedAxis(t.xAxis),i=this.utils.getAssignedAxis(t.yAxis),t=this.chart.options.navigation;if(s&&i)return t=merge({langKey:"infinityLine",type:"infinityLine",typeOptions:{type:"line",xAxis:s.axis.options.index,yAxis:i.axis.options.index,points:[{x:s.value,y:i.value},{x:s.value,y:i.value}]}},t.annotationsOptions,t.bindings.infinityLine.annotationsOptions),this.chart.addAnnotation(t)},steps:[bindingsUtils.updateNthPoint(1)]},arrowInfinityLine:{className:"highcharts-arrow-infinity-line",start:function(i){var t=this.chart.pointer.getCoordinates(i),s=this.utils.getAssignedAxis(t.xAxis),i=this.utils.getAssignedAxis(t.yAxis),t=this.chart.options.navigation;if(s&&i)return t=merge({langKey:"arrowInfinityLine",type:"infinityLine",typeOptions:{type:"line",line:{markerEnd:"arrow"},xAxis:s.axis.options.index,yAxis:i.axis.options.index,points:[{x:s.value,y:i.value},{x:s.value,y:i.value}]}},t.annotationsOptions,t.bindings.arrowInfinityLine.annotationsOptions),this.chart.addAnnotation(t)},steps:[bindingsUtils.updateNthPoint(1)]},horizontalLine:{className:"highcharts-horizontal-line",start:function(i){var t=this.chart.pointer.getCoordinates(i),s=this.utils.getAssignedAxis(t.xAxis),i=this.utils.getAssignedAxis(t.yAxis),t=this.chart.options.navigation;s&&i&&(t=merge({langKey:"horizontalLine",type:"infinityLine",draggable:"y",typeOptions:{type:"horizontalLine",xAxis:s.axis.options.index,yAxis:i.axis.options.index,points:[{x:s.value,y:i.value}]}},t.annotationsOptions,t.bindings.horizontalLine.annotationsOptions),this.chart.addAnnotation(t))}},verticalLine:{className:"highcharts-vertical-line",start:function(i){var t=this.chart.pointer.getCoordinates(i),s=this.utils.getAssignedAxis(t.xAxis),i=this.utils.getAssignedAxis(t.yAxis),t=this.chart.options.navigation;s&&i&&(t=merge({langKey:"verticalLine",type:"infinityLine",draggable:"x",typeOptions:{type:"verticalLine",xAxis:s.axis.options.index,yAxis:i.axis.options.index,points:[{x:s.value,y:i.value}]}},t.annotationsOptions,t.bindings.verticalLine.annotationsOptions),this.chart.addAnnotation(t))}},crooked3:{className:"highcharts-crooked3",start:function(i){var t=this.chart.pointer.getCoordinates(i),s=this.utils.getAssignedAxis(t.xAxis),n=this.utils.getAssignedAxis(t.yAxis);if(s&&n){var e=s.value,i=n.value,t=this.chart.options.navigation,t=merge({langKey:"crooked3",type:"crookedLine",typeOptions:{xAxis:s.axis.options.index,yAxis:n.axis.options.index,points:[{x:e,y:i},{x:e,y:i},{x:e,y:i}]}},t.annotationsOptions,t.bindings.crooked3.annotationsOptions);return this.chart.addAnnotation(t)}},steps:[bindingsUtils.updateNthPoint(1),bindingsUtils.updateNthPoint(2)]},crooked5:{className:"highcharts-crooked5",start:function(i){var t=this.chart.pointer.getCoordinates(i),s=this.utils.getAssignedAxis(t.xAxis),n=this.utils.getAssignedAxis(t.yAxis);if(s&&n){var e=s.value,i=n.value,t=this.chart.options.navigation,t=merge({langKey:"crooked5",type:"crookedLine",typeOptions:{xAxis:s.axis.options.index,yAxis:n.axis.options.index,points:[{x:e,y:i},{x:e,y:i},{x:e,y:i},{x:e,y:i},{x:e,y:i}]}},t.annotationsOptions,t.bindings.crooked5.annotationsOptions);return this.chart.addAnnotation(t)}},steps:[bindingsUtils.updateNthPoint(1),bindingsUtils.updateNthPoint(2),bindingsUtils.updateNthPoint(3),bindingsUtils.updateNthPoint(4)]},elliott3:{className:"highcharts-elliott3",start:function(i){var t=this.chart.pointer.getCoordinates(i),s=this.utils.getAssignedAxis(t.xAxis),n=this.utils.getAssignedAxis(t.yAxis);if(s&&n){var e=s.value,i=n.value,t=this.chart.options.navigation,t=merge({langKey:"elliott3",type:"elliottWave",typeOptions:{xAxis:s.axis.options.index,yAxis:n.axis.options.index,points:[{x:e,y:i},{x:e,y:i},{x:e,y:i},{x:e,y:i}]},labelOptions:{style:{color:"#666666"}}},t.annotationsOptions,t.bindings.elliott3.annotationsOptions);return this.chart.addAnnotation(t)}},steps:[bindingsUtils.updateNthPoint(1),bindingsUtils.updateNthPoint(2),bindingsUtils.updateNthPoint(3)]},elliott5:{className:"highcharts-elliott5",start:function(i){var t=this.chart.pointer.getCoordinates(i),s=this.utils.getAssignedAxis(t.xAxis),n=this.utils.getAssignedAxis(t.yAxis);if(s&&n){var e=s.value,i=n.value,t=this.chart.options.navigation,t=merge({langKey:"elliott5",type:"elliottWave",typeOptions:{xAxis:s.axis.options.index,yAxis:n.axis.options.index,points:[{x:e,y:i},{x:e,y:i},{x:e,y:i},{x:e,y:i},{x:e,y:i},{x:e,y:i}]},labelOptions:{style:{color:"#666666"}}},t.annotationsOptions,t.bindings.elliott5.annotationsOptions);return this.chart.addAnnotation(t)}},steps:[bindingsUtils.updateNthPoint(1),bindingsUtils.updateNthPoint(2),bindingsUtils.updateNthPoint(3),bindingsUtils.updateNthPoint(4),bindingsUtils.updateNthPoint(5)]},measureX:{className:"highcharts-measure-x",start:function(i){var t=this.chart.pointer.getCoordinates(i),s=this.utils.getAssignedAxis(t.xAxis),n=this.utils.getAssignedAxis(t.yAxis);if(s&&n){var e=s.value,i=n.value,t=this.chart.options.navigation,t=merge({langKey:"measure",type:"measure",typeOptions:{selectType:"x",xAxis:s.axis.options.index,yAxis:n.axis.options.index,point:{x:e,y:i},crosshairX:{strokeWidth:1,stroke:"#000000"},crosshairY:{enabled:!1,strokeWidth:0,stroke:"#000000"},background:{width:0,height:0,strokeWidth:0,stroke:"#ffffff"}},labelOptions:{style:{color:"#666666"}}},t.annotationsOptions,t.bindings.measureX.annotationsOptions);return this.chart.addAnnotation(t)}},steps:[bindingsUtils.updateRectSize]},measureY:{className:"highcharts-measure-y",start:function(i){var t=this.chart.pointer.getCoordinates(i),s=this.utils.getAssignedAxis(t.xAxis),n=this.utils.getAssignedAxis(t.yAxis);if(s&&n){var e=s.value,i=n.value,t=this.chart.options.navigation,t=merge({langKey:"measure",type:"measure",typeOptions:{selectType:"y",xAxis:s.axis.options.index,yAxis:n.axis.options.index,point:{x:e,y:i},crosshairX:{enabled:!1,strokeWidth:0,stroke:"#000000"},crosshairY:{strokeWidth:1,stroke:"#000000"},background:{width:0,height:0,strokeWidth:0,stroke:"#ffffff"}},labelOptions:{style:{color:"#666666"}}},t.annotationsOptions,t.bindings.measureY.annotationsOptions);return this.chart.addAnnotation(t)}},steps:[bindingsUtils.updateRectSize]},measureXY:{className:"highcharts-measure-xy",start:function(i){var t=this.chart.pointer.getCoordinates(i),s=this.utils.getAssignedAxis(t.xAxis),n=this.utils.getAssignedAxis(t.yAxis);if(s&&n){var e=s.value,i=n.value,t=this.chart.options.navigation,t=merge({langKey:"measure",type:"measure",typeOptions:{selectType:"xy",xAxis:s.axis.options.index,yAxis:n.axis.options.index,point:{x:e,y:i},background:{width:0,height:0,strokeWidth:10},crosshairX:{strokeWidth:1,stroke:"#000000"},crosshairY:{strokeWidth:1,stroke:"#000000"}},labelOptions:{style:{color:"#666666"}}},t.annotationsOptions,t.bindings.measureXY.annotationsOptions);return this.chart.addAnnotation(t)}},steps:[bindingsUtils.updateRectSize]},fibonacci:{className:"highcharts-fibonacci",start:function(i){var t=this.chart.pointer.getCoordinates(i),s=this.utils.getAssignedAxis(t.xAxis),n=this.utils.getAssignedAxis(t.yAxis);if(s&&n){var e=s.value,i=n.value,t=this.chart.options.navigation,t=merge({langKey:"fibonacci",type:"fibonacci",typeOptions:{xAxis:s.axis.options.index,yAxis:n.axis.options.index,points:[{x:e,y:i},{x:e,y:i}]},labelOptions:{style:{color:"#666666"}}},t.annotationsOptions,t.bindings.fibonacci.annotationsOptions);return this.chart.addAnnotation(t)}},steps:[bindingsUtils.updateNthPoint(1),bindingsUtils.updateHeight]},parallelChannel:{className:"highcharts-parallel-channel",start:function(i){var t=this.chart.pointer.getCoordinates(i),s=this.utils.getAssignedAxis(t.xAxis),n=this.utils.getAssignedAxis(t.yAxis);if(s&&n){var e=s.value,i=n.value,t=this.chart.options.navigation,t=merge({langKey:"parallelChannel",type:"tunnel",typeOptions:{xAxis:s.axis.options.index,yAxis:n.axis.options.index,points:[{x:e,y:i},{x:e,y:i}]}},t.annotationsOptions,t.bindings.parallelChannel.annotationsOptions);return this.chart.addAnnotation(t)}},steps:[bindingsUtils.updateNthPoint(1),bindingsUtils.updateHeight]},pitchfork:{className:"highcharts-pitchfork",start:function(i){var t=this.chart.pointer.getCoordinates(i),s=this.utils.getAssignedAxis(t.xAxis),n=this.utils.getAssignedAxis(t.yAxis);if(s&&n){var e=s.value,i=n.value,t=this.chart.options.navigation,t=merge({langKey:"pitchfork",type:"pitchfork",typeOptions:{xAxis:s.axis.options.index,yAxis:n.axis.options.index,points:[{x:s.value,y:n.value,controlPoint:{style:{fill:"#f21313"}}},{x:e,y:i},{x:e,y:i}],innerBackground:{fill:"rgba(100, 170, 255, 0.8)"}},shapeOptions:{strokeWidth:2}},t.annotationsOptions,t.bindings.pitchfork.annotationsOptions);return this.chart.addAnnotation(t)}},steps:[bindingsUtils.updateNthPoint(1),bindingsUtils.updateNthPoint(2)]},verticalCounter:{className:"highcharts-vertical-counter",start:function(i){var t=bindingsUtils.attractToPoint(i,this.chart),i=this.chart.options.navigation;t&&(this.verticalCounter=this.verticalCounter||0,i=merge({langKey:"verticalCounter",type:"verticalLine",typeOptions:{point:{x:t.x,y:t.y,xAxis:t.xAxis,yAxis:t.yAxis},label:{offset:t.below?40:-40,text:this.verticalCounter.toString()}},labelOptions:{style:{color:"#666666",fontSize:"11px"}},shapeOptions:{stroke:"rgba(0, 0, 0, 0.75)",strokeWidth:1}},i.annotationsOptions,i.bindings.verticalCounter.annotationsOptions),i=this.chart.addAnnotation(i),this.verticalCounter++,i.options.events.click.call(i,{}))}},timeCycles:{className:"highcharts-time-cycles",start:function(i){var t=bindingsUtils.attractToPoint(i,this.chart),i=this.chart.options.navigation;if(t)return i=merge({langKey:"timeCycles",type:"timeCycles",typeOptions:{xAxis:t.xAxis,yAxis:t.yAxis,points:[{x:t.x},{x:t.x}],line:{stroke:"rgba(0, 0, 0, 0.75)",fill:"transparent",strokeWidth:2}}},i.annotationsOptions,i.bindings.timeCycles.annotationsOptions),(i=this.chart.addAnnotation(i)).options.events.click.call(i,{}),i},steps:[bindingsUtils.updateNthPoint(1)]},verticalLabel:{className:"highcharts-vertical-label",start:function(i){var t=bindingsUtils.attractToPoint(i,this.chart),i=this.chart.options.navigation;t&&(i=merge({langKey:"verticalLabel",type:"verticalLine",typeOptions:{point:{x:t.x,y:t.y,xAxis:t.xAxis,yAxis:t.yAxis},label:{offset:t.below?40:-40}},labelOptions:{style:{color:"#666666",fontSize:"11px"}},shapeOptions:{stroke:"rgba(0, 0, 0, 0.75)",strokeWidth:1}},i.annotationsOptions,i.bindings.verticalLabel.annotationsOptions),(i=this.chart.addAnnotation(i)).options.events.click.call(i,{}))}},verticalArrow:{className:"highcharts-vertical-arrow",start:function(i){var t=bindingsUtils.attractToPoint(i,this.chart),i=this.chart.options.navigation;t&&(i=merge({langKey:"verticalArrow",type:"verticalLine",typeOptions:{point:{x:t.x,y:t.y,xAxis:t.xAxis,yAxis:t.yAxis},label:{offset:t.below?40:-40,format:" "},connector:{fill:"none",stroke:t.below?"#f21313":"#06b535"}},shapeOptions:{stroke:"rgba(0, 0, 0, 0.75)",strokeWidth:1}},i.annotationsOptions,i.bindings.verticalArrow.annotationsOptions),(i=this.chart.addAnnotation(i)).options.events.click.call(i,{}))}},fibonacciTimeZones:{className:"highcharts-fibonacci-time-zones",start:function(i){var t=this.chart.pointer.getCoordinates(i),s=this.utils.getAssignedAxis(t.xAxis),i=this.utils.getAssignedAxis(t.yAxis);if(s&&i){t=this.chart.options.navigation,t=merge({type:"fibonacciTimeZones",langKey:"fibonacciTimeZones",typeOptions:{xAxis:s.axis.options.index,yAxis:i.axis.options.index,points:[{x:s.value}]}},t.annotationsOptions,t.bindings.fibonacciTimeZones.annotationsOptions);return this.chart.addAnnotation(t)}},steps:[function(i,t){var s=t.options.typeOptions.points,n=s&&s[0].x,s=this.chart.pointer.getCoordinates(i),i=this.utils.getAssignedAxis(s.xAxis),s=this.utils.getAssignedAxis(s.yAxis);t.update({typeOptions:{xAxis:i.axis.options.index,yAxis:s.axis.options.index,points:[{x:n},{x:i.value}]}})}]},flagCirclepin:{className:"highcharts-flag-circlepin",start:bindingsUtils.addFlagFromForm("circlepin")},flagDiamondpin:{className:"highcharts-flag-diamondpin",start:bindingsUtils.addFlagFromForm("flag")},flagSquarepin:{className:"highcharts-flag-squarepin",start:bindingsUtils.addFlagFromForm("squarepin")},flagSimplepin:{className:"highcharts-flag-simplepin",start:bindingsUtils.addFlagFromForm("nopin")},zoomX:{className:"highcharts-zoom-x",init:function(i){this.chart.update({chart:{zoomType:"x"}}),fireEvent(this,"deselectButton",{button:i})}},zoomY:{className:"highcharts-zoom-y",init:function(i){this.chart.update({chart:{zoomType:"y"}}),fireEvent(this,"deselectButton",{button:i})}},zoomXY:{className:"highcharts-zoom-xy",init:function(i){this.chart.update({chart:{zoomType:"xy"}}),fireEvent(this,"deselectButton",{button:i})}},seriesTypeLine:{className:"highcharts-series-type-line",init:function(i){this.chart.series[0].update({type:"line",useOhlcData:!0}),fireEvent(this,"deselectButton",{button:i})}},seriesTypeOhlc:{className:"highcharts-series-type-ohlc",init:function(i){this.chart.series[0].update({type:"ohlc"}),fireEvent(this,"deselectButton",{button:i})}},seriesTypeCandlestick:{className:"highcharts-series-type-candlestick",init:function(i){this.chart.series[0].update({type:"candlestick"}),fireEvent(this,"deselectButton",{button:i})}},seriesTypeHeikinAshi:{className:"highcharts-series-type-heikinashi",init:function(i){this.chart.series[0].update({type:"heikinashi"}),fireEvent(this,"deselectButton",{button:i})}},seriesTypeHLC:{className:"highcharts-series-type-hlc",init:function(i){this.chart.series[0].update({type:"hlc",useOhlcData:!0}),fireEvent(this,"deselectButton",{button:i})}},seriesTypeHollowCandlestick:{className:"highcharts-series-type-hollowcandlestick",init:function(i){this.chart.series[0].update({type:"hollowcandlestick"}),fireEvent(this,"deselectButton",{button:i})}},fullScreen:{className:"highcharts-full-screen",noDataState:"normal",init:function(i){this.chart.fullscreen.toggle(),fireEvent(this,"deselectButton",{button:i})}},currentPriceIndicator:{className:"highcharts-current-price-indicator",init:function(i){var t=this.chart,s=t.series,n=t.stockTools,e=bindingsUtils.isPriceIndicatorEnabled(t.series);n&&n.guiEnabled&&(s.forEach(function(i){i.update({lastPrice:{enabled:!e},lastVisiblePrice:{enabled:!e,label:{enabled:!0}}},!1)}),t.redraw()),fireEvent(this,"deselectButton",{button:i})}},indicators:{className:"highcharts-indicators",init:function(){var t=this;fireEvent(t,"showPopup",{formType:"indicators",options:{},onSubmit:function(i){t.utils.manageIndicators.call(t,i)}})}},toggleAnnotations:{className:"highcharts-toggle-annotations",init:function(i){var t=this.chart,s=t.stockTools,n=s.getIconsURL();this.toggledAnnotations=!this.toggledAnnotations,(t.annotations||[]).forEach(function(i){i.setVisibility(!this.toggledAnnotations)},this),s&&s.guiEnabled&&(this.toggledAnnotations?i.firstChild.style["background-image"]='url("'+n+'annotations-hidden.svg")':i.firstChild.style["background-image"]='url("'+n+'annotations-visible.svg")'),fireEvent(this,"deselectButton",{button:i})}},saveChart:{className:"highcharts-save-chart",noDataState:"normal",init:function(i){var t=this.chart,s=[],n=[],e=[],o=[];t.annotations.forEach(function(i,t){s[t]=i.userOptions}),t.series.forEach(function(i){i.is("sma")?n.push(i.userOptions):"flags"===i.type&&e.push(i.userOptions)}),t.yAxis.forEach(function(i){bindingsUtils.isNotNavigatorYAxis(i)&&o.push(i.options)}),H.win.localStorage.setItem(PREFIX+"chart",JSON.stringify({annotations:s,indicators:n,flags:e,yAxes:o})),fireEvent(this,"deselectButton",{button:i})}}};setOptions({navigation:{bindings:stockToolsBindings}}),NavigationBindings.prototype.utils=merge(bindingsUtils,NavigationBindings.prototype.utils);