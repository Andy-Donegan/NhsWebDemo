"use strict";var __extends=this&&this.__extends||function(){var n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)};return function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}}();import SeriesRegistry from"../../../Core/Series/SeriesRegistry.js";var SMAIndicator=SeriesRegistry.seriesTypes.sma;import U from"../../../Core/Utilities.js";var isArray=U.isArray,extend=U.extend,merge=U.merge,LinearRegressionIndicator=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.data=void 0,e.options=void 0,e.points=void 0,e}return __extends(e,t),e.prototype.getRegressionLineParameters=function(e,t){for(var r,n=this.options.params.index,i=function(e,t){return isArray(e)?e[t]:e},o=e.reduce(function(e,t){return t+e},0),s=t.reduce(function(e,t){return i(t,n)+e},0),a=o/e.length,p=s/t.length,u=0,c=0,f=0;f<e.length;f++)u+=(r=e[f]-a)*(i(t[f],n)-p),c+=Math.pow(r,2);return{slope:s=c?u/c:0,intercept:p-s*a}},e.prototype.getEndPointY=function(e,t){return e.slope*t+e.intercept},e.prototype.transformXData=function(e,t){var r=e[0];return e.map(function(e){return(e-r)/t})},e.prototype.findClosestDistance=function(e){for(var t,r,n=1;n<e.length-1;n++)0<(t=e[n]-e[n-1])&&(void 0===r||t<r)&&(r=t);return r},e.prototype.getValues=function(e,t){for(var r,n,i,o,s=e.xData,a=e.yData,p=t.period,u={xData:[],yData:[],values:[]},c=this.options.params.xAxisUnit||this.findClosestDistance(s),f=p-1;f<=s.length-1;f++)n=s[f],o=s.slice(r=f-p+1,i=f+1),i=a.slice(r,i),o=this.transformXData(o,c),i=this.getRegressionLineParameters(o,i),o=this.getEndPointY(i,o[o.length-1]),u.values.push({regressionLineParameters:i,x:n,y:o}),u.xData.push(n),u.yData.push(o);return u},e.defaultOptions=merge(SMAIndicator.defaultOptions,{params:{xAxisUnit:null},tooltip:{valueDecimals:4}}),e}(SMAIndicator);extend(LinearRegressionIndicator.prototype,{nameBase:"Linear Regression Indicator"}),SeriesRegistry.registerSeriesType("linearRegression",LinearRegressionIndicator);export default LinearRegressionIndicator;