"use strict";var __extends=this&&this.__extends||function(){var n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)e.hasOwnProperty(o)&&(t[o]=e[o])})(t,e)};return function(t,e){function o(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}}();import PivotPointsPoint from"./PivotPointsPoint.js";import SeriesRegistry from"../../../Core/Series/SeriesRegistry.js";var SMAIndicator=SeriesRegistry.seriesTypes.sma;import U from"../../../Core/Utilities.js";var merge=U.merge,extend=U.extend,defined=U.defined,isArray=U.isArray,PivotPointsIndicator=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.data=void 0,t.options=void 0,t.points=void 0,t.endPoint=void 0,t.plotEndPoint=void 0,t}return __extends(t,e),t.prototype.toYData=function(t){return[t.P]},t.prototype.translate=function(){var o=this;SeriesRegistry.seriesTypes.sma.prototype.translate.apply(o),o.points.forEach(function(e){o.pointArrayMap.forEach(function(t){defined(e[t])&&(e["plot"+t]=o.yAxis.toPixels(e[t],!0))})}),o.plotEndPoint=o.xAxis.toPixels(o.endPoint,!0)},t.prototype.getGraphPath=function(t){for(var e,o,n,a=this,i=t.length,r=[[],[],[],[],[],[],[],[],[]],s=[],p=a.plotEndPoint,l=a.pointArrayMap.length;i--;){for(o=t[i],n=0;n<l;n++)e=a.pointArrayMap[n],defined(o[e])&&r[n].push({plotX:o.plotX,plotY:o["plot"+e],isNull:!1},{plotX:p,plotY:o["plot"+e],isNull:!1},{plotX:p,plotY:null,isNull:!0});p=o.plotX}return r.forEach(function(t){s=s.concat(SeriesRegistry.seriesTypes.sma.prototype.getGraphPath.call(a,t))}),s},t.prototype.drawDataLabels=function(){var o,n,a,i,r=this,s=r.pointArrayMap;r.options.dataLabels.enabled&&(n=r.points.length,s.concat([!1]).forEach(function(t,e){for(i=n;i--;)a=r.points[i],t?(a.y=a[t],a.pivotLine=t,a.plotY=a["plot"+t],o=a["dataLabel"+t],e&&(a["dataLabel"+s[e-1]]=a.dataLabel),a.dataLabels||(a.dataLabels=[]),a.dataLabels[0]=a.dataLabel=o=o&&o.element?o:null):a["dataLabel"+s[e-1]]=a.dataLabel;SeriesRegistry.seriesTypes.sma.prototype.drawDataLabels.apply(r,arguments)}))},t.prototype.getValues=function(t,e){var o,n,a,i,r,s=e.period,p=t.xData,l=t.yData,d=l?l.length:0,c=this[e.algorithm+"Placement"],u=[],f=[],y=[];if(!(p.length<s)&&isArray(l[0])&&4===l[0].length){for(r=s+1;r<=d+s;r+=s)a=p.slice(r-s-1,r),i=l.slice(r-s-1,r),o=a[(n=a.length)-1],i=c(this.getPivotAndHLC(i)),i=u.push([o].concat(i)),f.push(o),y.push(u[i-1].slice(1));return this.endPoint=a[0]+(o-a[0])/n*s,{values:u,xData:f,yData:y}}},t.prototype.getPivotAndHLC=function(t){var e=-1/0,o=1/0,n=t[t.length-1][3];return t.forEach(function(t){e=Math.max(e,t[1]),o=Math.min(o,t[2])}),[(e+o+n)/3,e,o,n]},t.prototype.standardPlacement=function(t){var e=t[1]-t[2];return[null,null,t[0]+e,2*t[0]-t[2],t[0],2*t[0]-t[1],t[0]-e,null,null]},t.prototype.camarillaPlacement=function(t){var e=t[1]-t[2];return[t[3]+1.5*e,t[3]+1.25*e,t[3]+1.1666*e,t[3]+1.0833*e,t[0],t[3]-1.0833*e,t[3]-1.1666*e,t[3]-1.25*e,t[3]-1.5*e]},t.prototype.fibonacciPlacement=function(t){var e=t[1]-t[2];return[null,t[0]+e,t[0]+.618*e,t[0]+.382*e,t[0],t[0]-.382*e,t[0]-.618*e,t[0]-e,null]},t.defaultOptions=merge(SMAIndicator.defaultOptions,{params:{index:void 0,period:28,algorithm:"standard"},marker:{enabled:!1},enableMouseTracking:!1,dataLabels:{enabled:!0,format:"{point.pivotLine}"},dataGrouping:{approximation:"averages"}}),t}(SMAIndicator);extend(PivotPointsIndicator.prototype,{nameBase:"Pivot Points",pointArrayMap:["R4","R3","R2","R1","P","S1","S2","S3","S4"],pointValKey:"P",pointClass:PivotPointsPoint}),SeriesRegistry.registerSeriesType("pivotpoints",PivotPointsIndicator);export default PivotPointsIndicator;