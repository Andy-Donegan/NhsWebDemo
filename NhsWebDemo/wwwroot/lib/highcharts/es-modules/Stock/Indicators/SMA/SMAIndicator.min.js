"use strict";var __extends=this&&this.__extends||function(){var n=function(t,a){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,a){t.__proto__=a}||function(t,a){for(var e in a)a.hasOwnProperty(e)&&(t[e]=a[e])})(t,a)};return function(t,a){function e(){this.constructor=t}n(t,a),t.prototype=null===a?Object.create(a):(e.prototype=a.prototype,new e)}}();import Chart from"../../../Core/Chart/Chart.js";import SeriesRegistry from"../../../Core/Series/SeriesRegistry.js";var LineSeries=SeriesRegistry.seriesTypes.line;import U from"../../../Core/Utilities.js";var addEvent=U.addEvent,error=U.error,extend=U.extend,isArray=U.isArray,merge=U.merge,pick=U.pick,splat=U.splat;import"./SMAComposition.js";var SMAIndicator=function(i){function t(){var t=null!==i&&i.apply(this,arguments)||this;return t.data=void 0,t.dataEventsToUnbind=void 0,t.linkedParent=void 0,t.options=void 0,t.points=void 0,t}return __extends(t,i),t.prototype.destroy=function(){this.dataEventsToUnbind.forEach(function(t){t()}),i.prototype.destroy.apply(this,arguments)},t.prototype.getName=function(){var t=this.name,e=[];return t||((this.nameComponents||[]).forEach(function(t,a){e.push(this.options.params[t]+pick(this.nameSuffixes[a],""))},this),t=(this.nameBase||this.type.toUpperCase())+(this.nameComponents?" ("+e.join(", ")+")":"")),t},t.prototype.getValues=function(t,a){var e,n,i=a.period,o=t.xData,r=t.yData,s=r.length,p=0,d=0,c=[],l=[],u=[],f=-1;if(!(o.length<i)){for(isArray(r[0])&&(f=a.index||0);p<i-1;)d+=f<0?r[p]:r[p][f],p++;for(e=p;e<s;e++)d+=f<0?r[e]:r[e][f],n=[o[e],d/i],c.push(n),l.push(n[0]),u.push(n[1]),d-=f<0?r[e-p]:r[e-p][f];return{values:c,xData:l,yData:u}}},t.prototype.init=function(e,t){var n=this;i.prototype.init.call(n,e,t);t=addEvent(Chart,"afterLinkSeries",function(){var t,a=!!n.dataEventsToUnbind.length;if(!n.linkedParent)return error("Series "+n.options.linkedTo+" not found! Check `linkedTo`.",!1,e);a||(n.dataEventsToUnbind.push(addEvent(n.linkedParent,"updatedData",function(){n.recalculateValues()})),n.calculateOn.xAxis&&n.dataEventsToUnbind.push(addEvent(n.linkedParent.xAxis,n.calculateOn.xAxis,function(){n.recalculateValues()}))),"init"===n.calculateOn.chart?n.processedYData||n.recalculateValues():a||(t=addEvent(n.chart,n.calculateOn.chart,function(){n.recalculateValues(),t()}))},{order:0});n.dataEventsToUnbind=[],n.eventsToUnbind.push(t)},t.prototype.recalculateValues=function(){var t,a,e,n,i=this,o=i.points||[],r=(i.xData||[]).length,s=i.getValues(i.linkedParent,i.options.params)||{values:[],xData:[],yData:[]},p=[],d=!0;if(r&&!i.hasGroupedData&&i.visible&&i.points)if(i.cropped){for(i.xAxis&&(a=i.xAxis.min,e=i.xAxis.max),t=i.cropData(s.xData,s.yData,a,e),n=0;n<t.xData.length;n++)p.push([t.xData[n]].concat(splat(t.yData[n])));a=s.xData.indexOf(i.xData[0]),e=s.xData.indexOf(i.xData[i.xData.length-1]),-1===a&&e===s.xData.length-2&&p[0][0]===o[0].x&&p.shift(),i.updateData(p)}else s.xData.length!==r-1&&s.xData.length!==r+1&&(d=!1,i.updateData(s.values));d&&(i.xData=s.xData,i.yData=s.yData,i.options.data=s.values),i.calculateOn.xAxis&&i.processedXData&&(delete i.processedXData,i.isDirty=!0,i.redraw()),i.isDirtyData=!1},t.prototype.processData=function(){var t=this,a=t.options.compareToMain,e=t.linkedParent;i.prototype.processData.apply(t,arguments),t.dataModify&&e&&e.dataModify&&e.dataModify.compareValue&&a&&(t.dataModify.compareValue=e.dataModify.compareValue)},t.defaultOptions=merge(LineSeries.defaultOptions,{name:void 0,tooltip:{valueDecimals:4},linkedTo:void 0,compareToMain:!1,params:{index:3,period:14}}),t}(LineSeries);extend(SMAIndicator.prototype,{calculateOn:{chart:"init"},hasDerivedData:!0,nameComponents:["period"],nameSuffixes:[],useCommonDataGrouping:!0}),SeriesRegistry.registerSeriesType("sma",SMAIndicator);export default SMAIndicator;