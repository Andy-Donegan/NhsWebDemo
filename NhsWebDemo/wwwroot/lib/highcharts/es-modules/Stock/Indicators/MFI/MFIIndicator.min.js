"use strict";var __extends=this&&this.__extends||function(){var o=function(e,r){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,r){e.__proto__=r}||function(e,r){for(var t in r)r.hasOwnProperty(t)&&(e[t]=r[t])})(e,r)};return function(e,r){function t(){this.constructor=e}o(e,r),e.prototype=null===r?Object.create(r):(t.prototype=r.prototype,new t)}}();import SeriesRegistry from"../../../Core/Series/SeriesRegistry.js";var SMAIndicator=SeriesRegistry.seriesTypes.sma;import U from"../../../Core/Utilities.js";var extend=U.extend,merge=U.merge,error=U.error,isArray=U.isArray;function sumArray(e){return e.reduce(function(e,r){return e+r})}function toFixed(e,r){return parseFloat(e.toFixed(r))}function calculateTypicalPrice(e){return(e[1]+e[2]+e[3])/3}function calculateRawMoneyFlow(e,r){return e*r}var MFIIndicator=function(r){function e(){var e=null!==r&&r.apply(this,arguments)||this;return e.data=void 0,e.options=void 0,e.points=void 0,e}return __extends(e,r),e.prototype.getValues=function(e,r){var t,o,i,a,n=r.period,s=e.xData,u=e.yData,c=u?u.length:0,l=r.decimals,p=1,y=e.chart.get(r.volumeSeriesID),d=y&&y.yData,f=[],h=!1,m=[],v=[],I=[],x=[];if(y){if(!(s.length<=n)&&isArray(u[0])&&4===u[0].length&&d){for(t=calculateTypicalPrice(u[p]);p<n+1;)h=t<=(t=calculateTypicalPrice(u[p])),o=calculateRawMoneyFlow(t,d[p]),I.push(h?o:0),x.push(h?0:o),p++;for(a=p-1;a<c;a++)p-1<a&&(I.shift(),x.shift(),h=t<(t=calculateTypicalPrice(u[a])),o=calculateRawMoneyFlow(t,d[a]),I.push(h?o:0),x.push(h?0:o)),i=sumArray(x),i=toFixed(100-100/(1+sumArray(I)/i),l),f.push([s[a],i]),m.push(s[a]),v.push(i);return{values:f,xData:m,yData:v}}}else error("Series "+r.volumeSeriesID+" not found! Check `volumeSeriesID`.",!0,e.chart)},e.defaultOptions=merge(SMAIndicator.defaultOptions,{params:{index:void 0,volumeSeriesID:"volume",decimals:4}}),e}(SMAIndicator);extend(MFIIndicator.prototype,{nameBase:"Money Flow Index"}),SeriesRegistry.registerSeriesType("mfi",MFIIndicator);export default MFIIndicator;