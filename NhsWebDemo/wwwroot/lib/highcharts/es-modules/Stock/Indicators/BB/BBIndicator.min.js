"use strict";var __extends=this&&this.__extends||function(){var i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)e.hasOwnProperty(o)&&(t[o]=e[o])})(t,e)};return function(t,e){function o(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}}();import MultipleLinesComposition from"../MultipleLinesComposition.js";import SeriesRegistry from"../../../Core/Series/SeriesRegistry.js";var SMAIndicator=SeriesRegistry.seriesTypes.sma;import U from"../../../Core/Utilities.js";var extend=U.extend,isArray=U.isArray,merge=U.merge;function getStandardDeviation(t,e,o,i){for(var r,n=0,s=t.length,a=0;a<s;a++)n+=(r=(o?t[a][e]:t[a])-i)*r;return n/=s-1,Math.sqrt(n)}var BBIndicator=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.data=void 0,t.options=void 0,t.points=void 0,t}return __extends(t,e),t.prototype.init=function(){SeriesRegistry.seriesTypes.sma.prototype.init.apply(this,arguments),this.options=merge({topLine:{styles:{lineColor:this.color}},bottomLine:{styles:{lineColor:this.color}}},this.options)},t.prototype.getValues=function(t,e){var o,i,r,n,s,a,p=e.period,l=e.standardDeviation,d=t.xData,y=t.yData,m=y?y.length:0,c=[],u=[],f=[];if(!(d.length<p)){for(n=isArray(y[0]),a=p;a<=m;a++)i=d.slice(a-p,a),r=y.slice(a-p,a),o=(s=SeriesRegistry.seriesTypes.sma.prototype.getValues.call(this,{xData:i,yData:r},e)).xData[0],i=s.yData[0],s=getStandardDeviation(r,e.index,n,i),c.push([o,r=i+l*s,i,s=i-l*s]),u.push(o),f.push([r,i,s]);return{values:c,xData:u,yData:f}}},t.defaultOptions=merge(SMAIndicator.defaultOptions,{params:{period:20,standardDeviation:2,index:3},bottomLine:{styles:{lineWidth:1,lineColor:void 0}},topLine:{styles:{lineWidth:1,lineColor:void 0}},tooltip:{pointFormat:'<span style="color:{point.color}">‚óè</span><b> {series.name}</b><br/>Top: {point.top}<br/>Middle: {point.middle}<br/>Bottom: {point.bottom}<br/>'},marker:{enabled:!1},dataGrouping:{approximation:"averages"}}),t}(SMAIndicator);extend(BBIndicator.prototype,{areaLinesNames:["top","bottom"],pointArrayMap:["top","middle","bottom"],pointValKey:"middle",nameComponents:["period","standardDeviation"],linesApiNames:["topLine","bottomLine"]}),MultipleLinesComposition.compose(BBIndicator),SeriesRegistry.registerSeriesType("bb",BBIndicator);export default BBIndicator;