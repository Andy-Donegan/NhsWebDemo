"use strict";var __extends=this&&this.__extends||function(){var r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)e.hasOwnProperty(o)&&(t[o]=e[o])})(t,e)};return function(t,e){function o(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}}();import MultipleLinesComposition from"../MultipleLinesComposition.js";import SeriesRegistry from"../../../Core/Series/SeriesRegistry.js";var SMAIndicator=SeriesRegistry.seriesTypes.sma;import U from"../../../Core/Utilities.js";var correctFloat=U.correctFloat,extend=U.extend,merge=U.merge;function getBaseForBand(t,e,o){return correctFloat(e-t)/(correctFloat(e+t)/2)*1e3*o}function getPointUB(t,e){return t*correctFloat(1+2*e)}function getPointLB(t,e){return t*correctFloat(1-2*e)}var ABandsIndicator=function(x){function t(){var t=null!==x&&x.apply(this,arguments)||this;return t.data=void 0,t.options=void 0,t.points=void 0,t}return __extends(t,x),t.prototype.getValues=function(t,e){var o,r,i,a,n,s=e.period,p=e.factor,c=e.index,d=t.xData,l=t.yData,u=l?l.length:0,y=[],m=[],f=[],g=[],h=[];if(!(u<s)){for(n=0;n<=u;n++)n<u&&(r=getBaseForBand(l[n][2],l[n][1],p),y.push(getPointUB(l[n][1],r)),m.push(getPointLB(l[n][2],r))),s<=n&&(i=d.slice(n-s,n),a=l.slice(n-s,n),o=x.prototype.getValues.call(this,{xData:i,yData:y.slice(n-s,n)},{period:s}),r=x.prototype.getValues.call(this,{xData:i,yData:m.slice(n-s,n)},{period:s}),a=(i=x.prototype.getValues.call(this,{xData:i,yData:a},{period:s,index:c})).xData[0],o=o.yData[0],r=r.yData[0],i=i.yData[0],f.push([a,o,i,r]),g.push(a),h.push([o,i,r]));return{values:f,xData:g,yData:h}}},t.defaultOptions=merge(SMAIndicator.defaultOptions,{params:{period:20,factor:.001,index:3},lineWidth:1,topLine:{styles:{lineWidth:1}},bottomLine:{styles:{lineWidth:1}},dataGrouping:{approximation:"averages"}}),t}(SMAIndicator);extend(ABandsIndicator.prototype,{areaLinesNames:["top","bottom"],linesApiNames:["topLine","bottomLine"],nameBase:"Acceleration Bands",nameComponents:["period","factor"],pointArrayMap:["top","middle","bottom"],pointValKey:"middle"}),MultipleLinesComposition.compose(ABandsIndicator),SeriesRegistry.registerSeriesType("abands",ABandsIndicator);export default ABandsIndicator;