"use strict";import D from"../Core/DefaultOptions.js";var defaultOptions=D.defaultOptions;import H from"../Core/Globals.js";var doc=H.doc;import U from"../Core/Utilities.js";var addEvent=U.addEvent,extend=U.extend,fireEvent=U.fireEvent,merge=U.merge;import A11yI18n from"./A11yI18n.js";import ContainerComponent from"./Components/ContainerComponent.js";import FocusBorder from"./FocusBorder.js";import InfoRegionsComponent from"./Components/InfoRegionsComponent.js";import KeyboardNavigation from"./KeyboardNavigation.js";import LegendComponent from"./Components/LegendComponent.js";import MenuComponent from"./Components/MenuComponent.js";import NewDataAnnouncer from"./Components/SeriesComponent/NewDataAnnouncer.js";import ProxyProvider from"./ProxyProvider.js";import RangeSelectorComponent from"./Components/RangeSelectorComponent.js";import SeriesComponent from"./Components/SeriesComponent/SeriesComponent.js";import ZoomComponent from"./Components/ZoomComponent.js";import whcm from"./HighContrastMode.js";import highContrastTheme from"./HighContrastTheme.js";import defaultOptionsA11Y from"./Options/Options.js";import defaultLangOptions from"./Options/LangOptions.js";import copyDeprecatedOptions from"./Options/DeprecatedOptions.js";var Accessibility=function(){function t(t){this.chart=void 0,this.components=void 0,this.keyboardNavigation=void 0,this.proxyProvider=void 0,this.init(t)}return t.prototype.init=function(t){if(this.chart=t,!doc.addEventListener||!t.renderer.isSVG)return this.zombie=!0,this.components={},void t.renderTo.setAttribute("aria-hidden",!0);copyDeprecatedOptions(t),this.proxyProvider=new ProxyProvider(this.chart),this.initComponents(),this.keyboardNavigation=new KeyboardNavigation(t,this.components)},t.prototype.initComponents=function(){var e=this.chart,o=this.proxyProvider,t=e.options.accessibility;this.components={container:new ContainerComponent,infoRegions:new InfoRegionsComponent,legend:new LegendComponent,chartMenu:new MenuComponent,rangeSelector:new RangeSelectorComponent,series:new SeriesComponent,zoom:new ZoomComponent},t.customComponents&&extend(this.components,t.customComponents);var n=this.components;this.getComponentOrder().forEach(function(t){n[t].initBase(e,o),n[t].init()})},t.prototype.getComponentOrder=function(){if(!this.components)return[];if(!this.components.series)return Object.keys(this.components);var t=Object.keys(this.components).filter(function(t){return"series"!==t});return["series"].concat(t)},t.prototype.update=function(){var e=this.components,o=this.chart,t=o.options.accessibility;fireEvent(o,"beforeA11yUpdate"),o.types=this.getChartTypes();t=t.keyboardNavigation.order;this.proxyProvider.updateGroupOrder(t),this.getComponentOrder().forEach(function(t){e[t].onChartUpdate(),fireEvent(o,"afterA11yComponentUpdate",{name:t,component:e[t]})}),this.keyboardNavigation.update(t),!o.highContrastModeActive&&whcm.isHighContrastModeActive()&&whcm.setHighContrastTheme(o),fireEvent(o,"afterA11yUpdate",{accessibility:this})},t.prototype.destroy=function(){var t=this.chart||{},e=this.components;Object.keys(e).forEach(function(t){e[t].destroy(),e[t].destroyBase()}),this.proxyProvider&&this.proxyProvider.destroy(),this.keyboardNavigation&&this.keyboardNavigation.destroy(),t.renderTo&&t.renderTo.setAttribute("aria-hidden",!0),t.focusElement&&t.focusElement.removeFocusBorder()},t.prototype.getChartTypes=function(){var e={};return this.chart.series.forEach(function(t){e[t.type]=1}),Object.keys(e)},t}();!function(o){var a=[];function p(){this.accessibility&&this.accessibility.destroy()}function c(){this.a11yDirty&&this.renderTo&&(delete this.a11yDirty,this.updateA11yEnabled());var e=this.accessibility;e&&!e.zombie&&(e.proxyProvider.updateProxyElementPositions(),e.getComponentOrder().forEach(function(t){e.components[t].onChartRender()}))}function m(t){t=t.options.accessibility;t&&(t.customComponents&&(this.options.accessibility.customComponents=t.customComponents,delete t.customComponents),merge(!0,this.options.accessibility,t),this.accessibility&&this.accessibility.destroy&&(this.accessibility.destroy(),delete this.accessibility)),this.a11yDirty=!0}function d(){var t=this.accessibility,e=this.options.accessibility;e&&e.enabled?t&&!t.zombie?t.update():(this.accessibility=t=new o(this),t&&!t.zombie&&t.update()):t?(t.destroy&&t.destroy(),delete this.accessibility):this.renderTo.setAttribute("aria-hidden",!0)}function h(){this.series.chart.accessibility&&(this.series.chart.a11yDirty=!0)}o.i18nFormat=A11yI18n.i18nFormat,o.compose=function(t,e,o,n,i,s,r){KeyboardNavigation.compose(e),NewDataAnnouncer.compose(i),LegendComponent.compose(e,o),MenuComponent.compose(e),SeriesComponent.compose(e,n,i),ZoomComponent.compose(t),A11yI18n.compose(e),FocusBorder.compose(e,s),r&&RangeSelectorComponent.compose(e,r),-1===a.indexOf(e)&&(a.push(e),e.prototype.updateA11yEnabled=d,addEvent(e,"destroy",p),addEvent(e,"render",c),addEvent(e,"update",m),["addSeries","init"].forEach(function(t){addEvent(e,t,function(){this.a11yDirty=!0})}),["afterDrilldown","drillupall"].forEach(function(t){addEvent(e,t,function(){var t=this.accessibility;t&&!t.zombie&&t.update()})})),-1===a.indexOf(n)&&(a.push(n),addEvent(n,"update",h)),-1===a.indexOf(i)&&(a.push(i),["update","updatedData","remove"].forEach(function(t){addEvent(i,t,function(){this.chart.accessibility&&(this.chart.a11yDirty=!0)})}))}}(Accessibility=Accessibility||{}),merge(!0,defaultOptions,defaultOptionsA11Y,{accessibility:{highContrastTheme:highContrastTheme},lang:defaultLangOptions});export default Accessibility;