"use strict";var __extends=this&&this.__extends||function(){var o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)};return function(t,e){function n(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}}();import RangeSelector from"../../Extensions/RangeSelector.js";import AccessibilityComponent from"../AccessibilityComponent.js";import ChartUtilities from"../Utils/ChartUtilities.js";var unhideChartElementFromAT=ChartUtilities.unhideChartElementFromAT,getAxisRangeDescription=ChartUtilities.getAxisRangeDescription;import Announcer from"../Utils/Announcer.js";import KeyboardNavigationHandler from"../KeyboardNavigationHandler.js";import U from"../../Core/Utilities.js";var addEvent=U.addEvent,attr=U.attr;function shouldRunInputNavigation(t){return Boolean(t.rangeSelector&&t.rangeSelector.inputGroup&&"hidden"!==t.rangeSelector.inputGroup.element.style.visibility&&!1!==t.options.rangeSelector.inputEnabled&&t.rangeSelector.minInput&&t.rangeSelector.maxInput)}var RangeSelectorComponent=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.announcer=void 0,t}return __extends(t,e),t.prototype.init=function(){var t=this.chart;this.announcer=new Announcer(t,"polite")},t.prototype.onChartUpdate=function(){var n=this.chart,o=this,r=n.rangeSelector;r&&(this.updateSelectorVisibility(),this.setDropdownAttrs(),r.buttons&&r.buttons.length&&r.buttons.forEach(function(t){o.setRangeButtonAttrs(t)}),r.maxInput&&r.minInput&&["minInput","maxInput"].forEach(function(t,e){t=r[t];t&&(unhideChartElementFromAT(n,t),o.setRangeInputAttrs(t,"accessibility.rangeSelector."+(e?"max":"min")+"InputLabel"))}))},t.prototype.updateSelectorVisibility=function(){function e(t){return t.setAttribute("aria-hidden",!0)}var n=this.chart,t=n.rangeSelector,o=t&&t.dropdown,r=t&&t.buttons||[];t&&t.hasVisibleDropdown&&o?(unhideChartElementFromAT(n,o),r.forEach(function(t){return e(t.element)})):(o&&e(o),r.forEach(function(t){return unhideChartElementFromAT(n,t.element)}))},t.prototype.setDropdownAttrs=function(){var t=this.chart,e=t.rangeSelector&&t.rangeSelector.dropdown;e&&(t=t.langFormat("accessibility.rangeSelector.dropdownLabel",{rangeTitle:t.options.lang.rangeSelectorZoom}),e.setAttribute("aria-label",t),e.setAttribute("tabindex",-1))},t.prototype.setRangeButtonAttrs=function(t){attr(t.element,{tabindex:-1,role:"button"})},t.prototype.setRangeInputAttrs=function(t,e){var n=this.chart;attr(t,{tabindex:-1,"aria-label":n.langFormat(e,{chart:n})})},t.prototype.onButtonNavKbdArrowKey=function(t,e){var n=t.response,o=this.keyCodes,r=this.chart,i=r.options.accessibility.keyboardNavigation.wrapAround,o=e===o.left||e===o.up?-1:1;return r.highlightRangeSelectorButton(r.highlightedRangeSelectorItemIx+o)?n.success:i?(t.init(o),n.success):n[0<o?"next":"prev"]},t.prototype.onButtonNavKbdClick=function(t){var e=t.response,t=this.chart;return 3===t.oldRangeSelectorItemState||this.fakeClickEvent(t.rangeSelector.buttons[t.highlightedRangeSelectorItemIx].element),e.success},t.prototype.onAfterBtnClick=function(){var t=this.chart,e=getAxisRangeDescription(t.xAxis[0]),e=t.langFormat("accessibility.rangeSelector.clickButtonAnnouncement",{chart:t,axisRangeDescription:e});e&&this.announcer.announce(e)},t.prototype.onInputKbdMove=function(t){var e=this.chart,n=e.rangeSelector,o=e.highlightedInputRangeIx=(e.highlightedInputRangeIx||0)+t;1<o||o<0?e.accessibility&&(e.accessibility.keyboardNavigation.tabindexContainer.focus(),e.accessibility.keyboardNavigation[t<0?"prev":"next"]()):n&&(t=n[o?"maxDateBox":"minDateBox"],o=n[o?"maxInput":"minInput"],t&&o&&e.setFocusToElement(t,o))},t.prototype.onInputNavInit=function(t){var e,n,o=this,r=this,i=this.chart,a=0<t?0:1,s=i.rangeSelector,c=s&&s[a?"maxDateBox":"minDateBox"],u=s&&s.minInput,t=s&&s.maxInput,s=a?t:u;i.highlightedInputRangeIx=a,c&&u&&t&&(i.setFocusToElement(c,s),this.removeInputKeydownHandler&&this.removeInputKeydownHandler(),e=addEvent(u,"keydown",u=function(t){(t.which||t.keyCode)===o.keyCodes.tab&&(t.preventDefault(),t.stopPropagation(),r.onInputKbdMove(t.shiftKey?-1:1))}),n=addEvent(t,"keydown",u),this.removeInputKeydownHandler=function(){e(),n()})},t.prototype.onInputNavTerminate=function(){var t=this.chart.rangeSelector||{};t.maxInput&&t.hideInput("max"),t.minInput&&t.hideInput("min"),this.removeInputKeydownHandler&&(this.removeInputKeydownHandler(),delete this.removeInputKeydownHandler)},t.prototype.initDropdownNav=function(){var o=this,r=this.chart,t=r.rangeSelector,e=t&&t.dropdown;t&&e&&(r.setFocusToElement(t.buttonGroup,e),this.removeDropdownKeydownHandler&&this.removeDropdownKeydownHandler(),this.removeDropdownKeydownHandler=addEvent(e,"keydown",function(t){var e=(t.which||t.keyCode)===o.keyCodes.tab,n=r.accessibility;e&&(t.preventDefault(),t.stopPropagation(),n&&(n.keyboardNavigation.tabindexContainer.focus(),n.keyboardNavigation[t.shiftKey?"prev":"next"]()))}))},t.prototype.getRangeSelectorButtonNavigation=function(){var n=this.chart,t=this.keyCodes,o=this;return new KeyboardNavigationHandler(n,{keyCodeMap:[[[t.left,t.right,t.up,t.down],function(t){return o.onButtonNavKbdArrowKey(this,t)}],[[t.enter,t.space],function(){return o.onButtonNavKbdClick(this)}]],validate:function(){return!!(n.rangeSelector&&n.rangeSelector.buttons&&n.rangeSelector.buttons.length)},init:function(t){var e=n.rangeSelector;e&&e.hasVisibleDropdown?o.initDropdownNav():e&&(e=e.buttons.length-1,n.highlightRangeSelectorButton(0<t?0:e))},terminate:function(){o.removeDropdownKeydownHandler&&(o.removeDropdownKeydownHandler(),delete o.removeDropdownKeydownHandler)}})},t.prototype.getRangeSelectorInputNavigation=function(){var t=this.chart,e=this;return new KeyboardNavigationHandler(t,{keyCodeMap:[],validate:function(){return shouldRunInputNavigation(t)},init:function(t){e.onInputNavInit(t)},terminate:function(){e.onInputNavTerminate()}})},t.prototype.getKeyboardNavigation=function(){return[this.getRangeSelectorButtonNavigation(),this.getRangeSelectorInputNavigation()]},t.prototype.destroy=function(){this.removeDropdownKeydownHandler&&this.removeDropdownKeydownHandler(),this.removeInputKeydownHandler&&this.removeInputKeydownHandler(),this.announcer&&this.announcer.destroy()},t}(AccessibilityComponent);!function(t){var n=[];function o(t){var e=this.rangeSelector&&this.rangeSelector.buttons||[],n=this.highlightedRangeSelectorItemIx,o=this.rangeSelector&&this.rangeSelector.selected;return void 0!==n&&e[n]&&n!==o&&e[n].setState(this.oldRangeSelectorItemState||0),!!e[this.highlightedRangeSelectorItemIx=t]&&(this.setFocusToElement(e[t].box,e[t].element),t!==o&&(this.oldRangeSelectorItemState=e[t].state,e[t].setState(1)),!0)}function r(){var t=this.chart.accessibility;if(t&&t.components.rangeSelector)return t.components.rangeSelector.onAfterBtnClick()}t.compose=function(t,e){-1===n.indexOf(t)&&(n.push(t),t.prototype.highlightRangeSelectorButton=o),-1===n.indexOf(e)&&(n.push(e),addEvent(RangeSelector,"afterBtnClick",r))}}(RangeSelectorComponent=RangeSelectorComponent||{});export default RangeSelectorComponent;