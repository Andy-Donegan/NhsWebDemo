"use strict";import AnnotationsA11y from"../AnnotationsA11y.js";var getPointAnnotationTexts=AnnotationsA11y.getPointAnnotationTexts;import ChartUtilities from"../../Utils/ChartUtilities.js";var getAxisDescription=ChartUtilities.getAxisDescription,getSeriesFirstPointElement=ChartUtilities.getSeriesFirstPointElement,getSeriesA11yElement=ChartUtilities.getSeriesA11yElement,unhideChartElementFromAT=ChartUtilities.unhideChartElementFromAT;import F from"../../../Core/FormatUtilities.js";var format=F.format,numberFormat=F.numberFormat;import HTMLUtilities from"../../Utils/HTMLUtilities.js";var reverseChildNodes=HTMLUtilities.reverseChildNodes,stripHTMLTags=HTMLUtilities.stripHTMLTagsFromString;import U from"../../../Core/Utilities.js";var find=U.find,isNumber=U.isNumber,pick=U.pick,defined=U.defined;function findFirstPointWithGraphic(i){var e=i.index;return i.series&&i.series.data&&defined(e)&&find(i.series.data,function(i){return!!(i&&void 0!==i.index&&i.index>e&&i.graphic&&i.graphic.element)})||null}function shouldAddDummyPoint(i){var e=i.series&&i.series.is("sunburst");return i.isNull&&!e}function makeDummyElement(i,e){e=i.series.chart.renderer.rect(e.x,e.y,1,1);return e.attr({class:"highcharts-a11y-dummy-point",fill:"none",opacity:0,"fill-opacity":0,"stroke-opacity":0}),e}function addDummyPointElement(i){var e=i.series,t=findFirstPointWithGraphic(i),s=t&&t.graphic,e=s?s.parentGroup:e.graph||e.group,t=makeDummyElement(i,t?{x:pick(i.plotX,t.plotX,0),y:pick(i.plotY,t.plotY,0)}:{x:pick(i.plotX,0),y:pick(i.plotY,0)});if(e&&e.element)return i.graphic=t,i.hasDummyGraphic=!0,t.add(e),e.element.insertBefore(t.element,s?s.element:null),t.element}function hasMorePointsThanDescriptionThreshold(i){var e=i.chart.options.accessibility.series.pointDescriptionEnabledThreshold;return!!(!1!==e&&i.points&&i.points.length>=e)}function shouldSetScreenReaderPropsOnPoints(i){var e=i.options.accessibility||{};return!hasMorePointsThanDescriptionThreshold(i)&&!e.exposeAsGroupOnly}function shouldSetKeyboardNavPropsOnPoints(i){var e=i.chart.options.accessibility.keyboardNavigation.seriesNavigation;return!(!i.points||!(i.points.length<e.pointNavigationEnabledThreshold||!1===e.pointNavigationEnabledThreshold))}function shouldDescribeSeriesElement(i){var e=i.chart,t=e.options.chart,s=t.options3d&&t.options3d.enabled,r=1<e.series.length,t=e.options.accessibility.series.describeSingleSeries,e=(i.options.accessibility||{}).exposeAsGroupOnly;return!(s&&r)&&(r||t||e||hasMorePointsThanDescriptionThreshold(i))}function pointNumberToString(i,e){var t=i.series,s=t.chart,r=s.options.accessibility.point||{},i=t.options.accessibility&&t.options.accessibility.point||{},t=t.tooltipOptions||{},s=s.options.lang;return isNumber(e)?numberFormat(e,i.valueDecimals||r.valueDecimals||t.valueDecimals||-1,s.decimalPoint,s.accessibility.thousandsSep||s.thousandsSep):e}function getSeriesDescriptionText(i){var e=(i.options.accessibility||{}).description;return e&&i.chart.langFormat("accessibility.series.description",{description:e,series:i})||""}function getSeriesAxisDescriptionText(i,e){var t=i[e];return i.chart.langFormat("accessibility.series."+e+"Description",{name:getAxisDescription(t),series:i})}function getPointA11yTimeDescription(i){var e=i.series,t=e.chart,s=e.options.accessibility&&e.options.accessibility.point||{},r=t.options.accessibility.point||{},e=e.xAxis&&e.xAxis.dateTime;if(e){e=e.getXDateFormat(i.x||0,t.options.tooltip.dateTimeLabelFormats),e=s.dateFormatter&&s.dateFormatter(i)||r.dateFormatter&&r.dateFormatter(i)||s.dateFormat||r.dateFormat||e;return t.time.dateFormat(e,i.x||0,void 0)}}function getPointXDescription(i){var e=getPointA11yTimeDescription(i),t=(i.series.xAxis||{}).categories&&defined(i.category)&&(""+i.category).replace("<br/>"," "),s=i.id&&i.id.indexOf("highcharts-")<0,r="x, "+i.x;return i.name||e||t||(s?i.id:r)}function getPointArrayMapValueDescription(t,i,e){var s=i||"",r=e||"";return t.series.pointArrayMap.reduce(function(i,e){return i+(i.length?", ":"")+(e=pointNumberToString(t,pick(t[i=e],t.options[i])),i+": "+s+e+r)},"")}function getPointValue(i){var e=i.series,t=e.chart.options.accessibility.point||{},s=e.chart.options.accessibility&&e.chart.options.accessibility.point||{},r=e.tooltipOptions||{},n=s.valuePrefix||t.valuePrefix||r.valuePrefix||"",t=s.valueSuffix||t.valueSuffix||r.valueSuffix||"",r=pointNumberToString(i,i[void 0!==i.value?"value":"y"]);return i.isNull?e.chart.langFormat("accessibility.series.nullPointValue",{point:i}):e.pointArrayMap?getPointArrayMapValueDescription(i,n,t):n+r+t}function getPointAnnotationDescription(i){var e=i.series.chart,t=getPointAnnotationTexts(i);return t.length?e.langFormat("accessibility.series.pointAnnotationsDescription",{point:i,annotations:t}):""}function getPointValueDescription(i){var e=i.series,t=e.chart,s=e.options.accessibility,r=s&&s.point&&s.point.valueDescriptionFormat||t.options.accessibility.point.valueDescriptionFormat,s=pick(e.xAxis&&e.xAxis.options.accessibility&&e.xAxis.options.accessibility.enabled,!t.angular),e=s?getPointXDescription(i):"",s={point:i,index:defined(i.index)?i.index+1:"",xDescription:e,value:getPointValue(i),separator:s?", ":""};return format(r,s,t)}function defaultPointDescriptionFormatter(i){var e=i.series,t=e.chart,s=getPointValueDescription(i),r=i.options&&i.options.accessibility&&i.options.accessibility.description,r=r?" "+r:"",t=1<t.series.length&&e.name?" "+e.name+".":"",e=getPointAnnotationDescription(i),e=e?" "+e:"";return i.accessibility=i.accessibility||{},(i.accessibility.valueDescription=s)+r+t+e}function setPointScreenReaderAttribs(i,e){var t=i.series,s=t.chart.options.accessibility.point||{},t=t.options.accessibility&&t.options.accessibility.point||{},i=stripHTMLTags(t.descriptionFormatter&&t.descriptionFormatter(i)||s.descriptionFormatter&&s.descriptionFormatter(i)||defaultPointDescriptionFormatter(i));e.setAttribute("role","img"),e.setAttribute("aria-label",i)}function describePointsInSeries(s){var r=shouldSetScreenReaderPropsOnPoints(s),i=shouldSetKeyboardNavPropsOnPoints(s);(r||i)&&s.points.forEach(function(i){var e=i.graphic&&i.graphic.element||shouldAddDummyPoint(i)&&addDummyPointElement(i),t=i.options&&i.options.accessibility&&!1===i.options.accessibility.enabled;e&&(e.setAttribute("tabindex","-1"),s.chart.styledMode||(e.style.outline="none"),r&&!t?setPointScreenReaderAttribs(i,e):e.setAttribute("aria-hidden",!0))})}function defaultSeriesDescriptionFormatter(e){function i(i){return t[i]&&1<t[i].length&&e[i]}var t=e.chart,s=t.types||[],r=getSeriesDescriptionText(e),n=getSeriesAxisDescriptionText(e,"xAxis"),o=getSeriesAxisDescriptionText(e,"yAxis"),a={name:e.name||"",ix:e.index+1,numSeries:t.series&&t.series.length,numPoints:e.points&&e.points.length,series:e},s=1<s.length?"Combination":"";return(t.langFormat("accessibility.series.summary."+e.type+s,a)||t.langFormat("accessibility.series.summary.default"+s,a))+(r?" "+r:"")+(i("yAxis")?" "+o:"")+(i("xAxis")?" "+n:"")}function describeSeriesElement(i,e){var t=i.options.accessibility||{},s=i.chart.options.accessibility,r=s.landmarkVerbosity;t.exposeAsGroupOnly?e.setAttribute("role","img"):"all"===r&&e.setAttribute("role","region"),e.setAttribute("tabindex","-1"),i.chart.styledMode||(e.style.outline="none"),e.setAttribute("aria-label",stripHTMLTags(s.series.descriptionFormatter&&s.series.descriptionFormatter(i)||defaultSeriesDescriptionFormatter(i)))}function describeSeries(i){var e=i.chart,t=getSeriesFirstPointElement(i),s=getSeriesA11yElement(i),r=e.is3d&&e.is3d();s&&(s.lastChild!==t||r||reverseChildNodes(s),describePointsInSeries(i),unhideChartElementFromAT(e,s),shouldDescribeSeriesElement(i)?describeSeriesElement(i,s):s.setAttribute("aria-label",""))}var SeriesDescriber={defaultPointDescriptionFormatter:defaultPointDescriptionFormatter,defaultSeriesDescriptionFormatter:defaultSeriesDescriptionFormatter,describeSeries:describeSeries};export default SeriesDescriber;