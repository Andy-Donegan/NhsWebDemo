"use strict";var __extends=this&&this.__extends||function(){var n=function(t,o){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,o){t.__proto__=o}||function(t,o){for(var e in o)o.hasOwnProperty(e)&&(t[e]=o[e])})(t,o)};return function(t,o){function e(){this.constructor=t}n(t,o),t.prototype=null===o?Object.create(o):(e.prototype=o.prototype,new e)}}();import AccessibilityComponent from"../AccessibilityComponent.js";import ChartUtilities from"../Utils/ChartUtilities.js";var unhideChartElementFromAT=ChartUtilities.unhideChartElementFromAT;import H from"../../Core/Globals.js";var noop=H.noop;import KeyboardNavigationHandler from"../KeyboardNavigationHandler.js";import U from"../../Core/Utilities.js";var attr=U.attr,extend=U.extend,pick=U.pick;function chartHasMapZoom(t){return!!(t.mapZoom&&t.mapNavButtons&&t.mapNavButtons.length)}var ZoomComponent=function(o){function t(){var t=null!==o&&o.apply(this,arguments)||this;return t.focusedMapNavButtonIx=-1,t}return __extends(t,o),t.prototype.init=function(){var o=this,e=this.chart;this.proxyProvider.addGroup("zoom","div"),["afterShowResetZoom","afterDrilldown","drillupall"].forEach(function(t){o.addEvent(e,t,function(){o.updateProxyOverlays()})})},t.prototype.onChartUpdate=function(){var e=this.chart,n=this;e.mapNavButtons&&e.mapNavButtons.forEach(function(t,o){unhideChartElementFromAT(e,t.element),n.setMapNavButtonAttrs(t.element,"accessibility.zoom.mapZoom"+(o?"Out":"In"))})},t.prototype.setMapNavButtonAttrs=function(t,o){var e=this.chart,e=e.langFormat(o,{chart:e});attr(t,{tabindex:-1,role:"button","aria-label":e})},t.prototype.onChartRender=function(){this.updateProxyOverlays()},t.prototype.updateProxyOverlays=function(){var t=this.chart;this.proxyProvider.clearGroup("zoom"),t.resetZoomButton&&this.createZoomProxyButton(t.resetZoomButton,"resetZoomProxyButton",t.langFormat("accessibility.zoom.resetZoomButton",{chart:t})),t.drillUpButton&&this.createZoomProxyButton(t.drillUpButton,"drillUpProxyButton",t.langFormat("accessibility.drillUpButton",{chart:t,buttonText:t.getDrilldownBackText()}))},t.prototype.createZoomProxyButton=function(t,o,e){this[o]=this.proxyProvider.addProxyElement("zoom",{click:t},{"aria-label":e,tabindex:-1})},t.prototype.getMapZoomNavigation=function(){var t=this.keyCodes,o=this.chart,e=this;return new KeyboardNavigationHandler(o,{keyCodeMap:[[[t.up,t.down,t.left,t.right],function(t){return e.onMapKbdArrow(this,t)}],[[t.tab],function(t,o){return e.onMapKbdTab(this,o)}],[[t.space,t.enter],function(){return e.onMapKbdClick(this)}]],validate:function(){return chartHasMapZoom(o)},init:function(t){return e.onMapNavInit(t)}})},t.prototype.onMapKbdArrow=function(t,o){var e=this.keyCodes,n=o===e.up||o===e.down?"yAxis":"xAxis",e=o===e.left||o===e.up?-1:1;return this.chart[n][0].panStep(e),t.response.success},t.prototype.onMapKbdTab=function(t,o){var e=this.chart,n=t.response,t=o.shiftKey,o=t&&!this.focusedMapNavButtonIx||!t&&this.focusedMapNavButtonIx;if(e.mapNavButtons[this.focusedMapNavButtonIx].setState(0),o)return e.mapZoom(),n[t?"prev":"next"];this.focusedMapNavButtonIx+=t?-1:1;t=e.mapNavButtons[this.focusedMapNavButtonIx];return e.setFocusToElement(t.box,t.element),t.setState(2),n.success},t.prototype.onMapKbdClick=function(t){var o=this.chart.mapNavButtons[this.focusedMapNavButtonIx].element;return this.fakeClickEvent(o),t.response.success},t.prototype.onMapNavInit=function(t){var o=this.chart,e=o.mapNavButtons[0],n=o.mapNavButtons[1],n=0<t?e:n;o.setFocusToElement(n.box,n.element),n.setState(2),this.focusedMapNavButtonIx=0<t?0:1},t.prototype.simpleButtonNavigation=function(t,o,e){var n=this.keyCodes,r=this,a=this.chart;return new KeyboardNavigationHandler(a,{keyCodeMap:[[[n.tab,n.up,n.down,n.left,n.right],function(t,o){t=t===n.tab&&o.shiftKey||t===n.left||t===n.up;return this.response[t?"prev":"next"]}],[[n.space,n.enter],function(){var t=e(this,a);return pick(t,this.response.success)}]],validate:function(){return a[t]&&a[t].box&&r[o].buttonElement},init:function(){a.setFocusToElement(a[t].box,r[o].buttonElement)}})},t.prototype.getKeyboardNavigation=function(){return[this.simpleButtonNavigation("resetZoomButton","resetZoomProxyButton",function(t,o){o.zoomOut()}),this.simpleButtonNavigation("drillUpButton","drillUpProxyButton",function(t,o){return o.drillUp(),t.response.prev}),this.getMapZoomNavigation()]},t}(AccessibilityComponent);!function(o){function e(t,o){var e=o||3,n=this.getExtremes(),r=(n.max-n.min)/e*t,o=n.max+r,e=n.min+r,r=o-e;t<0&&e<n.dataMin?o=(e=n.dataMin)+r:0<t&&o>n.dataMax&&(e=(o=n.dataMax)-r),this.setExtremes(e,o)}o.composedClasses=[],o.compose=function(t){-1===o.composedClasses.indexOf(t)&&(o.composedClasses.push(t),t.prototype.panStep=e)}}(ZoomComponent=ZoomComponent||{});export default ZoomComponent;