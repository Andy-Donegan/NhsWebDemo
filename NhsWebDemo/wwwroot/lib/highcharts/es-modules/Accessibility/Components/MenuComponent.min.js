"use strict";var __extends=this&&this.__extends||function(){var n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)e.hasOwnProperty(o)&&(t[o]=e[o])})(t,e)};return function(t,e){function o(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}}();import Chart from"../../Core/Chart/Chart.js";import U from"../../Core/Utilities.js";var attr=U.attr;import AccessibilityComponent from"../AccessibilityComponent.js";import KeyboardNavigationHandler from"../KeyboardNavigationHandler.js";import ChartUtilities from"../Utils/ChartUtilities.js";var getChartTitle=ChartUtilities.getChartTitle,unhideChartElementFromAT=ChartUtilities.unhideChartElementFromAT;import HTMLUtilities from"../Utils/HTMLUtilities.js";var getFakeMouseEvent=HTMLUtilities.getFakeMouseEvent;function getExportMenuButtonElement(t){return t.exportSVGElements&&t.exportSVGElements[0]}function exportingShouldHaveA11y(t){var e=t.options.exporting,t=getExportMenuButtonElement(t);return!!(e&&!1!==e.enabled&&e.accessibility&&e.accessibility.enabled&&t&&t.element)}var MenuComponent=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.init=function(){var t=this.chart,e=this;this.addEvent(t,"exportMenuShown",function(){e.onMenuShown()}),this.addEvent(t,"exportMenuHidden",function(){e.onMenuHidden()}),this.createProxyGroup()},e.prototype.onMenuHidden=function(){var t=this.chart.exportContextMenu;t&&t.setAttribute("aria-hidden","true"),this.isExportMenuShown=!1,this.setExportButtonExpandedState("false")},e.prototype.onMenuShown=function(){var t=this.chart,e=t.exportContextMenu;e&&(this.addAccessibleContextMenuAttribs(),unhideChartElementFromAT(t,e)),this.isExportMenuShown=!0,this.setExportButtonExpandedState("true")},e.prototype.setExportButtonExpandedState=function(t){this.exportButtonProxy&&this.exportButtonProxy.buttonElement.setAttribute("aria-expanded",t)},e.prototype.onChartRender=function(){var t=this.chart,e=t.focusElement,o=t.accessibility;this.proxyProvider.clearGroup("chartMenu"),this.proxyMenuButton(),this.exportButtonProxy&&e&&e===t.exportingGroup&&(e.focusBorder?t.setFocusToElement(e,this.exportButtonProxy.buttonElement):o&&o.keyboardNavigation.tabindexContainer.focus())},e.prototype.proxyMenuButton=function(){var t=this.chart,e=this.proxyProvider,o=getExportMenuButtonElement(t);exportingShouldHaveA11y(t)&&o&&(this.exportButtonProxy=e.addProxyElement("chartMenu",{click:o},{"aria-label":t.langFormat("accessibility.exporting.menuButtonLabel",{chart:t,chartTitle:getChartTitle(t)}),"aria-expanded":!1}))},e.prototype.createProxyGroup=function(){this.chart&&this.proxyProvider&&this.proxyProvider.addGroup("chartMenu","div")},e.prototype.addAccessibleContextMenuAttribs=function(){var t=this.chart,e=t.exportDivElements;e&&e.length&&(e.forEach(function(t){t&&("LI"!==t.tagName||t.children&&t.children.length?t.setAttribute("aria-hidden","true"):t.setAttribute("tabindex",-1))}),(e=e[0]&&e[0].parentNode)&&attr(e,{"aria-hidden":void 0,"aria-label":t.langFormat("accessibility.exporting.chartMenuLabel",{chart:t}),role:"list"}))},e.prototype.getKeyboardNavigation=function(){var t=this.keyCodes,o=this.chart,n=this;return new KeyboardNavigationHandler(o,{keyCodeMap:[[[t.left,t.up],function(){return n.onKbdPrevious(this)}],[[t.right,t.down],function(){return n.onKbdNext(this)}],[[t.enter,t.space],function(){return n.onKbdClick(this)}]],validate:function(){return!!o.exporting&&!1!==o.options.exporting.enabled&&!1!==o.options.exporting.accessibility.enabled},init:function(){var t=n.exportButtonProxy,e=n.chart.exportingGroup;t&&e&&o.setFocusToElement(e,t.buttonElement)},terminate:function(){o.hideExportMenu()}})},e.prototype.onKbdPrevious=function(t){for(var e=this.chart,o=e.options.accessibility,n=t.response,r=e.highlightedExportItemIx||0;r--;)if(e.highlightExportItem(r))return n.success;return o.keyboardNavigation.wrapAround?(e.highlightLastExportItem(),n.success):n.prev},e.prototype.onKbdNext=function(t){for(var e=this.chart,o=e.options.accessibility,n=t.response,r=(e.highlightedExportItemIx||0)+1;r<e.exportDivElements.length;++r)if(e.highlightExportItem(r))return n.success;return o.keyboardNavigation.wrapAround?(e.highlightExportItem(0),n.success):n.next},e.prototype.onKbdClick=function(t){var e=this.chart,o=e.exportDivElements[e.highlightedExportItemIx],n=getExportMenuButtonElement(e).element;return this.isExportMenuShown?this.fakeClickEvent(o):(this.fakeClickEvent(n),e.highlightExportItem(0)),t.response.success},e}(AccessibilityComponent);!function(t){var e=[];function o(){var t=getExportMenuButtonElement(this);!t||(t=t.element).onclick&&t.onclick(getFakeMouseEvent("click"))}function n(){var t=this,e=t.exportDivElements;e&&t.exportContextMenu&&(e.forEach(function(t){t&&"highcharts-menu-item"===t.className&&t.onmouseout&&t.onmouseout(getFakeMouseEvent("mouseout"))}),t.highlightedExportItemIx=0,t.exportContextMenu.hideMenu(),t.container.focus())}function r(t){var e=this.exportDivElements&&this.exportDivElements[t],o=this.exportDivElements&&this.exportDivElements[this.highlightedExportItemIx];if(!e||"LI"!==e.tagName||e.children&&e.children.length)return!1;var n=!!(this.renderTo.getElementsByTagName("g")[0]||{}).focus;return e.focus&&n&&e.focus(),o&&o.onmouseout&&o.onmouseout(getFakeMouseEvent("mouseout")),e.onmouseover&&e.onmouseover(getFakeMouseEvent("mouseover")),this.highlightedExportItemIx=t,!0}function i(){if(this.exportDivElements)for(var t=this.exportDivElements.length;t--;)if(this.highlightExportItem(t))return!0;return!1}t.compose=function(t){-1===e.indexOf(t)&&(e.push(t),(t=Chart.prototype).hideExportMenu=n,t.highlightExportItem=r,t.highlightLastExportItem=i,t.showExportMenu=o)}}(MenuComponent=MenuComponent||{});export default MenuComponent;