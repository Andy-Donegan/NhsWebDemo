"use strict";!function(t){"object"==typeof module&&module.exports?module.exports=t.default=t:"function"==typeof define&&define.amd?define("highcharts/indicators/ichimoku-kinko-hyo",["highcharts","highcharts/modules/stock"],function(o){return t(o),t.Highcharts=o,t}):t("undefined"!=typeof Highcharts?Highcharts:void 0)}(function(o){function t(o,t,n,e){o.hasOwnProperty(t)||(o[t]=e.apply(null,n))}t(o=o?o._modules:{},"Stock/Indicators/IKH/IKHIndicator.js",[o["Core/Color/Color.js"],o["Core/Globals.js"],o["Core/Series/SeriesRegistry.js"],o["Core/Utilities.js"]],function(o,i,x,t){function m(o){return{high:o.reduce(function(o,t){return Math.max(o,t[1])},-1/0),low:o.reduce(function(o,t){return Math.min(o,t[2])},1/0)}}function A(o){var t=o.indicator;t.points=o.points,t.nextPoints=o.nextPoints,t.color=o.color,t.options=Y(o.options.senkouSpan.styles,o.gap),t.graph=o.graph,t.fillGraph=!0,x.seriesTypes.sma.prototype.drawGraph.call(t)}var e,n=this&&this.__extends||(e=function(o,t){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(o,t){o.__proto__=t}||function(o,t){for(var n in t)t.hasOwnProperty(n)&&(o[n]=t[n])})(o,t)},function(o,t){function n(){this.constructor=o}e(o,t),o.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),p=o.parse,s=x.seriesTypes.sma,C=t.defined;o=t.extend;var r,P=t.isArray,a=t.isNumber,Y=t.merge,B=t.objectEach;function l(){var o=null!==r&&r.apply(this,arguments)||this;return o.data=void 0,o.options=void 0,o.points=void 0,o.graphCollection=void 0,o.graphsenkouSpan=void 0,o.ikhMap=void 0,o.nextPoints=void 0,o}return i.approximations["ichimoku-averages"]=function(){var n,e=[];return[].forEach.call(arguments,function(o,t){e.push(i.approximations.average(o)),n=!n&&void 0===e[t]}),n?void 0:e},n(l,r=s),l.prototype.init=function(){x.seriesTypes.sma.prototype.init.apply(this,arguments),this.options=Y({tenkanLine:{styles:{lineColor:this.color}},kijunLine:{styles:{lineColor:this.color}},chikouLine:{styles:{lineColor:this.color}},senkouSpanA:{styles:{lineColor:this.color,fill:p(this.color).setOpacity(.5).get()}},senkouSpanB:{styles:{lineColor:this.color,fill:p(this.color).setOpacity(.5).get()}},senkouSpan:{styles:{fill:p(this.color).setOpacity(.2).get()}}},this.options)},l.prototype.toYData=function(o){return[o.tenkanSen,o.kijunSen,o.chikouSpan,o.senkouSpanA,o.senkouSpanB]},l.prototype.translate=function(){var e=this;x.seriesTypes.sma.prototype.translate.apply(e),e.points.forEach(function(n){e.pointArrayMap.forEach(function(o){var t=n[o];a(t)&&(n["plot"+o]=e.yAxis.toPixels(t,!0),n.plotY=n["plot"+o],n.tooltipPos=[n.plotX,n["plot"+o]],n.isNull=!1)})})},l.prototype.drawGraph=function(){var n,o,e=this,t=e.points,i=t.length,p=e.options,s=e.graph,r=e.color,a={options:{gapSize:p.gapSize}},l=e.pointArrayMap.length,h=[[],[],[],[],[],[]],u={tenkanLine:h[0],kijunLine:h[1],chikouLine:h[2],senkouSpanA:h[3],senkouSpanB:h[4],senkouSpan:h[5]},c=[],f=e.options.senkouSpan,k=f.color||f.styles.fill,d=f.negativeColor,g=[[],[]],y=[[],[]],S=0;for(e.ikhMap=u;i--;){for(var v=t[i],m=0;m<l;m++)f=e.pointArrayMap[m],C(v[f])&&h[m].push({plotX:v.plotX,plotY:v["plot"+f],isNull:!1});d&&i!==t.length-1&&(f=u.senkouSpanB.length-1,m={plotX:(v=function(o,t,n,e){if(o&&t&&n&&e){var i=t.plotX-o.plotX;t=t.plotY-o.plotY;var p=e.plotX-n.plotX;e=e.plotY-n.plotY;var s=o.plotX-n.plotX,r=o.plotY-n.plotY;if(n=(-t*s+i*r)/(-p*t+i*e),p=(p*r-e*s)/(-p*t+i*e),0<=n&&n<=1&&0<=p&&p<=1)return{plotX:o.plotX+p*i,plotY:o.plotY+p*t}}return!1}(u.senkouSpanA[f-1],u.senkouSpanA[f],u.senkouSpanB[f-1],u.senkouSpanB[f])).plotX,plotY:v.plotY,isNull:!1,intersectPoint:!0},v&&(u.senkouSpanA.splice(f,0,m),u.senkouSpanB.splice(f,0,m),c.push(f)))}if(B(u,function(o,t){p[t]&&"senkouSpan"!==t&&(e.points=h[S],e.options=Y(p[t].styles,a),e.graph=e["graph"+t],e.fillGraph=!1,e.color=r,x.seriesTypes.sma.prototype.drawGraph.call(e),e["graph"+t]=e.graph),S++}),e.graphCollection&&e.graphCollection.forEach(function(o){e[o].destroy(),delete e[o]}),e.graphCollection=[],d&&u.senkouSpanA[0]&&u.senkouSpanB[0]){for(c.unshift(0),c.push(u.senkouSpanA.length-1),l=0;l<c.length-1;l++){if(f=c[l],v=c[l+1],i=u.senkouSpanB.slice(f,v+1),f=u.senkouSpanA.slice(f,v+1),1<=Math.floor(i.length/2))if(i[v=Math.floor(i.length/2)].plotY===f[v].plotY){for(o=m=v=0;o<i.length;o++)v+=i[o].plotY,m+=f[o].plotY;v=m<v?0:1}else v=i[v].plotY>f[v].plotY?0:1;else v=i[0].plotY>f[0].plotY?0:1;g[v]=g[v].concat(i),y[v]=y[v].concat(f)}["graphsenkouSpanColor","graphsenkouSpanNegativeColor"].forEach(function(o,t){g[t].length&&y[t].length&&(n=0===t?k:d,A({indicator:e,points:g[t],nextPoints:y[t],color:n,options:p,gap:a,graph:e[o]}),e[o]=e.graph,e.graphCollection.push(o))})}else A({indicator:e,points:u.senkouSpanB,nextPoints:u.senkouSpanA,color:k,options:p,gap:a,graph:e.graphsenkouSpan}),e.graphsenkouSpan=e.graph;delete e.nextPoints,delete e.fillGraph,e.points=t,e.options=p,e.graph=s,e.color=r},l.prototype.getGraphPath=function(o){var t=[];if(o=o||this.points,this.fillGraph&&this.nextPoints){if((n=x.seriesTypes.sma.prototype.getGraphPath.call(this,this.nextPoints))&&n.length){n[0][0]="L";for(var n,t=x.seriesTypes.sma.prototype.getGraphPath.call(this,o),e=(n=n.slice(0,t.length)).length-1;0<=e;e--)t.push(n[e])}}else t=x.seriesTypes.sma.prototype.getGraphPath.apply(this,arguments);return t},l.prototype.getValues=function(o,t){var n=t.period,e=t.periodTenkan;t=t.periodSenkouSpanB;var i,p,s,r,a=o.xData,l=o.yData,h=l&&l.length||0;o.xAxis.series.forEach(function(o){if(o.xData)for(s=o.xData,r=o.xIncrement?1:s.length-1;0<r;r--)p=s[r]-s[r-1],(void 0===i||p<i)&&(i=p)}),o=i;var u=[],c=[];if(!(a.length<=n)&&P(l[0])&&4===l[0].length){for(var f,k,d,g,y=a[0]-n*o,S=0;S<n;S++)c.push(y+S*o);for(S=0;S<h;S++){e<=S&&(f=((f=m(f=l.slice(S-e,S))).high+f.low)/2),n<=S&&(d=(f+(k=((k=m(k=l.slice(S-n,S))).high+k.low)/2))/2),t<=S&&(g=((g=m(g=l.slice(S-t,S))).high+g.low)/2);var y=l[S][3],v=a[S];void 0===u[S]&&(u[S]=[]),void 0===u[S+n]&&(u[S+n]=[]),u[S+n][0]=f,u[S+n][1]=k,u[S+n][2]=void 0,u[S][2]=y,S<=n&&(u[S+n][3]=void 0,u[S+n][4]=void 0),void 0===u[S+2*n]&&(u[S+2*n]=[]),u[S+2*n][3]=d,u[S+2*n][4]=g,c.push(v)}for(S=1;S<=n;S++)c.push(v+S*o);return{values:u,xData:c,yData:u}}},l.defaultOptions=Y(s.defaultOptions,{params:{index:void 0,period:26,periodTenkan:9,periodSenkouSpanB:52},marker:{enabled:!1},tooltip:{pointFormat:'<span style="color:{point.color}">‚óè</span> <b> {series.name}</b><br/>TENKAN SEN: {point.tenkanSen:.3f}<br/>KIJUN SEN: {point.kijunSen:.3f}<br/>CHIKOU SPAN: {point.chikouSpan:.3f}<br/>SENKOU SPAN A: {point.senkouSpanA:.3f}<br/>SENKOU SPAN B: {point.senkouSpanB:.3f}<br/>'},tenkanLine:{styles:{lineWidth:1,lineColor:void 0}},kijunLine:{styles:{lineWidth:1,lineColor:void 0}},chikouLine:{styles:{lineWidth:1,lineColor:void 0}},senkouSpanA:{styles:{lineWidth:1,lineColor:void 0}},senkouSpanB:{styles:{lineWidth:1,lineColor:void 0}},senkouSpan:{styles:{fill:"rgba(255, 0, 0, 0.5)"}},dataGrouping:{approximation:"ichimoku-averages"}}),o((t=l).prototype,{pointArrayMap:["tenkanSen","kijunSen","chikouSpan","senkouSpanA","senkouSpanB"],pointValKey:"tenkanSen",nameComponents:["periodSenkouSpanB","period","periodTenkan"]}),x.registerSeriesType("ikh",t),t}),t(o,"masters/indicators/ichimoku-kinko-hyo.src.js",[],function(){})});