"use strict";!function(t){"object"==typeof module&&module.exports?module.exports=t.default=t:"function"==typeof define&&define.amd?define("highcharts/indicators/volume-by-price",["highcharts","highcharts/modules/stock"],function(e){return t(e),t.Highcharts=e,t}):t("undefined"!=typeof Highcharts?Highcharts:void 0)}(function(e){e=e?e._modules:{};function t(e,t,o,i){e.hasOwnProperty(t)||(e[t]=i.apply(null,o))}t(e,"Stock/Indicators/VBP/VBPPoint.js",[e["Core/Series/Point.js"],e["Core/Series/SeriesRegistry.js"]],function(e,t){var i,o,n=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o])})(e,t)},function(e,t){function o(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(o.prototype=t.prototype,new o)}),t=t.seriesTypes.sma;function s(){return null!==o&&o.apply(this,arguments)||this}return o=t.prototype.pointClass,n(s,o),s.prototype.destroy=function(){return this.negativeGraphic&&(this.negativeGraphic=this.negativeGraphic.destroy()),e.prototype.destroy.apply(this,arguments)},s}),t(e,"Stock/Indicators/VBP/VBPIndicator.js",[e["Stock/Indicators/VBP/VBPPoint.js"],e["Core/Animation/AnimationUtilities.js"],e["Core/Globals.js"],e["Core/Series/SeriesRegistry.js"],e["Core/Utilities.js"],e["Core/Chart/StockChart.js"]],function(e,t,s,o,i,r){var n,a=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o])})(e,t)},function(e,t){function o(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(o.prototype=t.prototype,new o)}),p=t.animObject,l=s.noop,t=o.seriesTypes.sma,d=i.addEvent,y=i.arrayMax,m=i.arrayMin,g=i.correctFloat,v=i.defined,u=i.error,h=i.extend,c=i.isArray,i=i.merge;var f,S=Math.abs,V=o.seriesTypes.column.prototype,t=(a(x,f=t),x.prototype.init=function(e){var t,o,i=this;s.seriesTypes.sma.prototype.init.apply(i,arguments);var n=d(r,"afterLinkSeries",function(){i.options&&(o=i.options.params,t=i.linkedParent,o=e.get(o.volumeSeriesID),i.addCustomEvents(t,o)),n()},{order:1});return i},x.prototype.addCustomEvents=function(e,t){var o=this;function i(){o.chart.redraw(),o.setData([]),o.zoneStarts=[],o.zoneLinesSVG&&(o.zoneLinesSVG=o.zoneLinesSVG.destroy())}return o.dataEventsToUnbind.push(d(e,"remove",function(){i()})),t&&o.dataEventsToUnbind.push(d(t,"remove",function(){i()})),o},x.prototype.animate=function(e){var o=this,t=o.chart.inverted,i=o.group,n={};!e&&i&&(e=t?o.yAxis.top:o.xAxis.left,t?(i["forceAnimate:translateY"]=!0,n.translateY=e):(i["forceAnimate:translateX"]=!0,n.translateX=e),i.animate(n,h(p(o.options.animation),{step:function(e,t){o.group.attr({scaleX:Math.max(.001,t.pos)})}})))},x.prototype.drawPoints=function(){var e=this;e.options.volumeDivision.enabled&&(e.posNegVolume(!0,!0),V.drawPoints.apply(e,arguments),e.posNegVolume(!1,!1)),V.drawPoints.apply(e,arguments)},x.prototype.posNegVolume=function(e,t){var o,i,n,s,r=this,a=t?["positive","negative"]:["negative","positive"],p=r.options.volumeDivision,l=r.points.length,d=[],u=[],h=0;for(e?(r.posWidths=d,r.negWidths=u):(d=r.posWidths,u=r.negWidths);h<l;h++)(s=r.points[h])[a[0]+"Graphic"]=s.graphic,s.graphic=s[a[1]+"Graphic"],e&&(o=s.shapeArgs.width,(n=(i=r.priceZones[h]).wholeVolumeData)?(d.push(o/n*i.positiveVolumeData),u.push(o/n*i.negativeVolumeData)):(d.push(0),u.push(0))),s.color=t?p.styles.positiveColor:p.styles.negativeColor,s.shapeArgs.width=(t?r.posWidths:r.negWidths)[h],s.shapeArgs.x=t?s.shapeArgs.x:r.posWidths[h]},x.prototype.translate=function(){var e,o,i,n,s,r,t,a,p,l=this,d=l.options,u=l.chart,h=l.yAxis,c=h.min,f=l.options.zoneLines,m=l.priceZones,v=0;V.translate.apply(l),(e=l.points).length&&(t=d.pointPadding<.5?d.pointPadding:.1,d=l.volumeDataArray,o=y(d),i=u.plotWidth/2,a=u.plotTop,n=S(h.toPixels(c)-h.toPixels(c+l.rangeStep)),s=S(h.toPixels(c)-h.toPixels(c+l.rangeStep)),t&&(t=S(n*(1-2*t)),v=S((n-t)/2),n=S(t)),e.forEach(function(e,t){e.barX=e.plotX=0,p=e.plotY=h.toPixels(m[t].start)-a-(h.reversed?n-s:n)-v,r=g(i*m[t].wholeVolumeData/o),e.pointWidth=r,e.shapeArgs=l.crispCol.apply(l,[0,p,r,n]),e.volumeNeg=m[t].negativeVolumeData,e.volumePos=m[t].positiveVolumeData,e.volumeAll=m[t].wholeVolumeData}),f.enabled&&l.drawZones(u,h,l.zoneStarts,f.styles))},x.prototype.getValues=function(e,t){var o,i,n=e.processedXData,s=e.processedYData,r=this.chart,a=t.ranges,p=[],l=[],d=[];if(e.chart)if(i=r.get(t.volumeSeriesID)){if(!(o=c(s[0]))||4===s[0].length)return(this.priceZones=this.specifyZones(o,n,s,a,i)).forEach(function(e,t){p.push([e.x,e.end]),l.push(p[t][0]),d.push(p[t][1])}),{values:p,xData:l,yData:d};u("Type of "+e.name+" series is different than line, OHLC or candlestick.",!0,r)}else u("Series "+t.volumeSeriesID+" not found! Check `volumeSeriesID`.",!0,r);else u("Base series not found! In case it has been removed, add a new one.",!0,r)},x.prototype.specifyZones=function(e,t,o,i,n){var s,r,a=this,p=!!e&&function(e){for(var t,o=e.length,i=e[0][3],n=i,s=1;s<o;s++)(t=e[s][3])<i&&(i=t),n<t&&(n=t);return{min:i,max:n}}(o),l=p?p.min:m(o),d=p?p.max:y(o),u=a.zoneStarts=[],h=[],c=0,f=1,p=a.linkedParent;if(!a.options.compareToMain&&p.dataModify&&(l=p.dataModify.modifyValue(l),d=p.dataModify.modifyValue(d)),!v(l)||!v(d))return this.points.length&&(this.setData([]),this.zoneStarts=[],this.zoneLinesSVG&&(this.zoneLinesSVG=this.zoneLinesSVG.destroy())),[];for(s=a.rangeStep=g(d-l)/i,u.push(l);c<i-1;c++)u.push(g(u[c]+s));for(u.push(d),r=u.length;f<r;f++)h.push({index:f-1,x:t[0],start:u[f-1],end:u[f]});return a.volumePerZone(e,h,n,t,o)},x.prototype.volumePerZone=function(o,e,t,i,n){var s,r,a,p,l,d=this,u=t.processedXData,h=t.processedYData,c=e.length-1,f=n.length,t=h.length;return S(f-t)&&(i[0]!==u[0]&&h.unshift(0),i[f-1]!==u[t-1]&&h.push(0)),d.volumeDataArray=[],e.forEach(function(e){for(e.wholeVolumeData=0,e.positiveVolumeData=0,e.negativeVolumeData=0,l=0;l<f;l++){a=r=!1,p=o?n[l][3]:n[l],s=l?o?n[l-1][3]:n[l-1]:p;var t=d.linkedParent;!d.options.compareToMain&&t.dataModify&&(p=t.dataModify.modifyValue(p),s=t.dataModify.modifyValue(s)),p<=e.start&&0===e.index&&(r=!0),p>=e.end&&e.index===c&&(a=!0),(p>e.start||r)&&(p<e.end||a)&&(e.wholeVolumeData+=h[l],p<s?e.negativeVolumeData+=h[l]:e.positiveVolumeData+=h[l])}d.volumeDataArray.push(e.wholeVolumeData)}),e},x.prototype.drawZones=function(t,o,e,i){var n,s=t.renderer,r=this.zoneLinesSVG,a=[],p=t.plotWidth,l=t.plotTop;e.forEach(function(e){n=o.toPixels(e)-l,a=a.concat(t.renderer.crispLine([["M",0,n],["L",p,n]],i.lineWidth))}),r?r.animate({d:a}):this.zoneLinesSVG=s.path(a).attr({"stroke-width":i.lineWidth,stroke:i.color,dashstyle:i.dashStyle,zIndex:this.group.zIndex+.1}).add(this.group)},x.defaultOptions=i(t.defaultOptions,{params:{index:void 0,period:void 0,ranges:12,volumeSeriesID:"volume"},zoneLines:{enabled:!0,styles:{color:"#0A9AC9",dashStyle:"LongDash",lineWidth:1}},volumeDivision:{enabled:!0,styles:{positiveColor:"rgba(144, 237, 125, 0.8)",negativeColor:"rgba(244, 91, 91, 0.8)"}},animationLimit:1e3,enableMouseTracking:!1,pointPadding:0,zIndex:-1,crisp:!0,dataGrouping:{enabled:!1},dataLabels:{allowOverlap:!0,enabled:!0,format:"P: {point.volumePos:.2f} | N: {point.volumeNeg:.2f}",padding:0,style:{fontSize:"7px"},verticalAlign:"top"}}),x);function x(){var e=null!==f&&f.apply(this,arguments)||this;return e.data=void 0,e.negWidths=void 0,e.options=void 0,e.points=void 0,e.posWidths=void 0,e.priceZones=void 0,e.rangeStep=void 0,e.volumeDataArray=void 0,e.zoneStarts=void 0,e.zoneLinesSVG=void 0,e}return h(t.prototype,{nameBase:"Volume by Price",nameComponents:["ranges"],calculateOn:{chart:"render",xAxis:"afterSetExtremes"},pointClass:e,markerAttribs:l,drawGraph:l,getColumnMetrics:V.getColumnMetrics,crispCol:V.crispCol}),o.registerSeriesType("vbp",t),t}),t(e,"masters/indicators/volume-by-price.src.js",[],function(){})});