"use strict";!function(t){"object"==typeof module&&module.exports?module.exports=t.default=t:"function"==typeof define&&define.amd?define("highcharts/indicators/volume-by-price",["highcharts","highcharts/modules/stock"],function(e){return t(e),t.Highcharts=e,t}):t("undefined"!=typeof Highcharts?Highcharts:void 0)}(function(e){function t(e,t,o,i){e.hasOwnProperty(t)||(e[t]=i.apply(null,o))}t(e=e?e._modules:{},"Stock/Indicators/VBP/VBPPoint.js",[e["Core/Series/Point.js"],e["Core/Series/SeriesRegistry.js"]],function(e,t){var i,o,s=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o])})(e,t)},function(e,t){function o(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(o.prototype=t.prototype,new o)});return o=t.seriesTypes.sma.prototype.pointClass,s(n,o),n.prototype.destroy=function(){return this.negativeGraphic&&(this.negativeGraphic=this.negativeGraphic.destroy()),e.prototype.destroy.apply(this,arguments)},n;function n(){return null!==o&&o.apply(this,arguments)||this}}),t(e,"Stock/Indicators/VBP/VBPIndicator.js",[e["Stock/Indicators/VBP/VBPPoint.js"],e["Core/Animation/AnimationUtilities.js"],e["Core/Globals.js"],e["Core/Series/SeriesRegistry.js"],e["Core/Utilities.js"],e["Core/Chart/StockChart.js"]],function(e,t,n,o,i,a){var s,r=this&&this.__extends||(s=function(e,t){return(s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o])})(e,t)},function(e,t){function o(){this.constructor=e}s(e,t),e.prototype=null===t?Object.create(t):(o.prototype=t.prototype,new o)}),p=t.animObject;t=n.noop;var l,h=o.seriesTypes.sma,d=i.addEvent,y=i.arrayMax,u=i.arrayMin,g=i.correctFloat,c=i.defined,f=i.error,m=i.extend,v=i.isArray,S=i.merge,V=Math.abs,x=o.seriesTypes.column.prototype;function D(){var e=null!==l&&l.apply(this,arguments)||this;return e.data=void 0,e.negWidths=void 0,e.options=void 0,e.points=void 0,e.posWidths=void 0,e.priceZones=void 0,e.rangeStep=void 0,e.volumeDataArray=void 0,e.zoneStarts=void 0,e.zoneLinesSVG=void 0,e}return r(D,l=h),D.prototype.init=function(e){var t,o,i=this;n.seriesTypes.sma.prototype.init.apply(i,arguments);var s=d(a,"afterLinkSeries",function(){i.options&&(o=i.options.params,t=i.linkedParent,o=e.get(o.volumeSeriesID),i.addCustomEvents(t,o)),s()},{order:1});return i},D.prototype.addCustomEvents=function(e,t){function o(){i.chart.redraw(),i.setData([]),i.zoneStarts=[],i.zoneLinesSVG&&(i.zoneLinesSVG=i.zoneLinesSVG.destroy())}var i=this;return i.dataEventsToUnbind.push(d(e,"remove",function(){o()})),t&&i.dataEventsToUnbind.push(d(t,"remove",function(){o()})),i},D.prototype.animate=function(e){var o=this,t=o.chart.inverted,i=o.group,s={};!e&&i&&(e=t?o.yAxis.top:o.xAxis.left,t?(i["forceAnimate:translateY"]=!0,s.translateY=e):(i["forceAnimate:translateX"]=!0,s.translateX=e),i.animate(s,m(p(o.options.animation),{step:function(e,t){o.group.attr({scaleX:Math.max(.001,t.pos)})}})))},D.prototype.drawPoints=function(){this.options.volumeDivision.enabled&&(this.posNegVolume(!0,!0),x.drawPoints.apply(this,arguments),this.posNegVolume(!1,!1)),x.drawPoints.apply(this,arguments)},D.prototype.posNegVolume=function(e,t){var o,i=t?["positive","negative"]:["negative","positive"],s=this.options.volumeDivision,n=this.points.length,a=[],r=[],p=0;for(e?(this.posWidths=a,this.negWidths=r):(a=this.posWidths,r=this.negWidths);p<n;p++){var l,h,d=this.points[p];d[i[0]+"Graphic"]=d.graphic,d.graphic=d[i[1]+"Graphic"],e&&(l=d.shapeArgs.width,(o=(h=this.priceZones[p]).wholeVolumeData)?(a.push(l/o*h.positiveVolumeData),r.push(l/o*h.negativeVolumeData)):(a.push(0),r.push(0))),d.color=t?s.styles.positiveColor:s.styles.negativeColor,d.shapeArgs.width=(t?this.posWidths:this.negWidths)[p],d.shapeArgs.x=t?d.shapeArgs.x:this.posWidths[p]}},D.prototype.translate=function(){var o,i,s=this,e=s.options,t=s.chart,n=s.yAxis,a=n.min,r=s.options.zoneLines,p=s.priceZones,l=0;x.translate.apply(s);var h,d,u,c,f,m,v=s.points;v.length&&(h=e.pointPadding<.5?e.pointPadding:.1,e=s.volumeDataArray,d=y(e),u=t.plotWidth/2,c=t.plotTop,f=V(n.toPixels(a)-n.toPixels(a+s.rangeStep)),m=V(n.toPixels(a)-n.toPixels(a+s.rangeStep)),h&&(a=V(f*(1-2*h)),l=V((f-a)/2),f=V(a)),v.forEach(function(e,t){e.barX=e.plotX=0,i=e.plotY=n.toPixels(p[t].start)-c-(n.reversed?f-m:f)-l,o=g(u*p[t].wholeVolumeData/d),e.pointWidth=o,e.shapeArgs=s.crispCol.apply(s,[0,i,o,f]),e.volumeNeg=p[t].negativeVolumeData,e.volumePos=p[t].positiveVolumeData,e.volumeAll=p[t].wholeVolumeData}),r.enabled&&s.drawZones(t,n,s.zoneStarts,r.styles))},D.prototype.getValues=function(e,t){var o,i=e.processedXData,s=e.processedYData,n=this.chart,a=t.ranges,r=[],p=[],l=[];if(e.chart)if(o=n.get(t.volumeSeriesID)){if(!(t=v(s[0]))||4===s[0].length)return(this.priceZones=this.specifyZones(t,i,s,a,o)).forEach(function(e,t){r.push([e.x,e.end]),p.push(r[t][0]),l.push(r[t][1])}),{values:r,xData:p,yData:l};f("Type of "+e.name+" series is different than line, OHLC or candlestick.",!0,n)}else f("Series "+t.volumeSeriesID+" not found! Check `volumeSeriesID`.",!0,n);else f("Base series not found! In case it has been removed, add a new one.",!0,n)},D.prototype.specifyZones=function(e,t,o,i,s){if(e){for(var n=o.length,a=o[0][3],r=a,p=1;p<n;p++)(l=o[p][3])<a&&(a=l),r<l&&(r=l);n={min:a,max:r}}else n=!1;var n=(a=n)?a.min:u(o),l=a?a.max:y(o),a=this.zoneStarts=[],r=[],h=0,p=1,d=this.linkedParent;if(!this.options.compareToMain&&d.dataModify&&(n=d.dataModify.modifyValue(n),l=d.dataModify.modifyValue(l)),!c(n)||!c(l))return this.points.length&&(this.setData([]),this.zoneStarts=[],this.zoneLinesSVG&&(this.zoneLinesSVG=this.zoneLinesSVG.destroy())),[];for(d=this.rangeStep=g(l-n)/i,a.push(n);h<i-1;h++)a.push(g(a[h]+d));for(a.push(l),i=a.length;p<i;p++)r.push({index:p-1,x:t[0],start:a[p-1],end:a[p]});return this.volumePerZone(e,r,s,t,o)},D.prototype.volumePerZone=function(o,e,t,i,s){var n,a,r,p,l,h=this,d=t.processedXData,u=t.processedYData,c=e.length-1,f=s.length;return t=u.length,V(f-t)&&(i[0]!==d[0]&&u.unshift(0),i[f-1]!==d[t-1]&&u.push(0)),h.volumeDataArray=[],e.forEach(function(e){for(e.wholeVolumeData=0,e.positiveVolumeData=0,l=e.negativeVolumeData=0;l<f;l++){r=a=!1,p=o?s[l][3]:s[l],n=l?o?s[l-1][3]:s[l-1]:p;var t=h.linkedParent;!h.options.compareToMain&&t.dataModify&&(p=t.dataModify.modifyValue(p),n=t.dataModify.modifyValue(n)),p<=e.start&&0===e.index&&(a=!0),p>=e.end&&e.index===c&&(r=!0),(p>e.start||a)&&(p<e.end||r)&&(e.wholeVolumeData+=u[l],p<n?e.negativeVolumeData+=u[l]:e.positiveVolumeData+=u[l])}h.volumeDataArray.push(e.wholeVolumeData)}),e},D.prototype.drawZones=function(t,o,e,i){var s,n=t.renderer,a=this.zoneLinesSVG,r=[],p=t.plotWidth,l=t.plotTop;e.forEach(function(e){s=o.toPixels(e)-l,r=r.concat(t.renderer.crispLine([["M",0,s],["L",p,s]],i.lineWidth))}),a?a.animate({d:r}):this.zoneLinesSVG=n.path(r).attr({"stroke-width":i.lineWidth,stroke:i.color,dashstyle:i.dashStyle,zIndex:this.group.zIndex+.1}).add(this.group)},D.defaultOptions=S(h.defaultOptions,{params:{index:void 0,period:void 0,ranges:12,volumeSeriesID:"volume"},zoneLines:{enabled:!0,styles:{color:"#0A9AC9",dashStyle:"LongDash",lineWidth:1}},volumeDivision:{enabled:!0,styles:{positiveColor:"rgba(144, 237, 125, 0.8)",negativeColor:"rgba(244, 91, 91, 0.8)"}},animationLimit:1e3,enableMouseTracking:!1,pointPadding:0,zIndex:-1,crisp:!0,dataGrouping:{enabled:!1},dataLabels:{allowOverlap:!0,enabled:!0,format:"P: {point.volumePos:.2f} | N: {point.volumeNeg:.2f}",padding:0,style:{fontSize:"7px"},verticalAlign:"top"}}),m((i=D).prototype,{nameBase:"Volume by Price",nameComponents:["ranges"],calculateOn:{chart:"render",xAxis:"afterSetExtremes"},pointClass:e,markerAttribs:t,drawGraph:t,getColumnMetrics:x.getColumnMetrics,crispCol:x.crispCol}),o.registerSeriesType("vbp",i),i}),t(e,"masters/indicators/volume-by-price.src.js",[],function(){})});