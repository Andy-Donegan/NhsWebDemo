"use strict";!function(e){"object"==typeof module&&module.exports?module.exports=e.default=e:"function"==typeof define&&define.amd?define("highcharts/modules/series-label",["highcharts"],function(t){return e(t),e.Highcharts=t,e}):e("undefined"!=typeof Highcharts?Highcharts:void 0)}(function(t){t=t?t._modules:{};function e(t,e,o,r){t.hasOwnProperty(e)||(t[e]=r.apply(null,o))}e(t,"Extensions/SeriesLabel.js",[t["Core/Animation/AnimationUtilities.js"],t["Core/Chart/Chart.js"],t["Core/FormatUtilities.js"],t["Core/DefaultOptions.js"],t["Core/Series/Series.js"],t["Core/Renderer/SVG/SVGRenderer.js"],t["Core/Utilities.js"]],function(t,e,o,r,i,a,n){var C=t.animObject,P=o.format,o=r.setOptions,r=a.prototype.symbols,a=n.addEvent,L=n.extend,h=n.fireEvent,w=n.isNumber,T=n.pick,s=n.syncTimeout;function l(t,e,o,r,i,a){t=(a-e)*(o-t)-(r-e)*(i-t);return 0<t||!(t<0)}function c(t,e,o,r,i,a,h,n){return l(t,e,i,a,h,n)!==l(o,r,i,a,h,n)&&l(t,e,o,r,i,a)!==l(t,e,o,r,h,n)}function Y(t,e,o,r,i,a,h,n){return c(t,e,t+o,e,i,a,h,n)||c(t+o,e,t+o,e+r,i,a,h,n)||c(t,e+r,t+o,e+r,i,a,h,n)||c(t,e,t,e+r,i,a,h,n)}function p(i){var a,h;this.renderer&&(h=C((a=this).renderer.globalAnimation).duration,a.labelSeries=[],a.labelSeriesMaxSum=0,n.clearTimeout(a.seriesLabelTimer),a.series.forEach(function(t){var e=t.options.label,o=t.labelBySeries,r=o&&o.closest;e.enabled&&t.visible&&(t.graph||t.area)&&!t.isSeriesBoosting&&(a.labelSeries.push(t),e.minFontSize&&e.maxFontSize&&(t.sum=t.yData.reduce(function(t,e){return(t||0)+(e||0)},0),a.labelSeriesMaxSum=Math.max(a.labelSeriesMaxSum,t.sum)),"load"===i.type&&(h=Math.max(h,C(t.options.animation).duration)),r&&(void 0!==r[0].plotX?o.animate({x:r[0].plotX+r[1],y:r[0].plotY+r[2]}):o.attr({opacity:0})))}),a.seriesLabelTimer=s(function(){a.series&&a.labelSeries&&a.drawSeriesLabels()},a.renderer.forExport||!h?0:h))}o({plotOptions:{series:{label:{enabled:!0,connectorAllowed:!1,connectorNeighbourDistance:24,format:void 0,formatter:void 0,minFontSize:null,maxFontSize:null,onArea:null,style:{fontWeight:"bold"},boxesToAvoid:[]}}}}),r.connector=function(t,e,o,r,i){var a,h=i&&i.anchorX,n=i&&i.anchorY,s=o/2;return w(h)&&w(n)&&(a=[["M",h,n]],(i=(i=e-n)<0?-r-i:i)<o&&(s=h<t+o/2?i:o-i),e+r<n?a.push(["L",t+s,e+r]):n<e?a.push(["L",t+s,e]):h<t?a.push(["L",t,e+r/2]):t+o<h&&a.push(["L",t+o,e+r/2])),a||[]},i.prototype.getPointsOnGraph=function(){if(this.xAxis||this.yAxis){var t,e,o,r,i,a,h,n,s,l=this.points,c=[],p=this.graph||this.area,d=p.element,u=this.chart.inverted,f=this.xAxis,x=this.yAxis,b=(u?x:f).pos,m=(u?f:x).pos,g=T(this.options.label.onArea,!!this.area),y=x.getThreshold(this.options.threshold),Y={};if(this.getPointSpline&&d.getPointAtLength&&!g&&l.length<this.chart.plotSizeX/16){for(p.toD&&(s=p.attr("d"),p.attr({d:p.toD})),a=d.getTotalLength(),o=0;o<a;o+=16)X({chartX:b+(t=d.getPointAtLength(o)).x,chartY:m+t.y,plotX:t.x,plotY:t.y});s&&p.attr({d:s}),(t=l[l.length-1]).chartX=b+t.plotX,t.chartY=m+t.plotY,X(t)}else for(a=l.length,o=0;o<a;o+=1){if(t=l[o],e=l[o-1],t.chartX=b+t.plotX,t.chartY=m+t.plotY,g&&(t.chartCenterY=m+(t.plotY+T(t.yBottom,y))/2),0<o&&(r=Math.abs(t.chartX-e.chartX),i=Math.abs(t.chartY-e.chartY),16<(i=Math.max(r,i))))for(h=Math.ceil(i/16),n=1;n<h;n+=1)X({chartX:e.chartX+(t.chartX-e.chartX)*(n/h),chartY:e.chartY+(t.chartY-e.chartY)*(n/h),chartCenterY:e.chartCenterY+(t.chartCenterY-e.chartCenterY)*(n/h),plotX:e.plotX+(t.plotX-e.plotX)*(n/h),plotY:e.plotY+(t.plotY-e.plotY)*(n/h)});w(t.plotY)&&X(t)}return c}function X(t){var e=Math.round(t.plotX/8)+","+Math.round(t.plotY/8);Y[e]||(Y[e]=1,c.push(t))}},i.prototype.labelFontSize=function(t,e){return t+this.sum/this.chart.labelSeriesMaxSum*(e-t)+"px"},i.prototype.checkClearPoint=function(t,e,o,r){var i,a,h,n,s,l,c,p,d,u,f,x=this.chart,b=T(this.options.label.onArea,!!this.area),m=b||this.options.label.connectorAllowed,g=Number.MAX_VALUE,y=Number.MAX_VALUE;for(p=0;p<x.boxesToAvoid.length;p+=1)if(u=x.boxesToAvoid[p],!((f={left:t,right:t+o.width,top:e,bottom:e+o.height}).left>u.right||f.right<u.left||f.top>u.bottom||f.bottom<u.top))return!1;for(p=0;p<x.series.length;p+=1)if(n=(h=x.series[p]).interpolatedPoints,h.visible&&n){for(d=1;d<n.length;d+=1){if(n[d].chartX>=t-16&&n[d-1].chartX<=t+o.width+16){if(Y(t,e,o.width,o.height,n[d-1].chartX,n[d-1].chartY,n[d].chartX,n[d].chartY))return!1;this===h&&!s&&r&&(s=Y(t-16,e-16,o.width+32,o.height+32,n[d-1].chartX,n[d-1].chartY,n[d].chartX,n[d].chartY))}!m&&!s||this===h&&!b||(l=t+o.width/2-n[d].chartX,c=e+o.height/2-n[d].chartY,g=Math.min(g,l*l+c*c))}if(!b&&m&&this===h&&(r&&!s||g<Math.pow(this.options.label.connectorNeighbourDistance,2))){for(d=1;d<n.length;d+=1)(i=Math.min(Math.pow(t+o.width/2-n[d].chartX,2)+Math.pow(e+o.height/2-n[d].chartY,2),Math.pow(t-n[d].chartX,2)+Math.pow(e-n[d].chartY,2),Math.pow(t+o.width-n[d].chartX,2)+Math.pow(e-n[d].chartY,2),Math.pow(t+o.width-n[d].chartX,2)+Math.pow(e+o.height-n[d].chartY,2),Math.pow(t-n[d].chartX,2)+Math.pow(e+o.height-n[d].chartY,2)))<y&&(y=i,a=n[d]);s=!0}}return!(r&&!s)&&{x:t,y:e,weight:g-(a?y:0),connectorPoint:a}},e.prototype.drawSeriesLabels=function(){var v=this,t=this.labelSeries;v.boxesToAvoid=[],t.forEach(function(t){t.interpolatedPoints=t.getPointsOnGraph(),(t.options.label.boxesToAvoid||[]).forEach(function(t){v.boxesToAvoid.push(t)})}),v.series.forEach(function(t){var e=t.options.label;if(e&&(t.xAxis||t.yAxis)){var o,r,i,a,h,n,s,l,c,p="highcharts-color-"+T(t.colorIndex,"none"),d=!t.labelBySeries,u=e.minFontSize,f=e.maxFontSize,x=v.inverted,b=(x?t.yAxis:t.xAxis).pos,m=(x?t.xAxis:t.yAxis).pos,g=(v.inverted?t.yAxis:t.xAxis).len,y=(v.inverted?t.xAxis:t.yAxis).len,Y=t.interpolatedPoints,X=T(e.onArea,!!t.area),w=[],M=t.labelBySeries;if(X&&!x&&(c=[t.xAxis.toPixels(t.xData[0]),t.xAxis.toPixels(t.xData[t.xData.length-1])],s=Math.min.apply(Math,c),l=Math.max.apply(Math,c)),t.visible&&!t.isSeriesBoosting&&Y){for(M||(c=t.name,"string"==typeof e.format?c=P(e.format,t,v):e.formatter&&(c=e.formatter.call(t)),t.labelBySeries=M=v.renderer.label(c,0,-9999,"connector").addClass("highcharts-series-label highcharts-series-label-"+t.index+" "+(t.options.className||"")+" "+p),v.renderer.styledMode||(M.css(L({color:X?v.renderer.getContrast(t.color):t.color},e.style||{})),M.attr({opacity:v.renderer.forExport?1:0,stroke:t.color,"stroke-width":1})),u&&f&&M.css({fontSize:t.labelFontSize(u,f)}),M.attr({padding:0,zIndex:3}).add()),(o=M.getBBox()).width=Math.round(o.width),h=Y.length-1;0<h;--h)X?(n=S(r=Y[h].chartX-o.width/2,i=Y[h].chartCenterY-o.height/2,o)?t.checkClearPoint(r,i,o):n)&&w.push(n):((n=S(r=Y[h].chartX+3,i=Y[h].chartY-o.height-3,o)?t.checkClearPoint(r,i,o,!0):n)&&w.push(n),(n=S(r=Y[h].chartX+3,i=Y[h].chartY+3,o)?t.checkClearPoint(r,i,o,!0):n)&&w.push(n),(n=S(r=Y[h].chartX-o.width-3,i=Y[h].chartY+3,o)?t.checkClearPoint(r,i,o,!0):n)&&w.push(n),(n=S(r=Y[h].chartX-o.width-3,i=Y[h].chartY-o.height-3,o)?t.checkClearPoint(r,i,o,!0):n)&&w.push(n));if(e.connectorAllowed&&!w.length&&!X)for(r=b+g-o.width;b<=r;r-=16)for(i=m;i<m+y-o.height;i+=16)(a=t.checkClearPoint(r,i,o,!0))&&w.push(a);w.length?(w.sort(function(t,e){return e.weight-t.weight}),n=w[0],v.boxesToAvoid.push({left:n.x,right:n.x+o.width,top:n.y,bottom:n.y+o.height}),(u=Math.sqrt(Math.pow(Math.abs(n.x-(M.x||0)),2)+Math.pow(Math.abs(n.y-(M.y||0)),2)))&&t.labelBySeries&&(f={opacity:v.renderer.forExport?1:0,x:n.x,y:n.y},e={opacity:1},u<=10&&(e={x:f.x,y:f.y},f={}),u=void 0,d&&((u=C(t.options.animation)).duration*=.2),t.labelBySeries.attr(L(f,{anchorX:n.connectorPoint&&n.connectorPoint.plotX+b,anchorY:n.connectorPoint&&n.connectorPoint.plotY+m})).animate(e,u),t.options.kdNow=!0,t.buildKDTree(),(u=t.searchPoint({chartX:n.x,chartY:n.y},!0))&&(M.closest=[u,n.x-(u.plotX||0),n.y-(u.plotY||0)]))):A()}else A()}function S(t,e,o){var r=Math.max(b,T(s,-1/0)),i=Math.min(b+g,T(l,1/0));return r<t&&t<=i-o.width&&m<=e&&e<=m+y-o.height}function A(){M&&(t.labelBySeries=M.destroy())}}),h(v,"afterDrawSeriesLabels")},a(e,"load",p),a(e,"redraw",p)}),e(t,"masters/modules/series-label.src.js",[],function(){})});