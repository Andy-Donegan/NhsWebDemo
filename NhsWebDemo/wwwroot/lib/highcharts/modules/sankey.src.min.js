"use strict";!function(t){"object"==typeof module&&module.exports?module.exports=t.default=t:"function"==typeof define&&define.amd?define("highcharts/modules/sankey",["highcharts"],function(o){return t(o),t.Highcharts=o,t}):t("undefined"!=typeof Highcharts?Highcharts:void 0)}(function(o){o=o?o._modules:{};function t(o,t,e,i){o.hasOwnProperty(t)||(o[t]=i.apply(null,e))}t(o,"Series/NodesComposition.js",[o["Core/Series/Point.js"],o["Core/Series/Series.js"],o["Core/Utilities.js"]],function(i,o,t){var e,n,r=t.defined,s=t.extend,a=t.find,l=t.pick;function d(){return this.data=[].concat(this.points||[],this.nodes),o.prototype.destroy.apply(this,arguments)}function h(){this.nodes&&(this.nodes.forEach(function(o){o.destroy()}),this.nodes.length=0),o.prototype.setData.apply(this,arguments)}function p(o){var t=arguments,e=this.isNode?this.linksTo.concat(this.linksFrom):[this.fromNode,this.toNode];"select"!==o&&e.forEach(function(o){o&&o.series&&(i.prototype.setState.apply(o,t),o.isNode||(o.fromNode.graphic&&i.prototype.setState.apply(o.fromNode,t),o.toNode&&o.toNode.graphic&&i.prototype.setState.apply(o.toNode,t)))}),i.prototype.setState.apply(this,t)}return t=e=e||{},n=[],t.compose=function(o,t){var e;return-1===n.indexOf(o)&&(n.push(o),(e=o.prototype).setNodeState=p,e.setState=p),-1===n.indexOf(t)&&(n.push(t),(e=t.prototype).destroy=d,e.setData=h),t},t.createNode=function(o){var t=this.pointClass,e=function(o,t){return a(o,function(o){return o.id===t})},n=e(this.nodes,o);return n||(e=this.options.nodes&&e(this.options.nodes,o),(n=(new t).init(this,s({className:"highcharts-node",isNode:!0,id:o,y:1},e))).linksTo=[],n.linksFrom=[],n.formatPrefix="node",n.name=n.name||n.options.id||"",n.mass=l(n.options.mass,n.options.marker&&n.options.marker.radius,this.options.marker&&this.options.marker.radius,4),n.getSum=function(){var t=0,e=0;return n.linksTo.forEach(function(o){t+=o.weight}),n.linksFrom.forEach(function(o){e+=o.weight}),Math.max(t,e)},n.offset=function(o,t){for(var e=0,i=0;i<n[t].length;i++){if(n[t][i]===o)return e;e+=n[t][i].weight}},n.hasShape=function(){var t=0;return n.linksTo.forEach(function(o){o.outgoing&&t++}),!n.linksTo.length||t!==n.linksTo.length},this.nodes.push(n)),n},t.destroy=d,t.generatePoints=function(){var t=this.chart,e={};o.prototype.generatePoints.call(this),this.nodes||(this.nodes=[]),this.colorCounter=0,this.nodes.forEach(function(o){o.linksFrom.length=0,o.linksTo.length=0,o.level=o.options.level}),this.points.forEach(function(o){r(o.from)&&(e[o.from]||(e[o.from]=this.createNode(o.from)),e[o.from].linksFrom.push(o),o.fromNode=e[o.from],t.styledMode?o.colorIndex=l(o.options.colorIndex,e[o.from].colorIndex):o.color=o.options.color||e[o.from].color),r(o.to)&&(e[o.to]||(e[o.to]=this.createNode(o.to)),e[o.to].linksTo.push(o),o.toNode=e[o.to]),o.name=o.name||o.id},this),this.nodeLookup=e},t.setNodeState=p,e}),t(o,"Series/Sankey/SankeyPoint.js",[o["Core/Series/Point.js"],o["Core/Series/SeriesRegistry.js"],o["Core/Utilities.js"]],function(e,o,t){var i,n,r=this&&this.__extends||(i=function(o,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(o,t){o.__proto__=t}||function(o,t){for(var e in t)t.hasOwnProperty(e)&&(o[e]=t[e])})(o,t)},function(o,t){function e(){this.constructor=o}i(o,t),o.prototype=null===t?Object.create(t):(e.prototype=t.prototype,new e)}),o=o.seriesTypes.column,s=t.defined;t.extend;function a(){var o=null!==n&&n.apply(this,arguments)||this;return o.className=void 0,o.fromNode=void 0,o.level=void 0,o.linkBase=void 0,o.linksFrom=void 0,o.linksTo=void 0,o.mass=void 0,o.nodeX=void 0,o.nodeY=void 0,o.options=void 0,o.series=void 0,o.toNode=void 0,o}return n=o.prototype.pointClass,r(a,n),a.prototype.applyOptions=function(o,t){return e.prototype.applyOptions.call(this,o,t),s(this.options.level)&&(this.options.column=this.column=this.options.level),this},a.prototype.getClassName=function(){return(this.isNode?"highcharts-node ":"highcharts-link ")+e.prototype.getClassName.call(this)},a.prototype.isValid=function(){return this.isNode||"number"==typeof this.weight},a}),t(o,"Series/TreeUtilities.js",[o["Core/Color/Color.js"],o["Core/Utilities.js"]],function(f,o){var p=o.extend,l=o.isArray,d=o.isNumber,h=o.isObject,c=o.merge,m=o.pick;return{getColor:function(o,t){var e,i,n,r=t.index,s=t.mapOptionsToLevel,a=t.parentColor,l=t.parentColorIndex,d=t.series,h=t.colors,p=t.siblings,c=d.points,u=d.chart.options.chart;return o&&(c=c[o.i],o=s[o.level]||{},c&&o.colorByPoint&&(i=c.index%(h?h.length:u.colorCount),e=h&&h[i]),d.chart.styledMode||(n=m(c&&c.options.color,o&&o.color,e,a&&(n=a,(a=o&&o.colorVariation)&&"brightness"===a.key&&r&&p?f.parse(n).brighten(a.to*(r/p)).get():n),d.color)),i=m(c&&c.options.colorIndex,o&&o.colorIndex,i,l,t.colorIndex)),{color:n,colorIndex:i}},getLevelOptions:function(o){var n,t,e,r,i,s,a=null;if(h(o))for(a={},r=d(o.from)?o.from:1,s=o.levels,t={},n=h(o.defaults)?o.defaults:{},l(s)&&(t=s.reduce(function(o,t){var e,i;return h(t)&&d(t.level)&&(i=c({},t),e=m(i.levelIsConstant,n.levelIsConstant),delete i.levelIsConstant,delete i.level,e=t.level+(e?0:r-1),h(o[e])?c(!0,o[e],i):o[e]=i),o},{})),i=d(o.to)?o.to:1,e=0;e<=i;e++)a[e]=c({},n,h(t[e])?t[e]:{});return a},setTreeValues:function i(n,r){var o=r.before,t=r.idRoot,e=r.mapIdToNode[t],s=!1!==r.levelIsConstant,a=r.points[n.i],l=a&&a.options||{},d=[],h=0;n.levelDynamic=n.level-(s?0:e.level),n.name=m(a&&a.name,""),n.visible=t===n.id||!0===r.visible,(n="function"==typeof o?o(n,r):n).children.forEach(function(o,t){var e=p({},r);p(e,{index:t,siblings:n.children.length,visible:n.visible}),o=i(o,e),d.push(o),o.visible&&(h+=o.val)});l=m(l.value,h);return n.visible=0<=l&&(0<h||n.visible),n.children=d,n.childrenTotal=h,n.isLeaf=n.visible&&!h,n.val=l,n},updateRootId:function(o){var t;return h(o)&&(t=h(o.options)?o.options:{},t=m(o.rootNode,t.rootId,""),h(o.userOptions)&&(o.userOptions.rootId=t),o.rootNode=t),t}}}),t(o,"Series/Sankey/SankeySeries.js",[o["Core/Color/Color.js"],o["Core/Globals.js"],o["Series/NodesComposition.js"],o["Series/Sankey/SankeyPoint.js"],o["Core/Series/SeriesRegistry.js"],o["Series/TreeUtilities.js"],o["Core/Utilities.js"]],function(a,o,t,e,i,n,r){var s,l,d=this&&this.__extends||(s=function(o,t){return(s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(o,t){o.__proto__=t}||function(o,t){for(var e in t)t.hasOwnProperty(e)&&(o[e]=t[e])})(o,t)},function(o,t){function e(){this.constructor=o}s(o,t),o.prototype=null===t?Object.create(t):(e.prototype=t.prototype,new e)}),h=i.series,p=i.seriesTypes.column,c=n.getLevelOptions,u=r.defined,n=r.extend,f=r.find,m=r.isObject,v=r.merge,y=r.pick,g=r.relativeLength,k=r.stableSort,d=(d(C,l=p),C.getDLOptions=function(o){var t=m(o.optionsPoint)?o.optionsPoint.dataLabels:{},o=m(o.level)?o.level.dataLabels:{};return v({style:{}},o,t)},C.prototype.createNodeColumn=function(){var d=this,h=this.chart,p=[];return p.sum=function(){return this.reduce(function(o,t){return o+t.getSum()},0)},p.offset=function(o,t){for(var e=0,i=d.nodePadding,n=0;n<p.length;n++){var r=p[n].getSum(),s=Math.max(r*t,d.options.minLinkWidth),a=o.options[h.inverted?"offsetHorizontal":"offsetVertical"],l=o.options.offset||0,r=r?s+i:0;if(p[n]===o)return{relativeTop:e+(u(a)?g(a,s):g(l,r))};e+=r}},p.top=function(e){var i=d.nodePadding,o=this.reduce(function(o,t){return 0<o&&(o+=i),o+=Math.max(t.getSum()*e,d.options.minLinkWidth)},0);return(h.plotSizeY-o)/2},p},C.prototype.createNodeColumns=function(){var s=[];this.nodes.forEach(function(e){var o,t=-1;if(!u(e.options.column))if(0===e.linksTo.length)e.column=0;else{for(var i,n=0;n<e.linksTo.length;n++){var r=e.linksTo[n];r.fromNode.column>t&&r.fromNode!==e&&(t=(o=r.fromNode).column)}e.column=t+1,o&&"hanging"===o.options.layout&&(e.hangsFrom=o,i=-1,f(o.linksFrom,function(o,t){o=o.toNode===e;return o&&(i=t),o}),e.column+=i)}s[e.column]||(s[e.column]=this.createNodeColumn()),s[e.column].push(e)},this);for(var o=0;o<s.length;o++)void 0===s[o]&&(s[o]=this.createNodeColumn());return s},C.prototype.generatePoints=function(){t.generatePoints.apply(this,arguments),this.orderNodes&&(this.nodes.filter(function(o){return 0===o.linksTo.length}).forEach(function(o){!function t(o,e){void 0===o.level&&(o.level=e,o.linksFrom.forEach(function(o){o.toNode&&t(o.toNode,e+1)}))}(o,0)}),k(this.nodes,function(o,t){return o.level-t.level}))},C.prototype.getNodePadding=function(){var o,t=this.options.nodePadding||0;return!this.nodeColumns||(o=this.nodeColumns.reduce(function(o,t){return Math.max(o,t.length)},0))*t>this.chart.plotSizeY&&(t=this.chart.plotSizeY/o),t},C.prototype.hasData=function(){return!!this.processedXData.length},C.prototype.pointAttribs=function(o,t){if(!o)return{};var e=this,i=(o.isNode?o:o.fromNode).level,n=e.mapOptionsToLevel[i||0]||{},r=o.options,s=n.states&&n.states[t||""]||{},i=["colorByPoint","borderColor","borderWidth","linkOpacity"].reduce(function(o,t){return o[t]=y(s[t],r[t],n[t],e.options[t]),o},{}),t=y(s.color,r.color,(i.colorByPoint?o:n).color);return o.isNode?{fill:t,stroke:i.borderColor,"stroke-width":i.borderWidth}:{fill:a.parse(t).setOpacity(i.linkOpacity).get()}},C.prototype.render=function(){var o=this.points;this.points=this.points.concat(this.nodes||[]),p.prototype.render.call(this),this.points=o},C.prototype.translate=function(){var a=this;this.processedXData||this.processData(),this.generatePoints(),this.nodeColumns=this.createNodeColumns(),this.nodeWidth=g(this.options.nodeWidth,this.chart.plotSizeX);var l=this,d=this.chart,h=this.options,o=this.nodeWidth,t=this.nodeColumns;this.nodePadding=this.getNodePadding(),this.translationFactor=t.reduce(function(o,t){return Math.min(o,function(t){for(var o,e,i=t.slice(),n=a.options.minLinkWidth||0,r=0,s=d.plotSizeY-h.borderWidth-(t.length-1)*l.nodePadding;t.length;){for(r=s/t.sum(),o=!1,e=t.length;e--;)t[e].getSum()*r<n&&(t.splice(e,1),s-=n,o=!0);if(!o)break}return t.length=0,i.forEach(function(o){return t.push(o)}),r}(t))},1/0),this.colDistance=(d.plotSizeX-o-h.borderWidth)/Math.max(1,t.length-1),l.mapOptionsToLevel=c({from:1,levels:h.levels,to:t.length-1,defaults:{borderColor:h.borderColor,borderRadius:h.borderRadius,borderWidth:h.borderWidth,color:l.color,colorByPoint:h.colorByPoint,levelIsConstant:!0,linkColor:h.linkColor,linkLineWidth:h.linkLineWidth,linkOpacity:h.linkOpacity,states:h.states}}),t.forEach(function(t){t.forEach(function(o){l.translateNode(o,t)})},this),this.nodes.forEach(function(o){o.linksFrom.forEach(function(o){(o.weight||o.isNull)&&o.to&&(l.translateLink(o),o.allowShadow=!1)})})},C.prototype.translateLink=function(e){var o,t,i,n,r,s,a,l,d,h,p,c=function(o,t){t=o.offset(e,t)*v;return Math.min(o.nodeY+t,o.nodeY+(o.shapeArgs&&o.shapeArgs.height||0)-y)},u=e.fromNode,f=e.toNode,m=this.chart,v=this.translationFactor,y=Math.max(e.weight*v,this.options.minLinkWidth),g=this.options,k=(m.inverted?-this.colDistance:this.colDistance)*g.curveFactor,C=c(u,"linksFrom"),b=c(f,"linksTo"),N=u.nodeX,S=this.nodeWidth,x=f.nodeX,O=e.outgoing,P=N+S<x;m.inverted&&(C=m.plotSizeY-C,b=(m.plotSizeY||0)-b,S=-S,y=-y,P=x<N),e.shapeType="path",e.linkBase=[C,C+y,b,b+y],P&&"number"==typeof b?e.shapeArgs={d:[["M",N+S,C],["C",N+S+k,C,x-k,b,x,b],["L",x+(O?S:0),b+y/2],["L",x,b+y],["C",x-k,b+y,N+S+k,C+y,N+S,C+y],["Z"]]}:"number"==typeof b&&(p=m.plotHeight-C-y,o=x-20-y,n=(i=(t=N+S)+20)+y,h=(d=(l=(a=(s=(r=C)+y)+20)+p)+20)+y,g=s-.7*y,c=d+.7*y,O=(P=(f=b)+y)-.7*y,k=x-.7*y,p=t+.7*y,e.shapeArgs={d:[["M",t,r],["C",p,r,n,g,n,a],["L",n,l],["C",n,c,p,h,t,h],["L",x,h],["C",k,h,o,c,o,l],["L",o,c=P+20],["C",o,O,k,f,x,f],["L",x,P],["C",f=x-20,P,f,P,f,c],["L",f,l],["C",f,d,f,d,x,d],["L",t,d],["C",i,d,i,d,i,l],["L",i,a],["C",i,s,i,s,t,s],["Z"]]}),e.dlBox={x:N+(x-N+S)/2,y:C+(b-C)/2,height:y,width:0},e.tooltipPos=m.inverted?[m.plotSizeY-e.dlBox.y-y/2,m.plotSizeX-e.dlBox.x]:[e.dlBox.x,e.dlBox.y+y/2],e.y=e.plotY=1,e.color||(e.color=u.color)},C.prototype.translateNode=function(o,t){var e=this.translationFactor,i=this.chart,n=this.options,r=o.getSum(),s=Math.max(Math.round(r*e),this.options.minLinkWidth),a=Math.round(this.nodeWidth),l=Math.round(n.borderWidth)%2/2,d=t.offset(o,e),h=Math.floor(y(d.absoluteTop,t.top(e)+d.relativeTop))+l,t=Math.floor(this.colDistance*o.column+n.borderWidth/2)+g(o.options.offsetHorizontal||0,a)+l,e=i.inverted?i.plotSizeX-t:t;(o.sum=r)?(o.shapeType="rect",d=o.nodeX=e,l=o.nodeY=h,t=o.options.width||n.width||a,r=o.options.height||n.height||s,i.inverted&&(d=e-a,l=i.plotSizeY-h-s,t=o.options.height||n.height||a,r=o.options.width||n.width||s),o.dlOptions=C.getDLOptions({level:this.mapOptionsToLevel[o.level],optionsPoint:o.options}),o.plotX=1,o.plotY=1,o.tooltipPos=i.inverted?[i.plotSizeY-l-r/2,i.plotSizeX-d-t/2]:[d+t/2,l+r/2],o.shapeArgs={x:d,y:l,width:t,height:r,display:o.hasShape()?"":"none"}):o.dlOptions={enabled:!1}},C.defaultOptions=v(p.defaultOptions,{borderWidth:0,colorByPoint:!0,curveFactor:.33,dataLabels:{enabled:!0,backgroundColor:"none",crop:!1,nodeFormat:void 0,nodeFormatter:function(){return this.point.name},format:void 0,formatter:function(){},inside:!0},inactiveOtherPoints:!0,linkOpacity:.5,minLinkWidth:0,nodeWidth:20,nodePadding:10,showInLegend:!1,states:{hover:{linkOpacity:1},inactive:{linkOpacity:.1,opacity:.1,animation:{duration:50}}},tooltip:{followPointer:!0,headerFormat:'<span style="font-size: 10px">{series.name}</span><br/>',pointFormat:"{point.fromNode.name} → {point.toNode.name}: <b>{point.weight}</b><br/>",nodeFormat:"{point.name}: <b>{point.sum}</b><br/>"}}),C);function C(){var o=null!==l&&l.apply(this,arguments)||this;return o.colDistance=void 0,o.data=void 0,o.group=void 0,o.nodeLookup=void 0,o.nodePadding=void 0,o.nodes=void 0,o.nodeWidth=void 0,o.options=void 0,o.points=void 0,o.translationFactor=void 0,o}return t.compose(e,d),n(d.prototype,{animate:h.prototype.animate,createNode:t.createNode,forceDL:!0,invertible:!0,isCartesian:!1,orderNodes:!0,noSharedTooltip:!0,pointArrayMap:["from","to"],pointClass:e,searchPoint:o.noop}),i.registerSeriesType("sankey",d),d}),t(o,"masters/modules/sankey.src.js",[],function(){})});