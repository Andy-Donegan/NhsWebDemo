"use strict";!function(t){"object"==typeof module&&module.exports?module.exports=t.default=t:"function"==typeof define&&define.amd?define("highcharts/modules/sankey",["highcharts"],function(o){return t(o),t.Highcharts=o,t}):t("undefined"!=typeof Highcharts?Highcharts:void 0)}(function(o){function t(o,t,e,i){o.hasOwnProperty(t)||(o[t]=i.apply(null,e))}t(o=o?o._modules:{},"Series/NodesComposition.js",[o["Core/Series/Point.js"],o["Core/Series/Series.js"],o["Core/Utilities.js"]],function(i,o,t){var e,n,r=t.defined,s=t.extend,a=t.find,l=t.pick;function d(){return this.data=[].concat(this.points||[],this.nodes),o.prototype.destroy.apply(this,arguments)}function h(){this.nodes&&(this.nodes.forEach(function(o){o.destroy()}),this.nodes.length=0),o.prototype.setData.apply(this,arguments)}function p(o){var t=arguments,e=this.isNode?this.linksTo.concat(this.linksFrom):[this.fromNode,this.toNode];"select"!==o&&e.forEach(function(o){o&&o.series&&(i.prototype.setState.apply(o,t),o.isNode||(o.fromNode.graphic&&i.prototype.setState.apply(o.fromNode,t),o.toNode&&o.toNode.graphic&&i.prototype.setState.apply(o.toNode,t)))}),i.prototype.setState.apply(this,t)}return t=e=e||{},n=[],t.compose=function(o,t){return-1===n.indexOf(o)&&(n.push(o),(o=o.prototype).setNodeState=p,o.setState=p),-1===n.indexOf(t)&&(n.push(t),(o=t.prototype).destroy=d,o.setData=h),t},t.createNode=function(o){var t=this.pointClass,e=function(o,t){return a(o,function(o){return o.id===t})},n=e(this.nodes,o);return n||(e=this.options.nodes&&e(this.options.nodes,o),(n=(new t).init(this,s({className:"highcharts-node",isNode:!0,id:o,y:1},e))).linksTo=[],n.linksFrom=[],n.formatPrefix="node",n.name=n.name||n.options.id||"",n.mass=l(n.options.mass,n.options.marker&&n.options.marker.radius,this.options.marker&&this.options.marker.radius,4),n.getSum=function(){var t=0,e=0;return n.linksTo.forEach(function(o){t+=o.weight}),n.linksFrom.forEach(function(o){e+=o.weight}),Math.max(t,e)},n.offset=function(o,t){for(var e=0,i=0;i<n[t].length;i++){if(n[t][i]===o)return e;e+=n[t][i].weight}},n.hasShape=function(){var t=0;return n.linksTo.forEach(function(o){o.outgoing&&t++}),!n.linksTo.length||t!==n.linksTo.length},this.nodes.push(n)),n},t.destroy=d,t.generatePoints=function(){var t=this.chart,e={};o.prototype.generatePoints.call(this),this.nodes||(this.nodes=[]),this.colorCounter=0,this.nodes.forEach(function(o){o.linksFrom.length=0,o.linksTo.length=0,o.level=o.options.level}),this.points.forEach(function(o){r(o.from)&&(e[o.from]||(e[o.from]=this.createNode(o.from)),e[o.from].linksFrom.push(o),o.fromNode=e[o.from],t.styledMode?o.colorIndex=l(o.options.colorIndex,e[o.from].colorIndex):o.color=o.options.color||e[o.from].color),r(o.to)&&(e[o.to]||(e[o.to]=this.createNode(o.to)),e[o.to].linksTo.push(o),o.toNode=e[o.to]),o.name=o.name||o.id},this),this.nodeLookup=e},t.setNodeState=p,e}),t(o,"Series/Sankey/SankeyPoint.js",[o["Core/Series/Point.js"],o["Core/Series/SeriesRegistry.js"],o["Core/Utilities.js"]],function(e,o,t){var i,n,r=this&&this.__extends||(i=function(o,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(o,t){o.__proto__=t}||function(o,t){for(var e in t)t.hasOwnProperty(e)&&(o[e]=t[e])})(o,t)},function(o,t){function e(){this.constructor=o}i(o,t),o.prototype=null===t?Object.create(t):(e.prototype=t.prototype,new e)}),s=t.defined;return n=o.seriesTypes.column.prototype.pointClass,r(a,n),a.prototype.applyOptions=function(o,t){return e.prototype.applyOptions.call(this,o,t),s(this.options.level)&&(this.options.column=this.column=this.options.level),this},a.prototype.getClassName=function(){return(this.isNode?"highcharts-node ":"highcharts-link ")+e.prototype.getClassName.call(this)},a.prototype.isValid=function(){return this.isNode||"number"==typeof this.weight},a;function a(){var o=null!==n&&n.apply(this,arguments)||this;return o.className=void 0,o.fromNode=void 0,o.level=void 0,o.linkBase=void 0,o.linksFrom=void 0,o.linksTo=void 0,o.mass=void 0,o.nodeX=void 0,o.nodeY=void 0,o.options=void 0,o.series=void 0,o.toNode=void 0,o}}),t(o,"Series/TreeUtilities.js",[o["Core/Color/Color.js"],o["Core/Utilities.js"]],function(f,o){var h=o.extend,s=o.isArray,a=o.isNumber,l=o.isObject,d=o.merge,m=o.pick;return{getColor:function(o,t){var e,i,n,r=t.index,s=t.mapOptionsToLevel,a=t.parentColor,l=t.parentColorIndex,d=t.series,h=t.colors,p=t.siblings,c=d.points,u=d.chart.options.chart;return o&&(c=c[o.i],o=s[o.level]||{},c&&o.colorByPoint&&(n=c.index%(h?h.length:u.colorCount),i=h&&h[n]),d.chart.styledMode||(h=c&&c.options.color,u=o&&o.color,(e=a)&&(e=(e=o&&o.colorVariation)&&"brightness"===e.key&&r&&p?f.parse(a).brighten(r/p*e.to).get():a),e=m(h,u,i,e,d.color)),n=m(c&&c.options.colorIndex,o&&o.colorIndex,n,l,t.colorIndex)),{color:e,colorIndex:n}},getLevelOptions:function(o){var t=null;if(l(o)){var t={},n=a(o.from)?o.from:1,e=o.levels,i={},r=l(o.defaults)?o.defaults:{};for(s(e)&&(i=e.reduce(function(o,t){var e,i;return l(t)&&a(t.level)&&(e=d({},t),i=m(e.levelIsConstant,r.levelIsConstant),delete e.levelIsConstant,delete e.level,t=t.level+(i?0:n-1),l(o[t])?d(!0,o[t],e):o[t]=e),o},{})),e=a(o.to)?o.to:1,o=0;o<=e;o++)t[o]=d({},r,l(i[o])?i[o]:{})}return t},setTreeValues:function i(n,r){var o=r.before,t=r.idRoot,e=r.mapIdToNode[t],s=r.points[n.i],a=s&&s.options||{},l=[],d=0;return n.levelDynamic=n.level-(!1!==r.levelIsConstant?0:e.level),n.name=m(s&&s.name,""),n.visible=t===n.id||!0===r.visible,(n="function"==typeof o?o(n,r):n).children.forEach(function(o,t){var e=h({},r);h(e,{index:t,siblings:n.children.length,visible:n.visible}),o=i(o,e),l.push(o),o.visible&&(d+=o.val)}),o=m(a.value,d),n.visible=0<=o&&(0<d||n.visible),n.children=l,n.childrenTotal=d,n.isLeaf=n.visible&&!d,n.val=o,n},updateRootId:function(o){var t;return l(o)&&(t=l(o.options)?o.options:{},t=m(o.rootNode,t.rootId,""),l(o.userOptions)&&(o.userOptions.rootId=t),o.rootNode=t),t}}}),t(o,"Series/Sankey/SankeySeries.js",[o["Core/Color/Color.js"],o["Core/Globals.js"],o["Series/NodesComposition.js"],o["Series/Sankey/SankeyPoint.js"],o["Core/Series/SeriesRegistry.js"],o["Series/TreeUtilities.js"],o["Core/Utilities.js"]],function(a,o,t,e,i,n,r){var s,l=this&&this.__extends||(s=function(o,t){return(s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(o,t){o.__proto__=t}||function(o,t){for(var e in t)t.hasOwnProperty(e)&&(o[e]=t[e])})(o,t)},function(o,t){function e(){this.constructor=o}s(o,t),o.prototype=null===t?Object.create(t):(e.prototype=t.prototype,new e)}),d=i.series,h=i.seriesTypes.column,p=n.getLevelOptions,c=r.defined;n=r.extend;var u,f=r.find,m=r.isObject,v=r.merge,y=r.pick,g=r.relativeLength,k=r.stableSort;function C(){var o=null!==u&&u.apply(this,arguments)||this;return o.colDistance=void 0,o.data=void 0,o.group=void 0,o.nodeLookup=void 0,o.nodePadding=void 0,o.nodes=void 0,o.nodeWidth=void 0,o.options=void 0,o.points=void 0,o.translationFactor=void 0,o}return l(C,u=h),C.getDLOptions=function(o){var t=m(o.optionsPoint)?o.optionsPoint.dataLabels:{};return o=m(o.level)?o.level.dataLabels:{},v({style:{}},o,t)},C.prototype.createNodeColumn=function(){var d=this,h=this.chart,p=[];return p.sum=function(){return this.reduce(function(o,t){return o+t.getSum()},0)},p.offset=function(o,t){for(var e=0,i=d.nodePadding,n=0;n<p.length;n++){var r=p[n].getSum(),s=Math.max(r*t,d.options.minLinkWidth),a=o.options[h.inverted?"offsetHorizontal":"offsetVertical"],l=o.options.offset||0;if(r=r?s+i:0,p[n]===o)return{relativeTop:e+(c(a)?g(a,s):g(l,r))};e+=r}},p.top=function(e){var i=d.nodePadding,o=this.reduce(function(o,t){return 0<o&&(o+=i),o+(t=Math.max(t.getSum()*e,d.options.minLinkWidth))},0);return(h.plotSizeY-o)/2},p},C.prototype.createNodeColumns=function(){var s=[];this.nodes.forEach(function(e){var o=-1;if(!c(e.options.column))if(0===e.linksTo.length)e.column=0;else{for(var i,t=0;t<e.linksTo.length;t++){var n,r=e.linksTo[t];r.fromNode.column>o&&r.fromNode!==e&&(o=(n=r.fromNode).column)}e.column=o+1,n&&"hanging"===n.options.layout&&(e.hangsFrom=n,i=-1,f(n.linksFrom,function(o,t){return(o=o.toNode===e)&&(i=t),o}),e.column+=i)}s[e.column]||(s[e.column]=this.createNodeColumn()),s[e.column].push(e)},this);for(var o=0;o<s.length;o++)void 0===s[o]&&(s[o]=this.createNodeColumn());return s},C.prototype.generatePoints=function(){t.generatePoints.apply(this,arguments),this.orderNodes&&(this.nodes.filter(function(o){return 0===o.linksTo.length}).forEach(function(o){!function t(o,e){void 0===o.level&&(o.level=e,o.linksFrom.forEach(function(o){o.toNode&&t(o.toNode,e+1)}))}(o,0)}),k(this.nodes,function(o,t){return o.level-t.level}))},C.prototype.getNodePadding=function(){var o,t=this.options.nodePadding||0;return!this.nodeColumns||(o=this.nodeColumns.reduce(function(o,t){return Math.max(o,t.length)},0))*t>this.chart.plotSizeY&&(t=this.chart.plotSizeY/o),t},C.prototype.hasData=function(){return!!this.processedXData.length},C.prototype.pointAttribs=function(o,t){if(!o)return{};var e=this,i=e.mapOptionsToLevel[(o.isNode?o:o.fromNode).level||0]||{},n=o.options,r=i.states&&i.states[t||""]||{};t=["colorByPoint","borderColor","borderWidth","linkOpacity"].reduce(function(o,t){return o[t]=y(r[t],n[t],i[t],e.options[t]),o},{});var s=y(r.color,n.color,(t.colorByPoint?o:i).color);return o.isNode?{fill:s,stroke:t.borderColor,"stroke-width":t.borderWidth}:{fill:a.parse(s).setOpacity(t.linkOpacity).get()}},C.prototype.render=function(){var o=this.points;this.points=this.points.concat(this.nodes||[]),h.prototype.render.call(this),this.points=o},C.prototype.translate=function(){var a=this;this.processedXData||this.processData(),this.generatePoints(),this.nodeColumns=this.createNodeColumns(),this.nodeWidth=g(this.options.nodeWidth,this.chart.plotSizeX);var l=this,d=this.chart,h=this.options,o=this.nodeWidth,t=this.nodeColumns;this.nodePadding=this.getNodePadding(),this.translationFactor=t.reduce(function(o,t){return Math.min(o,function(t){for(var o,e,i=t.slice(),n=a.options.minLinkWidth||0,r=0,s=d.plotSizeY-h.borderWidth-(t.length-1)*l.nodePadding;t.length;){for(r=s/t.sum(),o=!1,e=t.length;e--;)t[e].getSum()*r<n&&(t.splice(e,1),s-=n,o=!0);if(!o)break}return t.length=0,i.forEach(function(o){return t.push(o)}),r}(t))},1/0),this.colDistance=(d.plotSizeX-o-h.borderWidth)/Math.max(1,t.length-1),l.mapOptionsToLevel=p({from:1,levels:h.levels,to:t.length-1,defaults:{borderColor:h.borderColor,borderRadius:h.borderRadius,borderWidth:h.borderWidth,color:l.color,colorByPoint:h.colorByPoint,levelIsConstant:!0,linkColor:h.linkColor,linkLineWidth:h.linkLineWidth,linkOpacity:h.linkOpacity,states:h.states}}),t.forEach(function(t){t.forEach(function(o){l.translateNode(o,t)})},this),this.nodes.forEach(function(o){o.linksFrom.forEach(function(o){(o.weight||o.isNull)&&o.to&&(l.translateLink(o),o.allowShadow=!1)})})},C.prototype.translateLink=function(e){var o,t,i,n,r,s,a,l,d,h,p,c,u,f=function(o,t){return t=o.offset(e,t)*g,Math.min(o.nodeY+t,o.nodeY+(o.shapeArgs&&o.shapeArgs.height||0)-k)},m=e.fromNode,v=e.toNode,y=this.chart,g=this.translationFactor,k=Math.max(e.weight*g,this.options.minLinkWidth),C=(y.inverted?-this.colDistance:this.colDistance)*this.options.curveFactor,b=f(m,"linksFrom"),f=f(v,"linksTo"),N=m.nodeX,S=this.nodeWidth,v=v.nodeX,x=e.outgoing,O=N+S<v;y.inverted&&(b=y.plotSizeY-b,f=(y.plotSizeY||0)-f,S=-S,k=-k,O=v<N),e.shapeType="path",e.linkBase=[b,b+k,f,f+k],O&&"number"==typeof f?e.shapeArgs={d:[["M",N+S,b],["C",N+S+C,b,v-C,f,v,f],["L",v+(x?S:0),f+k/2],["L",v,f+k],["C",v-C,f+k,N+S+C,b+k,N+S,b+k],["Z"]]}:"number"==typeof f&&(C=v-20-k,t=(o=(O=N+S)+20)+k,l=(a=(s=(r=(n=(i=b)+k)+20)+(y.plotHeight-b-k))+20)+k,h=(d=f)+k,p=a+.7*k,c=v-.7*k,u=O+.7*k,e.shapeArgs={d:[["M",O,i],["C",u,i,t,n-.7*k,t,r],["L",t,s],["C",t,p,u,l,O,l],["L",v,l],["C",c,l,C,p,C,s],["L",C,p=h+20],["C",C,h-.7*k,c,d,v,d],["L",v,h],["C",x=v-20,h,x,h,x,p],["L",x,s],["C",x,a,x,a,v,a],["L",O,a],["C",o,a,o,a,o,s],["L",o,r],["C",o,n,o,n,O,n],["Z"]]}),e.dlBox={x:N+(v-N+S)/2,y:b+(f-b)/2,height:k,width:0},e.tooltipPos=y.inverted?[y.plotSizeY-e.dlBox.y-k/2,y.plotSizeX-e.dlBox.x]:[e.dlBox.x,e.dlBox.y+k/2],e.y=e.plotY=1,e.color||(e.color=m.color)},C.prototype.translateNode=function(o,t){var e,i=this.translationFactor,n=this.chart,r=this.options,s=o.getSum(),a=Math.max(Math.round(s*i),this.options.minLinkWidth),l=Math.round(this.nodeWidth),d=Math.round(r.borderWidth)%2/2,h=t.offset(o,i);t=Math.floor(y(h.absoluteTop,t.top(i)+h.relativeTop))+d,d=Math.floor(this.colDistance*o.column+r.borderWidth/2)+g(o.options.offsetHorizontal||0,l)+d,d=n.inverted?n.plotSizeX-d:d,(o.sum=s)?(o.shapeType="rect",s=o.nodeX=d,i=o.nodeY=t,h=o.options.width||r.width||l,e=o.options.height||r.height||a,n.inverted&&(s=d-l,i=n.plotSizeY-t-a,h=o.options.height||r.height||l,e=o.options.width||r.width||a),o.dlOptions=C.getDLOptions({level:this.mapOptionsToLevel[o.level],optionsPoint:o.options}),o.plotX=1,o.plotY=1,o.tooltipPos=n.inverted?[n.plotSizeY-i-e/2,n.plotSizeX-s-h/2]:[s+h/2,i+e/2],o.shapeArgs={x:s,y:i,width:h,height:e,display:o.hasShape()?"":"none"}):o.dlOptions={enabled:!1}},C.defaultOptions=v(h.defaultOptions,{borderWidth:0,colorByPoint:!0,curveFactor:.33,dataLabels:{enabled:!0,backgroundColor:"none",crop:!1,nodeFormat:void 0,nodeFormatter:function(){return this.point.name},format:void 0,formatter:function(){},inside:!0},inactiveOtherPoints:!0,linkOpacity:.5,minLinkWidth:0,nodeWidth:20,nodePadding:10,showInLegend:!1,states:{hover:{linkOpacity:1},inactive:{linkOpacity:.1,opacity:.1,animation:{duration:50}}},tooltip:{followPointer:!0,headerFormat:'<span style="font-size: 10px">{series.name}</span><br/>',pointFormat:"{point.fromNode.name} → {point.toNode.name}: <b>{point.weight}</b><br/>",nodeFormat:"{point.name}: <b>{point.sum}</b><br/>"}}),t.compose(e,r=C),n(r.prototype,{animate:d.prototype.animate,createNode:t.createNode,forceDL:!0,invertible:!0,isCartesian:!1,orderNodes:!0,noSharedTooltip:!0,pointArrayMap:["from","to"],pointClass:e,searchPoint:o.noop}),i.registerSeriesType("sankey",r),r}),t(o,"masters/modules/sankey.src.js",[],function(){})});