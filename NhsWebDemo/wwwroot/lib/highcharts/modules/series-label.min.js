"use strict";!function(e){"object"==typeof module&&module.exports?module.exports=e.default=e:"function"==typeof define&&define.amd?define("highcharts/modules/series-label",["highcharts"],function(t){return e(t),e.Highcharts=t,e}):e("undefined"!=typeof Highcharts?Highcharts:void 0)}(function(t){function e(t,e,r,o){t.hasOwnProperty(e)||(t[e]=o.apply(null,r))}e(t=t?t._modules:{},"Extensions/SeriesLabel.js",[t["Core/Animation/AnimationUtilities.js"],t["Core/Chart/Chart.js"],t["Core/FormatUtilities.js"],t["Core/DefaultOptions.js"],t["Core/Series/Series.js"],t["Core/Renderer/SVG/SVGRenderer.js"],t["Core/Utilities.js"]],function(t,e,r,o,i,a,n){function s(t,e,r,o,i,a){return 0<(t=(a-e)*(r-t)-(o-e)*(i-t))||!(t<0)}function l(t,e,r,o,i,a,h,n){return s(t,e,i,a,h,n)!==s(r,o,i,a,h,n)&&s(t,e,r,o,i,a)!==s(t,e,r,o,h,n)}function m(t,e,r,o,i,a,h,n){return l(t,e,t+r,e,i,a,h,n)||l(t+r,e,t+r,e+o,i,a,h,n)||l(t,e+o,t+r,e+o,i,a,h,n)||l(t,e,t,e+o,i,a,h,n)}function h(i){var a,h;this.renderer&&(h=Y((a=this).renderer.globalAnimation).duration,a.labelSeries=[],a.labelSeriesMaxSum=0,n.clearTimeout(a.seriesLabelTimer),a.series.forEach(function(t){var e=t.options.label,r=t.labelBySeries,o=r&&r.closest;e.enabled&&t.visible&&(t.graph||t.area)&&!t.isSeriesBoosting&&(a.labelSeries.push(t),e.minFontSize&&e.maxFontSize&&(t.sum=t.yData.reduce(function(t,e){return(t||0)+(e||0)},0),a.labelSeriesMaxSum=Math.max(a.labelSeriesMaxSum,t.sum)),"load"===i.type&&(h=Math.max(h,Y(t.options.animation).duration)),o&&(void 0!==o[0].plotX?r.animate({x:o[0].plotX+o[1],y:o[0].plotY+o[2]}):r.attr({opacity:0})))}),a.seriesLabelTimer=p(function(){a.series&&a.labelSeries&&a.drawSeriesLabels()},a.renderer.forExport||!h?0:h))}var Y=t.animObject,X=r.format;t=o.setOptions,a=a.prototype.symbols,r=n.addEvent;var w=n.extend,c=n.fireEvent,f=n.isNumber,M=n.pick,p=n.syncTimeout;t({plotOptions:{series:{label:{enabled:!0,connectorAllowed:!1,connectorNeighbourDistance:24,format:void 0,formatter:void 0,minFontSize:null,maxFontSize:null,onArea:null,style:{fontWeight:"bold"},boxesToAvoid:[]}}}}),a.connector=function(t,e,r,o,i){var a=i&&i.anchorX;i=i&&i.anchorY;var h,n,s=r/2;return f(a)&&f(i)&&(h=[["M",a,i]],(n=(n=e-i)<0?-o-n:n)<r&&(s=a<t+r/2?n:r-n),e+o<i?h.push(["L",t+s,e+o]):i<e?h.push(["L",t+s,e]):a<t?h.push(["L",t,e+o/2]):t+r<a&&h.push(["L",t+r,e+o/2])),h||[]},i.prototype.getPointsOnGraph=function(){function t(t){var e=Math.round(t.plotX/8)+","+Math.round(t.plotY/8);c[e]||(c[e]=1,o.push(t))}if(this.xAxis||this.yAxis){var e,r=this.points,o=[],i=this.graph||this.area,a=i.element,h=this.chart.inverted,n=this.xAxis,s=this.yAxis,l=(h?s:n).pos,h=(h?n:s).pos,n=M(this.options.label.onArea,!!this.area),s=s.getThreshold(this.options.threshold),c={};if(this.getPointSpline&&a.getPointAtLength&&!n&&r.length<this.chart.plotSizeX/16){i.toD&&(e=i.attr("d"),i.attr({d:i.toD}));for(var p=a.getTotalLength(),d=0;d<p;d+=16){var u=a.getPointAtLength(d);t({chartX:l+u.x,chartY:h+u.y,plotX:u.x,plotY:u.y})}e&&i.attr({d:e}),(u=r[r.length-1]).chartX=l+u.plotX,u.chartY=h+u.plotY,t(u)}else for(p=r.length,d=0;d<p;d+=1){if(u=r[d],i=r[d-1],u.chartX=l+u.plotX,u.chartY=h+u.plotY,n&&(u.chartCenterY=h+(u.plotY+M(u.yBottom,s))/2),0<d&&(a=Math.abs(u.chartX-i.chartX),e=Math.abs(u.chartY-i.chartY),16<(a=Math.max(a,e))))for(a=Math.ceil(a/16),e=1;e<a;e+=1)t({chartX:i.chartX+e/a*(u.chartX-i.chartX),chartY:i.chartY+e/a*(u.chartY-i.chartY),chartCenterY:i.chartCenterY+e/a*(u.chartCenterY-i.chartCenterY),plotX:i.plotX+e/a*(u.plotX-i.plotX),plotY:i.plotY+e/a*(u.plotY-i.plotY)});f(u.plotY)&&t(u)}return o}},i.prototype.labelFontSize=function(t,e){return t+this.sum/this.chart.labelSeriesMaxSum*(e-t)+"px"},i.prototype.checkClearPoint=function(t,e,r,o){for(var i,a,h,n=this.chart,s=M(this.options.label.onArea,!!this.area),l=s||this.options.label.connectorAllowed,c=Number.MAX_VALUE,p=Number.MAX_VALUE,d=0;d<n.boxesToAvoid.length;d+=1){var u=n.boxesToAvoid[d],f=t+r.width,x=e,b=e+r.height;if(!(t>u.right||f<u.left||x>u.bottom||b<u.top))return!1}for(d=0;d<n.series.length;d+=1)if(u=(x=n.series[d]).interpolatedPoints,x.visible&&u){for(f=1;f<u.length;f+=1){if(u[f].chartX>=t-16&&u[f-1].chartX<=t+r.width+16){if(m(t,e,r.width,r.height,u[f-1].chartX,u[f-1].chartY,u[f].chartX,u[f].chartY))return!1;this===x&&!h&&o&&(h=m(t-16,e-16,r.width+32,r.height+32,u[f-1].chartX,u[f-1].chartY,u[f].chartX,u[f].chartY))}!l&&!h||this===x&&!s||(b=t+r.width/2-u[f].chartX,i=e+r.height/2-u[f].chartY,c=Math.min(c,b*b+i*i))}if(!s&&l&&this===x&&(o&&!h||c<Math.pow(this.options.label.connectorNeighbourDistance,2))){for(f=1;f<u.length;f+=1)(h=Math.min(Math.pow(t+r.width/2-u[f].chartX,2)+Math.pow(e+r.height/2-u[f].chartY,2),Math.pow(t-u[f].chartX,2)+Math.pow(e-u[f].chartY,2),Math.pow(t+r.width-u[f].chartX,2)+Math.pow(e-u[f].chartY,2),Math.pow(t+r.width-u[f].chartX,2)+Math.pow(e+r.height-u[f].chartY,2),Math.pow(t-u[f].chartX,2)+Math.pow(e+r.height-u[f].chartY,2)))<p&&(p=h,a=u[f]);h=!0}}return!(o&&!h)&&{x:t,y:e,weight:c-(a?p:0),connectorPoint:a}},e.prototype.drawSeriesLabels=function(){var y=this,t=this.labelSeries;y.boxesToAvoid=[],t.forEach(function(t){t.interpolatedPoints=t.getPointsOnGraph(),(t.options.label.boxesToAvoid||[]).forEach(function(t){y.boxesToAvoid.push(t)})}),y.series.forEach(function(t){function e(t,e,r){var o=Math.max(p,M(a,-1/0)),i=Math.min(p+u,M(h,1/0));return o<t&&t<=i-r.width&&d<=e&&e<=d+f-r.height}var r=t.options.label;if(r&&(t.xAxis||t.yAxis)){var o,a,h,i="highcharts-color-"+M(t.colorIndex,"none"),n=!t.labelBySeries,s=r.minFontSize,l=r.maxFontSize,c=y.inverted,p=(c?t.yAxis:t.xAxis).pos,d=(c?t.xAxis:t.yAxis).pos,u=(y.inverted?t.yAxis:t.xAxis).len,f=(y.inverted?t.xAxis:t.yAxis).len,x=t.interpolatedPoints,b=M(r.onArea,!!t.area),m=[],g=t.labelBySeries;if(b&&!c&&(c=[t.xAxis.toPixels(t.xData[0]),t.xAxis.toPixels(t.xData[t.xData.length-1])],a=Math.min.apply(Math,c),h=Math.max.apply(Math,c)),t.visible&&!t.isSeriesBoosting&&x){for(g||(g=t.name,"string"==typeof r.format?g=X(r.format,t,y):r.formatter&&(g=r.formatter.call(t)),t.labelBySeries=g=y.renderer.label(g,0,-9999,"connector").addClass("highcharts-series-label highcharts-series-label-"+t.index+" "+(t.options.className||"")+" "+i),y.renderer.styledMode||(g.css(w({color:b?y.renderer.getContrast(t.color):t.color},r.style||{})),g.attr({opacity:y.renderer.forExport?1:0,stroke:t.color,"stroke-width":1})),s&&l&&g.css({fontSize:t.labelFontSize(s,l)}),g.attr({padding:0,zIndex:3}).add()),(i=g.getBBox()).width=Math.round(i.width),c=x.length-1;0<c;--c)b?e(s=x[c].chartX-i.width/2,l=x[c].chartCenterY-i.height/2,i)&&(o=t.checkClearPoint(s,l,i)):((o=e(s=x[c].chartX+3,l=x[c].chartY-i.height-3,i)?t.checkClearPoint(s,l,i,!0):o)&&m.push(o),(o=e(s=x[c].chartX+3,l=x[c].chartY+3,i)?t.checkClearPoint(s,l,i,!0):o)&&m.push(o),(o=e(s=x[c].chartX-i.width-3,l=x[c].chartY+3,i)?t.checkClearPoint(s,l,i,!0):o)&&m.push(o),e(s=x[c].chartX-i.width-3,l=x[c].chartY-i.height-3,i)&&(o=t.checkClearPoint(s,l,i,!0))),o&&m.push(o);if(r.connectorAllowed&&!m.length&&!b)for(s=p+u-i.width;p<=s;s-=16)for(l=d;l<d+f-i.height;l+=16)(o=t.checkClearPoint(s,l,i,!0))&&m.push(o);m.length?(m.sort(function(t,e){return e.weight-t.weight}),o=m[0],y.boxesToAvoid.push({left:o.x,right:o.x+i.width,top:o.y,bottom:o.y+i.height}),(x=Math.sqrt(Math.pow(Math.abs(o.x-(g.x||0)),2)+Math.pow(Math.abs(o.y-(g.y||0)),2)))&&t.labelBySeries&&(m={opacity:y.renderer.forExport?1:0,x:o.x,y:o.y},r={opacity:1},x<=10&&(r={x:m.x,y:m.y},m={}),x=void 0,n&&((x=Y(t.options.animation)).duration*=.2),t.labelBySeries.attr(w(m,{anchorX:o.connectorPoint&&o.connectorPoint.plotX+p,anchorY:o.connectorPoint&&o.connectorPoint.plotY+d})).animate(r,x),t.options.kdNow=!0,t.buildKDTree(),t=t.searchPoint({chartX:o.x,chartY:o.y},!0))&&(g.closest=[t,o.x-(t.plotX||0),o.y-(t.plotY||0)])):g&&(t.labelBySeries=g.destroy())}else g&&(t.labelBySeries=g.destroy())}}),c(y,"afterDrawSeriesLabels")},r(e,"load",h),r(e,"redraw",h)}),e(t,"masters/modules/series-label.src.js",[],function(){})});