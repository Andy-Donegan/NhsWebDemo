"use strict";!function(t){"object"==typeof module&&module.exports?module.exports=t.default=t:"function"==typeof define&&define.amd?define("highcharts/modules/sonification",["highcharts"],function(n){return t(n),t.Highcharts=n,t}):t("undefined"!=typeof Highcharts?Highcharts:void 0)}(function(n){n=n?n._modules:{};function t(n,t,i,e){n.hasOwnProperty(t)||(n[t]=e.apply(null,i))}t(n,"Extensions/Sonification/MusicalFrequencies.js",[],function(){return[16.351597831287414,17.323914436054505,18.354047994837977,19.445436482630058,20.601722307054366,21.826764464562746,23.12465141947715,24.499714748859326,25.956543598746574,27.5,29.13523509488062,30.86770632850775,32.70319566257483,34.64782887210901,36.70809598967594,38.890872965260115,41.20344461410875,43.653528929125486,46.2493028389543,48.999429497718666,51.91308719749314,55,58.27047018976124,61.7354126570155,65.40639132514966,69.29565774421802,73.41619197935188,77.78174593052023,82.4068892282175,87.30705785825097,92.4986056779086,97.99885899543733,103.82617439498628,110,116.54094037952248,123.47082531403103,130.8127826502993,138.59131548843604,146.8323839587038,155.56349186104046,164.81377845643496,174.61411571650194,184.9972113558172,195.99771799087463,207.65234878997256,220,233.08188075904496,246.94165062806206,261.6255653005986,277.1826309768721,293.6647679174076,311.1269837220809,329.6275569128699,349.2282314330039,369.9944227116344,391.99543598174927,415.3046975799451,440,466.1637615180899,493.8833012561241,523.2511306011972,554.3652619537442,587.3295358348151,622.2539674441618,659.2551138257398,698.4564628660078,739.9888454232688,783.9908719634985,830.6093951598903,880,932.3275230361799,987.7666025122483,1046.5022612023945,1108.7305239074883,1174.6590716696303,1244.5079348883237,1318.5102276514797,1396.9129257320155,1479.9776908465376,1567.981743926997,1661.2187903197805,1760,1864.6550460723597,1975.533205024496,2093.004522404789,2217.4610478149766,2349.31814333926,2489.0158697766474,2637.02045530296,2793.825851464031,2959.955381693075,3135.9634878539946,3322.437580639561,3520,3729.3100921447194,3951.066410048992,4186.009044809578]}),t(n,"Extensions/Sonification/SignalHandler.js",[],function(){function n(n){this.signals=void 0,this.supportedSignals=void 0,this.init(n||[])}return n.prototype.init=function(n){this.supportedSignals=n,this.signals={}},n.prototype.registerSignalCallbacks=function(i){var e=this;e.supportedSignals.forEach(function(n){var t=i[n];t&&(e.signals[n]=e.signals[n]||[]).push(t)})},n.prototype.clearSignalCallbacks=function(n){var t=this;n?n.forEach(function(n){t.signals[n]&&delete t.signals[n]}):t.signals={}},n.prototype.emitSignal=function(n,t){var i;return this.signals[n]&&this.signals[n].forEach(function(n){n=n(t);i=void 0!==n?n:i}),i},n}),t(n,"Extensions/Sonification/SonificationUtilities.js",[n["Extensions/Sonification/MusicalFrequencies.js"],n["Extensions/Sonification/SignalHandler.js"],n["Core/Utilities.js"]],function(n,t,i){var a=i.clamp,r=i.merge,u={musicalFrequencies:n,SignalHandler:t,getExtremesForInstrumentProps:function(e,n,t){function i(n){return{instrumentMapping:n.mapping}}var o=e.options.sonification&&e.options.sonification.defaultInstrumentOptions,s=(n||[]).slice(0);o&&s.push(i(o));return e.series.forEach(function(n){n=n.options.sonification&&n.options.sonification.instruments;n&&(s=s.concat(n.map(i)))}),s.reduce(function(t,i){return Object.keys(i.instrumentMapping||{}).forEach(function(n){n=i.instrumentMapping[n];"string"!=typeof n||t[n]||(t[n]=u.calculateDataExtremes(e,n))}),t},r(t))},getMusicalScale:function(e){return n.filter(function(n,t){var i=t%12+1;return e.some(function(n){return n===i})})},calculateDataExtremes:function(n,i){return n.series.reduce(function(t,n){return n.points.forEach(function(n){n=(void 0!==n[i]?n:n.options)[i];t.min=Math.min(t.min,n),t.max=Math.max(t.max,n)}),t},{min:1/0,max:-1/0})},virtualAxisTranslate:function(n,t,i,e){var o=t.max-t.min,s=Math.abs(i.max-i.min),t=e?t.max-n:n-t.min,t=i.min+s*t/o;return 0<o?a(t,i.min,i.max):i.min}};return u}),t(n,"Extensions/Sonification/Options.js",[],function(){return{sonification:{enabled:!1,duration:2500,afterSeriesWait:700,masterVolume:1,order:"sequential",defaultInstrumentOptions:{instrument:"sineMusical",minFrequency:392,maxFrequency:1046,mapping:{pointPlayTime:"x",duration:200,frequency:"y"}}}}}),t(n,"Extensions/Sonification/Sonification.js",[n["Core/DefaultOptions.js"],n["Core/Utilities.js"],n["Extensions/Sonification/SonificationUtilities.js"],n["Extensions/Sonification/Options.js"]],function(n,t,i,e){n=n.defaultOptions;return(0,t.merge)(!0,n,e),{fadeOutDuration:20,utilities:i}}),t(n,"Extensions/Sonification/Instrument.js",[n["Core/Globals.js"],n["Extensions/Sonification/Sonification.js"],n["Extensions/Sonification/SonificationUtilities.js"],n["Core/Utilities.js"]],function(n,s,t,i){var e=n.win,o=i.error,a=i.merge,r=i.pick,u=i.uniqueKey,c=(l.prototype.init=function(n){var t;this.initAudioContext()?(this.options=a(l.defaultOptions,n),this.id=this.options.id=n&&n.id||u(),this.masterVolume=this.options.masterVolume||0,t=l.audioContext,n=this.destinationNode||t.destination,this.gainNode=t.createGain(),this.setGain(0),this.panNode=t.createStereoPanner&&t.createStereoPanner(),this.panNode?(this.setPan(0),this.gainNode.connect(this.panNode),this.panNode.connect(n)):this.gainNode.connect(n),"oscillator"===this.options.type&&this.initOscillator(this.options.oscillator),this.playCallbackTimers=[]):o(29)},l.prototype.copy=function(n){return new l(a(this.options,{id:null},n))},l.prototype.initAudioContext=function(){var n=e.AudioContext||e.webkitAudioContext,t=!!l.audioContext;return!!n&&(l.audioContext=l.audioContext||new n,!t&&l.audioContext&&"running"===l.audioContext.state&&l.audioContext.suspend(),!!(l.audioContext&&l.audioContext.createOscillator&&l.audioContext.createGain))},l.prototype.initOscillator=function(n){var t=l.audioContext;this.oscillator=t.createOscillator(),this.oscillator.type=n.waveformShape,this.oscillator.connect(this.gainNode),this.oscillatorStarted=!1},l.prototype.setPan=function(n){this.panNode&&this.panNode.pan.setValueAtTime(n,l.audioContext.currentTime)},l.prototype.setGain=function(n,t){var i=this.gainNode,n=n*this.masterVolume;i&&(1.2<n&&(console.warn("Highcharts sonification warning: Volume of instrument set too high."),n=1.2),t?(i.gain.setValueAtTime(i.gain.value,l.audioContext.currentTime),i.gain.linearRampToValueAtTime(n,l.audioContext.currentTime+t/1e3)):i.gain.setValueAtTime(n,l.audioContext.currentTime))},l.prototype.cancelGainRamp=function(){this.gainNode&&this.gainNode.gain.cancelScheduledValues(0)},l.prototype.setMasterVolume=function(n){this.masterVolume=n||0},l.prototype.getValidFrequency=function(i,n,t){var e=this.options.allowedFrequencies,o=r(t,1/0),s=r(n,-1/0);return e&&e.length?e.reduce(function(n,t){return Math.abs(t-i)<Math.abs(n-i)&&t<o&&s<t?t:n},1/0):i},l.prototype.clearPlayCallbackTimers=function(){this.playCallbackTimers.forEach(function(n){clearInterval(n)}),this.playCallbackTimers=[]},l.prototype.setFrequency=function(n,t){t=t||{},t=this.getValidFrequency(n,t.min,t.max);"oscillator"===this.options.type&&this.oscillatorPlay(t)},l.prototype.oscillatorPlay=function(n){this.oscillatorStarted||(this.oscillator.start(),this.oscillatorStarted=!0),this.oscillator.frequency.setValueAtTime(n,l.audioContext.currentTime)},l.prototype.preparePlay=function(){this.setGain(.001),"suspended"===l.audioContext.state&&l.audioContext.resume(),this.oscillator&&!this.oscillatorStarted&&(this.oscillator.start(),this.oscillatorStarted=!0)},l.prototype.play=function(n){function t(t,i,e){var o,s=n.duration,a=u.options.playCallbackInterval,r=0;"function"==typeof t?(o=setInterval(function(){var n=++r*a/s;1<=n?(u[i](t(1),e),clearInterval(o)):u[i](t(n),e)},a),u.playCallbackTimers.push(o)):u[i](t,e)}var u=this,i=n.duration||0;if(u.id){if("suspended"===l.audioContext.state||this.oscillator&&!this.oscillatorStarted)return u.preparePlay(),void setTimeout(function(){u.play(n)},10);u.playCallbackTimers.length&&u.clearPlayCallbackTimers(),u.cancelGainRamp(),u.stopOscillatorTimeout&&(clearTimeout(u.stopOscillatorTimeout),delete u.stopOscillatorTimeout),u.stopTimeout&&(clearTimeout(u.stopTimeout),delete u.stopTimeout,u.stopCallback&&(u._play=u.play,u.play=function(){},u.stopCallback("cancelled"),u.play=u._play));var e=i<s.fadeOutDuration+20;u.stopCallback=n.onEnd;var o=function(){delete u.stopTimeout,u.stop(e)};i?(u.stopTimeout=setTimeout(o,e?i:i-s.fadeOutDuration),t(n.frequency,"setFrequency",{minFrequency:n.minFrequency,maxFrequency:n.maxFrequency}),t(r(n.volume,1),"setGain",4),t(r(n.pan,0),"setPan")):o()}},l.prototype.mute=function(){this.setGain(1e-4,.8*s.fadeOutDuration)},l.prototype.stop=function(n,t,i){function e(){if(o.stopOscillatorTimeout&&delete o.stopOscillatorTimeout,o.oscillator&&o.options.oscillator){try{o.oscillator.stop()}catch(n){}o.gainNode&&o.oscillator.disconnect(o.gainNode),o.initOscillator(o.options.oscillator)}t&&t(i),o.stopCallback&&o.stopCallback(i)}var o=this;o.playCallbackTimers.length&&o.clearPlayCallbackTimers(),o.stopTimeout&&clearTimeout(o.stopTimeout),n?(o.setGain(0),e()):(o.mute(),o.stopOscillatorTimeout=setTimeout(e,s.fadeOutDuration+100))},l.defaultOptions={type:"oscillator",playCallbackInterval:20,masterVolume:1,oscillator:{waveformShape:"sine"}},l.definitions={},l);function l(n){this.id=void 0,this.masterVolume=void 0,this.options=void 0,this.playCallbackTimers=void 0,this.init(n)}return["sine","square","triangle","sawtooth"].forEach(function(n){c.definitions[n]=new c({oscillator:{waveformShape:n}}),c.definitions[n+"Musical"]=new c({allowedFrequencies:t.musicalFrequencies,oscillator:{waveformShape:n}}),c.definitions[n+"Major"]=new c({allowedFrequencies:t.getMusicalScale([1,3,5,6,8,10,12]),oscillator:{waveformShape:n}})}),c}),t(n,"Extensions/Sonification/Earcon.js",[n["Extensions/Sonification/Instrument.js"],n["Core/Utilities.js"]],function(l,n){var p=n.error,f=n.merge,m=n.pick,t=n.uniqueKey;function i(n){this.id=void 0,this.instrumentsPlaying=void 0,this.options=void 0,this.init(n||{})}return i.prototype.init=function(n){this.options=n,this.options.id||(this.options.id=this.id=t()),this.instrumentsPlaying={}},i.prototype.sonify=function(n){var t=f(this.options,n),s=m(t.volume,1),a=t.pan,r=this,u=n&&n.onEnd,c=r.options.onEnd;t.instruments.forEach(function(n){var t,i="string"==typeof n.instrument?l.definitions[n.instrument]:n.instrument,e=f(n.playOptions),o="";i&&i.play?n.playOptions&&(e.pan=m(a,e.pan),t=e.onEnd,e.onEnd=function(){delete r.instrumentsPlaying[o],t&&t.apply(this,arguments),Object.keys(r.instrumentsPlaying).length||(u&&u.apply(this,arguments),c&&c.apply(this,arguments))},(i=i.copy()).setMasterVolume(s),o=i.id,(r.instrumentsPlaying[o]=i).play(e)):p(30)})},i.prototype.cancelSonify=function(t){var i=this.instrumentsPlaying,n=i&&Object.keys(i);n&&n.length&&(n.forEach(function(n){i[n].stop(!t,null,"cancelled")}),this.instrumentsPlaying={})},i}),t(n,"Extensions/Sonification/Timeline.js",[n["Extensions/Sonification/Sonification.js"],n["Core/Utilities.js"],n["Extensions/Sonification/SonificationUtilities.js"]],function(t,n,i){var e=n.merge,c=n.splat;function o(n){this.cursor=void 0,this.options=void 0,this.paths=void 0,this.pathsPlaying=void 0,this.signalHandler=void 0,this.init(n||{})}return o.prototype.init=function(n){this.options=n,this.cursor=0,this.paths=n.paths||[],this.pathsPlaying={},this.signalHandler=new i.SignalHandler(["playOnEnd","masterOnEnd","onPathStart","onPathEnd"]),this.signalHandler.registerSignalCallbacks(e(n,{masterOnEnd:n.onEnd}))},o.prototype.play=function(n){this.pause(),this.signalHandler.clearSignalCallbacks(["playOnEnd"]),this.signalHandler.registerSignalCallbacks({playOnEnd:n}),this.playPaths(1)},o.prototype.rewind=function(n){this.pause(),this.signalHandler.clearSignalCallbacks(["playOnEnd"]),this.signalHandler.registerSignalCallbacks({playOnEnd:n}),this.playPaths(-1)},o.prototype.playPaths=function(o){var s=this,a=s.signalHandler;if(!s.paths.length){var n={cancelled:!1};return a.emitSignal("playOnEnd",n),void a.emitSignal("masterOnEnd",n)}var r=c(this.paths[this.cursor]),u=this.paths[this.cursor+o];r.forEach(function(n){n&&(n.timeline=s,setTimeout(function(){var e;e=n,a.emitSignal("onPathStart",e),(s.pathsPlaying[e.id]=e)[0<o?"play":"rewind"](function(n){var t=n&&n.cancelled,i={path:e,cancelled:t};delete s.pathsPlaying[e.id],a.emitSignal("onPathEnd",i);n=0;n++,r.length<=1&&(u&&!t?(s.cursor+=o,c(u).forEach(function(n){n[0<o?"resetCursor":"resetCursorEnd"]()}),s.playPaths(o)):(a.emitSignal("playOnEnd",i),a.emitSignal("masterOnEnd",i)))})},t.fadeOutDuration))})},o.prototype.pause=function(t){var i=this;Object.keys(i.pathsPlaying).forEach(function(n){i.pathsPlaying[n]&&i.pathsPlaying[n].pause(t)}),i.pathsPlaying={}},o.prototype.resetCursor=function(){this.paths.forEach(function(n){c(n).forEach(function(n){n.resetCursor()})}),this.cursor=0},o.prototype.resetCursorEnd=function(){this.paths.forEach(function(n){c(n).forEach(function(n){n.resetCursorEnd()})}),this.cursor=this.paths.length-1},o.prototype.setCursor=function(t){return this.paths.some(function(n){return c(n).some(function(n){return n.setCursor(t)})})},o.prototype.getCursor=function(){return this.getCurrentPlayingPaths().reduce(function(n,t){return n[t.id]=t.getCursor(),n},{})},o.prototype.atStart=function(){return!this.cursor&&!c(this.paths[0]).some(function(n){return n.cursor})},o.prototype.getCurrentPlayingPaths=function(){return this.paths.length?c(this.paths[this.cursor]):[]},o}),t(n,"Extensions/Sonification/TimelineEvent.js",[n["Core/Utilities.js"]],function(n){var s=n.merge,t=n.uniqueKey;function i(n){this.id=void 0,this.options=void 0,this.time=void 0,this.init(n)}return i.prototype.init=function(n){this.options=n,this.time=n.time||0,this.id=this.options.id=n.id||t()},i.prototype.play=function(n){var t=this.options.eventObject,i=this.options.onEnd,e=n&&n.onEnd,o=this.options.playOptions&&this.options.playOptions.onEnd,n=s(this.options.playOptions,n);t&&t.sonify?(n.onEnd=i||e||o?function(){var t=arguments;[i,e,o].forEach(function(n){n&&n.apply(this,t)})}:void 0,t.sonify(n)):(e&&e(),i&&i())},i.prototype.cancel=function(n){var t=this.options.eventObject;t&&t.cancelSonify(n)},i}),t(n,"Extensions/Sonification/TimelinePath.js",[n["Extensions/Sonification/TimelineEvent.js"],n["Extensions/Sonification/SonificationUtilities.js"],n["Core/Utilities.js"]],function(t,i,n){var e=n.merge,o=n.uniqueKey;function s(n){this.cursor=void 0,this.events=void 0,this.eventIdMap=void 0,this.eventsPlaying=void 0,this.id=void 0,this.options=void 0,this.signalHandler=void 0,this.init(n)}return s.prototype.init=function(n){this.options=n,this.id=this.options.id=n.id||o(),this.cursor=0,this.eventsPlaying={},this.events=n.silentWait?[new t({time:0}),new t({time:n.silentWait})]:this.options.events,this.targetDuration=n.targetDuration||n.silentWait,this.sortEvents(),this.updateEventIdMap(),this.signalHandler=new i.SignalHandler(["playOnEnd","masterOnEnd","onStart","onEventStart","onEventEnd"]),this.signalHandler.registerSignalCallbacks(e(n,{masterOnEnd:n.onEnd}))},s.prototype.sortEvents=function(){this.events=this.events.sort(function(n,t){return n.time-t.time})},s.prototype.updateEventIdMap=function(){this.eventIdMap=this.events.reduce(function(n,t,i){return n[t.id]=i,n},{})},s.prototype.addTimelineEvents=function(n){this.events=this.events.concat(n),this.sortEvents(),this.updateEventIdMap()},s.prototype.getCursor=function(){return this.events[this.cursor]},s.prototype.setCursor=function(n){n=this.eventIdMap[n];return void 0!==n&&(this.cursor=n,!0)},s.prototype.play=function(n){this.pause(),this.signalHandler.emitSignal("onStart"),this.signalHandler.clearSignalCallbacks(["playOnEnd"]),this.signalHandler.registerSignalCallbacks({playOnEnd:n}),this.playEvents(1)},s.prototype.rewind=function(n){this.pause(),this.signalHandler.emitSignal("onStart"),this.signalHandler.clearSignalCallbacks(["playOnEnd"]),this.signalHandler.registerSignalCallbacks({playOnEnd:n}),this.playEvents(-1)},s.prototype.resetCursor=function(){this.cursor=0},s.prototype.resetCursorEnd=function(){this.cursor=this.events.length-1},s.prototype.pause=function(t){var i=this;clearTimeout(i.nextScheduledPlay),Object.keys(i.eventsPlaying).forEach(function(n){i.eventsPlaying[n]&&i.eventsPlaying[n].cancel(t)}),i.eventsPlaying={}},s.prototype.playEvents=function(n){function t(n){e.signalHandler.emitSignal("masterOnEnd",n),e.signalHandler.emitSignal("playOnEnd",n)}var i,e=this,o=e.events[this.cursor],s=e.events[this.cursor+n];!1!==(o.timelinePath=e).signalHandler.emitSignal("onEventStart",o)?((e.eventsPlaying[o.id]=o).play({onEnd:function(n){n={event:o,cancelled:!!n};delete e.eventsPlaying[o.id],e.signalHandler.emitSignal("onEventEnd",n),s||t(n)}}),s&&((i=Math.abs(s.time-o.time))<1?(e.cursor+=n,e.playEvents(n)):this.nextScheduledPlay=setTimeout(function(){e.cursor+=n,e.playEvents(n)},i))):t({event:o,cancelled:!0})},s}),t(n,"Extensions/Sonification/SeriesSonify.js",[n["Extensions/Sonification/Earcon.js"],n["Extensions/Sonification/Instrument.js"],n["Core/Series/Point.js"],n["Extensions/Sonification/SonificationUtilities.js"],n["Extensions/Sonification/Timeline.js"],n["Extensions/Sonification/TimelineEvent.js"],n["Extensions/Sonification/TimelinePath.js"],n["Core/Utilities.js"]],function(p,f,m,n,o,h,d,t){var i,e,y=n.getExtremesForInstrumentProps,g=n.virtualAxisTranslate,s=t.extend,a=t.find,r=t.isArray,v=t.merge,u=t.objectEach,E=t.pick;function c(n,s){var t,i,e,o,a=s.timeExtremes||x(n,s.pointPlayTime),r=y(n.chart,s.instruments,s.dataExtremes),u=(i=s.instruments,e=r,o=n.points[n.points.length-1],i.reduce(function(n,t){t=t.instrumentMapping.duration,t="string"==typeof t?0:"function"==typeof t?t(o,e):t;return Math.max(n,t)},0)),c=E(s.masterVolume,1),i=s.instruments.map(function(n){var t=n.instrument,t=("string"==typeof t?f.definitions[t]:t).copy();return v(n,{instrument:t})}),l=(t=c,(i=i).forEach(function(n){n=n.instrument;"string"!=typeof n&&n.setMasterVolume(t)}),i),i=n.points.reduce(function(n,t){var o,i=(o=t,(s.earcons||[]).reduce(function(n,t){var i,e=t.earcon;return t.condition?(i=t.condition(o))instanceof p?n.push(i):i&&n.push(e):t.onPoint&&o.id===t.onPoint&&n.push(e),n},[])),e=g(S(t,s.pointPlayTime),a,{min:0,max:Math.max(s.duration-u,10)});return n.concat(new h({eventObject:t,time:e,id:t.id,playOptions:{instruments:l,dataExtremes:r,masterVolume:c}}),i.map(function(n){return new h({eventObject:n,time:e,playOptions:{volume:c}})}))},[]);return new d({events:i,onStart:function(){s.onStart&&s.onStart(n)},onEventStart:function(n){var t=n.options&&n.options.eventObject;if(t instanceof m){if(!t.series.visible&&!t.series.chart.series.some(function(n){return n.visible}))return n.timelinePath.timeline.pause(),n.timelinePath.timeline.resetCursor(),!1;s.onPointStart&&s.onPointStart(n,t)}},onEventEnd:function(n){var t=n.event&&n.event.options&&n.event.options.eventObject;t instanceof m&&s.onPointEnd&&s.onPointEnd(n.event,t)},onEnd:function(){s.onEnd&&s.onEnd(n)},targetDuration:s.duration})}function l(n){var t=n.options.sonification||{},i=n.chart.options.sonification||{},e=i.events||{},o=t.events||{};return{onEnd:o.onSeriesEnd||e.onSeriesEnd,onStart:o.onSeriesStart||e.onSeriesStart,onPointEnd:o.onPointEnd||e.onPointEnd,onPointStart:o.onPointStart||e.onPointStart,pointPlayTime:i.defaultInstrumentOptions&&i.defaultInstrumentOptions.mapping&&i.defaultInstrumentOptions.mapping.pointPlayTime,masterVolume:i.masterVolume,instruments:function(n,t){if(t&&t.instruments)return t.instruments;function i(i){u(i,function(n,t){null===n&&delete i[t]})}var e=n.chart.options.sonification&&n.chart.options.sonification.defaultInstrumentOptions||{},n=n.options.sonification&&n.options.sonification.instruments||[{}];return n.map(function(n){return i(n.mapping||{}),i(n),{instrument:n.instrument||e.instrument,instrumentOptions:v(e,n,{mapping:void 0,instrument:void 0}),instrumentMapping:v(e.mapping,n.mapping)}})}(n),earcons:t.earcons||i.earcons}}function S(n,t){return"function"==typeof t?t(n):E(n[t],n.options[t])}function x(n,i){return n.points.reduce(function(n,t){t=S(t,i);return n.min=Math.min(n.min,t),n.max=Math.max(n.max,t),n},{min:1/0,max:-1/0})}function P(n){var t,i,e,e=(i=n,e=(t=this).chart.options.sonification,n=t.options.sonification,v({duration:n&&n.duration||e&&e.duration},l(t),i)),t=c(this,e),i=this.chart.sonification;i&&(i.timeline&&i.timeline.pause(),i.duration=e.duration,i.timeline=new o({paths:[t]}),i.timeline.play())}return t=i=i||{},e=[],t.compose=function(n){var t;return-1===e.indexOf(n)&&(e.push(n),t=n.prototype,s(t,{sonify:P})),n},t.buildChartSonifySeriesOptions=function(t,n,i){var e=i.seriesOptions||{},o=(s=t.chart.options.sonification)&&s.defaultInstrumentOptions&&s.defaultInstrumentOptions.mapping&&s.defaultInstrumentOptions.mapping.pointPlayTime||"x",s=l(t);return v(s,{dataExtremes:n,timeExtremes:x(t,o),instruments:i.instruments||s.instruments,onStart:i.onSeriesStart||s.onStart,onEnd:i.onSeriesEnd||s.onEnd,earcons:i.earcons||s.earcons,masterVolume:E(i.masterVolume,s.masterVolume)},r(e)?a(e,function(n){return n.id===E(t.id,t.options.id)})||{}:e,{pointPlayTime:o})},t.buildTimelinePathFromSeries=c,i}),t(n,"Extensions/Sonification/ChartSonify.js",[n["Extensions/Sonification/Earcon.js"],n["Core/Series/Point.js"],n["Extensions/Sonification/SeriesSonify.js"],n["Extensions/Sonification/SonificationUtilities.js"],n["Extensions/Sonification/Timeline.js"],n["Extensions/Sonification/TimelineEvent.js"],n["Extensions/Sonification/TimelinePath.js"],n["Core/Utilities.js"]],function(c,i,l,n,p,f,m,t){var h=n.getExtremesForInstrumentProps,s=n.virtualAxisTranslate,e=t.addEvent,o=t.extend,d=t.merge,a=t.pick,y=t.splat;function g(n,t){var e=Math.max(t-n.reduce(function(n,t){t=y(t);return n+(1===t.length&&t[0].options&&t[0].options.silentWait||0)},0),0),o=n.reduce(function(n,t){return n+y(t).reduce(function(n,t){t=t.series&&t.seriesOptions&&t.seriesOptions.timeExtremes;return t?Math.max(n,t.max-t.min):n},0)},0);return n.reduce(function(n,t){t=y(t).reduce(function(n,t){var i;return t instanceof m?n.push(t):t.series&&(t.seriesOptions.duration=t.seriesOptions.duration||(i=t.seriesOptions.timeExtremes.max-t.seriesOptions.timeExtremes.min,s(i,{min:0,max:o},{min:0,max:e})),n.push(l.buildTimelinePathFromSeries(t.series,t.seriesOptions))),n},[]);return n.push(t),n},[])}function r(n){var t,i=(t=(t=this).options.sonification||{},d({duration:t.duration,afterSeriesWait:t.afterSeriesWait,pointPlayTime:t.defaultInstrumentOptions&&t.defaultInstrumentOptions.mapping&&t.defaultInstrumentOptions.mapping.pointPlayTime,order:t.order,onSeriesStart:t.events&&t.events.onSeriesStart,onSeriesEnd:t.events&&t.events.onSeriesEnd,onEnd:t.events&&t.events.onEnd},n));this.sonification.timeline&&this.sonification.timeline.pause(),this.sonification.duration=i.duration;var o,s,e,a,r=h(this,i.instruments,i.dataExtremes),u=(n=i.order,o=this,s=function(n){return l.buildChartSonifySeriesOptions(n,r,i)},"sequential"===n||"simultaneous"===n?(u=o.series.reduce(function(n,t){return t.visible&&!1!==(t.options.sonification&&t.options.sonification.enabled)&&n.push({series:t,seriesOptions:s(t)}),n},[]),"simultaneous"===n&&(u=[u])):u=n.reduce(function(n,t){t=y(t).reduce(function(n,t){var i,e;return"string"==typeof t?(e=o.get(t)).visible&&(i={series:e,seriesOptions:s(e)}):t instanceof c&&(i=new m({events:[new f({eventObject:t})]})),(i=t.silentWait?new m({silentWait:t.silentWait}):i)&&n.push(i),n},[]);return t.length&&n.push(t),n},[]),u);e=u;var u=g(u=(a=i.afterSeriesWait||0)?e.reduce(function(n,t,i){t=y(t);return n.push(t),i<e.length-1&&t.some(function(n){return n.series})&&n.push(new m({silentWait:a})),n},[]):e,i.duration);u.forEach(function(n){var o;o=(n=n).reduce(function(n,t){t=t.events;return t&&t.length&&(n.min=Math.min(t[0].time,n.min),n.max=Math.max(t[t.length-1].time,n.max)),n},{min:1/0,max:-1/0}),n.forEach(function(n){var t=n.events,i=t&&t.length,e=[];i&&t[0].time<=o.min||e.push(new f({time:o.min})),i&&t[t.length-1].time>=o.max||e.push(new f({time:o.max})),e.length&&n.addTimelineEvents(e)})}),this.sonification.timeline=new p({paths:u,onEnd:i.onEnd}),this.sonification.timeline.play()}function u(){var t;return this.sonification.timeline?(t=this.sonification.timeline.getCursor(),Object.keys(t).map(function(n){return t[n].options.eventObject}).filter(function(n){return n instanceof i})):[]}function v(n){var t=this.sonification.timeline;t&&y(n).forEach(function(n){t.setCursor(n.id)})}function E(n){this.sonification.timeline?this.sonification.timeline.pause(a(n,!0)):this.sonification.currentlyPlayingPoint&&this.sonification.currentlyPlayingPoint.cancelSonify(n)}function S(n){this.sonification.timeline&&this.sonification.timeline.play(n)}function x(n){this.sonification.timeline&&this.sonification.timeline.rewind(n)}function P(n){this.pauseSonify(n),this.resetSonifyCursor()}function C(){this.sonification.timeline&&this.sonification.timeline.resetCursor()}function O(){this.sonification.timeline&&this.sonification.timeline.resetCursorEnd()}var j=[];return{chartSonify:r,compose:function(n){var t;return-1===j.indexOf(n)&&(j.push(n),t=n.prototype,o(t,{sonify:r,pauseSonify:E,resumeSonify:S,rewindSonify:x,cancelSonify:P,getCurrentSonifyPoints:u,setSonifyCursor:v,resetSonifyCursor:C,resetSonifyCursorEnd:O}),e(n,"init",function(){this.sonification={}}),e(n,"update",function(n){n=n.options.sonification;n&&d(!0,this.options.sonification,n)})),n},pause:E,resume:S,rewind:x,cancel:P,getCurrentPoints:u,setCursor:v,resetCursor:C,resetCursorEnd:O}}),t(n,"Extensions/Sonification/PointSonify.js",[n["Extensions/Sonification/Instrument.js"],n["Core/Utilities.js"],n["Extensions/Sonification/SonificationUtilities.js"]],function(p,n,f){var t,m=n.error,h=n.merge,d=n.pick,i=[],y={minDuration:20,maxDuration:2e3,minVolume:.1,maxVolume:1,minPan:-1,maxPan:1,minFrequency:220,maxFrequency:2200};function e(n){function s(t,n,i){if("function"==typeof t)return n?function(n){return t(a,c,n)}:t(a,c);if("string"!=typeof t)return t;var e="-"===t.charAt(0),o=e?t.slice(1):t,n=d(a[o],a.options[o]);return c[o]=c[o]||f.calculateDataExtremes(a.series.chart,o),f.virtualAxisTranslate(n,c[o],i,e)}var a=this,r=a.series.chart,u=d(n.masterVolume,r.options.sonification&&r.options.sonification.masterVolume),c=n.dataExtremes||{};(r.sonification.currentlyPlayingPoint=a).sonification=a.sonification||{},a.sonification.instrumentsPlaying=a.sonification.instrumentsPlaying||{};var l=a.sonification.signalHandler=a.sonification.signalHandler||new f.SignalHandler(["onEnd"]);l.clearSignalCallbacks(),l.registerSignalCallbacks({onEnd:n.onEnd}),!a.isNull&&a.visible&&a.series.visible?n.instruments.forEach(function(t){var n="string"==typeof t.instrument?p.definitions[t.instrument]:t.instrument,i=t.instrumentMapping||{},e=h(y,t.instrumentOptions),o=n.id;n&&n.play?(void 0!==u&&n.setMasterVolume(u),(a.sonification.instrumentsPlaying[n.id]=n).play({frequency:s(i.frequency,!0,{min:e.minFrequency,max:e.maxFrequency}),duration:s(i.duration,!1,{min:e.minDuration,max:e.maxDuration}),pan:s(i.pan,!0,{min:e.minPan,max:e.maxPan}),volume:s(i.volume,!0,{min:e.minVolume,max:e.maxVolume}),onEnd:function(n){t.onEnd&&t.onEnd.apply(this,arguments),r.sonification&&r.sonification.currentlyPlayingPoint&&delete r.sonification.currentlyPlayingPoint,a.sonification&&a.sonification.instrumentsPlaying&&(delete a.sonification.instrumentsPlaying[o],Object.keys(a.sonification.instrumentsPlaying).length||l.emitSignal("onEnd",n))},minFrequency:e.minFrequency,maxFrequency:e.maxFrequency})):m(30)}):l.emitSignal("onEnd")}function o(t){var i=this.sonification&&this.sonification.instrumentsPlaying,n=i&&Object.keys(i);n&&n.length&&(n.forEach(function(n){i[n].stop(!t,null,"cancelled")}),this.sonification.instrumentsPlaying={},this.sonification.signalHandler.emitSignal("onEnd","cancelled"))}return(t||(t={})).compose=function(n){var t;return-1===i.indexOf(n)&&(i.push(n),(t=n.prototype).sonify=e,t.cancelSonify=o),n},t}),t(n,"masters/modules/sonification.src.js",[n["Core/Globals.js"],n["Extensions/Sonification/ChartSonify.js"],n["Extensions/Sonification/Earcon.js"],n["Extensions/Sonification/Instrument.js"],n["Extensions/Sonification/PointSonify.js"],n["Extensions/Sonification/SeriesSonify.js"],n["Extensions/Sonification/Sonification.js"],n["Extensions/Sonification/Timeline.js"],n["Extensions/Sonification/TimelineEvent.js"],n["Extensions/Sonification/TimelinePath.js"]],function(n,t,i,e,o,s,a,r,u,c){var l=this&&this.__assign||function(){return(l=Object.assign||function(n){for(var t,i=1,e=arguments.length;i<e;i++)for(var o in t=arguments[i])Object.prototype.hasOwnProperty.call(t,o)&&(n[o]=t[o]);return n}).apply(this,arguments)},n=n;n.sonification=l(l({},a),{instruments:e.definitions,Earcon:i,Instrument:e,Timeline:r,TimelineEvent:u,TimelinePath:c}),n.Earcon=i,n.Instrument=e,t.compose(n.Chart),s.compose(n.Series),o.compose(n.Point)})});