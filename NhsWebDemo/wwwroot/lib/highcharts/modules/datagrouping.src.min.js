"use strict";!function(a){"object"==typeof module&&module.exports?module.exports=a.default=a:"function"==typeof define&&define.amd?define("highcharts/modules/datagrouping",["highcharts"],function(t){return a(t),a.Highcharts=t,a}):a("undefined"!=typeof Highcharts?Highcharts:void 0)}(function(t){t=t?t._modules:{};function a(t,a,o,e){t.hasOwnProperty(a)||(t[a]=e.apply(null,o))}a(t,"Extensions/DataGrouping.js",[t["Core/Axis/Axis.js"],t["Core/Axis/DateTimeAxis.js"],t["Core/FormatUtilities.js"],t["Core/Globals.js"],t["Core/Series/Point.js"],t["Core/Series/Series.js"],t["Core/Tooltip.js"],t["Core/DefaultOptions.js"],t["Core/Utilities.js"]],function(e,x,t,a,o,i,r,n,s){var g=t.format,D=i.prototype,p=s.addEvent,u=s.arrayMax,l=s.arrayMin,h=s.correctFloat,C=s.defined,G=s.error,c=s.extend,F=s.isNumber,H=s.merge,y=s.pick,j=a.approximations={sum:function(t){var a,o=t.length;if(!o&&t.hasNulls)a=null;else if(o)for(a=0;o--;)a+=t[o];return a},average:function(t){var a=t.length,t=j.sum(t);return t=F(t)&&a?h(t/a):t},averages:function(){var a=[];return[].forEach.call(arguments,function(t){a.push(j.average(t))}),void 0===a[0]?void 0:a},open:function(t){return t.length?t[0]:t.hasNulls?null:void 0},high:function(t){return t.length?u(t):t.hasNulls?null:void 0},low:function(t){return t.length?l(t):t.hasNulls?null:void 0},close:function(t){return t.length?t[t.length-1]:t.hasNulls?null:void 0},hlc:function(t,a,o){if(t=j.high(t),a=j.low(a),o=j.close(o),F(t)||F(a)||F(o))return[t,a,o]},ohlc:function(t,a,o,e){if(t=j.open(t),a=j.high(a),o=j.low(o),e=j.close(e),F(t)||F(a)||F(o)||F(e))return[t,a,o,e]},range:function(t,a){return t=j.low(t),a=j.high(a),F(t)||F(a)?[t,a]:null===t&&null===a?null:void 0}},t=function(t,a,o,e){var i,r,n,s,p,u,l=this,h=l.data,d=l.options&&l.options.data,g=[],c=[],f=[],m=t.length,x=!!a,D=[],G=l.pointArrayMap,y=G&&G.length,v=["x"].concat(G||["y"]),M=this.options.dataGrouping&&this.options.dataGrouping.groupAll,A=0,P=0;for(n="function"==typeof(u=e)?u:j[u]||j[l.getDGApproximation&&l.getDGApproximation()||"average"],y?G.forEach(function(){D.push([])}):D.push([]),s=y||1,p=0;p<=m&&!(t[p]>=o[0]);p++);for(;p<=m;p++){for(;void 0!==o[A+1]&&t[p]>=o[A+1]||p===m;){for(i=o[A],l.dataGroupInfo={start:M?P:l.cropStart+P,length:D[0].length},r=n.apply(l,D),l.pointClass&&!C(l.dataGroupInfo.options)&&(l.dataGroupInfo.options=H(l.pointClass.prototype.optionsToObject.call({series:l},l.options.data[l.cropStart+P])),v.forEach(function(t){delete l.dataGroupInfo.options[t]})),void 0!==r&&(g.push(i),c.push(r),f.push(l.dataGroupInfo)),P=p,k=0;k<s;k++)D[k].length=0,D[k].hasNulls=!1;if(A+=1,p===m)break}if(p===m)break;if(G)for(var b,S=l.options.dataGrouping&&l.options.dataGrouping.groupAll?p:l.cropStart+p,W=h&&h[S]||l.pointClass.prototype.applyOptions.apply({series:l},[d[S]]),k=0;k<y;k++)b=W[G[k]],F(b)?D[k].push(b):null===b&&(D[k].hasNulls=!0);else S=x?a[p]:null,F(S)?D[0].push(S):null===S&&(D[0].hasNulls=!0)}return{groupedXData:g,groupedYData:c,groupMap:f}},s={approximations:j,groupData:t},d=(D.processData,D.generatePoints),f={groupPixelWidth:2,dateTimeLabelFormats:{millisecond:["%A, %b %e, %H:%M:%S.%L","%A, %b %e, %H:%M:%S.%L","-%H:%M:%S.%L"],second:["%A, %b %e, %H:%M:%S","%A, %b %e, %H:%M:%S","-%H:%M:%S"],minute:["%A, %b %e, %H:%M","%A, %b %e, %H:%M","-%H:%M"],hour:["%A, %b %e, %H:%M","%A, %b %e, %H:%M","-%H:%M"],day:["%A, %b %e, %Y","%A, %b %e","-%A, %b %e, %Y"],week:["Week from %A, %b %e, %Y","%A, %b %e","-%A, %b %e, %Y"],month:["%B %Y","%B","-%B %Y"],year:["%Y","%Y","-%Y"]}},m={line:{},spline:{},area:{},areaspline:{},arearange:{},column:{groupPixelWidth:10},columnrange:{groupPixelWidth:10},candlestick:{groupPixelWidth:10},ohlc:{groupPixelWidth:5},hlc:{groupPixelWidth:5},heikinashi:{groupPixelWidth:10}},v=a.defaultDataGroupingUnits=[["millisecond",[1,2,5,10,20,25,50,100,200,500]],["second",[1,2,5,10,15,30]],["minute",[1,2,5,10,15,30]],["hour",[1,2,3,4,6,8,12]],["day",[1]],["week",[1]],["month",[1,3,6]],["year",null]];return D.getDGApproximation=function(){return this.is("arearange")?"range":this.is("ohlc")?"ohlc":this.is("hlc")?"hlc":this.is("column")?"sum":"average"},D.groupData=t,D.applyGrouping=function(t){var a,o=this,e=o.chart,i=o.options.dataGrouping,r=!1!==o.allowDG&&i&&y(i.enabled,e.options.isStock),n=o.visible||!e.options.chart.ignoreHiddenSeries,s=this.currentDataGrouping,p=!1;if(r&&!o.requireSorting&&(o.requireSorting=p=!0),c=!1==(d=t,!((h=o).isCartesian&&!h.isDirty&&!h.xAxis.isDirty&&!h.yAxis.isDirty&&!d))||!r,p&&(o.requireSorting=!1),!c){o.destroyGroupedData();var u=void 0,l=i.groupAll?o.xData:o.processedXData,t=i.groupAll?o.yData:o.processedYData,h=e.plotSizeX,d=o.xAxis,r=d.options.ordinal,p=o.groupPixelWidth;if(p&&l&&l.length){o.isDirty=a=!0,o.points=null;var g=d.getExtremes(),c=g.min,g=g.max,r=r&&d.ordinal&&d.ordinal.getGroupIntervalFactor(c,g,o)||1,f=d.getTimeTicks(x.Additions.prototype.normalizeTimeTickInterval(p*(g-c)/h*r,i.units||v),Math.min(c,l[0]),Math.max(g,l[l.length-1]),d.options.startOfWeek,l,o.closestPointRange),c=D.groupData.apply(o,[l,t,f,i.approximation]),l=c.groupedXData,t=c.groupedYData,m=0;for(i&&i.smoothed&&l.length&&(i.firstAnchor="firstPoint",i.anchor="middle",i.lastAnchor="lastPoint",G(32,!1,e,{"dataGrouping.smoothed":"use dataGrouping.anchor"})),function(t,a,o){var e,i=t.options.dataGrouping,r=t.currentDataGrouping&&t.currentDataGrouping.gapSize,n;if(i&&t.xData&&r&&t.groupMap){var s=a.length-1,p=i.anchor,u=y(i.firstAnchor,p),l=y(i.lastAnchor,p);if(p&&p!=="start"){var h=r*{middle:.5,end:1}[p];n=a.length-1;while(n--&&n>0)a[n]+=h}if(u&&u!=="start"&&t.xData[0]>=a[0]){var d=t.groupMap[0].start,g=t.groupMap[0].length;var c=void 0;if(F(d)&&F(g))c=d+(g-1);a[0]={middle:a[0]+.5*r,end:a[0]+r,firstPoint:t.xData[0],lastPoint:c&&t.xData[c]}[u]}if(l&&l!=="start"&&r&&a[s]>=o-r){var f=t.groupMap[t.groupMap.length-1].start;a[s]={middle:a[s]+.5*r,end:a[s]+r,firstPoint:f&&t.xData[f],lastPoint:t.xData[t.xData.length-1]}[l]}}}(o,l,g),u=1;u<f.length;u++)f.info.segmentStarts&&-1!==f.info.segmentStarts.indexOf(u)||(m=Math.max(f[u]-f[u-1],m));(g=f.info).gapSize=m,o.closestPointRange=f.info.totalRange,o.groupMap=c.groupMap,n&&function(t,a){if(C(a[0])&&F(t.min)&&F(t.dataMin)&&a[0]<t.min){if(!C(t.options.min)&&t.min<=t.dataMin||t.min===t.dataMin)t.min=Math.min(a[0],t.min);t.dataMin=Math.min(a[0],t.dataMin)}if(C(a[a.length-1])&&F(t.max)&&F(t.dataMax)&&a[a.length-1]>t.max){if(!C(t.options.max)&&F(t.dataMax)&&t.max>=t.dataMax||t.max===t.dataMax)t.max=Math.max(a[a.length-1],t.max);t.dataMax=Math.max(a[a.length-1],t.dataMax)}}(d,l),i.groupAll&&(o.allGroupedData=t,l=(d=o.cropData(l,t,d.min,d.max,1)).xData,t=d.yData,o.cropStart=d.start),o.processedXData=l,o.processedYData=t}else o.groupMap=null;o.hasGroupedData=a,o.currentDataGrouping=g,o.preventGraphAnimation=(s&&s.totalRange)!==(g&&g.totalRange)}},D.destroyGroupedData=function(){this.groupedData&&(this.groupedData.forEach(function(t,a){t&&(this.groupedData[a]=t.destroy?t.destroy():null)},this),this.groupedData.length=0)},D.generatePoints=function(){d.apply(this),this.destroyGroupedData(),this.groupedData=this.hasGroupedData?this.points:null},e.prototype.applyGrouping=function(a){var o=this;o.series.forEach(function(t){t.groupPixelWidth=void 0,t.groupPixelWidth=o.getGroupPixelWidth&&o.getGroupPixelWidth(),t.groupPixelWidth&&(t.hasProcessed=!0),t.applyGrouping(!!a.hasExtemesChanged)})},e.prototype.getGroupPixelWidth=function(){for(var t,a,o=this.series,e=o.length,i=0,r=!1,n=e;n--;)(a=o[n].options.dataGrouping)&&(i=Math.max(i,y(a.groupPixelWidth,f.groupPixelWidth)));for(n=e;n--;)(a=o[n].options.dataGrouping)&&(t=(o[n].processedXData||o[n].data).length,(o[n].groupPixelWidth||t>this.chart.plotSizeX/i||t&&a.forced)&&(r=!0));return r?i:0},e.prototype.setDataGrouping=function(a,t){var o;if(t=y(t,!0),a=a||{forced:!1,units:null},this instanceof e)for(o=this.series.length;o--;)this.series[o].update({dataGrouping:a},!1);else this.chart.options.series.forEach(function(t){t.dataGrouping=a},!1);this.ordinal&&(this.ordinal.slope=void 0),t&&this.chart.redraw()},p(e,"postProcessData",e.prototype.applyGrouping),p(o,"update",function(){if(this.dataGroup)return G(24,!1,this.series.chart),!1}),p(r,"headerFormatter",function(t){var a,o,e=this.chart,i=e.time,r=t.labelConfig,n=r.series,s=n.options,p=n.tooltipOptions,u=s.dataGrouping,l=p.xDateFormat,h=n.xAxis,d=p[t.isFooter?"footerFormat":"headerFormat"];h&&"datetime"===h.options.type&&u&&F(r.key)&&(o=n.currentDataGrouping,s=u.dateTimeLabelFormats||f.dateTimeLabelFormats,o?(u=s[o.unitName],1===o.count?l=u[0]:(l=u[1],a=u[2])):!l&&s&&h.dateTime&&(l=h.dateTime.getXDateFormat(r.x,p.dateTimeLabelFormats)),l=i.dateFormat(l,r.key),a&&(l+=i.dateFormat(a,r.key+o.totalRange-1)),n.chart.styledMode&&(d=this.styledModeFormat(d)),t.text=g(d,{point:c(r.point,{key:l}),series:n},e),t.preventDefault())}),p(i,"destroy",D.destroyGroupedData),p(i,"afterSetOptions",function(t){var a=t.options,o=this.type,e=this.chart.options.plotOptions,i=n.defaultOptions.plotOptions[o].dataGrouping,r=this.useCommonDataGrouping&&f;e&&(m[o]||r)&&(i=i||H(f,m[o]),t=this.chart.rangeSelector,a.dataGrouping=H(r,i,e.series&&e.series.dataGrouping,e[o].dataGrouping,this.userOptions.dataGrouping,!a.isInternal&&t&&F(t.selected)&&t.buttonOptions[t.selected].dataGrouping))}),p(e,"afterSetScale",function(){this.series.forEach(function(t){t.hasProcessed=!1})}),a.dataGrouping=s}),a(t,"masters/modules/datagrouping.src.js",[t["Extensions/DataGrouping.js"]],function(t){return t})});